<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>XEP-0163: Personal Eventing Protocol</title><style type="text/css">
/* don't mind this hack */
nav#toc h2:before {
display: none;
content: "XEP-0163";
}
        </style><link rel="stylesheet" type="text/css" href="xmpp.css"><link href="prettify.css" type="text/css" rel="stylesheet"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"><script type="text/javascript" src="prettify.js"></script><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0"><meta name="DC.Title" content="Personal Eventing Protocol"><meta name="DC.Creator" content="Peter Saint-Andre"><meta name="DC.Creator" content="Kevin Smith"><meta name="DC.Description" content="This specification defines semantics for using the XMPP publish-subscribe protocol to broadcast state change events associated with an instant messaging and presence account. This profile of pubsub therefore enables a standard XMPP user account to function as a virtual pubsub service, easing the discovery of syndicated data and event notifications associated with such an account."><meta name="DC.Publisher" content="XMPP Standards Foundation"><meta name="DC.Contributor" content="XMPP Extensions Editor"><meta name="DC.Date" content="2022-02-16"><meta name="DC.Type" content="XMPP Extension Protocol"><meta name="DC.Format" content="XHTML"><meta name="DC.Identifier" content="XEP-0163"><meta name="DC.Language" content="en"><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright © 1999 – 2020 by the XMPP Standards Foundation (XSF)."></head><body onload="prettyPrint()"><h1>XEP-0163: Personal Eventing Protocol</h1><div class="docmeta-wrap"><dl id="docmeta" class="compact"><dt>Abstract</dt><dd>This specification defines semantics for using the XMPP publish-subscribe protocol to broadcast state change events associated with an instant messaging and presence account. This profile of pubsub therefore enables a standard XMPP user account to function as a virtual pubsub service, easing the discovery of syndicated data and event notifications associated with such an account.</dd><dt>Authors</dt><dd><ul class="authors"><li>Peter Saint-Andre</li><li>Kevin Smith</li></ul></dd><dt>Copyright</dt><dd>© 1999 – 2021 XMPP Standards Foundation. <a href="#appendix-legal">SEE LEGAL NOTICES</a>.</dd><dt>Status</dt><dd><p>Stable</p><div id="status-notice" class="draft standards track">NOTICE: The protocol defined herein is a <strong>Stable Standard</strong> of the XMPP Standards Foundation. Implementations are encouraged and the protocol is appropriate for deployment in production systems, but some changes to the protocol are possible before it becomes a Final Standard.</div></dd><dt>Type</dt><dd>Standards Track</dd><dt>Version</dt><dd>1.2.2 (2022-02-16)</dd></dl><div class="timeline-wrap"><div class="timeline-head">Document Lifecycle</div><ol class="timeline"><li>Experimental</li><li>Proposed</li><li class="current">Stable</li><li>Final</li></ol></div></div><nav id="toc"><a href="#top"><h2>Table of Contents</h2></a><ol class="toc"><li><a href="#intro">Introduction</a><ol><li><a href="#motivation">Motivation</a></li><li><a href="#howitworks">How It Works</a></li></ol></li><li><a href="#approach">Concepts and Approach</a><ol><li><a href="#approach-everyjid">Every Account a Pubsub Service</a></li><li><a href="#approach-publisher">One Publisher Per Node</a></li><li><a href="#approach-presence">Use Presence</a></li><li><a href="#approach-filter">Filtered Notifications</a></li><li><a href="#approach-defaults">Smart Defaults</a></li></ol></li><li><a href="#publish">Publishing Events</a></li><li><a href="#notify">Receiving Event Notifications</a><ol><li><a href="#notify-autosubscribe">Automatic Subscriptions</a></li><li><a href="#notify-filterednotifications">Notification Filtering</a></li><li><a href="#notify-generate">Generating Notifications</a><ol><li><a href="#notify-addressing">Addressing</a></li><li><a href="#notify-num">Number of Notifications</a></li><li><a href="#notify-when">When to Generate Notifications</a></li><li><a href="#notify-last">Sending the Last Published Item</a></li></ol></li></ol></li><li><a href="#defaults">Recommended Defaults</a></li><li><a href="#support">Determining Support</a><ol><li><a href="#support-owner">Account Owner Service Discovery</a></li><li><a href="#support-contact">Contact Service Discovery</a></li></ol></li><li><a href="#impl">Implementation Notes</a><ol><li><a href="#impl-subscriptions">Cancelling Subscriptions</a></li><li><a href="#approach-onenode">One Node Per Namespace</a></li></ol></li><li><a href="#security">Security Considerations</a></li><li><a href="#iana">IANA Considerations</a></li><li><a href="#registrar">XMPP Registrar Considerations</a><ol><li><a href="#registrar-disco">Service Discovery Category/Type</a></li></ol></li><li><a href="#schema">XML Schema</a></li><li><a href="#ack">Acknowledgements</a></li></ol><h6><a href="#appendices">Appendices</a></h6><ol class="toc-appendices"><li><a href="#appendix-docinfo">Document Information</a></li><li><a href="#appendix-authorinfo">Author Information</a></li><li><a href="#appendix-legal">Legal Notices</a></li><li><a href="#appendix-xmpp">Relation to XMPP</a></li><li><a href="#appendix-discuss">Discussion Venue</a></li><li><a href="#appendix-conformance">Requirements Conformance</a></li><li><a href="#appendix-notes">Notes</a></li><li><a href="#appendix-revs">Revision History</a></li><li><a href="#appendix-biblatex">Bib(La)Tex Entry</a></li></ol></nav><h2 id="intro">1.
       Introduction<a class="anchor-link" href="#intro"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="motivation">1.1 Motivation<a class="anchor-link" href="#motivation"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">Personal eventing provides a way for a Jabber/XMPP user to send updates or "events" to other users, who are typically contacts in the user's roster. An event can be anything that a user wants to make known to other people, such as those described in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0080.html">User Geolocation (XEP-0080)</a></span>  [<a href="#nt-idm175">1</a>], <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0107.html">User Mood (XEP-0107)</a></span>  [<a href="#nt-idm179">2</a>], <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0108.html">User Activity (XEP-0108)</a></span>  [<a href="#nt-idm183">3</a>], and <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0118.html">User Tune (XEP-0118)</a></span>  [<a href="#nt-idm187">4</a>].  While the XMPP <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0060.html">Publish-Subscribe (XEP-0060)</a></span>  [<a href="#nt-idm191">5</a>] extension ("pubsub") can be used to broadcast such events associated, the full pubsub protocol is often thought of as complicated and therefore has not been widely implemented.
     [<a href="#nt-idm193">6</a>] To make publish-subscribe functionality more accessible (especially to instant messaging and presence applications that conform to <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc6121">XMPP IM</a></span>  [<a href="#nt-idm196">7</a>]), this document defines a simplified subset of pubsub that can be followed by instant messaging client and server developers to more easily deploy personal eventing services across the Jabber/XMPP network. We label this subset "Personal Eventing Protocol" or PEP.</p>
    <p class="em" style="">Note: Any use cases not described herein are described in <span class="ref">XEP-0060</span>. Also, this document does not show error flows related to the generic publish-subscribe use cases referenced herein, since they are exhaustively defined in <span class="ref">XEP-0060</span>. The reader is referred to <span class="ref">XEP-0060</span> for all relevant protocol details related to the XMPP publish-subscribe extension. This document merely defines a "subset" or "profile" of XMPP publish-subscribe.</p>
  </div>
  <div class="indent"><h3 id="howitworks">1.2 How It Works<a class="anchor-link" href="#howitworks"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">This section provides a friendly introduction to personal eventing via pubsub (PEP).</p>
    <p class="" style="">Imagine that you are a Shakespearean character named Juliet and that you want to generate events about what music you're listening to, which anyone may see as long as they are authorized to see your online/offline presence (i.e., a pubsub access model of "presence").</p>
    <p class="" style="">We assume that you have three contacts with the following relationship to you:</p>
    <ol start="1" class="" style="">
      <li class="" style="">benvolio@montague.lit, who has no subscription to your presence</li>
      <li class="" style="">nurse@capulet.lit, who has a bidirectional subscription to your presence and who is in your "Servants" roster group</li>
      <li class="" style="">romeo@montague.lit, who has a bidirectional subscription to your presence and who is in your "Friends" roster group</li>
    </ol>
    <p class="" style="">We also assume that your server (capulet.lit) supports PEP and that your client discovered that support when you logged in.</p>
    <p class="" style="">Now you start playing a song on your music playing software. Your client captures that "event" and publishes it to your server:</p>
    <figure class="code-example" id="example-1"><figcaption><strong>Example 1.</strong> Publishing an event<a class="anchor-link" href="#example-1"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony' type='set' id='pub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='http://jabber.org/protocol/tune'&gt;
      &lt;item&gt;
        &lt;tune xmlns='http://jabber.org/protocol/tune'&gt;
          &lt;artist&gt;Gerald Finzi&lt;/artist&gt;
          &lt;length&gt;255&lt;/length&gt;
          &lt;source&gt;Music for "Love's Labors Lost" (Suite for small orchestra)&lt;/source&gt;
          &lt;title&gt;Introduction (Allegro vigoroso)&lt;/title&gt;
          &lt;track&gt;1&lt;/track&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">Note the following about your publish request:</p>
    <ol start="1" class="" style="">
      <li class="" style="">It is sent with no 'to' address (see <a href="#approach-everyjid">Every Account a Pubsub Service</a>).</li>
      <li class="" style="">It specifies a node of "http://jabber.org/protocol/tune" (see <a href="#approach-onenode">One Node per Namespace</a>).</li>
    </ol>
    <p class="" style="">If all goes well (see <a href="#publish">Publishing Events</a>), everyone who is interested in what you are listening to will receive notification of the event:</p>
    <figure class="code-example" id="example-2"><figcaption><strong>Example 2.</strong> Interested parties receive event notifications<a class="anchor-link" href="#example-2"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='juliet@capulet.lit'
         to='romeo@montague.lit/orchard'
         type='headline'
         id='tunefoo1'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='http://jabber.org/protocol/tune'&gt;
      &lt;item&gt;
        &lt;tune xmlns='http://jabber.org/protocol/tune'&gt;
          &lt;artist&gt;Gerald Finzi&lt;/artist&gt;
          &lt;length&gt;255&lt;/length&gt;
          &lt;source&gt;Music for "Love's Labors Lost" (Suite for small orchestra)&lt;/source&gt;
          &lt;title&gt;Introduction (Allegro vigoroso)&lt;/title&gt;
          &lt;track&gt;1&lt;/track&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message from='juliet@capulet.lit'
         to='nurse@capulet.lit/chamber'
         type='headline'
         id='tunefoo2'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='http://jabber.org/protocol/tune'&gt;
      &lt;item&gt;
        &lt;tune xmlns='http://jabber.org/protocol/tune'&gt;
          &lt;artist&gt;Gerald Finzi&lt;/artist&gt;
          &lt;length&gt;255&lt;/length&gt;
          &lt;source&gt;Music for "Love's Labors Lost" (Suite for small orchestra)&lt;/source&gt;
          &lt;title&gt;Introduction (Allegro vigoroso)&lt;/title&gt;
          &lt;track&gt;1&lt;/track&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
    <p class="" style="">Because PEP services must send notifications to the account owner, you too receive the notification at each of your resources (here "balcony" and "chamber").</p>
    <figure class="code-example" id="example-3"><figcaption><strong>Example 3.</strong> Publisher receives event notification<a class="anchor-link" href="#example-3"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='juliet@capulet.lit'
         to='juliet@capulet.lit/balcony'
         type='headline'
         id='tunefoo3'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='http://jabber.org/protocol/tune'&gt;
      &lt;item&gt;
        &lt;tune xmlns='http://jabber.org/protocol/tune'&gt;
          &lt;artist&gt;Gerald Finzi&lt;/artist&gt;
          &lt;length&gt;255&lt;/length&gt;
          &lt;source&gt;Music for "Love's Labors Lost" (Suite for small orchestra)&lt;/source&gt;
          &lt;title&gt;Introduction (Allegro vigoroso)&lt;/title&gt;
          &lt;track&gt;1&lt;/track&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message from='juliet@capulet.lit'
         to='juliet@capulet.lit/chamber'
         type='headline'
         id='tunefoo4'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='http://jabber.org/protocol/tune'&gt;
      &lt;item&gt;
        &lt;tune xmlns='http://jabber.org/protocol/tune'&gt;
          &lt;artist&gt;Gerald Finzi&lt;/artist&gt;
          &lt;length&gt;255&lt;/length&gt;
          &lt;source&gt;Music for "Love's Labors Lost" (Suite for small orchestra)&lt;/source&gt;
          &lt;title&gt;Introduction (Allegro vigoroso)&lt;/title&gt;
          &lt;track&gt;1&lt;/track&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
    <p class="" style="">But how do Romeo and the Nurse tell your server that they are interested in knowing what you're listening to? In generic pubsub they typically need to explicitly subscribe to your "http://jabber.org/protocol/tune" node.  [<a href="#nt-idm225">8</a>] But PEP services support two special features:</p>
    <ol start="" class="" style="">
      <li class="" style="">"auto-subscribe" -- because they are subscribed to your presence, they automatically receive your events (see <a href="#approach-presence">Use Presence</a>).</li>
      <li class="" style="">"filtered-notification" -- they can include some special flags in their <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0115.html">Entity Capabilities (XEP-0115)</a></span>  [<a href="#nt-idm232">9</a>] information to specify which event types (payloads) they want to receive (see <a href="#approach-filter">Filtered Notifications</a>).</li>
    </ol>
    <figure class="code-example" id="example-4"><figcaption><strong>Example 4.</strong> Romeo sends presence with caps<a class="anchor-link" href="#example-4"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;presence from='romeo@montague.lit/orchard'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     hash='sha-1'
     node='http://www.chatopus.com'
     ver='zHyEOgxTrkpSdGcQKH8EFPLsriY='/&gt;
&lt;/presence&gt;
</pre></figure>
    <p class="" style="">Your server knows to send tune information to Romeo because when the server unpacks the value of the 'ver' attribute ("054H4A7280JuT6+IroVYxgCAjZo=") in accordance with <span class="ref">XEP-0115</span>, it discovers that Romeo's client advertises a service discovery feature of "http://jabber.org/protocol/tune+notify", where the "+notify" suffix indicates interest in receiving notifications of the node whose NodeID precedes the suffix (see <span class="ref">XEP-0060 § 9.2</span>). The server can verify this support if needed by sending a service discovery request to Romeo's full JID, where the response would be as follows:</p>
    <figure class="code-example" id="example-5"><figcaption><strong>Example 5.</strong> Disco#info result from extension<a class="anchor-link" href="#example-5"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='romeo@montague.lit/orchard'
    to='juliet@capulet.lit'
    type='result'
    id='disco123'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity category='client' name='Exodus 0.9.1' type='pc'/&gt;
    &lt;feature var='http://jabber.org/protocol/disco#info'/&gt;
    &lt;feature var='http://jabber.org/protocol/disco#items'/&gt;
    &lt;feature var='http://jabber.org/protocol/geoloc'/&gt;
    &lt;feature var='http://jabber.org/protocol/geoloc+notify'/&gt;
    &lt;feature var='http://jabber.org/protocol/tune'/&gt;
    &lt;feature var='http://jabber.org/protocol/tune+notify'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">Naturally your server doesn't need to send out a disco#info request every time, since it will quickly create a large cache of 'ver' values.</p>
    <p class="" style="">So that's the general idea.</p>
  </div>
<h2 id="approach">2.
       Concepts and Approach<a class="anchor-link" href="#approach"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">Personal eventing via pubsub ("PEP") is based on the following principles:</p>
  <ol start="1" class="" style="">
    <li class="" style="">Every account a pubsub service.</li>
    <li class="" style="">One publisher per node.</li>
    <li class="" style="">Use presence.</li>
    <li class="" style="">Filter notifications based on expressed interest.</li>
    <li class="" style="">Smart defaults.</li>
  </ol>
  <p class="" style="">These principles are described more fully below.</p>
  <div class="indent"><h3 id="approach-everyjid">2.1 Every Account a Pubsub Service<a class="anchor-link" href="#approach-everyjid"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">When a user creates an account (or has an account provisioned) at a Jabber/XMPP server that supports PEP, the server associates a virtual pubsub service with the account. This greatly simplifies the task of discovering the account owner's personal pubsub nodes, since the root pubsub node simply is the account owner's bare JID (&lt;localpart@domain.tld&gt; or &lt;domain.tld&gt;). This assumption also simplifies publishing and subscribing.</p>
  </div>
  <div class="indent"><h3 id="approach-publisher">2.2 One Publisher Per Node<a class="anchor-link" href="#approach-publisher"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">There is no need for multiple publishers to a PEP service, since by definition the service generates information associated with only one entity. The owner-publisher for every node is the bare JID of the account owner.</p>
  </div>
  <div class="indent"><h3 id="approach-presence">2.3 Use Presence<a class="anchor-link" href="#approach-presence"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">Although generic publish-subscribe services do not necessarily have access to presence information about subscribers, PEP services are integrated with presence in the following ways:</p>
    <ul class="" style="">
      <li class="" style="">Each messaging and presence account simply <em>is</em> a virtual publish-subscribe service.</li>
      <li class="" style="">The default access model is "presence".</li>
      <li class="" style="">A contact's subscription to an account owner's personal eventing data is automatically created because the contact has an XMPP presence subscription (the "auto-subscribe" feature).</li>
      <li class="" style="">Services take account of subscriber presence in the generation of notifications.  [<a href="#nt-idm263">10</a>]</li>
      <li class="" style="">A service automatically sends notifications to all of the account owner's connected resources (subject to notification filtering).</li>
    </ul>
    <p class="" style="">These uses of presence simplify the task of developing compliant clients (cf. <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0134.html">XMPP Design Guidelines (XEP-0134)</a></span>  [<a href="#nt-idm269">11</a>]).</p>
    <p class="box" style="">Note: It is strongly NOT RECOMMENDED to use directed presence with Entity Capabilities data that differs from the data included in broadcast presence for the purpose of establishing implicit PEP subscriptions to another entity, because the directed presence information will be overwritten by any subsequent presence broadcast.</p>
  </div>
  <div class="indent"><h3 id="approach-filter">2.4 Filtered Notifications<a class="anchor-link" href="#approach-filter"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">By default, the existence of an XMPP presence subscription is used to establish a PEP subscription to the account owner's personal eventing data. In order to filter which notifications are sent by the PEP service, the contact's client includes extended <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0115.html">Entity Capabilities (XEP-0115)</a></span>  [<a href="#nt-idm232">9</a>] information in the presence notifications it sends to the account owner. Because the PEP service supports the "filtered-notifications" feature, it sends only those notifications that match the contact's expressed notification preferences.</p>
  </div>
  <div class="indent"><h3 id="approach-defaults">2.5 Smart Defaults<a class="anchor-link" href="#approach-defaults"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">Most pubsub configuration options and metadata are not needed for personal eventing. Instead, PEP services offer smart defaults to simplify node creation and management.</p>
  </div>
<h2 id="publish">3.
       Publishing Events<a class="anchor-link" href="#publish"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">An account owner publishes an item to a node by following the protocol specified in <span class="ref">XEP-0060</span>:</p>
  <figure class="code-example" id="example-6"><figcaption><strong>Example 6.</strong> Account owner publishes item<a class="anchor-link" href="#example-6"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony' type='set' id='pub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='http://jabber.org/protocol/tune'&gt;
      &lt;item&gt;
        &lt;tune xmlns='http://jabber.org/protocol/tune'&gt;
          &lt;artist&gt;Gerald Finzi&lt;/artist&gt;
          &lt;length&gt;255&lt;/length&gt;
          &lt;source&gt;Music for "Love's Labors Lost" (Suite for small orchestra)&lt;/source&gt;
          &lt;title&gt;Introduction (Allegro vigoroso)&lt;/title&gt;
          &lt;track&gt;1&lt;/track&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
  <p class="" style="">If the node does not already exist, the PEP service MUST create the node. This "auto-create" feature (defined in <span class="ref">XEP-0060</span>) MUST be supported by a PEP service. (Naturally, the account owner's client MAY follow the node creation use case specified in <span class="ref">XEP-0060</span> before attempting to publish an item.)</p>
  <p class="" style="">A PEP service SHOULD also support the "publish-options" feature defined in <span class="ref">XEP-0060</span>.</p>
  <p class="" style="">If the publication logic dictates that event notifications shall be sent, the account owner's server generates notifications and sends them to all appropriate entities as described in the <a href="#notify">Receiving Event Notifications</a> section of this document, as well as to any of the account owner's available resources.</p>
  <p class="box" style="">Note: PEP ties the receipt of PEP notifications to the subscriber's presence, but does not tie the generation of PEP notifications to the publisher's presence. If the publisher wishes to stop generating PEP events (or to generate an "empty" event as can be done for some PEP payloads) before ending its presence session, the publisher MUST direct its client to do so and MUST NOT depend on the PEP service to automatically "zero out" its PEP information when the PEP service receives unavailable presence from the publisher.</p>
<h2 id="notify">4.
       Receiving Event Notifications<a class="anchor-link" href="#notify"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">An entity shall receive event notifications if:</p>
  <ol start="1" class="" style="">
    <li class="" style="">The node has an open access model and the entity has explicitly or implicitly subscribed to the node as explained in <span class="ref">XEP-0060</span>.</li>
    <li class="" style="">The entity shares presence with the account owner (see <a href="#notify-presence">Presence Sharing</a>), is authorized to receive events from the node in accordance with the node access model (see <span class="ref">XEP-0060</span>), and advertises an interest in the payload type (see <a href="#notify-filter">Notification Filtering</a>).</li>
    <li class="" style="">The entity is the account owner itself, in which case the PEP service shall send notifications to all of the account owner's available resources (subject to <a href="#notify-filter">notification filtering</a>).</li>
  </ol>
  <div class="indent"><h3 id="notify-autosubscribe">4.1 Automatic Subscriptions<a class="anchor-link" href="#notify-autosubscribe"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A PEP service MUST support the "auto-subscribe" feature defined in Section 9.1 of <span class="ref">XEP-0060</span>. This implies that when a user has an XMPP presence subscription to the account owner's presence, the user automatically also has the right to subscribe to any of the account owner's PEP nodes (if the access model is the default of "presence") and to retrieve items from such PEP nodes.</p>
  </div>
  <div class="indent"><h3 id="notify-filterednotifications">4.2 Notification Filtering<a class="anchor-link" href="#notify-filterednotifications"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A PEP service MUST support the "filtered-notifications" feature defined in Section 9.2 of <span class="ref">XEP-0060</span>. This implies that when an automatic subscriber can specify which event payloads it wants to receive by including appropriate feature bundles in the <span class="ref">XEP-0115</span> information it broadcasts.</p>
  </div>
  <div class="indent"><h3 id="notify-generate">4.3 Generating Notifications<a class="anchor-link" href="#notify-generate"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <div class="indent"><h4 id="notify-addressing">4.3.1 Addressing<a class="anchor-link" href="#notify-addressing"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <ol start="1" class="" style="">
        <li class="" style=""><p class="" style="">The server MUST set the 'from' address on the notification to the bare JID (&lt;localpart@domain.tld&gt; or &lt;domain.tld&gt;) of the account owner (in these examples, "juliet@capulet.lit").</p></li>
        <li class="" style=""><p class="" style="">Any errors generated by the recipient or the recipient's server in relation to the notification MUST be directed to the JID of the 'from' address on the notification (i.e., the bare JID) so that bounce processing can be handled by the PEP service rather than by the publishing client.</p></li>
        <li class="" style=""><p class="" style="">When sending notifications to an entity that has a presence subscription to the account owner, the server SHOULD include an <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0033.html">Extended Stanza Addressing (XEP-0033)</a></span>  [<a href="#nt-idm321">12</a>] "replyto" extension specifying the publishing resource (in this example, "juliet@capulet.lit/balcony"); this enables the subscriber's client to differentiate between information received from each of the account owner's resources (for example, different resources may be in different places and therefore may need to specify distinct geolocation data). However, a server MUST NOT include the "replyto" address when sending a notification to an entity that does not have a presence subscription to the account owner.</p></li>
        <li class="" style=""><p class="" style="">If the PEP service has presence information about the intended recipient, it SHOULD direct the notification(s) to the full JID(s) of the recipient's (&lt;localpart@domain.tld/resource&gt; or &lt;domain.tld/resource&gt;); if the PEP service does not have presence information about a subscriber, it MUST address the notification to the subscriber's bare JID (&lt;localpart@domain.tld&gt; or &lt;domain.tld&gt;).</p></li>
      </ol>
    </div>
    <div class="indent"><h4 id="notify-num">4.3.2 Number of Notifications<a class="anchor-link" href="#notify-num"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <ol start="1" class="" style="">
        <li class="" style=""><p class="" style="">If an entity subscribed using a full JID (&lt;localpart@domain.tld/resource&gt; or &lt;domain.tld/resource&gt;) or a bare domain identifier &lt;domain.tld&gt;, a PEP service MUST send one notification only, addressed to the subscribed JID.</p></li>
        <li class="" style=""><p class="" style="">If a subscriber subscribed using a bare JID &lt;localpart@domain.tld&gt; and a PEP service does not have appropriate presence information about the subscriber, a PEP service MUST send at most one notification, addressed to the bare JID &lt;localpart@domain.tld&gt; of the subscriber, and MAY choose not to send any notification. (By "appropriate presence information" is meant an available presence stanza with <span class="ref">XEP-0115</span> data that indicates interest in the relevant data format.)</p></li>
        <li class="" style=""><p class="" style="">If a subscriber subscribed using a bare JID &lt;localpart@domain.tld&gt; and a PEP service has appropriate presence information about the subscriber, the PEP service MUST send one notification to the full JID (&lt;localpart@domain.tld/resource&gt; or &lt;domain.tld/resource&gt;) of each of the subscriber's available resources that have included <span class="ref">XEP-0115</span> information indicating an interest in the data format.</p></li>
      </ol>
    </div>
    <div class="indent"><h4 id="notify-when">4.3.3 When to Generate Notifications<a class="anchor-link" href="#notify-when"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <ol start="1" class="" style="">
        <li class="" style=""><p class="" style="">When an account owner publishes an item to a node, a PEP service MUST generate a notification and send it to all appropriate subscribers (where the number of notifications is determined by the foregoing rules).</p></li>
        <li class="" style=""><p class="" style="">When a PEP service receives initial presence  [<a href="#nt-idm341">13</a>] from a subscriber's resource including <span class="ref">XEP-0115</span> information that indicates an interest in the data format, it MUST generate a notification containing at least the last published item for that node and send it to the newly-available resource; see below under <a href="#notify-last">Sending the Last Published Item</a>.</p></li>
        <li class="" style=""><p class="" style="">As an exception to the foregoing MUST rules, a PEP service MUST NOT send notifications to a subscriber if the user has blocked the subscriber from receiving the kind of stanza used for notifications (typically message stanzas) by means of communications blocking as specified in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0016.html">Privacy Lists (XEP-0016)</a></span>  [<a href="#nt-idm348">14</a>] or <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0191.html">Blocking Command (XEP-0191)</a></span>  [<a href="#nt-idm352">15</a>].</p></li>
      </ol>
    </div>
    <div class="indent"><h4 id="notify-last">4.3.4 Sending the Last Published Item<a class="anchor-link" href="#notify-last"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">As mentioned, a PEP service MUST send the last published item to all new subscribers and to all newly-available resources for each subscriber, including the account owner itself. (That is, the default value of the "pubsub#send_last_published_item" node configuration field must be "on_sub_and_presence"; this behavior essentially mimics the functionality of presence as defined in <span class="ref">XMPP IM</span>.) When processing a new subscription, the service MAY send not only the last published item but instead all items that are currently associated with the node (i.e., up to the maximum number of items at the node, which might be one if the node is a "singleton node" as described in <span class="ref">XEP-0060</span>). If the service has knowledge about the datetime that a subscriber's newly-available resource last received updated information from the node (e.g., as described in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0256.html">Last Activity in Presence (XEP-0256)</a></span>  [<a href="#nt-idm360">16</a>]), then it MAY also send more items than only the last published item to the newly-available resource.</p>
      <p class="box" style="">Note: The "on_sub_and_presence" setting relates to the <em>subscriber's</em> presence, not the publisher's presence.</p>
      <figure class="code-example" id="example-7"><figcaption><strong>Example 7.</strong> Subscriber sends presence from newly-available resource<a class="anchor-link" href="#example-7"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;presence from='romeo@montague.lit/orchard'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     hash='sha-1'
     node='http://www.chatopus.com'
     ver='zHyEOgxTrkpSdGcQKH8EFPLsriY='/&gt;
&lt;/presence&gt;
</pre></figure>
      <figure class="code-example" id="example-8"><figcaption><strong>Example 8.</strong> Subscriber's server sends presence from newly-available resource to publisher's bare JID (i.e., PEP service)<a class="anchor-link" href="#example-8"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;presence from='romeo@montague.lit/orchard' to='juliet@capulet.lit'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     hash='sha-1'
     node='http://www.chatopus.com'
     ver='zHyEOgxTrkpSdGcQKH8EFPLsriY='/&gt;
&lt;/presence&gt;
</pre></figure>
      <figure class="code-example" id="example-9"><figcaption><strong>Example 9.</strong> PEP service sends last published item to newly-available resource<a class="anchor-link" href="#example-9"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='juliet@capulet.lit'
         to='romeo@montague.lit/orchard'
         type='headline'
         id='foo'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='http://jabber.org/protocol/tune'&gt;
      &lt;item&gt;
        &lt;tune xmlns='http://jabber.org/protocol/tune'&gt;
          &lt;artist&gt;Gerald Finzi&lt;/artist&gt;
          &lt;length&gt;255&lt;/length&gt;
          &lt;source&gt;Music for "Love's Labors Lost" (Suite for small orchestra)&lt;/source&gt;
          &lt;title&gt;Introduction (Allegro vigoroso)&lt;/title&gt;
          &lt;track&gt;1&lt;/track&gt;
        &lt;/tune&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
  &lt;delay xmlns='urn:xmpp:delay' stamp='2003-12-13T23:58:37Z'/&gt;
&lt;/message&gt;
</pre></figure>
    </div>
  </div>
<h2 id="defaults">5.
       Recommended Defaults<a class="anchor-link" href="#defaults"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">A PEP service MUST:</p>
  <ul class="" style="">
    <li class="" style="">Support the node discovery, node creation, node deletion, publish item, subscribe, unsubscribe, and item retrieval use cases specified in <span class="ref">XEP-0060</span>.</li>
    <li class="" style="">Support the "auto-create", "auto-subscribe", and "filtered-notifications" features.</li>
    <li class="" style="">Support the "owner" and "subscriber" affiliations.</li>
    <li class="" style="">Support the "presence" access model and set it to the default.</li>
    <li class="" style="">Support the "open", "roster", and "whitelist" access models.</li>
    <li class="" style="">Treat the account owner's bare JID (&lt;localpart@domain.tld&gt; or &lt;domain.tld&gt;) as a collection node (i.e., as the root collection node for the account's virtual pubsub service).</li>
    <li class="" style="">Default the 'deliver_notifications' configuration option to true (i.e., deliver payloads by default).</li>
    <li class="" style="">Default the 'send_last_published_item' configuration option to on_sub_and_presence (i.e., send the last published item on subscription and on receipt of presence).  [<a href="#nt-idm379">17</a>]</li>
  </ul>
  <p class="" style="">A PEP service MAY support other use cases, affiliations, access models, and features, but such support is OPTIONAL.</p>
<h2 id="support">6.
       Determining Support<a class="anchor-link" href="#support"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="support-owner">6.1 Account Owner Service Discovery<a class="anchor-link" href="#support-owner"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">Naturally, before an account owner attempts to complete any PEP use cases, its client SHOULD determine whether the account owner's server supports PEP; to do so, it MUST send a <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0030.html">Service Discovery (XEP-0030)</a></span>  [<a href="#nt-idm386">18</a>] information request to its own bare JID:</p>
    <figure class="code-example" id="example-10"><figcaption><strong>Example 10.</strong> Account owner queries server regarding protocol support<a class="anchor-link" href="#example-10"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='juliet@capulet.lit'
    id='disco1'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">If the account owner's server supports PEP and the account is provisioned for PEP, the server MUST return an identity of "pubsub/pep" on behalf of the account (as well as a list of the namespaces and other features it supports, including all supported <span class="ref">XEP-0060</span> features):</p>
    <figure class="code-example" id="example-11"><figcaption><strong>Example 11.</strong> Server communicates protocol support<a class="anchor-link" href="#example-11"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit'
    to='juliet@capulet.lit/balcony'
    id='disco1'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity category='account' type='registered'/&gt;
    &lt;identity category='pubsub' type='pep'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#access-presence'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#auto-create'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#auto-subscribe'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#config-node'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#create-and-configure'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#create-nodes'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#filtered-notifications'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#persistent-items'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#publish'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#retrieve-items'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#subscribe'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
</pre></figure>
  </div>
  <div class="indent"><h3 id="support-contact">6.2 Contact Service Discovery<a class="anchor-link" href="#support-contact"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A contact MAY send service discovery requests to the account owner's bare JID (&lt;localpart@domain.tld&gt; or &lt;domain.tld&gt;). If the contact already has a subscription to the account owner's presence, this is not necessary in order to receive notifications from the account owner via personal eventing. However, a user without a presence subscription needs to do so in order to discover if the account owner is a virtual pubsub service and to discover the account owner's eventing nodes. The relevant protocol flows are demonstrated in <span class="ref">XEP-0060</span>.</p>
    <p class="" style="">Note: When returning disco#items results, the account owner's server MUST check the access model for each of the account owner's PEP nodes and MUST return as service discovery items only those nodes to which the contact is allowed to subscribe or from which the contact is allowed to retrieve items without first subscribing.</p>
  </div>
<h2 id="impl">7.
       Implementation Notes<a class="anchor-link" href="#impl"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="impl-subscriptions">7.1 Cancelling Subscriptions<a class="anchor-link" href="#impl-subscriptions"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">In order to ensure appropriate access to information published at nodes of type "presence" and "roster", a PEP service MUST re-calculate access controls when:</p>
    <ol start="1" class="" style="">
      <li class="" style="">A presence subscription state changes (e.g., when a subscription request is approved).</li>
      <li class="" style="">A roster item is modified (e.g., when the item is moved to a new roster group).</li>
    </ol>
    <p class="" style="">If the modification results in a loss of access, the service MUST cancel the entity's subscription. In addition, the service MAY send a message to the (former) subscriber informing it of the cancellation (for information about the format of messages sent to notify subscribers of subscription cancellation, see the "Notification of Subscription Denial or Cancellation" section of <span class="ref">XEP-0060</span>).</p>
  </div>
  <div class="indent"><h3 id="approach-onenode">7.2 One Node Per Namespace<a class="anchor-link" href="#approach-onenode"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">An earlier version of this document specified that there could be only one publish-subscribe node associated with any given payload type (XML namespace) for the account owner (e.g., there could be only one pubsub node for geolocation events, one node for tune events, and one node for mood events, etc.). However, this rule is now considered overly restrictive because some data formats can be used to encapsulate many different kinds of information; the usual example is Atom as defined in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc4287">RFC 4287</a></span>  [<a href="#nt-idm408">19</a>], for which many extensions exist. Therefore, this document now does not specify that there is a one-to-one relationship between NodeIDs and payload namespaces.</p>
    <p class="" style="">A specification that defines a given payload format for use in PEP MUST specify whether there shall be only one node per namespace, or whether multiple NodeIDs for the same namespace are allowable.</p>
  </div>
<h2 id="security">8.
       Security Considerations<a class="anchor-link" href="#security"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">A PEP service MAY enforce additional privacy and security policies when determining whether an entity is allowed to subscribe to a node or retrieve items from a node; however, any such policies shall be considered specific to an implementation or deployment and are out of scope for this document.</p>
<h2 id="iana">9.
       IANA Considerations<a class="anchor-link" href="#iana"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">This document requires no interaction with the <span class="ref" style=""><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-idm417">20</a>].</p>
<h2 id="registrar">10.
       XMPP Registrar Considerations<a class="anchor-link" href="#registrar"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="registrar-disco">10.1 Service Discovery Category/Type<a class="anchor-link" href="#registrar-disco"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The <span class="ref" style=""><a href="https://xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-idm424">21</a>] includes a category of "pubsub" in its registry of Service Discovery identities (see &lt;<a href="https://xmpp.org/registrar/disco-categories.html">https://xmpp.org/registrar/disco-categories.html</a>&gt;); as a result of this document, the Registrar includes a type of "pep" to that category.</p>
    <p class="" style="">The registry submission is as follows:</p>
    <figure class="code"><figcaption></figcaption><pre class="prettyprint">
&lt;category&gt;
  &lt;name&gt;pubsub&lt;/name&gt;
  &lt;type&gt;
    &lt;name&gt;pep&lt;/name&gt;
    &lt;desc&gt;
      A personal eventing service that supports the
      publish-subscribe subset defined in XEP-0163.
    &lt;/desc&gt;
    &lt;doc&gt;XEP-0163&lt;/doc&gt;
  &lt;/type&gt;
&lt;/category&gt;
</pre></figure>
  </div>
<h2 id="schema">11.
       XML Schema<a class="anchor-link" href="#schema"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">Because PEP simply reuses the protocol specified in <span class="ref">XEP-0060</span>, a separate schema is not needed.</p>
<h2 id="ack">12.
       Acknowledgements<a class="anchor-link" href="#ack"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">The authors wish to thank the participants in the XMPP Interoperability Testing Event held July 24 and 25, 2006, who provided valuable feedback that resulted in radical simplification of the protocol.</p>
  <p class="" style="">Thanks also to the many members of the standards@xmpp.org discussion list who patiently suffered through seemingly endless discussion of the auto-create and publish-and-configure features.</p>
<hr><a name="appendices"></a><h2>Appendices</h2><h3 id="appendix-docinfo">Appendix A: Document Information<a class="anchor-link" href="#appendix-docinfo"><abbr title="Link to this point in the document">¶</abbr></a></h3><dl class="compact"><dt>Series</dt><dd><a href="https://xmpp.org/extensions/">XEP</a></dd><dt>Number</dt><dd>0163</dd><dt>Publisher</dt><dd><a href="/xsf/">XMPP Standards Foundation</a></dd><dt>Status</dt><dd><a href="https://xmpp.org/extensions/xep-0001.html#states-Draft">Draft</a></dd><dt>Type</dt><dd><a href="https://xmpp.org/extensions/xep-0001.html#types-Standards%20Track">Standards Track</a></dd><dt>Version</dt><dd>1.2.2</dd><dt>Last Updated</dt><dd>2022-02-16</dd><dt>Approving Body</dt><dd><a href="https://xmpp.org/council/">XMPP Council</a></dd><dt>Dependencies</dt><dd>XMPP Core, XMPP IM, <a href="xep-0030.html">XEP-0030</a>, <a href="xep-0060.html">XEP-0060</a>, <a href="xep-0115.html">XEP-0115</a></dd><dt>Supersedes</dt><dd>None</dd><dt>Superseded By</dt><dd>None</dd><dt>Short Name</dt><dd>pep</dd><dt>Source Control</dt><dd><a class="standardsButton" href="https://github.com/xsf/xeps/blob/master/xep-0163.xml">HTML</a></dd></dl><p>
          This document in other formats:
          <a class="standardsButton" href="https://xmpp.org/extensions/xep-0163.xml">XML</a> 
          <a class="standardsButton" href="https://xmpp.org/extensions/xep-0163.pdf">PDF</a></p><h3 id="appendix-authorinfo">Appendix B: Author Information<a class="anchor-link" href="#appendix-authorinfo"><abbr title="Link to this point in the document">¶</abbr></a></h3><h5>Peter Saint-Andre</h5><dl class="compact"><dt>Email</dt><dd><a href="mailto:xsf@stpeter.im">xsf@stpeter.im</a></dd><dt>JabberID</dt><dd><a href="xmpp:peter@jabber.org">peter@jabber.org</a></dd><dt>URI</dt><dd><a href="http://stpeter.im/">http://stpeter.im/</a></dd></dl><h5>Kevin Smith</h5><dl class="compact"><dt>Email</dt><dd><a href="mailto:kevin@kismith.co.uk">kevin@kismith.co.uk</a></dd><dt>JabberID</dt><dd><a href="xmpp:kevin@doomsong.co.uk">kevin@doomsong.co.uk</a></dd></dl><h3 id="appendix-legal">Appendix C: Legal Notices<a class="anchor-link" href="#appendix-legal"><abbr title="Link to this point in the document">¶</abbr></a></h3><div class="indent"><h4>Copyright</h4><p>This XMPP Extension Protocol is copyright © 1999 – 2020 by the <a href="https://xmpp.org/">XMPP Standards Foundation</a> (XSF).</p><h4>Permissions</h4><p>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.</p><h4>Disclaimer of Warranty</h4><p class="box info">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. ##</p><h4>Limitation of Liability</h4><p>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.</p><h4>IPR Conformance</h4><p>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which can be found at &lt;<a href="https://xmpp.org/about/xsf/ipr-policy">https://xmpp.org/about/xsf/ipr-policy</a>&gt; or obtained by writing to XMPP Standards Foundation, P.O. Box 787, Parker, CO 80134 USA).</p><h4>Visual Presentation</h4><p>The HTML representation (you are looking at) is maintained by the XSF. It is based on the <a href="http://yaml.de">YAML CSS Framework</a>, which is licensed under the terms of the <a href="https://creativecommons.org/licenses/by/2.0/">CC-BY-SA 2.0</a> license.</p></div><h3 id="appendix-xmpp">Appendix D: Relation to XMPP<a class="anchor-link" href="#appendix-xmpp"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 6120) and XMPP IM (RFC 6121) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><h3 id="appendix-discuss">Appendix E: Discussion Venue<a class="anchor-link" href="#appendix-discuss"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">The primary venue for discussion of XMPP Extension Protocols is the &lt;<a href="https://mail.jabber.org/mailman/listinfo/standards">standards@xmpp.org</a>&gt; discussion list.</p><p class="indent">Discussion on other xmpp.org discussion lists might also be appropriate; see &lt;<a href="https://xmpp.org/about/discuss.shtml">https://xmpp.org/about/discuss.shtml</a>&gt; for a complete list.</p><p class="indent">Errata can be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><h3 id="appendix-conformance">Appendix F: Requirements Conformance<a class="anchor-link" href="#appendix-conformance"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">The following requirements keywords as used in this document are to be interpreted as described in <a href="https://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><h3 id="appendix-notes">Appendix G: Notes<a class="anchor-link" href="#appendix-notes"><abbr title="Link to this point in the document">¶</abbr></a></h3><div class="indent"><p><a name="nt-idm175">1</a>. XEP-0080: User Geolocation &lt;<a href="https://xmpp.org/extensions/xep-0080.html">https://xmpp.org/extensions/xep-0080.html</a>&gt;.</p><p><a name="nt-idm179">2</a>. XEP-0107: User Mood &lt;<a href="https://xmpp.org/extensions/xep-0107.html">https://xmpp.org/extensions/xep-0107.html</a>&gt;.</p><p><a name="nt-idm183">3</a>. XEP-0108: User Activity &lt;<a href="https://xmpp.org/extensions/xep-0108.html">https://xmpp.org/extensions/xep-0108.html</a>&gt;.</p><p><a name="nt-idm187">4</a>. XEP-0118: User Tune &lt;<a href="https://xmpp.org/extensions/xep-0118.html">https://xmpp.org/extensions/xep-0118.html</a>&gt;.</p><p><a name="nt-idm191">5</a>. XEP-0060: Publish-Subscribe &lt;<a href="https://xmpp.org/extensions/xep-0060.html">https://xmpp.org/extensions/xep-0060.html</a>&gt;.</p><p><a name="nt-idm193">6</a>. Instead, many "extended presence" formats are currently sent using the &lt;presence/&gt; stanza type; unfortunately, this overloads presence, results in unnecessary presence traffic, and does not provide fine-grained control over access. The use of publish-subscribe rather than presence is therefore preferable.</p><p><a name="nt-idm196">7</a>. RFC 6121: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://tools.ietf.org/html/rfc6121">http://tools.ietf.org/html/rfc6121</a>&gt;.</p><p><a name="nt-idm225">8</a>. That may still be necessary for open access model nodes in PEP if another user does not send you presence, such as benvolio@montague.lit in our scenario.</p><p><a name="nt-idm232">9</a>. XEP-0115: Entity Capabilities &lt;<a href="https://xmpp.org/extensions/xep-0115.html">https://xmpp.org/extensions/xep-0115.html</a>&gt;.</p><p><a name="nt-idm263">10</a>. This works only if the subscription state is "both" (see <span class="ref">RFC 3921</span>).</p><p><a name="nt-idm269">11</a>. XEP-0134: XMPP Design Guidelines &lt;<a href="https://xmpp.org/extensions/xep-0134.html">https://xmpp.org/extensions/xep-0134.html</a>&gt;.</p><p><a name="nt-idm321">12</a>. XEP-0033: Extended Stanza Addressing &lt;<a href="https://xmpp.org/extensions/xep-0033.html">https://xmpp.org/extensions/xep-0033.html</a>&gt;.</p><p><a name="nt-idm341">13</a>. By "initial presence" is meant a presence stanza with no 'type' attribute that the PEP service receives after the subscriber was previously unavailable; any subsequent presence stanza with no 'type' attribute that the PEP service receives after the initial presence notification but before the subscriber against goes offline MUST NOT trigger sending of a new pubsub notification.</p><p><a name="nt-idm348">14</a>. XEP-0016: Privacy Lists &lt;<a href="https://xmpp.org/extensions/xep-0016.html">https://xmpp.org/extensions/xep-0016.html</a>&gt;.</p><p><a name="nt-idm352">15</a>. XEP-0191: Blocking Command &lt;<a href="https://xmpp.org/extensions/xep-0191.html">https://xmpp.org/extensions/xep-0191.html</a>&gt;.</p><p><a name="nt-idm360">16</a>. XEP-0256: Last Activity in Presence &lt;<a href="https://xmpp.org/extensions/xep-0256.html">https://xmpp.org/extensions/xep-0256.html</a>&gt;.</p><p><a name="nt-idm379">17</a>. Because subscriptions are implicit in PEP rather than explicit as in generic pubsub, the on_sub_and_presence setting effectively means sending on presence.</p><p><a name="nt-idm386">18</a>. XEP-0030: Service Discovery &lt;<a href="https://xmpp.org/extensions/xep-0030.html">https://xmpp.org/extensions/xep-0030.html</a>&gt;.</p><p><a name="nt-idm408">19</a>. RFC 4287: The Atom Syndication Format &lt;<a href="http://tools.ietf.org/html/rfc4287">http://tools.ietf.org/html/rfc4287</a>&gt;.</p><p><a name="nt-idm417">20</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p><p><a name="nt-idm424">21</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="https://xmpp.org/registrar/">https://xmpp.org/registrar/</a>&gt;.</p></div><h3 id="appendix-revs">Appendix H: Revision History<a class="anchor-link" href="#appendix-revs"><abbr title="Link to this point in the document">¶</abbr></a></h3><p>Note: Older versions of this specification might be available at <a href="https://xmpp.org/extensions/attic/">https://xmpp.org/extensions/attic/</a></p><ol class="revision-history"><li id="revision-history-v1.2.2"><div class="revision-head">Version 1.2.2 (2022-02-16)<a class="anchor-link" href="#revision-history-v1.2.2"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Add comma and fix typo</p><div class="revision-author">melvo</div></li><li id="revision-history-v1.2.1"><div class="revision-head">Version 1.2.1 (2018-03-18)<a class="anchor-link" href="#revision-history-v1.2.1"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Clarify how +notify works</p><div class="revision-author">fs</div></li><li id="revision-history-v1.2"><div class="revision-head">Version 1.2 (2010-07-12)<a class="anchor-link" href="#revision-history-v1.2"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Removed the one-node-per-namespace rule (community consensus indicates that this rule was overly restrictive); clarified the meaning of auto-subscribe; clarified that sending the last published item does not prevent the service from sending additional items in some circumstances; discouraged the use of directed presence for the purpose of implicit subscriptions.</p><div class="revision-author">psa</div></li><li id="revision-history-v1.1"><div class="revision-head">Version 1.1 (2007-09-26)<a class="anchor-link" href="#revision-history-v1.1"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">In accordance with XMPP Council consensus (1) explicitly defined auto-create, auto-subscribe, filtered-notifications, and last-published features, (2) moved them to XEP-0060, and (3) added appropriate references to XEP-0060 throughout; also added friendly but non-normative How It Works section and removed references to private data storage; updated to reflect changes to entity capabilities and pubsub.</p><div class="revision-author">psa</div></li><li id="revision-history-v1.0"><div class="revision-head">Version 1.0 (2006-09-20)<a class="anchor-link" href="#revision-history-v1.0"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Per a vote of the Jabber Council, advanced status to Draft.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.15"><div class="revision-head">Version 0.15 (2006-08-30)<a class="anchor-link" href="#revision-history-v0.15"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Added the deliver_notifications and send_last_published_item configuration options to the recommended defaults.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.14"><div class="revision-head">Version 0.14 (2006-08-02)<a class="anchor-link" href="#revision-history-v0.14"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Changed various recommended defaults from SHOULD to MUST; corrected several errors in the text and examples.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.13"><div class="revision-head">Version 0.13 (2006-08-01)<a class="anchor-link" href="#revision-history-v0.13"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Recommended node creation with default configuration on initial publish; corrected several errors and clarified several points in the text.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.12"><div class="revision-head">Version 0.12 (2006-08-01)<a class="anchor-link" href="#revision-history-v0.12"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Simplified the subscription process using XMPP presence and entity capabilities.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.11"><div class="revision-head">Version 0.11 (2006-07-20)<a class="anchor-link" href="#revision-history-v0.11"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Clarified rules regarding number of notifications and when to generate notifications; corrected several errors in the text and examples.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.10"><div class="revision-head">Version 0.10 (2006-07-07)<a class="anchor-link" href="#revision-history-v0.10"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Updated to reflect version 1.8 of XEP-0060.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.9"><div class="revision-head">Version 0.9 (2006-06-15)<a class="anchor-link" href="#revision-history-v0.9"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Updated to reflect use of data forms in XEP-0060.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.8"><div class="revision-head">Version 0.8 (2006-04-10)<a class="anchor-link" href="#revision-history-v0.8"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Clarified terminology and defaults.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.7"><div class="revision-head">Version 0.7 (2006-04-10)<a class="anchor-link" href="#revision-history-v0.7"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Specified that notifications are to be sent from bare JID, not full JID.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.6"><div class="revision-head">Version 0.6 (2006-04-10)<a class="anchor-link" href="#revision-history-v0.6"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Updated to reflect pubsub changes; clarified business rules for generation of notifications and cancellation of subscriptions.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.5"><div class="revision-head">Version 0.5 (2006-03-09)<a class="anchor-link" href="#revision-history-v0.5"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Modified roster groups example to use jabber:x:data; added note about advertising client support for PEP.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.4"><div class="revision-head">Version 0.4 (2006-02-02)<a class="anchor-link" href="#revision-history-v0.4"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Specified rules for generation of notifications, including use of presence in determining address of intended recipient for notifications and sending of last published item on receipt of presence information; changed name to Personal Eventing Protocol; specified service discovery identity of pubsub/pep; removed section on service types; added Kevin Smith as co-author.</p><div class="revision-author">psa/ks</div></li><li id="revision-history-v0.3"><div class="revision-head">Version 0.3 (2006-01-30)<a class="anchor-link" href="#revision-history-v0.3"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Specified that a service may enforce additional privacy and security policies; specified that an account owner must always be allowed to subscribe and to retrieve items; specified that an implementation should enforce access modifications resulting from roster state changes.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.2"><div class="revision-head">Version 0.2 (2006-01-11)<a class="anchor-link" href="#revision-history-v0.2"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Updated to reflect proposed XEP-0060 modifications.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.1"><div class="revision-head">Version 0.1 (2005-11-02)<a class="anchor-link" href="#revision-history-v0.1"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Initial version.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.0.2"><div class="revision-head">Version 0.0.2 (2005-10-25)<a class="anchor-link" href="#revision-history-v0.0.2"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Added more details and examples.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.0.1"><div class="revision-head">Version 0.0.1 (2005-10-24)<a class="anchor-link" href="#revision-history-v0.0.1"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">First draft.</p><div class="revision-author">psa</div></li></ol><h3 id="appendix-biblatex">Appendix I: Bib(La)TeX Entry</h3><pre>
@report{saint-andre2005pep,
  title = {Personal Eventing Protocol},
  author = {Saint-Andre, Peter and Smith, Kevin},
  type = {XEP},
  number = {0163},
  version = {1.2.2},
  institution = {XMPP Standards Foundation},
  url = {https://xmpp.org/extensions/xep-0163.html},
  date = {2005-10-24/2022-02-16},
}</pre><p>END</p></body></html>
