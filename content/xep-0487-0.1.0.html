<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>XEP-0487: Host Meta 2 - One Method To Rule Them All</title><style type="text/css">
/* don't mind this hack */
nav#toc h2:before {
display: none;
content: "XEP-0487";
}
        </style><link rel="stylesheet" type="text/css" href="xmpp.css"><link href="prettify.css" type="text/css" rel="stylesheet"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"><script type="text/javascript" src="prettify.js"></script><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="DC.Title" content="Host Meta 2 - One Method To Rule Them All"><meta name="DC.Creator" content="Travis Burtrum"><meta name="DC.Description" content="This document defines an XMPP Extension Protocol for extending XEP-0156 by modifying the JSON Web Host Metadata Link format to support discovering all possible XMPP connection methods, for c2s and s2s"><meta name="DC.Publisher" content="XMPP Standards Foundation"><meta name="DC.Contributor" content="XMPP Extensions Editor"><meta name="DC.Date" content="2024-03-10"><meta name="DC.Type" content="XMPP Extension Protocol"><meta name="DC.Format" content="XHTML"><meta name="DC.Identifier" content="XEP-0487"><meta name="DC.Language" content="en"><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright © 1999 – 2020 by the XMPP Standards Foundation (XSF)."></head><body onload="prettyPrint()"><h1>XEP-0487: Host Meta 2 - One Method To Rule Them All</h1><div class="docmeta-wrap"><dl id="docmeta" class="compact"><dt>Abstract</dt><dd>This document defines an XMPP Extension Protocol for extending XEP-0156 by modifying the JSON Web Host Metadata Link format to support discovering all possible XMPP connection methods, for c2s and s2s</dd><dt>Author</dt><dd>Travis Burtrum</dd><dt>Copyright</dt><dd>© 2023 – 2024 XMPP Standards Foundation. <a href="#appendix-legal">SEE LEGAL NOTICES</a>.</dd><dt>Status</dt><dd><p>Experimental</p><div id="status-notice" class="experimental standards track">WARNING: This Standards-Track document is Experimental. Publication as an XMPP Extension Protocol does not imply approval of this proposal by the XMPP Standards Foundation. Implementation of the protocol described herein is encouraged in exploratory implementations, but production systems are advised to carefully consider whether it is appropriate to deploy implementations of this protocol before it advances to a status of Draft.</div></dd><dt>Supersedes</dt><dd><a href="xep-0156.html">XEP-0156</a>, <a href="https://datatracker.ietf.org/doc/html/rfc7711">RFC 7711</a></dd><dt>Type</dt><dd>Standards Track</dd><dt>Version</dt><dd>0.1.0 (2024-03-10)</dd></dl><div class="timeline-wrap"><div class="timeline-head">Document Lifecycle</div><ol class="timeline"><li class="current">Experimental</li><li>Proposed</li><li>Stable</li><li>Final</li></ol></div></div><nav id="toc"><a href="#top"><h2>Table of Contents</h2></a><ol class="toc"><li><a href="#intro">Introduction</a></li><li><a href="#http">HTTPS Lookup Method</a><ol><li><a href="#httpformat">Link Format</a></li><li><a href="#httpbizrules">Business Rules</a></li><li><a href="#httpexamples">Examples</a></li></ol></li><li><a href="#impl">Implementation Notes</a><ol><li><a href="#impl-admins">For Server Administrators</a></li><li><a href="#impl-codemonkey">For Programmers</a></li><li><a href="#impl-speccy">For Future Spec Writers</a></li></ol></li><li><a href="#rationale">Rationale</a><ol><li><a href="#rationale-dns">Why not DNS?</a></li><li><a href="#rationale-hm-xml">Why not host-meta.xml?</a></li><li><a href="#rationale-hm-json">Why host-meta.json instead of something else?</a></li><li><a href="#rationale-params">Why do we even need these additional parameters?</a></li><li><a href="#rationale-misc">Misc</a></li></ol></li><li><a href="#security">Security Considerations</a></li><li><a href="#iana">IANA Considerations</a></li><li><a href="#registrar">XMPP Registrar Considerations</a></li></ol><h6><a href="#appendices">Appendices</a></h6><ol class="toc-appendices"><li><a href="#appendix-docinfo">Document Information</a></li><li><a href="#appendix-authorinfo">Author Information</a></li><li><a href="#appendix-legal">Legal Notices</a></li><li><a href="#appendix-xmpp">Relation to XMPP</a></li><li><a href="#appendix-discuss">Discussion Venue</a></li><li><a href="#appendix-conformance">Requirements Conformance</a></li><li><a href="#appendix-notes">Notes</a></li><li><a href="#appendix-revs">Revision History</a></li><li><a href="#appendix-biblatex">Bib(La)Tex Entry</a></li></ol></nav><h2 id="intro">1.
       Introduction<a class="anchor-link" href="#intro"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">Although <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc6120">XMPP Core</a></span>  [<a href="#nt-id19">1</a>] specifies the use of TCP as the method of connecting to an XMPP server, alternative connection methods exist, including the <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0124.html">BOSH (XEP-0124)</a></span>  [<a href="#nt-id20">2</a>] method (for which <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0206.html">XMPP Over BOSH (XEP-0206)</a></span>  [<a href="#nt-id21">3</a>] is the XMPP profile), the websocket
 subprotocol specified in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc7395">RFC 7395</a></span>  [<a href="#nt-id22">4</a>], <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0368.html">SRV records for XMPP over TLS (XEP-0368)</a></span>  [<a href="#nt-id23">5</a>], <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0467.html">XMPP over QUIC (XEP-0467)</a></span>  [<a href="#nt-id24">6</a>], and <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0468.html">WebSocket S2S (XEP-0468)</a></span>  [<a href="#nt-id25">7</a>], and surely others that don't yet exist. For some of these methods, it is necessary to discover further parameters before connecting, such as the HTTPS URL of a BOSH or WebSocket request. Without ways to auto-discover these parameters, the relevant information would need to be provided manually by a human user (which is cumbersome and error-prone) or hard-coded into XMPP software applications (which is brittle and not interoperable)
).</p>
  <p class="" style="">Additional things also require automatic discovery, like <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc7711">RFC 7711</a></span>  [<a href="#nt-id26">8</a>] (replaced here by pinning public keys instead like <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc7469">RFC 7469</a></span>  [<a href="#nt-id27">9</a>]), <span class="ref" style=""><a href="http://tools.ietf.org/html/draft-ietf-tls-esni/">TLS Encrypted Client Hello</a></span>  [<a href="#nt-id28">10</a>], SNI names, and ALPN protocols.</p>
  <p class="" style="">This document defines a way to encapsulate information about all these connection methods and parameters for auto-discovery via Link entries in a server's "host-meta.json" file. It also provides a flag to signal to the client or server that all info is here and no other methods need be used.
  </p>
<h2 id="http">2.
       HTTPS Lookup Method<a class="anchor-link" href="#http"><abbr title="Link to this point in the document">¶</abbr></a></h2>

  <div class="indent"><h3 id="httpformat">2.1 Link Format<a class="anchor-link" href="#httpformat"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The HTTPS lookup method uses Web Host Metadata <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc6415">RFC 6415</a></span>  [<a href="#nt-id29">11</a>] to categorize and list the URIs of alternative connection methods. It is intended to replace all current methods for looking up connection information by "native" clients and servers, as well as be used by web browsers.</p>
    <p class="" style="">Each alternative connection method is specified in the host-meta.json (JRD) file using a distinctive link relation <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc5988">RFC 5988</a></span>  [<a href="#nt-id30">12</a>]. This specification defines several extension relation types, here links are provided to their respective transport definitions:</p>
    <ul class="" style="">
      <li class="" style="">urn:xmpp:alt-connections:tls           - c2s Direct TLS - <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0368.html">SRV records for XMPP over TLS (XEP-0368)</a></span>  [<a href="#nt-id23">5</a>]</li>
      <li class="" style="">urn:xmpp:alt-connections:quic          - c2s Quic       - <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0467.html">XMPP over QUIC (XEP-0467)</a></span>  [<a href="#nt-id24">6</a>]</li>
      <li class="" style="">urn:xmpp:alt-connections:s2s-websocket - s2s WebSocket  - <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0468.html">WebSocket S2S (XEP-0468)</a></span>  [<a href="#nt-id25">7</a>]</li>
      <li class="" style="">urn:xmpp:alt-connections:s2s-tls       - s2s Direct TLS - <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0368.html">SRV records for XMPP over TLS (XEP-0368)</a></span>  [<a href="#nt-id23">5</a>]</li>
      <li class="" style="">urn:xmpp:alt-connections:s2s-quic      - s2s Quic       - <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0467.html">XMPP over QUIC (XEP-0467)</a></span>  [<a href="#nt-id24">6</a>]</li>
    </ul>
    <p class="" style="">And additionally re-uses some defined in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0156.html">Discovering Alternative XMPP Connection Methods (XEP-0156)</a></span>  [<a href="#nt-id31">13</a>]:</p>
    <ul class="" style="">
      <li class="" style="">urn:xmpp:alt-connections:websocket     - c2s WebSocket - <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc7395">RFC 7395</a></span>  [<a href="#nt-id22">4</a>]</li>
      <li class="" style="">urn:xmpp:alt-connections:xbosh         - c2s BOSH      - <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0206.html">XMPP Over BOSH (XEP-0206)</a></span>  [<a href="#nt-id21">3</a>]</li>
    </ul>
    <p class="" style="">Additionally a top level "xmpp" object is defined, which currently has the following subfields defined:</p>
    <ul class="" style="">
      <li class="" style="">"ttl" - integer - MANDATORY - seconds this document can be cached for</li>
      <li class="" style="">"public-key-pins-sha-256" - list of strings - OPTIONAL - base64 sha256 hashes of public keys to trust, use as defined in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc7469">RFC 7469</a></span>  [<a href="#nt-id27">9</a>]</li>
    </ul>
    <p class="" style="">The following are new fields defined in each link object:</p>
    <ul class="" style="">
      <li class="" style="">"priority" and "weight" - integers - MANDATORY - Use as defined in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc2782">RFC 2782</a></span>  [<a href="#nt-id32">14</a>]</li>
      <li class="" style="">"sni" - string - MANDATORY - name to send in the TLS/QUIC SNI extension</li>
      <li class="" style="">"ech" - string - OPTIONAL - Use as defined in <span class="ref" style=""><a href="http://tools.ietf.org/html/draft-ietf-tls-esni/">TLS Encrypted Client Hello</a></span>  [<a href="#nt-id28">10</a>]</li>
      <li class="" style="">"ips" - list of strings - at least one MANDATORY - IPv4 or IPv6 addresses only, connect to these</li>
    </ul>
    <p class="" style="">The "href" field in websocket/bosh links remains unchanged from XEP-0156, but is replaced by "port" (integer) in Direct TLS/Quic connections.</p>
  </div>

  <div class="indent"><h3 id="httpbizrules">2.2 Business Rules<a class="anchor-link" href="#httpbizrules"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The following business rules apply:</p>
    <ol start="1" class="" style="">
      <li class="" style="">host-meta files MUST be fetched only over HTTPS, and MUST only use secure connections (TLS or equivalent).
          This provides secure delegation, meaning you MUST send the provided SNI and validate that the certificate 
          is valid for that host *or* the XMPP domain (or the public key hash is pinned).</li>  
      <li class="" style="">host-meta responses with the top level "xmpp" object mean this XEP is in use and legacy SRV/POSH/etc lookups SHOULD be skipped, alternatively if the top level "xmpp" object does not exist, XEP-0156 rules apply instead.</li>
      <li class="" style="">Client/Server implementations SHOULD consider weight/priority as presumably the server admin has thought about which links can handle load best etc, but MAY prioritize certain protocols over others, for example a privacy client may want to use websocket to look most like HTTPS, or a mobile client might prefer Quic for connection roaming. Regardless server operators MUST NOT count on any ordering, a client can connect to any of these under even normal circumstances.</li>
    </ol>
  </div>

  <div class="indent"><h3 id="httpexamples">2.3 Examples<a class="anchor-link" href="#httpexamples"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">It is possible to use additionally a JSON-based format for host-meta information. The JSON representation of the host metadata is named JRD and specified in Appendix A of <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc6415">RFC 6415</a></span>  [<a href="#nt-id29">11</a>]. The above XRD example would be presented in JRD as:</p>
    <figure class="code-example" id="example-1"><figcaption><strong>Example 1.</strong> Result for /.well-known/host-meta.json<a class="anchor-link" href="#example-1"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
{
  "xmpp": {
    "ttl": 3000,
    "public-key-pins-sha-256": [
      "4/mggdlVx8A3pvHAWW5sD+qJyMtUHgiRuPjVC48N0XQ="
    ]
  },
  "links": [
    {
      "rel": "urn:xmpp:alt-connections:websocket",
      "href": "wss://other.example.org/xmpp-websocket",
      "ips": [
        "1.2.3.4",
        "fd00:feed:dad:beef::1"
      ],
      "priority": 15,
      "weight": 50,
      "sni": "example.org",
      "ech": "eG1wcC1jbGllbnQ="
    },
    {
      "rel": "urn:xmpp:alt-connections:tls",
      "port": 443,
      "ips": [
        "1.2.3.4",
        "fd00:feed:dad:beef::1"
      ],
      "priority": 10,
      "weight": 50,
      "sni": "example.org",
      "ech": "eG1wcC1jbGllbnQ="
    },
    {
      "rel": "urn:xmpp:alt-connections:quic",
      "port": 443,
      "ips": [
        "1.2.3.4",
        "fd00:feed:dad:beef::1"
      ],
      "priority": 5,
      "weight": 50,
      "sni": "example.org",
      "ech": "eG1wcC1jbGllbnQ="
    },
    {
      "rel": "urn:xmpp:alt-connections:s2s-websocket",
      "href": "wss://other.example.org/s2s-xmpp-websocket",
      "ips": [
        "1.2.3.4",
        "fd00:feed:dad:beef::1"
      ],
      "priority": 15,
      "weight": 50,
      "sni": "example.org",
      "ech": "eG1wcC1jbGllbnQ="
    },
    {
      "rel": "urn:xmpp:alt-connections:s2s-tls",
      "port": 443,
      "ips": [
        "1.2.3.4",
        "fd00:feed:dad:beef::1"
      ],
      "priority": 10,
      "weight": 50,
      "sni": "example.org",
      "ech": "eG1wcC1jbGllbnQ="
    },
    {
      "rel": "urn:xmpp:alt-connections:s2s-quic",
      "port": 443,
      "ips": [
        "1.2.3.4",
        "fd00:feed:dad:beef::1"
      ],
      "priority": 5,
      "weight": 50,
      "sni": "example.org",
      "ech": "eG1wcC1jbGllbnQ="
    },
    {
      "rel": "urn:xmpp:alt-connections:xbosh",
      "href": "https://web.example.com:5280/bosh"
    }
  ]
}
</pre></figure>
  </div>
<h2 id="impl">3.
       Implementation Notes<a class="anchor-link" href="#impl"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="impl-admins">3.1 For Server Administrators<a class="anchor-link" href="#impl-admins"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">For the forseeable future you will need to maintain legacy SRV records in addition to this file, and you should provide DANE TLSA records too if possible.</p>
    <p class="" style="">To make your server as accessible to other clients/servers no matter how bad the network they are on, it is advised to use port 443 when possible, as it looks the most like HTTPS.</p>
    <p class="" style="">Extra care must be taken in updating "public-key-pins-sha-256" similar to that which is required of HPKP and DANE, summarized here, you MUST add the new key to the file, continue using the old key until least 2 TTL periods have passed, and only then remove the old key from the file and start using the new key.</p>
    <p class="" style="">To make connection discovery work in web clients (including those hosted on a different domain) the host service SHOULD set appropriate <a href="https://www.w3.org/TR/cors/">CORS</a> headers for Web Host Metadata files. The exact headers and values are out of scope of this document but may include: <em>Access-Control-Allow-Origin</em>, <em>Access-Control-Allow-Methods</em> and <em>Access-Control-Allow-Headers</em>.</p>
    <p class="" style="">Due care has to be exercised in limiting the scope of <em>Access-Control-Allow-Origin</em> response header to Web Host Metadata files only.</p>
    <figure class="code"><figcaption>Example header allowing all sites to read host metadata</figcaption><pre class="prettyprint">
Access-Control-Allow-Origin: *
</pre></figure>
    <p class="box" style=""><em>Access-Control-Allow-Origin</em> header with a value of <em>*</em> allows JavaScript code running on a different domain to read the content of Web Host Metadata files. Special value <em>*</em> ensures that the request will only succeed if it is <a href="https://www.w3.org/TR/cors/#resource-requests">invoked without user credentials</a> (e.g. cookies, HTTP authentication).</p>
  </div>
  <div class="indent"><h3 id="impl-codemonkey">3.2 For Programmers<a class="anchor-link" href="#impl-codemonkey"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">
      As an author of a client or server, you presumably have users, and those users have a single desire, to communicate over XMPP. 
      This means that they want to connect at any costs, they *do not* want to see the first error to appear and have all further attempts aborted until it's fixed.
      With this problem statement, here is a list of current best practices to make this happen:
    </p>
    <ul class="" style="">
      <li class="" style="">"ttl" is a guideline for when you SHOULD try to fetch a newer copy, if you can't, you MUST try to fetch connection info other ways, and also fall back to expired data if needed</li>
      <li class="" style="">When trying a particular connection with a list of IPs, you can try them all in order, or pick a random one like DNS would do, but if you do, you MUST keep track of the ones you tried, and try all the rest later if your connection wasn't succesful</li>
      <li class="" style="">An application MUST keep trying every possible connection until they have both an authenticated stream (the TLS certificate is valid) and have seen a valid XMPP stream element for the server you are trying to connect to.  You may get an authenticated stream and an HTTP or IMAP or SMTP error, or even an XMPP stream header for another server, you MUST keep going until both of these are satisified.</li>
    </ul>
  </div>
  <div class="indent"><h3 id="impl-speccy">3.3 For Future Spec Writers<a class="anchor-link" href="#impl-speccy"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">Keep in mind this json file is defined in an RFC and we need to keep backwards compatibility with it, software only implementing XEP-0156 should be able to read and use this file as extended by this XEP only seeing the websocket/bosh connections.</p>
  </div>
<h2 id="rationale">4.
       Rationale<a class="anchor-link" href="#rationale"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">At the time of this writing, connecting to an XMPP server requires at least 5 seperate fetches of data, and doesn't support half the things this XEP does.  I don't find adding more fetches a sustainable path forward, hence definining one extensible method for all things going forward.</p>
  <p class="" style="">Here I will go through alternative solutions that were explored and explain their deficiencies and why they were not chosen.</p>
  <div class="indent"><h3 id="rationale-dns">4.1 Why not DNS?<a class="anchor-link" href="#rationale-dns"><abbr title="Link to this point in the document">¶</abbr></a></h3>
      <ul class="" style="">
        <li class="" style="">SRV records cannot hold the additional parameters needed and are not extensible.</li>
        <li class="" style="">The web solves these problems in HTTP3 by introducing another set of DNS records (<span class="ref" style=""><a href="http://tools.ietf.org/html/rfc9460">RFC 9460</a></span>  [<a href="#nt-id33">15</a>]) but that poses a problem for XMPP because we don't have the clout to introduce our own DNS records and hope for any sort of adoption with the myriad of DNS setup panels most people use.</li>
        <li class="" style="">We could register our own SvcParamKeys and use SVCB records, but that suffers the same problem as above.</li>
        <li class="" style="">Perhaps most importantly, while we all hope and pray for DNSSEC (and DANE), many TLDs don't yet support it, and we can't trust this info (pinned keys or secure delegation) without cryptographic authenticity.</li>
        <li class="" style="">Some of these parameters not even the web trusts over plaintext, DNS-over-TLS/HTTPS is a requirement for ECH.</li>
        <li class="" style="">TXT records can hold arbitrary data, but the authenticity/privacy problems above persist, practical size limits make this a non-starter, and writing a custom parser isn't great from a security perspective.</li>
      </ul>
  </div>
  <div class="indent"><h3 id="rationale-hm-xml">4.2 Why not host-meta.xml?<a class="anchor-link" href="#rationale-hm-xml"><abbr title="Link to this point in the document">¶</abbr></a></h3>
      <ul class="" style="">
        <li class="" style="">XMPP uses XML right? So we already have a XML parser to use! Actually no, XMPP uses a (very) strict subset of XML, and an XML parser properly configured to parse XMPP *will not* parse host-meta.xml. Some more security conscious XML parsers are explicitly built for XMPP and cannot be configured to parse host-meta.xml. It is *dangerous* from a security perspective to have an XML parser capable of parsing host-meta.xml anywhere in your client/server, see CVE-2022-0217.</li>
        <li class="" style="">Extending host-meta.xml the ideal way where things that can only have 1 value per link and should be an attribute (like port) would require namespaced attributes which are not widely supported or currently used at all in XMPP (though legal).</li>
        <li class="" style="">It would also require dummy values in Link like href='DUMMY' or so when a port is set.  Or introducing another tag... Regardless it won't be very clean, and I consider the first issue a complete deal breaker.</li>
      </ul>
  </div>
  <div class="indent"><h3 id="rationale-hm-json">4.3 Why host-meta.json instead of something else?<a class="anchor-link" href="#rationale-hm-json"><abbr title="Link to this point in the document">¶</abbr></a></h3>
      <ul class="" style="">
        <li class="" style="">A major design goal here is enabling 1 single fetch to get everything needed to connect to a server.  This file already exists and is already being grabbed by clients, since we can extend it without breaking compatibility with those clients, this doesn't introduce another network fetch.</li>
        <li class="" style=""><span class="ref" style=""><a href="http://tools.ietf.org/html/rfc7711">RFC 7711</a></span>  [<a href="#nt-id26">8</a>] already exists for clients and servers and uses JSON, same parser can be used.</li>
        <li class="" style="">As stated in the section above, I find a JSON parser much less of a potential security vulnerability to have available than an XML parser capable of parsing host-meta.xml</li>
      </ul>
  </div>
  <div class="indent"><h3 id="rationale-params">4.4 Why do we even need these additional parameters?<a class="anchor-link" href="#rationale-params"><abbr title="Link to this point in the document">¶</abbr></a></h3>
      <ul class="" style="">
        <li class="" style="">SNI fixes a fundamental problem we have with current methods of secure delegation (XEP-0156 and DNSSEC signed SRV records), in that these enable certificate validation to allow a certificate if it contains either one of two names, the service name *or* the target name. But you can only send one name with SNI, and nothing indicates which to send! If you send the wrong one the connection will fail, this necessitates sending one and, if it fails, sending the other, which is of course less than ideal.</li>
        <li class="" style="">ECH allows encrypting SNI+ALPN on the wire and so is invaluable for privacy.</li>
        <li class="" style="">Pinned public keys are a better replacement for POSH (they don't need changed on certificate renewal which commonly happens every 60 days now), and an alternative to DANE which can't be used where DNSSEC is not available.</li>
      </ul>
  </div>
  <div class="indent"><h3 id="rationale-misc">4.5 Misc<a class="anchor-link" href="#rationale-misc"><abbr title="Link to this point in the document">¶</abbr></a></h3>
      <ul class="" style="">
        <li class="" style="">host-meta.json has an 'expires' key defined already, why 'ttl' instead? I was almost convinced to use this until I realized this means that the file needs served by a program that can update 'expires' dynamically on fetch, or at least on a schedule, and that is far more complicated and therefore less preferable than a simple ttl that never needs updated allowing clients to keep track of their own expiry.</li>
        <li class="" style="">What would be the next best option? Well I think a new file over https/.well-known that is in an XMPP-subset-of-XML format and so can safely share the same parser. It would be similar to <a href="https://xmpp.org/extensions/inbox/hacx.html">HACX</a> which was rejected with the direction to look into extending <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0156.html">Discovering Alternative XMPP Connection Methods (XEP-0156)</a></span>  [<a href="#nt-id31">13</a>], which this is doing.</li>
      </ul>
  </div>
<h2 id="security">5.
       Security Considerations<a class="anchor-link" href="#security"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">It should be noted this allows your web host to hijack your XMPP connection, but that's actually been true for quite some time, they could already bypass the need for a certificate with POSH, or get one from LetsEncrypt if you didn't have the proper CAA records, or hijack it for websocket/bosh supporting clients, so this doesn't really open up new avenues of attack.</p>
  <p class="" style="">Please refer to the security considerations and warnings of <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc7469">RFC 7469</a></span>  [<a href="#nt-id27">9</a>] with regards to having a backup public key and being careful to not break your domain for the whole TTL. For this reason and others it is advised to put a max limit on TTL of 1 week (604800).</p>
  <p class="" style="">Validating certs is full of edge cases and must be done with the utmost of care and precision.</p>
<h2 id="iana">6.
       IANA Considerations<a class="anchor-link" href="#iana"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">This document requires no interaction with the <span class="ref" style=""><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-id34">16</a>].</p>
<h2 id="registrar">7.
       XMPP Registrar Considerations<a class="anchor-link" href="#registrar"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">This document requires no interaction with the <span class="ref" style=""><a href="https://xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-id35">17</a>].</p>
<hr><a name="appendices"></a><h2>Appendices</h2><h3 id="appendix-docinfo">Appendix A: Document Information<a class="anchor-link" href="#appendix-docinfo"><abbr title="Link to this point in the document">¶</abbr></a></h3><dl class="compact"><dt>Series</dt><dd><a href="https://xmpp.org/extensions/">XEP</a></dd><dt>Number</dt><dd>0487</dd><dt>Publisher</dt><dd><a href="/xsf/">XMPP Standards Foundation</a></dd><dt>Status</dt><dd><a href="https://xmpp.org/extensions/xep-0001.html#states-Experimental">Experimental</a></dd><dt>Type</dt><dd><a href="https://xmpp.org/extensions/xep-0001.html#types-Standards%20Track">Standards Track</a></dd><dt>Version</dt><dd>0.1.0</dd><dt>Last Updated</dt><dd>2024-03-10</dd><dt>Approving Body</dt><dd><a href="https://xmpp.org/council/">XMPP Council</a></dd><dt>Dependencies</dt><dd>XMPP Core, <a href="https://datatracker.ietf.org/doc/html/rfc1464">RFC 1464</a></dd><dt>Supersedes</dt><dd><a href="xep-0156.html">XEP-0156</a>, <a href="https://datatracker.ietf.org/doc/html/rfc7711">RFC 7711</a></dd><dt>Superseded By</dt><dd>None</dd><dt>Short Name</dt><dd>connections-v2</dd><dt>Registry</dt><dd>
              &lt;<a href="https://xmpp.org/registrar/connections-v2.html">https://xmpp.org/registrar/connections-v2.html</a>&gt;
            </dd><dt>Source Control</dt><dd><a class="standardsButton" href="https://github.com/xsf/xeps/blob/master/xep-0487.xml">HTML</a></dd></dl><p>
          This document in other formats:
          <a class="standardsButton" href="https://xmpp.org/extensions/xep-0487.xml">XML</a> 
          <a class="standardsButton" href="https://xmpp.org/extensions/xep-0487.pdf">PDF</a></p><h3 id="appendix-authorinfo">Appendix B: Author Information<a class="anchor-link" href="#appendix-authorinfo"><abbr title="Link to this point in the document">¶</abbr></a></h3><h5>Travis Burtrum</h5><dl class="compact"><dt>Email</dt><dd><a href="mailto:travis@burtrum.org">travis@burtrum.org</a></dd><dt>JabberID</dt><dd><a href="xmpp:travis@burtrum.org">travis@burtrum.org</a></dd><dt>URI</dt><dd><a href="https://moparisthebest.com/">https://moparisthebest.com/</a></dd></dl><h3 id="appendix-legal">Appendix C: Legal Notices<a class="anchor-link" href="#appendix-legal"><abbr title="Link to this point in the document">¶</abbr></a></h3><div class="indent"><h4>Copyright</h4><p>This XMPP Extension Protocol is copyright © 1999 – 2020 by the <a href="https://xmpp.org/">XMPP Standards Foundation</a> (XSF).</p><h4>Permissions</h4><p>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.</p><h4>Disclaimer of Warranty</h4><p class="box info">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. ##</p><h4>Limitation of Liability</h4><p>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.</p><h4>IPR Conformance</h4><p>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which can be found at &lt;<a href="https://xmpp.org/about/xsf/ipr-policy">https://xmpp.org/about/xsf/ipr-policy</a>&gt; or obtained by writing to XMPP Standards Foundation, P.O. Box 787, Parker, CO 80134 USA).</p><h4>Visual Presentation</h4><p>The HTML representation (you are looking at) is maintained by the XSF. It is based on the <a href="http://yaml.de">YAML CSS Framework</a>, which is licensed under the terms of the <a href="https://creativecommons.org/licenses/by/2.0/">CC-BY-SA 2.0</a> license.</p></div><h3 id="appendix-xmpp">Appendix D: Relation to XMPP<a class="anchor-link" href="#appendix-xmpp"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 6120) and XMPP IM (RFC 6121) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><h3 id="appendix-discuss">Appendix E: Discussion Venue<a class="anchor-link" href="#appendix-discuss"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">The primary venue for discussion of XMPP Extension Protocols is the &lt;<a href="https://mail.jabber.org/mailman/listinfo/standards">standards@xmpp.org</a>&gt; discussion list.</p><p class="indent">Discussion on other xmpp.org discussion lists might also be appropriate; see &lt;<a href="https://xmpp.org/community/">https://xmpp.org/community/</a>&gt; for a complete list.</p><p class="indent">Given that this XMPP Extension Protocol normatively references IETF technologies, discussion on the &lt;<a href="https://mail.jabber.org/mailman/listinfo/xsf-ietf">xsf-ietf@xmpp.org</a>&gt; list might also be appropriate.</p><p class="indent">Errata can be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><h3 id="appendix-conformance">Appendix F: Requirements Conformance<a class="anchor-link" href="#appendix-conformance"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">The following requirements keywords as used in this document are to be interpreted as described in <a href="https://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><h3 id="appendix-notes">Appendix G: Notes<a class="anchor-link" href="#appendix-notes"><abbr title="Link to this point in the document">¶</abbr></a></h3><div class="indent"><p><a name="nt-id19">1</a>. RFC 6120: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://tools.ietf.org/html/rfc6120">http://tools.ietf.org/html/rfc6120</a>&gt;.</p><p><a name="nt-id20">2</a>. XEP-0124: Bidirectional-streams Over Synchronous HTTP &lt;<a href="https://xmpp.org/extensions/xep-0124.html">https://xmpp.org/extensions/xep-0124.html</a>&gt;.</p><p><a name="nt-id21">3</a>. XEP-0206: XMPP Over BOSH &lt;<a href="https://xmpp.org/extensions/xep-0206.html">https://xmpp.org/extensions/xep-0206.html</a>&gt;.</p><p><a name="nt-id22">4</a>. RFC 7395: An Extensible Messaging and Presence Protocol (XMPP) Subprotocol for WebSocket &lt;<a href="http://tools.ietf.org/html/rfc7395">http://tools.ietf.org/html/rfc7395</a>&gt;.</p><p><a name="nt-id23">5</a>. XEP-0368: SRV records for XMPP over TLS &lt;<a href="https://xmpp.org/extensions/xep-0368.html">https://xmpp.org/extensions/xep-0368.html</a>&gt;.</p><p><a name="nt-id24">6</a>. XEP-0467: XMPP over QUIC &lt;<a href="https://xmpp.org/extensions/xep-0467.html">https://xmpp.org/extensions/xep-0467.html</a>&gt;.</p><p><a name="nt-id25">7</a>. XEP-0468: WebSocket S2S &lt;<a href="https://xmpp.org/extensions/xep-0468.html">https://xmpp.org/extensions/xep-0468.html</a>&gt;.</p><p><a name="nt-id26">8</a>. RFC 7711: PKIX over Secure HTTP (POSH)&lt;<a href="http://tools.ietf.org/html/rfc7711">http://tools.ietf.org/html/rfc7711</a>&gt;.</p><p><a name="nt-id27">9</a>. RFC 7469: Public Key Pinning Extension for HTTP &lt;<a href="http://tools.ietf.org/html/rfc7469">http://tools.ietf.org/html/rfc7469</a>&gt;.</p><p><a name="nt-id28">10</a>. TLS Encrypted Client Hello &lt;<a href="http://tools.ietf.org/html/draft-ietf-tls-esni/">http://tools.ietf.org/html/draft-ietf-tls-esni/</a>&gt;.</p><p><a name="nt-id29">11</a>. RFC 6415: Web Host Metadata &lt;<a href="http://tools.ietf.org/html/rfc6415">http://tools.ietf.org/html/rfc6415</a>&gt;.</p><p><a name="nt-id30">12</a>. RFC 5988: Web Linking &lt;<a href="http://tools.ietf.org/html/rfc5988">http://tools.ietf.org/html/rfc5988</a>&gt;.</p><p><a name="nt-id31">13</a>. XEP-0156: Discovering Alternative XMPP Connection Methods &lt;<a href="https://xmpp.org/extensions/xep-0156.html">https://xmpp.org/extensions/xep-0156.html</a>&gt;.</p><p><a name="nt-id32">14</a>. RFC 2782: A DNS RR for specifying the location of services (DNS SRV) &lt;<a href="http://tools.ietf.org/html/rfc2782">http://tools.ietf.org/html/rfc2782</a>&gt;.</p><p><a name="nt-id33">15</a>. RFC 9460: Service Binding and Parameter Specification via the DNS (SVCB and HTTPS Resource Records) &lt;<a href="http://tools.ietf.org/html/rfc9460">http://tools.ietf.org/html/rfc9460</a>&gt;.</p><p><a name="nt-id34">16</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p><p><a name="nt-id35">17</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="https://xmpp.org/registrar/">https://xmpp.org/registrar/</a>&gt;.</p></div><h3 id="appendix-revs">Appendix H: Revision History<a class="anchor-link" href="#appendix-revs"><abbr title="Link to this point in the document">¶</abbr></a></h3><p>Note: Older versions of this specification might be available at <a href="https://xmpp.org/extensions/attic/">https://xmpp.org/extensions/attic/</a></p><ol class="revision-history"><li id="revision-history-v0.1.0"><div class="revision-head">Version <a href="https://xmpp.org/extensions/attic/xep-0487-0.1.0.html">0.1.0</a> (2024-03-10)<a class="anchor-link" href="#revision-history-v0.1.0"><abbr title="Link to this point in the document">¶</abbr></a></div>
      <ul class="" style="">
        <li class="" style="">Promoted to Experimental</li>
      </ul>
    <div class="revision-author">XEP Editor: dg</div></li><li id="revision-history-v0.0.1"><div class="revision-head">Version <a href="https://xmpp.org/extensions/attic/xep-0487-0.0.1.html">0.0.1</a> (2023-11-19)<a class="anchor-link" href="#revision-history-v0.0.1"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">First draft.</p><div class="revision-author">tjb</div></li></ol><h3 id="appendix-biblatex">Appendix I: Bib(La)TeX Entry</h3><pre>
@report{burtrum2023connections-v2,
  title = {Host Meta 2 - One Method To Rule Them All},
  author = {Burtrum, Travis},
  type = {XEP},
  number = {0487},
  version = {0.1.0},
  institution = {XMPP Standards Foundation},
  url = {https://xmpp.org/extensions/xep-0487.html},
  date = {2023-11-19/2024-03-10},
}</pre><p>END</p></body></html>
