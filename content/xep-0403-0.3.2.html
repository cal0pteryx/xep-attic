<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>XEP-0403: Mediated Information eXchange (MIX): Presence Support.</title><style type="text/css">
/* don't mind this hack */
nav#toc h2:before {
display: none;
content: "XEP-0403";
}
        </style><link rel="stylesheet" type="text/css" href="xmpp.css"><link href="prettify.css" type="text/css" rel="stylesheet"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"><script type="text/javascript" src="prettify.js"></script><meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0"><meta name="DC.Title" content="Mediated Information eXchange (MIX): Presence Support."><meta name="DC.Creator" content="Kevin Smith"><meta name="DC.Creator" content="Steve Kille"><meta name="DC.Description" content="This document defines an extension to Mediated Information eXchange (MIX) specified in XEP-0369 to provide presence information for MIX clients to MIX channel participants.  It also specifies relay of IQ stanzas through a MIX channel. "><meta name="DC.Publisher" content="XMPP Standards Foundation"><meta name="DC.Contributor" content="XMPP Extensions Editor"><meta name="DC.Date" content="2020-12-01"><meta name="DC.Type" content="XMPP Extension Protocol"><meta name="DC.Format" content="XHTML"><meta name="DC.Identifier" content="XEP-0403"><meta name="DC.Language" content="en"><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright © 1999 – 2020 by the XMPP Standards Foundation (XSF)."></head><body onload="prettyPrint()"><h1>XEP-0403: Mediated Information eXchange (MIX): Presence Support.</h1><div class="docmeta-wrap"><dl id="docmeta" class="compact"><dt>Abstract</dt><dd>This document defines an extension to Mediated Information eXchange (MIX) specified in XEP-0369 to provide presence information for MIX clients to MIX channel participants.  It also specifies relay of IQ stanzas through a MIX channel. </dd><dt>Authors</dt><dd><ul class="authors"><li>Kevin Smith</li><li>Steve Kille</li></ul></dd><dt>Copyright</dt><dd>© 1999 – 2020 XMPP Standards Foundation. <a href="#appendix-legal">SEE LEGAL NOTICES</a>.</dd><dt>Status</dt><dd><p>Deferred</p><div id="status-notice" class="deferred standards track">WARNING: This document has been automatically Deferred after 12 months of inactivity in its previous Experimental state. Implementation of the protocol described herein is not recommended for production systems. However, exploratory implementations are encouraged to resume the standards process.</div></dd><dt>Type</dt><dd>Standards Track</dd><dt>Version</dt><dd>0.3.2 (2020-12-01)</dd></dl><div class="timeline-wrap"><div class="timeline-head">Document Lifecycle</div><ol class="timeline"><li>Experimental</li><li class="current inserted">Deferred</li><li>Proposed</li><li>Draft</li><li>Final</li></ol></div></div><nav id="toc"><a href="#top"><h2>Table of Contents</h2></a><ol class="toc"><li><a href="#intro">Introduction</a></li><li><a href="#reqs">Requirements</a></li><li><a href="#concepts">Concepts</a><ol><li><a href="#concept-participant-info">Participant Information in Presence</a></li><li><a href="#concept-jid-address">Partipant JID Addressing for Presence and IQ relay</a></li><li><a href="#concepts-presence">User Presence in MIX</a></li><li><a href="#concepts-roster">MIX Channels in Roster</a></li><li><a href="#presence-node">Presence Node</a></li></ol></li><li><a href="#usecases">Use Cases</a><ol><li><a href="#usecase-user-presence">Setting User Presence</a></li><li><a href="#usecase-obtaining-presence">Client Coming Online and Obtaining Presence from the Local Server</a></li><li><a href="#usecase-user-offline">Going Offline</a></li><li><a href="#usecase-presence-leave">User Leaving a Channel</a></li><li><a href="#usecase-iq-relay">Relaying IQ Stanzas</a></li><li><a href="#usecase-vcard">Requesting a vCard through a Channel</a></li></ol></li><li><a href="#use-presence-initialize">Presence Initializion</a></li><li><a href="#i18n">Internationalization Considerations</a></li><li><a href="#security">Security Considerations</a></li><li><a href="#iana">IANA Considerations</a></li><li><a href="#registrar">XMPP Registrar Considerations</a></li><li><a href="#schema">XML Schema</a></li><li><a href="#ack">Acknowledgements</a></li></ol><h6><a href="#appendices">Appendices</a></h6><ol class="toc-appendices"><li><a href="#appendix-docinfo">Document Information</a></li><li><a href="#appendix-authorinfo">Author Information</a></li><li><a href="#appendix-legal">Legal Notices</a></li><li><a href="#appendix-xmpp">Relation to XMPP</a></li><li><a href="#appendix-discuss">Discussion Venue</a></li><li><a href="#appendix-conformance">Requirements Conformance</a></li><li><a href="#appendix-notes">Notes</a></li><li><a href="#appendix-revs">Revision History</a></li></ol></nav><h2 id="intro">1.
       Introduction<a class="anchor-link" href="#intro"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">The Mediated Information eXchange (MIX) protocol framework and core capabilities for message distribution are specified in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0369.html">Mediated Information eXchange (MIX) (XEP-0369)</a></span>  [<a href="#nt-idm80">1</a>] (MIX-CORE).    This specification enables presence status of online clients belonging to channel participants to be shared through the channel with participants that wish to see this presence status.   This is a achieved by a MIX presence node, which channel participants may subscribe to.
   </p>
  <p class="" style="">
    MIX-CORE shares participant JIDs, which enables messages to be exchange directly. 
    To facilitate communication between clients IQ stanzas  MAY be routed through a MIX channel.  This is needed because IQ stanzas from an unknown JID may be blocked.  Routing IQ stanzas through the channel avoids this.
  </p>

<h2 id="reqs">2.
       Requirements<a class="anchor-link" href="#reqs"><abbr title="Link to this point in the document">¶</abbr></a></h2>

<p class="" style="">This specification addressed a number of presence requirements:</p>

  <ol start="" class="" style="">
    <li class="" style="">The mechanism must work cleanly for participants with multiple clients.</li>
    <li class="" style="">Standard presence messages must be used to share presence.</li>
    <li class="" style="">Nick changes should be visible as changes (and not as a new user).</li>
    <li class="" style="">Where <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0404.html">Mediated Information eXchange (MIX): JID Hidden Channels. (XEP-0404)</a></span>  [<a href="#nt-idm92">2</a>] (MIX-ANON) is not used,  a mechanism is needed so that participants are able to directly contact other participants.</li>
    <li class="" style="">IQ stanzas, including vCard, can be be sent indirectly through a MIX channel.</li>

  </ol>

<h2 id="concepts">3.
       Concepts<a class="anchor-link" href="#concepts"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  
 <div class="indent"><h3 id="concept-participant-info">3.1 Participant Information in Presence<a class="anchor-link" href="#concept-participant-info"><abbr title="Link to this point in the document">¶</abbr></a></h3>
   <p class="" style="">
     A MIX channel implementing this specification MUST be able to distribute presence information about channel participants.   In order to share JID and Nick information about a participant, this information is encoded in the presence message.   This allows full presence information to be shared for each participant without the need for the client to perform any lookup.    
   </p>
 </div>
  
  

<div class="indent"><h3 id="concept-jid-address">3.2 Partipant JID Addressing for Presence and IQ relay<a class="anchor-link" href="#concept-jid-address"><abbr title="Link to this point in the document">¶</abbr></a></h3>
  <p class="" style="">
    Participants in Presence messages and in IQ messages relayed through a channel are identified by an encoded JID of the form are encoded, using the format "&lt;stable-participant-identifier&gt;#&lt;channel&gt;@&lt;mix domain&gt;".   This provides a stable JID for each participant. This JID format is used in three places:
  </p>
  <ol start="" class="" style="">
    <li class="" style="">The 'from' of presence stanzas generated by the channel, where the from encodes the Stable Participant ID of the participant to which the presence stanza relates.</li>
    <li class="" style="">The 'to' of IQ stanzas being addresses to a participant and being sent to the channel for indirect communication.</li>
    <li class="" style="">The 'from' of IQ stanzas coming from the channel, to reflect the sending participant where this stanza is being relayed by the channel.</li>
  </ol>
  <p class="" style="">
    These JIDs will be used to represent specific JID clients.   The resource associated with the encoded JID can be either of the follipwing two options:
    
 
  </p>
  
  <ol start="" class="" style="">
    <li class="" style="">The resource value from the associated client JID; or</li>
    <li class="" style="">A mapped valued to an anonymized value.  This approach MUST be used with MIX-ANON.</li>
  </ol>
  
  
</div>
  
  
  <div class="indent"><h3 id="concepts-presence">3.3 User Presence in MIX<a class="anchor-link" href="#concepts-presence"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">
      MIX channels store presence of each online client for a user that chooses to publish presence, in the format that is distributed as presence.  Presence is stored in the presence node with an item for each client that is publishing presence.  Each item is named with an encoded JID and contains the presence information that is distributed.    Where a user publishes presence for one or more clients, this information is available to all users subscribing to the channel presence.
    </p>
    <p class="" style="">
      A client participating in a MUC channel MAY send its presences status to the MIX channel using standard presence.  The mechanisms to do this are summarized in the next section and standardized in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0405.html">Mediated Information eXchange (MIX): Participant Server Requirements (XEP-0405)</a></span>  [<a href="#nt-idm113">3</a>].
    </p>

    <p class="" style="">
      The MIX channel will distribute received presence to participants that have subscribed to the participants node.   The client to which each presence update refers is identified by the &lt;from&gt; of the presence sent by the MIX channel, using the encoded JID format.
  
    </p>

    <p class="" style="">
      Presence updates are distributed by a channel to the bare JID of each participant and then the subscriber's server will distribute to each of the participant's currently online clients following the rules set out in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0405.html">Mediated Information eXchange (MIX): Participant Server Requirements (XEP-0405)</a></span>  [<a href="#nt-idm113">3</a>].
    </p>
  </div>



  <div class="indent"><h3 id="concepts-roster">3.4 MIX Channels in Roster<a class="anchor-link" href="#concepts-roster"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">
      When a user joins a MIX channel, the channel MUST be added to the user's roster, as specified in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0405.html">Mediated Information eXchange (MIX): Participant Server Requirements (XEP-0405)</a></span>  [<a href="#nt-idm113">3</a>].   There are two reasons for this.
    </p>
    <ol start="" class="" style="">
      <li class="" style="">It enables a client to determine which channels the user has joined and so may expect messages and/or presence updates from (dependent on what the user has subscribed to).</li>
      <li class="" style="">
        When the user has chosen to share presence with the channel, it enables this to happen using standard presence mechanisms.  This avoids the need for MIX-specific mechanisms for clients to update presence on a channel.  When a client comes online, presence information will be sent to each MIX channel that the user participates in.   This will update other channel participants.  It will also lead to a presence update for each MIX channel being sent to the client.   So a user will receive channel presence information as the user comes online, in contrast to being subsequent to a MUC Join.
      </li>
    </ol>
  </div>






  <div class="indent"><h3 id="presence-node">3.5 Presence Node<a class="anchor-link" href="#presence-node"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">MIX defines one node to support presence, as summarized in the table below.  This node is required to support this specification.</p>
    <figure class="table"><figcaption id="table-1"><strong>Table 1:</strong> MIX Presence Node<a class="anchor-link" href="#table-1"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><table>
      <tr class="body"><th colspan="" rowspan="">Name</th><th colspan="" rowspan="">Node</th><th colspan="" rowspan="">Description</th><th colspan="" rowspan="">Update</th><th colspan="" rowspan="">Distribution</th></tr>

      <tr class="body"><td align="" colspan="" rowspan="">Presence</td><td align="" colspan="" rowspan="">'urn:xmpp:mix:nodes:presence'</td><td align="" colspan="" rowspan="">For storing information about the availability status of online participants, which MAY include multiple clients for a single participant.</td><td align="" colspan="" rowspan="">Presence</td><td align="" colspan="" rowspan="">Presence</td></tr>

    </table></figure>




      <p class="" style="">
        The presence node contains the presence value for clients belonging to participants that choose to publish presence to the channel. A MIX channel MAY require that all participants publish presence, so that active channel participants are visible.  It is not possible to enforce this in the server, so participants in a channel with this option MUST publish presence.  Each item in the presence node is identified by an encoded JID. The presence is encoded as a standard a presence stanza using a &lt;presence/&gt; element qualified by the 'jabber:client' namespace.
      </p>
    <p class="" style="">
      MIX extends the &lt;presence&gt; stanza using a &lt;mix&gt; element qualified by the 'urn:xmpp:mix:presence:0' namespace.  This enables any receiver of presence  to identify the JID of the client to which the  presence presence refers and to have a nick to display.  This element contains two child elements:
    </p>
    <ol start="" class="" style="">
      <li class="" style="">A &lt;nick&gt; element that contains the Nick of the message sender, taken from the Participants Node.  This MUST be present if a Nick is defined for the user.</li>
      <li class="" style="">A &lt;jid&gt; element containing the  full JID of the client. This MUST be present, unless following the "JID Hidden" model defined in MIX-ANON.  If this element is omitted, the &lt;nick&gt; element MUST be present.</li>
    </ol>
 
      <p class="" style="">
        This node MAY be subscribed to by users using the user's bare JID.  So presence of online clients is sent to the user's server for each user subscribed to this node. Presence is always sent using standard presence protocol and MUST NOT be sent using pubsub protocol.   Clients MUST NOT directly access the presence node using pubsub.  The Presence node is a permanent PubSub node.  The following example shows a presence node value for the client with full JID 'hecate@shakespeare.example/UUID-x4r/2491'.
      </p>
      <figure class="code-example" id="example-1"><figcaption><strong>Example 1.</strong> Value of Presence Node<a class="anchor-link" href="#example-1"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;items node='urn:xmpp:mix:nodes:presence'&gt;
  &lt;item id='123456#coven@mix.shakespeare.example/UUID-x4r/2491'&gt;
    &lt;presence xmlns='jabber:client'&gt;
      &lt;mix xmlns='urn:xmpp:mix:presence:0'&gt;
        &lt;jid&gt;hecate@shakespeare.example/UUID-x4r/2491&lt;/jid&gt;
        &lt;nick&gt;thirdwitch&lt;/jid&gt;
      &lt;/mix&gt;
      &lt;show&gt;dnd&lt;/show&gt;
      &lt;status&gt;Making a Brew&lt;/status&gt;
    &lt;/presence&gt;
  &lt;/item&gt;
&lt;/items&gt;
</pre></figure>



  </div>

<h2 id="usecases">4.
       Use Cases<a class="anchor-link" href="#usecases"><abbr title="Link to this point in the document">¶</abbr></a></h2>



    <div class="indent"><h3 id="usecase-user-presence">4.1 Setting User Presence<a class="anchor-link" href="#usecase-user-presence"><abbr title="Link to this point in the document">¶</abbr></a></h3>
      <p class="" style="">

        A user joins a channel over an extended period, and participation in a channel does not generally change when user goes online or offline.   The user's  participation in a channel is reflected by the user's bare JID in the participant node.   All messages to the channel are sent to this JID.

      </p>
      <p class="" style="">

A user MAY share presence information with the channel, for one or more online clients.   The channel is entered by the user's server into the user's roster when the user subscribes to the channel as specified in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0405.html">Mediated Information eXchange (MIX): Participant Server Requirements (XEP-0405)</a></span>  [<a href="#nt-idm113">3</a>].  Where a user shares presence information with a channel, the subscription is configured with one way presence, which will cause all presence changes for the client to be sent to the channel.
    When an XMPP client comes online or changes presence status, this will be communicated by the user to the user's server using broadcast presence.  The user's XMPP server is then responsible to share this presence information to each entry in the roster and in particular to each MIX channel in the roster.
      </p>
      <p class="" style="">
    The MIX channel will update the "urn:xmpp:mix:nodes:presence" node with any change of status and the updated presence information and then share this updated presence with users subscribed to this node, as described below.   When the user sets an explicit status, this is used to modify the presence node in the channel.   When a client being used by the user goes offline, the associated server will send presence status "unavailable" to the MIX channel, which will cause the node item for that client to be removed from the presence node.
      </p>

      <p class="" style="">
      Presence status and availability is set in a MIX channel by standard presence stanzas sent to the MIX channel by the user's server.   Users wishing to receive presence updates will subscribe to the MIX channel presence node.   Presence updates are sent out to subscribing participants using standard presence stanzas.
      </p>
      <p class="" style="">
        A user setting status is now used as an example.   Unlike in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idm165">4</a>] where coming online is a special action, coming online in MIX is implicit when presence status is set.  Going offline is a achieved by setting presence status to unavailable, which removes the client full JID entry from the presence node.  When a user sets a presence status, the user's server sends updated presence to the MIX channel, and the MIX service then publishes the user's  availability to the "urn:xmpp:mix:nodes:presence" node. If there is not an item named by the full JID of the client with updated presence status, this item is created.   The sequence is shown in the following examples, starting with a client setting presences status on the connected server.</p>
      <figure class="code-example" id="example-2"><figcaption><strong>Example 2.</strong> Client Sets Presence Status on Server<a class="anchor-link" href="#example-2"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;presence xmlns='jabber:client'
               from='hag66@shakespeare.example/UUID-a1j/7533'&gt;
  &lt;show&gt;dnd&lt;/show&gt;
  &lt;status&gt;Making a Brew&lt;/status&gt;
&lt;/presence&gt;</pre></figure>

      <p class="" style="">
        The server then sends the presence information to roster entries.  The following example then shows the presence message from the client's server to the MIX channel.
      </p>
      <figure class="code-example" id="example-3"><figcaption><strong>Example 3.</strong> Server sends Presence Status to MIX Channel<a class="anchor-link" href="#example-3"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;presence  from='hag66@shakespeare.example/UUID-a1j/7533'
              to='coven@mix.shakespeare.example'&gt;
  &lt;show&gt;dnd&lt;/show&gt;
  &lt;status&gt;Making a Brew&lt;/status&gt;
&lt;/presence&gt;</pre></figure>
      <p class="" style="">The user's presence information is then published by the service to the "urn:xmpp:mix:nodes:presence" node. The MIX channel then broadcasts the presence change to all users who are subscribed to the "urn:xmpp:mix:nodes:presence" node.  The presence stanza 'from' uses an encoded JID.
      Note that presence is associated with a client and so will have a full JID.  The following example shows a presence message as distributed by the server to a presences subscriber.</p>
      <figure class="code-example" id="example-4"><figcaption><strong>Example 4.</strong> Channel Distributes Presence<a class="anchor-link" href="#example-4"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;presence from='123435#coven@mix.shakespeare.example/UUID-a1j/7533'
          to='hag99@shakespeare.example'
          id='77E07BB0-55CF-4BD4-890E-3F7C0E686BBD'&gt;
  &lt;mix xmlns='urn:xmpp:mix:presence:0'&gt;
     &lt;jid&gt;hecate@shakespeare.example/UUID-x4r/2491&lt;/jid&gt;
     &lt;nick&gt;thirdwitch&lt;/jid&gt;
  &lt;/mix&gt;
  &lt;show&gt;dnd&lt;/show&gt;
  &lt;status&gt;Making a Brew&lt;/status&gt;
&lt;/presence&gt;</pre></figure>
    <p class="" style="">
     The presence is distributed to those subscribing to the MIX channel presence node using a standard XMPP presence stanza. The presence change is recorded on the "urn:xmpp:mix:nodes:presence" node.

    </p>
      <p class="" style="">
        The history of the presence node MAY be archived using MAM.   The MAM archive stores the node in PubSub format, following the node specification.  This enables presence history to be retrieved using PubSub.
      </p>
    </div>





    <div class="indent"><h3 id="usecase-obtaining-presence">4.2 Client Coming Online and Obtaining Presence from the Local Server<a class="anchor-link" href="#usecase-obtaining-presence"><abbr title="Link to this point in the document">¶</abbr></a></h3>
      <p class="" style="">
       MIX Clients obtain presence from their local server.   This is specified in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0405.html">Mediated Information eXchange (MIX): Participant Server Requirements (XEP-0405)</a></span>  [<a href="#nt-idm113">3</a>].

      </p>


    </div>






    <div class="indent"><h3 id="usecase-user-offline">4.3 Going Offline<a class="anchor-link" href="#usecase-user-offline"><abbr title="Link to this point in the document">¶</abbr></a></h3>
      <p class="" style="">When a client goes offline, this presence update is sent by the client's server to the MIX channel.   From the client perspective, this is the same as any other presence change.   The MIX Channel also needs to remove the client from the participant's node.</p>
      <figure class="code-example" id="example-5"><figcaption><strong>Example 5.</strong> Client Goes Offline in the Channel<a class="anchor-link" href="#example-5"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;presence type='unavailable'
          from='hag66@shakespeare.example/UUID-a1j/7533'
          to='coven@mix.shakespeare.example'/&gt;
</pre></figure>
      <p class="" style="">The MIX channel will retract (remove) the item in the presence node of the MIX channel identified by the client's full JID.  The MIX channel will notify subscribers to the presence node of the user going offline by sending a presence stanza to the full  JID of each client. The presence stanza will use the encoded JID of the client that is going offline, as shown in the following example:</p>

      <figure class="code-example" id="example-6"><figcaption><strong>Example 6.</strong> Channel Distributes Notification of Client going Offline<a class="anchor-link" href="#example-6"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;presence from='12345#coven@mix.shakespeare.example/UUID-a1j/7533'
          to='hecate@shakespeare.example'
          id='77E07BB0-55CF-4BD4-890E-3F7C0E686BBD'
          type='unavailable'&gt;
      &lt;mix xmlns='urn:xmpp:mix:presence:0'&gt;
        &lt;jid&gt;hecate@shakespeare.example/UUID-x4r/2491&lt;/jid&gt;
        &lt;nick&gt;thirdwitch&lt;/jid&gt;
      &lt;/mix&gt;
&lt;/presence&gt;</pre></figure>

      <p class="" style="">
        There is the possibility that the message associated with the user going offline will be lost.   If this happens, "ghost" entries will appear in the presence node.   A MIX service MAY take steps to address this, for example by probing client with a disco for presence items that remain unchanged for a long period.
      </p>



    </div>

    <div class="indent"><h3 id="usecase-presence-leave">4.4 User Leaving a Channel<a class="anchor-link" href="#usecase-presence-leave"><abbr title="Link to this point in the document">¶</abbr></a></h3>
      <p class="" style="">
        The primary actions for a user leaving a channel are specified in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0369.html">Mediated Information eXchange (MIX) (XEP-0369)</a></span>  [<a href="#nt-idm80">1</a>].    This section sets out additional actions for handling presence.    When a user leaves the channel, all entries for the user's clients MUST be removed from the participants node.   The MIX channel MUST distribute unavailable presence notifications for each client removed to all subscribers of the participants node.
      </p>

      <figure class="code-example" id="example-7"><figcaption><strong>Example 7.</strong> Channel Distributes Notification when User Leaves Channel<a class="anchor-link" href="#example-7"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;presence from='12345#coven@mix.shakespeare.example/UUID-a1j/7533'
          to='hecate@shakespeare.example'
          id='77E07BB0-55CF-4BD4-890E-3F7C0E686BBD'
          type='unavailable'&gt;
      &lt;mix xmlns='urn:xmpp:mix:presence:0'&gt;
        &lt;jid&gt;hecate@shakespeare.example/UUID-x4r/2491&lt;/jid&gt;
        &lt;nick&gt;thirdwitch&lt;/jid&gt;
      &lt;/mix&gt;
&lt;/presence&gt;</pre></figure>

    </div>


<div class="indent"><h3 id="usecase-iq-relay">4.5 Relaying IQ Stanzas<a class="anchor-link" href="#usecase-iq-relay"><abbr title="Link to this point in the document">¶</abbr></a></h3>
  <p class="" style="">
    MIX channels MAY relay IQ stanzas between participants.  This is often useful to obtain client information where a direct request to the client would be blocked.   When a client sends an IQ stanza through a MIX channel, it will set the 'from' to its own JID and set the 'to' to the encoded JID of the recipient.   Participants may be addressed by full JID or bare JID.   The MIX channel will modify the JIDs in the outgoing message, so that the 'to' is the full JID of the recipient and the 'from' is the encoded JID of the sender.   This is illustrated in the vCard section below.
  </p>
</div>
  
  
  
  <div class="indent"><h3 id="usecase-vcard">4.6 Requesting a vCard through a Channel<a class="anchor-link" href="#usecase-vcard"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A client  MAY request the vCard of a channel participant through a MIX channel, for example to get an avatar.  The MIX channel MAY pass this request on or MAY block it.  vCard requests MAY use <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0054.html">vcard-temp (XEP-0054)</a></span>  [<a href="#nt-idm199">5</a>] (vcard-temp) or <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0292.html">vCard4 over XMPP (XEP-0292)</a></span>  [<a href="#nt-idm203">6</a>] (vCard4 over XMPP).  The MIX channel does not process the vCard requests, but simply relays them on to real bare JID of the target.  A MIX service MAY choose to relay one or both protocols.   In the following example, using vcard-temp, the requesting client sends a message to the  encoded JID of the channel participant for which the vCard is desired.</p>
    <figure class="code-example" id="example-8"><figcaption><strong>Example 8.</strong> Client directly requests vCard through channel<a class="anchor-link" href="#example-8"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='hag66@shakespeare.example/UUID-c8y/1573'
    id='lx09df27'
    to='989898#coven@mix.shakespeare.example'
    type='get'&gt;
  &lt;vCard xmlns='vcard-temp'/&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">The MIX channel MAY pass on the vCard request or MAY reject with an error, dependent on channel policy.  The MIX service will then address the vCard request to the user's server (using bare JID) using an the encoded JID of the requester in the 'from'.  </p>
    <figure class="code-example" id="example-9"><figcaption><strong>Example 9.</strong> Channel passes on vCard request to the User's Server<a class="anchor-link" href="#example-9"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='123456#coven@mix.shakespeare.example/6789'
    id='lx09df27'
    to='peter@shakespeare.example'
    type='get'&gt;
  &lt;vCard xmlns='vcard-temp'/&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">
      The user's server, on behalf of the user, MUST send a response or reject with an error.   The user's server will send the vCard back to the channel.
    </p>
    <figure class="code-example" id="example-10"><figcaption><strong>Example 10.</strong> User's Server sends vCard Response via MIX channel<a class="anchor-link" href="#example-10"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='peter@shakespeare.example'
    id='lx09df27'
    to='123456#coven@mix.shakespeare.example/6789'
    type='result'&gt;
    &lt;vCard xmlns='vcard-temp'&gt;
    &lt;FN&gt;Peter Saint-Andre&lt;/FN&gt;
    &lt;N&gt;
      &lt;FAMILY&gt;Saint-Andre&lt;/FAMILY&gt;
      &lt;GIVEN&gt;Peter&lt;/GIVEN&gt;
      &lt;MIDDLE/&gt;
    &lt;/N&gt;
    &lt;NICKNAME&gt;stpeter&lt;/NICKNAME&gt;
    &lt;URL&gt;http://www.xmpp.org/xsf/people/stpeter.shtml&lt;/URL&gt;
  &lt;/vCard&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">
      The MIX channel will then send the vCard response to the requesting client on behalf of the client sending the response.
    </p>
    <figure class="code-example" id="example-11"><figcaption><strong>Example 11.</strong> MIX Channel sends vCard responst to Client<a class="anchor-link" href="#example-11"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='989898#coven@mix.shakespeare.example'
    id='lx09df27'
    to='hag66@shakespeare.example/UUID-c8y/1573'
    type='result'&gt;
 &lt;vCard xmlns='vcard-temp'&gt;
    &lt;FN&gt;Peter Saint-Andre&lt;/FN&gt;
    &lt;N&gt;
      &lt;FAMILY&gt;Saint-Andre&lt;/FAMILY&gt;
      &lt;GIVEN&gt;Peter&lt;/GIVEN&gt;
      &lt;MIDDLE/&gt;
    &lt;/N&gt;
    &lt;NICKNAME&gt;stpeter&lt;/NICKNAME&gt;
    &lt;URL&gt;http://www.xmpp.org/xsf/people/stpeter.shtml&lt;/URL&gt;
  &lt;/vCard&gt;
&lt;/iq&gt;
</pre></figure>
  </div>
  
<h2 id="use-presence-initialize">5.
       Presence Initializion<a class="anchor-link" href="#use-presence-initialize"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">
    For an active MIX Channel, the presence node is updated as channel participants change status and presence information is sent to the channel.  When a MIX channel starts, typically when the associated MIX Service and Server start, there is a need to initialize the presence node.    This is done by the XMPP server associated with the MIX channel sending out a presence probe for each channel participant, following the presence probe process specified in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc6121">RFC 6121</a></span>  [<a href="#nt-idm216">7</a>].   A presence probe MUST NOT be sent for users who have set presence preference to not sharing.
  </p>
<h2 id="i18n">6.
       Internationalization Considerations<a class="anchor-link" href="#i18n"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">See considerations in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0369.html">Mediated Information eXchange (MIX) (XEP-0369)</a></span>  [<a href="#nt-idm80">1</a>].
  </p>

<h2 id="security">7.
       Security Considerations<a class="anchor-link" href="#security"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">See considerations in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0369.html">Mediated Information eXchange (MIX) (XEP-0369)</a></span>  [<a href="#nt-idm80">1</a>].</p>

  <p class="" style="">
    When converting a 1:1 conversation to a channel there is potential to expose sensitive information and to present invalid information.
  </p>

<h2 id="iana">8.
       IANA Considerations<a class="anchor-link" href="#iana"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">None.</p>
<h2 id="registrar">9.
       XMPP Registrar Considerations<a class="anchor-link" href="#registrar"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">The urn:xmpp:mix namespace needs to be registered.</p>
<h2 id="schema">10.
       XML Schema<a class="anchor-link" href="#schema"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">To be supplied when MIX progresses to proposed standard.</p>
<h2 id="ack">11.
       Acknowledgements<a class="anchor-link" href="#ack"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">See <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0369.html">Mediated Information eXchange (MIX) (XEP-0369)</a></span>  [<a href="#nt-idm80">1</a>] for a list of contributors to the MIX Family of specifications.</p>
<hr><a name="appendices"></a><h2>Appendices</h2><h3 id="appendix-docinfo">Appendix A: Document Information<a class="anchor-link" href="#appendix-docinfo"><abbr title="Link to this point in the document">¶</abbr></a></h3><dl class="compact"><dt>Series</dt><dd><a href="http://xmpp.org/extensions/">XEP</a></dd><dt>Number</dt><dd>0403</dd><dt>Publisher</dt><dd><a href="/xsf/">XMPP Standards Foundation</a></dd><dt>Status</dt><dd><a href="http://xmpp.org/extensions/xep-0001.html#states-Deferred">Deferred</a></dd><dt>Type</dt><dd><a href="http://xmpp.org/extensions/xep-0001.html#types-Standards%20Track">Standards Track</a></dd><dt>Version</dt><dd>0.3.2</dd><dt>Last Updated</dt><dd>2020-12-01</dd><dt>Approving Body</dt><dd><a href="http://xmpp.org/council/">XMPP Council</a></dd><dt>Dependencies</dt><dd>XMPP Core, XMPP IM, XEP-0004, XEP-0030, XEP-0054, XEP-0060, XEP-0084, XEP-0128, XEP-0198, XEP-0292, XEP-0297, XEP-0313, XEP-0369, XEP-0372, XEP-0404, XEP-0405</dd><dt>Supersedes</dt><dd>None</dd><dt>Superseded By</dt><dd>None</dd><dt>Short Name</dt><dd>MIX-PRESENCE</dd><dt>Source Control</dt><dd><a class="standardsButton" href="https://github.com/xsf/xeps/blob/master/xep-0403.xml">HTML</a></dd></dl><p>
          This document in other formats:
          <a class="standardsButton" href="http://xmpp.org/extensions/xep-0403.xml">XML</a> 
          <a class="standardsButton" href="http://xmpp.org/extensions/xep-0403.pdf">PDF</a></p><h3 id="appendix-authorinfo">Appendix B: Author Information<a class="anchor-link" href="#appendix-authorinfo"><abbr title="Link to this point in the document">¶</abbr></a></h3><h5>Kevin Smith</h5><dl class="compact"><dt>Email</dt><dd><a href="mailto:kevin.smith@isode.com">kevin.smith@isode.com</a></dd><dt>JabberID</dt><dd><a href="xmpp:kevin.smith@isode.com">kevin.smith@isode.com</a></dd></dl><h5>Steve Kille</h5><dl class="compact"><dt>Email</dt><dd><a href="mailto:steve.kille@isode.com">steve.kille@isode.com</a></dd><dt>JabberID</dt><dd><a href="xmpp:steve.kille@isode.com">steve.kille@isode.com</a></dd></dl><h3 id="appendix-legal">Appendix C: Legal Notices<a class="anchor-link" href="#appendix-legal"><abbr title="Link to this point in the document">¶</abbr></a></h3><div class="indent"><h4>Copyright</h4><p>This XMPP Extension Protocol is copyright © 1999 – 2020 by the <a href="https://xmpp.org/">XMPP Standards Foundation</a> (XSF).</p><h4>Permissions</h4><p>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.</p><h4>Disclaimer of Warranty</h4><p class="box info">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. ##</p><h4>Limitation of Liability</h4><p>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.</p><h4>IPR Conformance</h4><p>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which can be found at &lt;<a href="https://xmpp.org/about/xsf/ipr-policy">https://xmpp.org/about/xsf/ipr-policy</a>&gt; or obtained by writing to XMPP Standards Foundation, P.O. Box 787, Parker, CO 80134 USA).</p><h4>Visual Presentation</h4><p>The HTML representation (you are looking at) is maintained by the XSF. It is based on the <a href="http://yaml.de">YAML CSS Framework</a>, which is licensed under the terms of the <a href="https://creativecommons.org/licenses/by/2.0/">CC-BY-SA 2.0</a> license.</p></div><h3 id="appendix-xmpp">Appendix D: Relation to XMPP<a class="anchor-link" href="#appendix-xmpp"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 6120) and XMPP IM (RFC 6121) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><h3 id="appendix-discuss">Appendix E: Discussion Venue<a class="anchor-link" href="#appendix-discuss"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">The primary venue for discussion of XMPP Extension Protocols is the &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">standards@xmpp.org</a>&gt; discussion list.</p><p class="indent">Discussion on other xmpp.org discussion lists might also be appropriate; see &lt;<a href="http://xmpp.org/about/discuss.shtml">http://xmpp.org/about/discuss.shtml</a>&gt; for a complete list.</p><p class="indent">Errata can be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><h3 id="appendix-conformance">Appendix F: Requirements Conformance<a class="anchor-link" href="#appendix-conformance"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">The following requirements keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><h3 id="appendix-notes">Appendix G: Notes<a class="anchor-link" href="#appendix-notes"><abbr title="Link to this point in the document">¶</abbr></a></h3><div class="indent"><p><a name="nt-idm80">1</a>. XEP-0369: Mediated Information eXchange (MIX) &lt;<a href="https://xmpp.org/extensions/xep-0369.html">https://xmpp.org/extensions/xep-0369.html</a>&gt;.</p><p><a name="nt-idm92">2</a>. XEP-0404: Mediated Information eXchange (MIX): JID Hidden Channels. &lt;<a href="https://xmpp.org/extensions/xep-0404.html">https://xmpp.org/extensions/xep-0404.html</a>&gt;.</p><p><a name="nt-idm113">3</a>. XEP-0405: Mediated Information eXchange (MIX): Participant Server Requirements &lt;<a href="https://xmpp.org/extensions/xep-0405.html">https://xmpp.org/extensions/xep-0405.html</a>&gt;.</p><p><a name="nt-idm165">4</a>. XEP-0045: Multi-User Chat &lt;<a href="https://xmpp.org/extensions/xep-0045.html">https://xmpp.org/extensions/xep-0045.html</a>&gt;.</p><p><a name="nt-idm199">5</a>. XEP-0054: vcard-temp &lt;<a href="https://xmpp.org/extensions/xep-0054.html">https://xmpp.org/extensions/xep-0054.html</a>&gt;.</p><p><a name="nt-idm203">6</a>. XEP-0292: vCard4 over XMPP &lt;<a href="https://xmpp.org/extensions/xep-0292.html">https://xmpp.org/extensions/xep-0292.html</a>&gt;.</p><p><a name="nt-idm216">7</a>. RFC 6121: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://tools.ietf.org/html/rfc6121">http://tools.ietf.org/html/rfc6121</a>&gt;.</p></div><h3 id="appendix-revs">Appendix H: Revision History<a class="anchor-link" href="#appendix-revs"><abbr title="Link to this point in the document">¶</abbr></a></h3><p>Note: Older versions of this specification might be available at <a href="http://xmpp.org/extensions/attic/">http://xmpp.org/extensions/attic/</a></p><ol class="revision-history"><li id="revision-history-v0.3.2"><div class="revision-head">Version 0.3.2 (2020-12-01)<a class="anchor-link" href="#revision-history-v0.3.2"><abbr title="Link to this point in the document">¶</abbr></a></div>Fix incorrect namespaces<div class="revision-author">gh/@mathieui</div></li><li id="revision-history-v0.3.1"><div class="revision-head">Version 0.3.1 (2018-11-03)<a class="anchor-link" href="#revision-history-v0.3.1"><abbr title="Link to this point in the document">¶</abbr></a></div>Fix a bunch of typos, batch-style.<div class="revision-author">pep</div></li><li id="revision-history-v0.3.0"><div class="revision-head">Version 0.3.0 (2018-06-06)<a class="anchor-link" href="#revision-history-v0.3.0"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">
     Allow mapped resource in presence;
     Remove extraneous vCard checks;
    </p><div class="revision-author">sek</div></li><li id="revision-history-v0.2.0"><div class="revision-head">Version 0.2.0 (2018-06-05)<a class="anchor-link" href="#revision-history-v0.2.0"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">
      Change JID Addressing of IQs and Presence;
      Clarify routing if IQs through channel;
      Add vCard routing;
      Add mix information to presence;
    </p><div class="revision-author">sek</div></li><li id="revision-history-v0.1.0"><div class="revision-head">Version 0.1.0 (2018-05-21)<a class="anchor-link" href="#revision-history-v0.1.0"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">
      Split out from MIX 0.10.0;
    </p><div class="revision-author">sek</div></li></ol><p>END</p></body></html>
