<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>XEP-0060: Publish-Subscribe</title><style type="text/css">
/* don't mind this hack */
nav#toc h2:before {
display: none;
content: "XEP-0060";
}
        </style><link rel="stylesheet" type="text/css" href="xmpp.css"><link href="prettify.css" type="text/css" rel="stylesheet"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"><script type="text/javascript" src="prettify.js"></script><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0"><meta name="DC.Title" content="Publish-Subscribe"><meta name="DC.Creator" content="Peter Millard"><meta name="DC.Creator" content="Peter Saint-Andre"><meta name="DC.Creator" content="Ralph Meijer"><meta name="DC.Description" content="This specification defines an XMPP protocol extension for generic publish-subscribe functionality. The protocol enables XMPP entities to create nodes (topics) at a pubsub service and publish information at those nodes; an event notification (with or without payload) is then broadcasted to all entities that have subscribed to the node. Pubsub therefore adheres to the classic Observer design pattern and can serve as the foundation for a wide variety of applications, including news feeds, content syndication, rich presence, geolocation, workflow systems, network management systems, and any other application that requires event notifications."><meta name="DC.Publisher" content="XMPP Standards Foundation"><meta name="DC.Contributor" content="XMPP Extensions Editor"><meta name="DC.Date" content="2021-08-03"><meta name="DC.Type" content="XMPP Extension Protocol"><meta name="DC.Format" content="XHTML"><meta name="DC.Identifier" content="XEP-0060"><meta name="DC.Language" content="en"><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright © 1999 – 2020 by the XMPP Standards Foundation (XSF)."></head><body onload="prettyPrint()"><h1>XEP-0060: Publish-Subscribe</h1><div class="docmeta-wrap"><dl id="docmeta" class="compact"><dt>Abstract</dt><dd>This specification defines an XMPP protocol extension for generic publish-subscribe functionality. The protocol enables XMPP entities to create nodes (topics) at a pubsub service and publish information at those nodes; an event notification (with or without payload) is then broadcasted to all entities that have subscribed to the node. Pubsub therefore adheres to the classic Observer design pattern and can serve as the foundation for a wide variety of applications, including news feeds, content syndication, rich presence, geolocation, workflow systems, network management systems, and any other application that requires event notifications.</dd><dt>Authors</dt><dd><ul class="authors"><li>Peter Millard</li><li>Peter Saint-Andre</li><li>Ralph Meijer</li></ul></dd><dt>Copyright</dt><dd>© 1999 – 2021 XMPP Standards Foundation. <a href="#appendix-legal">SEE LEGAL NOTICES</a>.</dd><dt>Status</dt><dd><p>Draft</p><div id="status-notice" class="draft standards track">NOTICE: The protocol defined herein is a <strong>Draft Standard</strong> of the XMPP Standards Foundation. Implementations are encouraged and the protocol is appropriate for deployment in production systems, but some changes to the protocol are possible before it becomes a Final Standard.</div></dd><dt>Type</dt><dd>Standards Track</dd><dt>Version</dt><dd>1.21.0 (2021-08-03)</dd></dl><div class="timeline-wrap"><div class="timeline-head">Document Lifecycle</div><ol class="timeline"><li>Experimental</li><li>Proposed</li><li class="current">Draft</li><li>Final</li></ol></div></div><nav id="toc"><a href="#top"><h2>Table of Contents</h2></a><ol class="toc"><li><a href="#intro">Introduction</a><ol><li><a href="#intro-overview">Overview</a></li><li><a href="#intro-howitworks">How It Works</a></li></ol></li><li><a href="#glossary">Glossary</a></li><li><a href="#reqs">Requirements</a></li><li><a href="#preliminaries">Preliminaries</a><ol><li><a href="#affiliations">Affiliations</a></li><li><a href="#substates">Subscription States</a></li><li><a href="#events">Event Types</a></li><li><a href="#nodetypes">Node Types</a></li><li><a href="#accessmodels">Node Access Models</a></li><li><a href="#addressing">Addressing</a><ol><li><a href="#addressing-jid">JID</a></li><li><a href="#addressing-jidnode">JID+NodeID</a></li></ol></li></ol></li><li><a href="#entity">Entity Use Cases</a><ol><li><a href="#entity-features">Discover Features</a></li><li><a href="#entity-nodes">Discover Nodes</a></li><li><a href="#entity-info">Discover Node Information</a></li><li><a href="#entity-metadata">Discover Node Metadata</a></li><li><a href="#entity-discoveritems">Discover Items for a Node</a></li><li><a href="#entity-subscriptions">Retrieve Subscriptions</a></li><li><a href="#entity-affiliations">Retrieve Affiliations</a></li></ol></li><li><a href="#subscriber">Subscriber Use Cases</a><ol><li><a href="#subscriber-subscribe">Subscribe to a Node</a><ol><li><a href="#subscriber-subscribe-request">Request</a></li><li><a href="#subscriber-subscribe-success">Success Case</a></li><li><a href="#subscriber-subscribe-error">Error Cases</a><ol><li><a href="#subscriber-subscribe-error-nomatch">JIDs Do Not Match</a></li><li><a href="#subscriber-subscribe-error-presence">Presence Subscription Required</a></li><li><a href="#subscriber-subscribe-error-rostergroup">Not in Roster Group</a></li><li><a href="#subscriber-subscribe-error-whitelist">Not on Whitelist</a></li><li><a href="#subscriber-subscribe-error-payment">Payment Required</a></li><li><a href="#subscriber-subscribe-error-anonymous">Anonymous Subscriptions Not Allowed</a></li><li><a href="#subscriber-subscribe-error-pending">Subscription Pending</a></li><li><a href="#subscriber-subscribe-error-blocked">Blocked</a></li><li><a href="#subscriber-subscribe-error-toomany">Too Many Subscriptions</a></li><li><a href="#subscriber-subscribe-error-unsupported">Subscriptions Not Supported</a></li><li><a href="#subscriber-subscribe-error-redirect">Node Has Moved</a></li><li><a href="#subscriber-subscribe-error-node">Node Does Not Exist</a></li></ol></li><li><a href="#subscriber-subscribe-approval">Approval Required</a></li><li><a href="#subscriber-subscribe-configure">Configuration Required</a></li><li><a href="#subscriber-subscribe-multi">Multiple Subscriptions</a></li><li><a href="#subscriber-subscribe-last">Receiving the Last Published Item</a></li></ol></li><li><a href="#subscriber-unsubscribe">Unsubscribe from a Node</a><ol><li><a href="#subscriber-unsubscribe-request">Request</a></li><li><a href="#subscriber-unsubscribe-success">Success Case</a></li><li><a href="#subscriber-unsubscribe-error">Error Cases</a><ol><li><a href="#subscriber-unsubscribe-error-nosubid">No Subscription ID</a></li><li><a href="#subscriber-unsubscribe-error-nosub">No Such Subscriber</a></li><li><a href="#subscriber-unsubscribe-error-forbidden">Insufficient Privileges</a></li><li><a href="#subscriber-unsubscribe-error-node">Node Does Not Exist</a></li><li><a href="#subscriber-unsubscribe-error-badsubid">Bad Subscription ID</a></li></ol></li></ol></li><li><a href="#subscriber-configure">Configure Subscription Options</a><ol><li><a href="#subscriber-configure-support">Advertising Support</a></li><li><a href="#subscriber-configure-request">Request</a></li><li><a href="#subscriber-configure-success">Success Case</a></li><li><a href="#subscriber-configure-error">Error Cases</a><ol><li><a href="#subscriber-configure-error-forbidden">Insufficient Privileges</a></li><li><a href="#subscriber-configure-error-nosub">No Such Subscriber</a></li><li><a href="#subscriber-configure-error-jid">Subscriber JID Required</a></li><li><a href="#subscriber-configure-error-subid">Subscription ID Required</a></li><li><a href="#subscriber-configure-error-badsubid">Invalid Subscription ID</a></li><li><a href="#subscriber-configure-error-options">Subscription Options Not Supported</a></li><li><a href="#subscriber-configure-error-node">Node Does Not Exist</a></li></ol></li><li><a href="#subscriber-configure-submit">Form Submission</a></li><li><a href="#subscriber-configure-process">Form Processing</a><ol><li><a href="#subscriber-configure-process-success">Success</a></li><li><a href="#subscriber-configure-process-failure">Failure</a></li></ol></li><li><a href="#subscriber-configure-subandconfig">Subscribe and Configure</a></li></ol></li><li><a href="#subscribe-default">Request Default Subscription Configuration Options</a><ol><li><a href="#subscriber-default-request">Request</a></li><li><a href="#subscriber-default-success">Success Case</a></li><li><a href="#subscriber-default-error">Error Cases</a><ol><li><a href="#subscriber-default-error-noconfig">Node Configuration Not Supported</a></li><li><a href="#subscriber-default-error-notsupported">Default Subscription Configuration Retrieval Not Supported</a></li></ol></li></ol></li><li><a href="#subscriber-retrieve">Retrieve Items from a Node</a><ol><li><a href="#subscriber-retrieve-perms">Permissions</a></li><li><a href="#subscriber-retrieve-requestall">Requesting All Items</a></li><li><a href="#subscriber-retrieve-returnall">Returning All Items</a></li><li><a href="#subscriber-retrieve-returnsome">Returning Some Items</a></li><li><a href="#subscriber-retrieve-returnlast">Returning the Last Published Item</a></li><li><a href="#subscriber-retrieve-returnnotify">Returning Notifications Only</a></li><li><a href="#subscriber-retrieve-requestrecent">Requesting the Most Recent Items</a></li><li><a href="#subscriber-retrieve-requestone">Requesting a Particular Item</a></li><li><a href="#subscriber-retrieve-error">Error Cases</a><ol><li><a href="#subscriber-retrieve-error-subid">Subscription ID Required</a></li><li><a href="#subscriber-retrieve-error-badsubid">Invalid Subscription ID</a></li><li><a href="#subscriber-retrieve-error-notsubscribed">Entity Not Subscribed</a></li><li><a href="#subscriber-retrieve-error-persistent">Persistent Items Not Supported</a></li><li><a href="#subscriber-retrieve-error-notsupported">Item Retrieval Not Supported</a></li><li><a href="#subscriber-retrieve-error-presence">Presence Subscription Required</a></li><li><a href="#subscriber-retrieve-error-rostergroup">Not in Roster Group</a></li><li><a href="#subscriber-retrieve-error-whitelist">Not on Whitelist</a></li><li><a href="#subscriber-retrieve-error-payment">Payment Required</a></li><li><a href="#subscriber-retrieve-error-blocked">Blocked</a></li><li><a href="#subscriber-retrieve-error-node">Node Does Not Exist</a></li><li><a href="#subscriber-retrieve-error-items">No Such Item(s)</a></li></ol></li></ol></li></ol></li><li><a href="#publisher">Publisher Use Cases</a><ol><li><a href="#publisher-publish">Publish an Item to a Node</a><ol><li><a href="#publisher-publish-request">Request</a></li><li><a href="#publisher-publish-success">Success Case</a><ol><li><a href="#publisher-publish-success-withpayload">Notification With Payload</a></li><li><a href="#publisher-publish-success-withoutpayload">Notification Without Payload</a></li><li><a href="#publisher-publish-success-publisher">Item Publisher</a></li><li><a href="#publisher-publish-success-subid">Inclusion of Subscription ID</a></li></ol></li><li><a href="#publisher-publish-error">Error Cases</a><ol><li><a href="#publisher-publish-error-forbidden">Insufficient Privileges</a></li><li><a href="#publisher-publish-error-notsupported">Item Publication Not Supported</a></li><li><a href="#publisher-publish-error-node">Node Does Not Exist</a></li><li><a href="#publisher-publish-error-bigpayload">Payload Too Big</a></li><li><a href="#publisher-publish-error-badpayload">Bad Payload</a></li><li><a href="#publisher-publish-error-badrequest">Request Does Not Match Configuration</a></li></ol></li><li><a href="#publisher-publish-autocreate">Automatic Node Creation</a></li><li><a href="#publisher-publish-options">Publishing Options</a></li></ol></li><li><a href="#publisher-delete">Delete an Item from a Node</a><ol><li><a href="#publisher-delete-request">Request</a></li><li><a href="#publisher-delete-success">Success Case</a><ol><li><a href="#publisher-delete-success-notify">Delete And Notify</a></li><li><a href="#publisher-delete-success-subid">Inclusion of Subscription ID</a></li></ol></li><li><a href="#publisher-delete-error">Error Cases</a><ol><li><a href="#publisher-delete-error-forbidden">Insufficient Privileges</a></li><li><a href="#publisher-delete-error-node">Node Does Not Exist</a></li><li><a href="#publisher-delete-error-nodeid">NodeID Required</a></li><li><a href="#publisher-delete-error-itemid">Item or ItemID Required</a></li><li><a href="#publisher-delete-error-persistent">Persistent Items Not Supported</a></li><li><a href="#publisher-delete-error-notsupported">Item Deletion Not Supported</a></li></ol></li></ol></li></ol></li><li><a href="#owner">Owner Use Cases</a><ol><li><a href="#owner-create">Create a Node</a><ol><li><a href="#owner-create-general">General Considerations</a></li><li><a href="#owner-create-default">Create a Node With Default Configuration</a></li><li><a href="#owner-create-and-configure">Create and Configure a Node</a></li></ol></li><li><a href="#owner-configure">Configure a Node</a><ol><li><a href="#owner-configure-request">Request</a></li><li><a href="#owner-configure-success">Success Case</a></li><li><a href="#owner-configure-error">Error Cases</a><ol><li><a href="#owner-configure-error-notsupported">Node Configuration Not Supported</a></li><li><a href="#owner-configure-error-forbidden">Insufficient Privileges</a></li><li><a href="#owner-configure-error-nodeid">NodeID Required</a></li><li><a href="#owner-configure-error-options">No Configuration Options</a></li><li><a href="#owner-configure-error-node">Node Does Not Exist</a></li></ol></li><li><a href="#owner-configure-submit">Form Submission</a></li><li><a href="#owner-configure-process">Form Processing</a><ol><li><a href="#owner-configure-process-success">Success</a></li><li><a href="#owner-configure-process-failure">Failure</a></li><li><a href="#owner-configure-process-notify">Success With Notifications</a></li></ol></li></ol></li><li><a href="#owner-default">Request Default Node Configuration Options</a><ol><li><a href="#owner-default-request">Request</a></li><li><a href="#owner-default-success">Success Case</a></li><li><a href="#owner-default-error">Error Cases</a><ol><li><a href="#owner-default-error-noconfig">Node Configuration Not Supported</a></li><li><a href="#owner-default-error-notsupported">Default Node Configuration Retrieval Not Supported</a></li></ol></li></ol></li><li><a href="#owner-delete">Delete a Node</a><ol><li><a href="#owner-delete-request">Request</a></li><li><a href="#owner-delete-success">Success Case</a></li><li><a href="#owner-delete-error">Error Cases</a><ol><li><a href="#owner-delete-error-forbidden">Insufficient Privileges</a></li><li><a href="#owner-delete-error-node">Node Does Not Exist</a></li></ol></li></ol></li><li><a href="#owner-purge">Purge All Node Items</a><ol><li><a href="#owner-purge-request">Request</a></li><li><a href="#owner-purge-success">Success Case</a></li><li><a href="#owner-purge-error">Error Cases</a><ol><li><a href="#owner-purge-error-notsupported">Node Purging Not Supported</a></li><li><a href="#owner-purge-error-forbidden">Insufficient Privileges</a></li><li><a href="#owner-purge-error-nopersist">Node Does Not Persist Items</a></li><li><a href="#owner-purge-error-node">Node Does Not Exist</a></li></ol></li></ol></li><li><a href="#owner-subreq">Manage Subscription Requests</a></li><li><a href="#owner-subreq-process">Process Pending Subscription Requests</a><ol><li><a href="#owner-subreq-request">Request</a></li><li><a href="#owner-subreq-success">Success Case</a></li><li><a href="#owner-subreq-error">Error Cases</a><ol><li><a href="#owner-subreq-error-adhoc">Ad-Hoc Commands Not Supported</a></li><li><a href="#owner-subreq-error-getpending">Get-Pending Not Supported</a></li><li><a href="#owner-subreq-error-forbidden">Insufficient Privileges</a></li><li><a href="#owner-subreq-error-node">Node Does Not Exist</a></li></ol></li><li><a href="#owner-subreq-pernode">Per-Node Request</a></li></ol></li><li><a href="#owner-subscriptions">Manage Subscriptions</a><ol><li><a href="#owner-subscriptions-retrieve">Retrieve Subscriptions List</a><ol><li><a href="#owner-subscriptions-retrieve-request">Request</a></li><li><a href="#owner-subscriptions-retrieve-success">Success Case</a></li><li><a href="#owner-subscriptions-retrieve-error">Error Cases</a></li></ol></li><li><a href="#owner-subscriptions-modify">Modify Subscriptions</a><ol><li><a href="#owner-subscriptions-modify-request">Request</a></li><li><a href="#owner-subscriptions-modify-success">Success Case</a></li><li><a href="#owner-subscriptions-modify-error">Error Cases</a></li><li><a href="#owner-subscriptions-multi">Multiple Simultaneous Modifications</a></li></ol></li><li><a href="#owner-subscriptions-delete">Delete a Subscriber</a></li><li><a href="#owner-subscriptions-notifysub">Notifying Subscribers</a></li></ol></li><li><a href="#owner-affiliations">Manage Affiliations</a><ol><li><a href="#owner-affiliations-retrieve">Retrieve Affiliations List</a><ol><li><a href="#owner-affiliations-retrieve-request">Request</a></li><li><a href="#owner-affiliations-retrieve-success">Success Case</a></li><li><a href="#owner-affiliations-retrieve-error">Error Cases</a></li></ol></li><li><a href="#owner-affiliations-modify">Modify Affiliation</a><ol><li><a href="#owner-affiliations-modify-request">Request</a></li><li><a href="#owner-affiliations-modify-success">Success Case</a></li><li><a href="#owner-affiliations-modify-error">Error Cases</a></li><li><a href="#owner-affiliations-multi">Multiple Simultaneous Modifications</a></li></ol></li><li><a href="#owner-affiliations-delete">Delete an Entity</a></li><li><a href="#owner-affiliations-notify">Notifying Entities</a></li></ol></li></ol></li><li><a href="#presence">IM Account Integration</a><ol><li><a href="#auto-subscribe">Auto-Subscribe</a><ol><li><a href="#auto-subscribe-owner">Account Owner</a></li><li><a href="#auto-subscribe-contact">Presence Subscriber</a></li><li><a href="#auto-subscribe-directed">Presence Sharer</a></li></ol></li><li><a href="#filtered-notifications">Filtered Notifications</a></li></ol></li><li><a href="#features">Feature Summary</a></li><li><a href="#errors">Error Conditions</a></li><li><a href="#impl">Implementation Notes</a><ol><li><a href="#impl-notify">Notification Triggers</a></li><li><a href="#impl-recipients">Intended Recipients for Notifications</a></li><li><a href="#impl-bounce">Handling Notification-Related Errors</a></li><li><a href="#impl-tempsub">Temporary Subscriptions</a></li><li><a href="#impl-presence">Presence-Based Delivery of Events</a></li><li><a href="#impl-offline">Not Routing Events to Offline Storage</a></li><li><a href="#impl-body">Including a Message Body</a></li><li><a href="#impl-uniqueness">Node ID and Item ID Uniqueness</a></li><li><a href="#impl-caching">Item Caching</a></li><li><a href="#impl-batch">Batch Processing</a></li><li><a href="#impl-autosubscribe">Auto-Subscribing Owners and Publishers</a></li><li><a href="#impl-authorize">Authorizing Subscription Requests (Pending Subscribers)</a></li><li><a href="#impl-subchange">Notification of Subscription State Changes</a></li><li><a href="#impl-semantics">NodeID Semantics</a></li><li><a href="#impl-shim">Inclusion of SHIM Headers</a></li><li><a href="#impl-association">Associating Events and Payloads with the Generating Entity</a></li><li><a href="#impl-chaining">Chaining</a></li><li><a href="#impl-leases">Time-Based Subscriptions (Leases)</a></li><li><a href="#impl-content">Content-Based Pubsub Systems</a></li><li><a href="#impl-singleton">Singleton Nodes</a></li><li><a href="#impl-uri">PubSub URIs</a></li><li><a href="#usecase.xdata">Integration with Data Forms</a></li></ol></li><li><a href="#i18n">Internationalization Considerations</a><ol><li><a href="#i18n-formtypes">Field Labels</a></li></ol></li><li><a href="#security">Security Considerations</a><ol><li><a href="#security-privacy">Private Information</a></li><li><a href="#security-authorization">Authorization</a></li><li><a href="#security-access">Access Models</a></li><li><a href="#security-presence">Presence Leaks</a></li></ol></li><li><a href="#iana">IANA Considerations</a></li><li><a href="#registrar">XMPP Registrar Considerations</a><ol><li><a href="#registrar-ns">Protocol Namespaces</a></li><li><a href="#registrar-disco">Service Discovery Category/Type</a></li><li><a href="#registrar-features">Service Discovery Features</a></li><li><a href="#registrar-formtypes">Field Standardization</a><ol><li><a href="#registrar-formtypes-auth">pubsub#subscribe_authorization FORM_TYPE</a></li><li><a href="#registrar-formtypes-subscribe">pubsub#subscribe_options FORM_TYPE</a></li><li><a href="#registrar-formtypes-metadata">pubsub#meta-data FORM_TYPE</a></li><li><a href="#registrar-formtypes-config">pubsub#node_config FORM_TYPE</a></li></ol></li><li><a href="#registrar-shim">SHIM Headers</a></li><li><a href="#registrar-querytypes">URI Query Types</a></li><li><a href="#registrar.xdata-validate">Data Forms Validation Datatypes</a></li></ol></li><li><a href="#schemas">XML Schemas</a><ol><li><a href="#schemas-pubsub">http://jabber.org/protocol/pubsub</a></li><li><a href="#schemas-error">http://jabber.org/protocol/pubsub#errors</a></li><li><a href="#schemas-event">http://jabber.org/protocol/pubsub#event</a></li><li><a href="#schemas-owner">http://jabber.org/protocol/pubsub#owner</a></li></ol></li><li><a href="#ack">Acknowledgements</a></li><li><a href="#authornote">Author Note</a></li></ol><h6><a href="#appendices">Appendices</a></h6><ol class="toc-appendices"><li><a href="#appendix-docinfo">Document Information</a></li><li><a href="#appendix-authorinfo">Author Information</a></li><li><a href="#appendix-legal">Legal Notices</a></li><li><a href="#appendix-xmpp">Relation to XMPP</a></li><li><a href="#appendix-discuss">Discussion Venue</a></li><li><a href="#appendix-conformance">Requirements Conformance</a></li><li><a href="#appendix-notes">Notes</a></li><li><a href="#appendix-revs">Revision History</a></li><li><a href="#appendix-biblatex">Bib(La)Tex Entry</a></li></ol></nav><h2 id="intro">1.
       Introduction<a class="anchor-link" href="#intro"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="intro-overview">1.1 Overview<a class="anchor-link" href="#intro-overview"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The XMPP publish-subscribe extension defined in this document provides a framework for a wide variety of applications, including news feeds, content syndication, extended presence, geolocation, avatar management, shared bookmarks, auction and trading systems, workflow systems, network management systems, NNTP gateways, profile management, and any other application that requires event notifications.</p>
    <p class="" style="">This technology uses the classic "publish-subscribe" or "observer" design pattern: a person or application publishes information, and an event notification (with or without payload) is broadcasted to all authorized subscribers. In general, the relationship between the publisher and subscriber is mediated by a service that receives publication requests, broadcasts event notifications to subscribers, and enables privileged entities to manage lists of people or applications that are authorized to publish or subscribe. The focal point for publication and subscription is a "node" to which publishers send data and from which subscribers receive event notifications. Nodes can also maintain a history of events and provide other services that supplement the pure pubsub model.</p>
    <p class="" style="">This document defines a generic protocol that all pubsub applications can use. Compliant implementations are not required to implement all of the features defined here (see the <a href="#features">Feature Summary</a>.) Other specifications may define "subsets" or "profiles" of publish-subscribe for use in specialized contexts, but such profiles are out of scope for this document.</p>
  </div>
  <div class="indent"><h3 id="intro-howitworks">1.2 How It Works<a class="anchor-link" href="#intro-howitworks"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">Although this specification is large because it defines many side use cases and possible error flows, the basic idea is simple:</p>
    <ol start="" class="" style="">
      <li class="" style="">An entity publishes information to a node at a publish-subscribe service.</li>
      <li class="" style="">The pubsub service pushes an event notification to all entities that are authorized to learn about the published information.</li>
    </ol>
    <p class="" style="">Perhaps the most popular application of pubsub-like functionality is content syndication, which has become familiar from the RSS and Atom (<span class="ref" style=""><a href="http://tools.ietf.org/html/rfc4287">RFC 4287</a></span>  [<a href="#nt-idm504">1</a>]) feeds associated with weblogs, news sites, and other frequently-updated information available on the Internet. Consider the example of a weblog published by &lt;hamlet@denmark.lit&gt;. When Hamlet writes a new weblog entry, his blogging software publishes the entry to a pubsub node hosted at &lt;pubsub.shakespeare.lit&gt;:</p>
    <figure class="code-example" id="example-1"><figcaption><strong>Example 1.</strong> Publisher Publishes a New Weblog Entry<a class="anchor-link" href="#example-1"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/blogbot'
    to='pubsub.shakespeare.lit'
    id='pub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='princely_musings'&gt;
      &lt;item&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Soliloquy&lt;/title&gt;
          &lt;summary&gt;
To be, or not to be: that is the question:
Whether 'tis nobler in the mind to suffer
The slings and arrows of outrageous fortune,
Or to take arms against a sea of troubles,
And by opposing end them?
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32397&lt;/id&gt;
          &lt;published&gt;2003-12-13T18:30:02Z&lt;/published&gt;
          &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">So that is the "pub" part of pubsub.</p>
    <p class="" style="">Now the pubsub service notifies all the subscribers about the new blog entry:</p>
    <figure class="code-example" id="example-2"><figcaption><strong>Example 2.</strong> Service Notifies Subscribers<a class="anchor-link" href="#example-2"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit' to='francisco@denmark.lit' id='foo'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'&gt;
        [ ... ENTRY ... ]
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message from='pubsub.shakespeare.lit' to='bernardo@denmark.lit' id='bar'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'&gt;
        [ ... ENTRY ... ]
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message from='pubsub.shakespeare.lit' to='horatio@denmark.lit' id='baz'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'&gt;
        [ ... ENTRY ... ]
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message from='pubsub.shakespeare.lit' to='bard@shakespeare.lit' id='fez'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'&gt;
        [ ... ENTRY ... ]
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
    <p class="" style="">Here is an even simpler example: a transient node that sends only event notifications without a payload:</p>
    <figure class="code-example" id="example-3"><figcaption><strong>Example 3.</strong> A Transient Notification<a class="anchor-link" href="#example-3"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit' to='francisco@denmark.lit'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='elsinore/doorbell'/&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
    <p class="" style="">Naturally, the entities involved may need to complete other use cases in order to enable full pubsub functionality -- for example, the publisher may need to create the node (see <a href="#owner-create">Create a Node</a>) and subscribers may need to sign up for event notifications (see <a href="#subscriber-subscribe">Subscribe to a Node</a>). These use cases are fully described in the remainder of this document. (For information about which features are required and which are recommended or optional, consult the <a href="#features">Feature Summary</a>.)</p>
  </div>
<h2 id="glossary">2.
       Glossary<a class="anchor-link" href="#glossary"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">The following terms are used throughout this document to refer to elements, objects, or actions that occur in the context of a pubsub service. (Note: Some of these terms are specified in greater detail within the body of this document.)</p>
  <div class="indent"><dl>
    <dt><strong>Authorize Access Model</strong></dt><dd>A node access model under which an entity can subscribe only through having a subscription request approved by a node owner (subscription requests are accepted but only provisionally) and only subscribers may retrieve items.</dd>
    <dt><strong>Address</strong></dt><dd>(1) A JID as defined in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc6120">XMPP Core</a></span>  [<a href="#nt-idm527">2</a>], or (2) the combination of a JID and a <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0030.html">Service Discovery (XEP-0030)</a></span>  [<a href="#nt-idm531">3</a>] node.</dd>
    <dt><strong>Collection Node</strong></dt><dd>A type of node that contains nodes and/or other collections but no published items. Collections make it possible to represent more sophisticated relationships among nodes. Collection nodes are defined in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0248.html">PubSub Collection Nodes (XEP-0248)</a></span>  [<a href="#nt-idm538">4</a>].</dd>
    <dt><strong>Entity</strong></dt><dd>A JID-addressable XMPP entity (client, service, application, etc.).</dd>
    <dt><strong>Event</strong></dt><dd>A change in the state of a node.</dd>
    <dt><strong>Instant Node</strong></dt><dd>A node whose NodeID is automatically generated by a pubsub service.</dd>
    <dt><strong>Item</strong></dt><dd>An XML fragment which is published to a node, thereby generating an event.</dd>
    <dt><strong>ItemID</strong></dt><dd>A unique identifier for an item in the context of a specific node.</dd>
    <dt><strong>Leaf Node</strong></dt><dd>A type of node that contains published items only. It is NOT a container for other nodes.</dd>
    <dt><strong>Node</strong></dt><dd>A virtual location to which information can be published and from which event notifications and/or payloads can be received (in other pubsub systems, this may be labelled a "topic").</dd>
    <dt><strong>NodeID</strong></dt><dd>The unique identifier for a node within the context of a pubsub service. The NodeID is either supplied by the node creator or generated by the pubsub service (if the node creator requests an Instant Node). The NodeID MAY have semantic meaning (e.g., in some systems or in pubsub profiles such as PEP the NodeID might be an XML namespace for the associated payload), but such meaning is OPTIONAL. If a document defines a given NodeID as unique within the realm of XMPP pubsub systems, it MUST specify the XML namespace of the associated payload.</dd>
    <dt><strong>Notification</strong></dt><dd>A message sent to a subscriber informing them of an event.</dd>
    <dt><strong>Outcast</strong></dt><dd>An entity that is disallowed from subscribing or publishing to a node.</dd>
    <dt><strong>Owner</strong></dt><dd>The manager of a node, of which there may be more than one; often but not necessarily the node creator.</dd>
    <dt><strong>Open Access Model</strong></dt><dd>A node access model under which any entity may subscribe and retrieve items without approval.</dd>
    <dt><strong>Payload</strong></dt><dd>The XML data that is contained within the &lt;item/&gt; element of a publication request or an event notification. A given payload is defined by an XML namespace and associated schema. A document that defines a payload format SHOULD specify whether the payload can be used only for a NodeID whose value is the same as the XML namespace, or whether the payload can be used for any NodeID. Such a document also SHOULD specify whether it is suggested that node at which such payloads are published are best configured as <a href="#impl-singleton">Singleton Nodes</a>.</dd>
    <dt><strong>Personal Eventing</strong></dt><dd>A simplified subset of Publish-Subscribe for use in the context of instant messaging and presence applications, whereby each IM user's JID is a virtual pubsub service; for details, see <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0163.html">Personal Eventing Protocol (XEP-0163)</a></span>  [<a href="#nt-idm585">5</a>].</dd>
    <dt><strong>Presence Access Model</strong></dt><dd>A node access model under which any entity that is subscribed to the owner's presence with a subscription of type "from" or "both" (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3921">RFC 3921</a></span>  [<a href="#nt-idm592">6</a>]) may subscribe to the node and retrieve items from the node; this access model applies mainly to instant messaging systems.</dd>
    <dt><strong>Publisher</strong></dt><dd>An entity that is allowed to publish items to a node and that is automatically subscribed to the node.</dd>
    <dt><strong>Publish-Only</strong></dt><dd>An entity that is allowed to publish items to a node but that is not allowed to receive notifications. (This affiliation is useful in the context of nodes that do not have an open access model when automated entities need to generate notifications on behalf of the owner.)</dd>
    <dt><strong>Pubsub Service</strong></dt><dd>An XMPP server or component that adheres to the protocol defined herein.</dd>
    <dt><strong>Roster Access Model</strong></dt><dd>A node access model under which any entity that is subscribed to the owner's presence and in the specified roster group(s) may subscribe to the node and retrieve items from the node; this access model applies mainly to instant messaging systems.</dd>
    <dt><strong>Subscriber</strong></dt><dd>An entity that is subscribed to a node.</dd>
    <dt><strong>Whitelist Access Model</strong></dt><dd>A node access model under which an entity may subscribe and retrieve items only if explicitly allowed to do so by the node owner (subscription requests from unauthorized entities are rejected).</dd>
  </dl></div>
<h2 id="reqs">3.
       Requirements<a class="anchor-link" href="#reqs"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">Requirements for a pubsub service can be driven by end-user needs as well as the needs of other components and services which can use the service. First, a pubsub service implemented using XMPP MUST provide the basic features that implement a pure publish-subscribe pattern:</p>
        
  <ul class="" style="">
    <li class="" style="">An entity MUST be able to publish events to a service such that all subscribers to a node receive notification of the event. See <a href="#publisher-publish">Publish an Item to a Node</a>.</li>
    <li class="" style="">An entity MUST be able to subscribe to a node (or be informed that subscription is not allowed). See <a href="#subscriber-subscribe">Subscribe to a Node</a>.</li>
    <li class="" style="">An entity MUST be allowed to be affiliated with a node. Allowable affiliations are member, none, outcast, owner, publish-only, and publisher. Implementations MUST support affiliations of none and owner, and MAY support affiliations of member, outcast, publisher, and publish-only. See <a href="#affiliations">Affiliations</a>.</li>
    <li class="" style="">An entity MUST be allowed to query the pubsub service (or a specific node) to determine what optional features of this specification the service (or node) implements. This query MUST use the Service Discovery (disco#info) protocol. See <a href="#entity-info">Discover Node Information</a>.</li>
  </ul>

        
  <p class="" style="">Some of the possible uses of an XMPP-based pubsub service will require other features, but these features are OPTIONAL and therefore not mandatory for compliance with this specification. However, if these features are implemented, they MUST adhere to the protocol described herein in to be compliant. These features include:</p>
  <ul class="" style="">
    <li class="" style="">A service MAY cache the last item published to a node (even if the "persistent-items" option is set to false); if it does default "cache-last-item" to true, it SHOULD send the last published item (or notification thereof) to subscribed entities based on configuration of the "send_last_published_item" field.</li>
    <li class="" style="">A node owner SHOULD be able to specify who may subscribe to a node.</li>
    <li class="" style="">A node owner SHOULD be able to specify who may publish to a node.</li>
    <li class="" style="">A node MAY be configured to deliver the published payload inside the event notification.</li>
    <li class="" style="">A node MAY be configured to persist published items to some persistent storage mechanism.</li>
    <li class="" style="">A node MAY be configured to persist only a limited number of items.</li>
    <li class="" style="">A service MAY support collections as described in <span class="ref">XEP-0248</span>.</li>
    <li class="" style="">A service or node MAY support extended service discovery information (metadata).</li>
  </ul>

<h2 id="preliminaries">4.
       Preliminaries<a class="anchor-link" href="#preliminaries"><abbr title="Link to this point in the document">¶</abbr></a></h2>

  <div class="indent"><h3 id="affiliations">4.1 Affiliations<a class="anchor-link" href="#affiliations"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">To manage permissions, the protocol defined herein uses a hierarchy of affiliations, similiar to those introduced in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idm639">7</a>].</p>
    <p class="" style="">All affiliations MUST be based on a bare JID (&lt;localpart@domain.tld&gt; or &lt;domain.tld&gt;) instead of a full JID (&lt;localpart@domain.tld/resource&gt; or &lt;domain.tld/resource&gt;).</p>
    <p class="" style="">Support for the "owner" and "none" affiliations is REQUIRED. Support for all other affiliations is RECOMMENDED. For each non-required affiliation supported by an implementation, it SHOULD return a service discovery feature of "name-affiliation" where "name" is the name of the affiliation, such as "member", "outcast", or "publisher" (see the <a href="#features">Feature Summary</a>). Particular kinds of pubsub services MAY enforce additional requirements (e.g., requiring support for a given non-required affiliation or for all affiliations).</p>
    <figure class="table"><figcaption id="table-1"><strong>Table 1:</strong> Affiliations and their Privileges<a class="anchor-link" href="#table-1"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><table>
      <tr class="body">
        <th colspan="" rowspan="">Affiliation</th>
        <th colspan="" rowspan="">Subscribe</th>
        <th colspan="" rowspan="">Retrieve Items</th>
        <th colspan="" rowspan="">Publish Items</th>
        <th colspan="" rowspan="">Delete Single Item</th>
        <th colspan="" rowspan="">Purge Node</th>
        <th colspan="" rowspan="">Configure Node</th>
        <th colspan="" rowspan="">Delete Node</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Owner</td>
        <td align="" colspan="" rowspan="">Yes</td>
        <td align="" colspan="" rowspan="">Yes</td>
        <td align="" colspan="" rowspan="">Yes</td>
        <td align="" colspan="" rowspan="">Yes</td>
        <td align="" colspan="" rowspan="">Yes</td>
        <td align="" colspan="" rowspan="">Yes</td>
        <td align="" colspan="" rowspan="">Yes</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Publisher</td>
        <td align="" colspan="" rowspan="">Yes</td>
        <td align="" colspan="" rowspan="">Yes</td>
        <td align="" colspan="" rowspan="">Yes</td>
        <td align="" colspan="" rowspan="">Yes *</td>
        <td align="" colspan="" rowspan="">Yes *</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Publish-Only</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">Yes</td>
        <td align="" colspan="" rowspan="">Yes *</td>
        <td align="" colspan="" rowspan="">No *</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Member</td>
        <td align="" colspan="" rowspan="">Yes</td>
        <td align="" colspan="" rowspan="">Yes</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">None</td>
        <td align="" colspan="" rowspan="">Yes</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Outcast</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">No</td>
      </tr>
    </table></figure>
    <p class="" style="">* Note: A service MAY allow any publisher to delete / purge any item once it has been published to that node instead of allowing only the original publisher to remove it. This behavior is NOT RECOMMENDED for the publish-only affiliation, which SHOULD be allowed to delete only items that the publish-only entity has published.</p>
    <p class="" style="">The ways in which an entity changes its affiliation with a node are well-defined. Typically, action by an owner is required to make an affiliation state transition. Affiliation changes and their triggering actions are specified in the following table.</p>
    <figure class="table"><figcaption id="table-2"><strong>Table 2:</strong> Affiliation State Chart<a class="anchor-link" href="#table-2"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><table>
      <tr class="body">
        <th colspan="" rowspan=""> </th>
        <th colspan="" rowspan="">Outcast</th>
        <th colspan="" rowspan="">None</th>
        <th colspan="" rowspan="">Member</th>
        <th colspan="" rowspan="">Publisher</th>
        <th colspan="" rowspan="">Owner</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Outcast</td>
        <td align="" colspan="" rowspan="">--</td>
        <td align="" colspan="" rowspan="">Owner removes ban</td>
        <td align="" colspan="" rowspan="">Owner adds entity to member list</td>
        <td align="" colspan="" rowspan="">Owner adds entity to publisher list</td>
        <td align="" colspan="" rowspan="">Owner adds entity to owner list</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">None</td>
        <td align="" colspan="" rowspan="">Owner bans entity</td>
        <td align="" colspan="" rowspan="">--</td>
        <td align="" colspan="" rowspan="">Owner adds entity to member list</td>
        <td align="" colspan="" rowspan="">Owner adds entity to publisher list</td>
        <td align="" colspan="" rowspan="">Owner adds entity to owner list</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Member</td>
        <td align="" colspan="" rowspan="">Owner bans entity</td>
        <td align="" colspan="" rowspan="">Owner removes entity from member list</td>
        <td align="" colspan="" rowspan="">--</td>
        <td align="" colspan="" rowspan="">Owner adds entity to publisher list</td>
        <td align="" colspan="" rowspan="">Owner adds entity to owner list</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Publisher</td>
        <td align="" colspan="" rowspan="">Owner bans entity</td>
        <td align="" colspan="" rowspan="">Owner removes entity from publisher list</td>
        <td align="" colspan="" rowspan="">n/a</td>
        <td align="" colspan="" rowspan="">--</td>
        <td align="" colspan="" rowspan="">Owner adds entity to owner list</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Owner</td>
        <td align="" colspan="" rowspan="">n/a</td>
        <td align="" colspan="" rowspan="">Owner resigns</td>
        <td align="" colspan="" rowspan="">n/a</td>
        <td align="" colspan="" rowspan="">n/a</td>
        <td align="" colspan="" rowspan="">--</td>
      </tr>
    </table></figure>
  </div>

  <div class="indent"><h3 id="substates">4.2 Subscription States<a class="anchor-link" href="#substates"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">Subscriptions to a node may exist in several states.</p>
    <figure class="table"><figcaption id="table-3"><strong>Table 3:</strong> Subscription States<a class="anchor-link" href="#table-3"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><table>
      <tr class="body">
        <th colspan="" rowspan="">Subscription State</th>
        <th colspan="" rowspan="">Description</th>
        </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">None</td>
        <td align="" colspan="" rowspan="">The node MUST NOT send event notifications or payloads to the Entity.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Pending</td>
        <td align="" colspan="" rowspan="">An entity has requested to subscribe to a node and the request has not yet been approved by a node owner. The node MUST NOT send event notifications or payloads to the entity while it is in this state.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Unconfigured</td>
        <td align="" colspan="" rowspan="">An entity has subscribed but its subscription options have not yet been configured. The node MAY send event notifications or payloads to the entity while it is in this state. The service MAY timeout unconfigured subscriptions.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Subscribed</td>
        <td align="" colspan="" rowspan="">An entity is subscribed to a node. The node MUST send all event notifications (and, if configured, payloads) to the entity while it is in this state (subject to subscriber configuration and content filtering).</td>
      </tr>
    </table></figure>
  </div>

  <div class="indent"><h3 id="events">4.3 Event Types<a class="anchor-link" href="#events"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The requirements for the publish-subscribe protocol imply that there are two major dimensions along which we can measure events: persistent vs. transient, and pure event notification vs. inclusion of payload. An implementation SHOULD enable an owner to configure a node along both of these dimensions.</p>
    <p class="" style="">No matter whether a node is configured for persistent or transient events, a service MAY cache the last item published to the node, in which case it SHOULD send that item to subscribers based on configuration of the "send_last_published_item" option (see the <a href="#impl-caching">Item Caching</a> section of this document); if the service supports the "http://jabber.org/protocol/pubsub#last-published" feature then the value of this option MUST default to "on_sub_and_presence" (though the service SHOULD allow the node owner to override the default).</p>
    <p class="box" style="">Note: The "on_sub_and_presence" setting relates to the <em>subscriber's</em> presence, not the publisher's presence.</p>
    <p class="" style="">A pubsub service MUST validate publish requests against the configuration of the node along both of these dimensions (see the <a href="#publisher-publish">Publish An Item to a Node</a> section of this document for the relevant error conditions).</p>
    <p class="" style="">The node configuration and desired event type determine whether an item must be provided by the publisher, whether the item includes a payload in the publish request or event notification, and whether an item ID is provided by the publisher or generated by the pubsub service. We can summarize the relevant rules as follows:</p>
    <figure class="table"><figcaption id="table-4"><strong>Table 4:</strong> Items, Payloads, and Item IDs<a class="anchor-link" href="#table-4"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><table>
      <tr class="body"><th colspan="" rowspan=""> </th><th colspan="" rowspan="">Notification-Only Node *</th><th colspan="" rowspan="">Payload-Included Node *</th></tr>
      <tr class="body">
        <td align="" colspan="" rowspan=""><strong>Persistent Node **</strong></td>
        <td align="" colspan="" rowspan="">Publish request MUST include an &lt;item/&gt; element, which MAY be empty or MAY contain a payload; even if publish request contains a payload, pubsub service MUST NOT include the payload in event notifications; if publish request did not include item ID, pubsub service MUST generate item ID</td>
        <td align="" colspan="" rowspan="">Publish request MUST include an &lt;item/&gt; element, which SHOULD contain a payload; if publish request included a payload, event notifications MUST include the payload; if publish request did not include item ID, pubsub service MUST generate item ID</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan=""><strong>Transient Node **</strong></td>
        <td align="" colspan="" rowspan="">Publish request MUST NOT include an &lt;item/&gt; element; payload is not included in publish request or event notifications, although event notifications MUST include an empty &lt;items/&gt; element; item ID is neither provided in publish request nor generated by pubsub service</td>
        <td align="" colspan="" rowspan="">Publish request MUST include an &lt;item/&gt; element, which SHOULD contain a payload; if publish request included a payload, event notifications MUST include the payload; pubsub service MAY generate an item ID</td>
      </tr>
    </table></figure>
    <p class="" style="">* Note: Whether the node is notification-only or includes payloads is determined by the "pubsub#deliver_payloads" configuration field.</p>
    <p class="" style="">** Note: Whether the node is persistent or transient is determined by the "pubsub#persist_items" configuration field.</p>
  </div>

  <div class="indent"><h3 id="nodetypes">4.4 Node Types<a class="anchor-link" href="#nodetypes"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">There are two types of nodes:</p>
    <figure class="table"><figcaption id="table-5"><strong>Table 5:</strong> Node Types<a class="anchor-link" href="#table-5"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><table>
      <tr class="body">
        <th colspan="" rowspan="">Node Type</th>
        <th colspan="" rowspan="">Description</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Leaf</td>
        <td align="" colspan="" rowspan="">A node that contains published items only. It is NOT a container for other nodes. This is the most common node type.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Collection</td>
        <td align="" colspan="" rowspan="">A node that contains nodes and/or other collections but no published items. Collections make it possible to represent more sophisticated relationships among nodes. For details, refer to <span class="ref">XEP-0248</span>.</td>
      </tr>
    </table></figure>
  </div>

  <div class="indent"><h3 id="accessmodels">4.5 Node Access Models<a class="anchor-link" href="#accessmodels"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">In order to make node creation simpler for clients, we define the following node access models (in order of openness):</p>
    <figure class="table"><figcaption id="table-6"><strong>Table 6:</strong> Node Access Models<a class="anchor-link" href="#table-6"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><table>
      <tr class="body">
        <th colspan="" rowspan="">Access Model</th>
        <th colspan="" rowspan="">Description</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Open</td>
        <td align="" colspan="" rowspan="">Any entity may subscribe to the node (i.e., without the necessity for subscription approval) and any entity may retrieve items from the node (i.e., without being subscribed); this SHOULD be the default access model for generic pubsub services.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Presence</td>
        <td align="" colspan="" rowspan="">Any entity with a subscription of type "from" or "both" may subscribe to the node and retrieve items from the node; this access model applies mainly to instant messaging systems (see <span class="ref">RFC 3921</span>).</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Roster</td>
        <td align="" colspan="" rowspan="">Any entity in the specified roster group(s) may subscribe to the node and retrieve items from the node; this access model applies mainly to instant messaging systems (see <span class="ref">RFC 3921</span>).</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Authorize</td>
        <td align="" colspan="" rowspan="">The node owner must approve all subscription requests, and only subscribers may retrieve items from the node.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Whitelist</td>
        <td align="" colspan="" rowspan="">An entity may subscribe or retrieve items only if on a whitelist managed by the node owner. The node owner MUST automatically be on the whitelist. In order to add entities to the whitelist, the node owner SHOULD use the protocol specified in the <a href="#owner-affiliations">Manage Affiliated Entities</a> section of this document, specifically by setting the affiliation to "member".</td>
      </tr>
    </table></figure>
    <p class="" style="">A generic publish-subscribe implementation SHOULD support all of the defined access models, although specialized publish-subscribe implementations MAY support only a subset of the access models. Which access models are provided in a particular deployment is a matter of service provisioning (e.g., some restricted deployments may wish to lock down permissions so that only the "authorize" and "whitelist" access models are provided, or even only the "whitelist" access model).</p>
    <p class="" style="">A node creator or owner can override the default access model by specifying an appropriate value for the 'pubsub#access_model' configuration field (see the <a href="#owner-create">Create a Node With Default Configuration</a> and <a href="#owner-configure">Configure a Node</a> sections of this document).</p>
  </div>

  <div class="indent"><h3 id="addressing">4.6 Addressing<a class="anchor-link" href="#addressing"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">If a pubsub node is addressable, it MUST be addressable either (1) as a JID or (2) as the combination of a JID and a node.  [<a href="#nt-idm840">8</a>]</p>
    <div class="indent"><h4 id="addressing-jid">4.6.1 JID<a class="anchor-link" href="#addressing-jid"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If a pubsub node is addressable as a JID, the NodeID MUST be the resource identifier, and MUST NOT be specified by the "user" portion (node identifier) of the JID (e.g. "domain.tld/NodeID" and "user@domain.tld/NodeID" are allowed; "NodeID@domain.tld" is not allowed  [<a href="#nt-idm844">9</a>]). JID addressing SHOULD be used when interacting with a pubsub node using a protocol that does not support the node attribute. For example, when a service makes it possible for entities to subscribe to nodes via presence, it would address nodes as JIDs. If a pubsub node is addressable as a JID, the pubsub service MUST ensure that the NodeID conforms to the Resourceprep profile of Stringprep as described in <span class="ref">RFC 3920</span>.</p>
      <p class="" style="">Consider the following example, in which the pubsub service is located at the hostname pubsub.shakespeare.lit.</p>
      <figure class="code-example" id="example-4"><figcaption><strong>Example 4.</strong> Node addressed as domain.tld/NodeID<a class="anchor-link" href="#example-4"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq to='pubsub.shakespeare.lit/news announcements'&gt;
  ...
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">Now consider the following example, in which the pubsub service is located at pubsub@shakespeare.lit.</p>
      <figure class="code-example" id="example-5"><figcaption><strong>Example 5.</strong> Node addressed as user@domain.tld/NodeID<a class="anchor-link" href="#example-5"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq to='pubsub@shakespeare.lit/news announcements'&gt;
  ...
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="addressing-jidnode">4.6.2 JID+NodeID<a class="anchor-link" href="#addressing-jidnode"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If a pubsub node is addressable as a JID plus node, the NodeID MUST be the value of both the Service Discovery 'node' attribute and the pubsub 'node' attribute; i.e., for discovery purposes, a pubsub node is equivalent to a Service Discovery node. If a pubsub node is addressable as a JID plus node, the pubsub service SHOULD ensure that the NodeID conforms to the Resourceprep profile of Stringprep as described in <span class="ref">RFC 3920</span>.</p>
      <p class="" style="">Consider the following example, in which the (virtual) pubsub service is located at hamlet@denmark.lit.</p>
      <figure class="code-example" id="example-6"><figcaption><strong>Example 6.</strong> Node addressed as JID+NodeID<a class="anchor-link" href="#example-6"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq to='hamlet@denmark.lit'&gt;
  &lt;query node='princely_musings'/&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
  </div>
<h2 id="entity">5.
       Entity Use Cases<a class="anchor-link" href="#entity"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">This section defines the use cases for and protocols to be used by any entity that wishes to interact with a publish-subscribe service, mainly focused on Service Discovery use cases.</p>

  <div class="indent"><h3 id="entity-features">5.1 Discover Features<a class="anchor-link" href="#entity-features"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A service MUST respond to service discovery information requests qualified by the 'http://jabber.org/protocol/disco#info' namespace. The "disco#info" result returned by a pubsub service MUST indicate the identity of the service and indicate which pubsub features are supported.</p>
    <figure class="code-example" id="example-7"><figcaption><strong>Example 7.</strong> Entity Queries Pubsub Service Regarding Supported Features<a class="anchor-link" href="#example-7"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='feature1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
</pre></figure>
    <figure class="code-example" id="example-8"><figcaption><strong>Example 8.</strong> Pubsub Service Returns Set of Supported Features<a class="anchor-link" href="#example-8"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='feature1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity category='pubsub' type='service'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">The possible pubsub features are noted throughout this document and have been registered as described in the <a href="#registrar">XMPP Registrar Considerations</a> section of this document. For information regarding which features are required, recommended, and optional, see the <a href="#features">Feature Summary</a> section of this document.</p>
  </div>

  <div class="indent"><h3 id="entity-nodes">5.2 Discover Nodes<a class="anchor-link" href="#entity-nodes"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">If a service implements a hierarchy of nodes (by means of <a href="#collections">Collection Nodes</a>), it MUST also enable entities to discover the nodes in that hierarchy by means of the <strong>Service Discovery</strong> protocol, subject to the recommendations in <span class="ref">XEP-0030</span> regarding large result sets (for which <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0055.html">Jabber Search (XEP-0055)</a></span>  [<a href="#nt-idm871">10</a>] or some other protocol SHOULD be used). The following examples show the use of service discovery in discovering the nodes available at a hierarchical pubsub service.</p>
    <p class="" style="">Note: Node hierarchies and collection nodes are OPTIONAL. For details, refer to the <a href="#impl-semantics">NodeID Semantics</a> and <a href="#collections">Collection Nodes</a> sections of this document.</p>
    <p class="" style="">In the first example, an entity sends a service discovery items ("disco#items") request to the root node (i.e., the service itself), which is a <a href="#collections">Collection Node</a>:</p>
    <figure class="code-example" id="example-9"><figcaption><strong>Example 9.</strong> Entity asks service for all first-level nodes<a class="anchor-link" href="#example-9"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='nodes1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
</pre></figure>
    <figure class="code-example" id="example-10"><figcaption><strong>Example 10.</strong> Service returns all first-level nodes<a class="anchor-link" href="#example-10"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='nodes1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'&gt;
    &lt;item jid='pubsub.shakespeare.lit'
          node='blogs'
          name='Weblog updates'/&gt;
    &lt;item jid='pubsub.shakespeare.lit'
          node='news'
          name='News and announcements'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">In the second example, an entity sends a disco#items request to one of the first-level nodes, which is also a collection node:</p>
    <figure class="code-example" id="example-11"><figcaption><strong>Example 11.</strong> Entity requests second-level nodes<a class="anchor-link" href="#example-11"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='nodes2'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'
         node='blogs'/&gt;
&lt;/iq&gt;
</pre></figure>
    <figure class="code-example" id="example-12"><figcaption><strong>Example 12.</strong> Service returns second-level nodes<a class="anchor-link" href="#example-12"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='nodes2'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'
         node='blogs'&gt;
    &lt;item jid='pubsub.shakespeare.lit'
          node='princely_musings'/&gt;
    &lt;item jid='pubsub.shakespeare.lit'
          node='kingly_ravings'/&gt;
    &lt;item jid='pubsub.shakespeare.lit'
          node='starcrossed_stories'/&gt;
    &lt;item jid='pubsub.shakespeare.lit'
          node='moorish_meanderings'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">If a node is a leaf node rather than a collection node and items have been published to the node, the service MAY return one &lt;item/&gt; element for each published item as described in the <a href="#entity-discoveritems">Discover Items for a Node</a> section of this document, however such items MUST NOT include a 'node' attribute (since they are published items, not nodes).</p>
  </div>

  <div class="indent"><h3 id="entity-info">5.3 Discover Node Information<a class="anchor-link" href="#entity-info"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A pubsub service MUST allow entities to query individual nodes for the information associated with that node. The Service Discovery protocol MUST be used to discover this information. The "disco#info" result MUST include an identity with a category of "pubsub" and a type of either "leaf" or "collection".</p>
    <p class="" style="">Note: If a node has an identity type of "leaf", then it MUST NOT contain other nodes or collections (only items); if a node has an identity type of "collection", then it MUST NOT contain items (only other nodes or collections).</p>
    <figure class="code-example" id="example-13"><figcaption><strong>Example 13.</strong> Entity queries collection node for information<a class="anchor-link" href="#example-13"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='info2'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='blogs'/&gt;
&lt;/iq&gt;
</pre></figure>
    <figure class="code-example" id="example-14"><figcaption><strong>Example 14.</strong> Service responds with identity of pubsub/collection<a class="anchor-link" href="#example-14"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='meta1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='blogs'&gt;
    &lt;identity category='pubsub' type='collection'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></figure>
    <figure class="code-example" id="example-15"><figcaption><strong>Example 15.</strong> Entity queries leaf node for information<a class="anchor-link" href="#example-15"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='info1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='princely_musings'/&gt;
&lt;/iq&gt;
</pre></figure>
    <figure class="code-example" id="example-16"><figcaption><strong>Example 16.</strong> Service responds with identity of pubsub/leaf<a class="anchor-link" href="#example-16"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='info1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='princely_musings'&gt;
    ...
    &lt;identity category='pubsub' type='leaf'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
</pre></figure>
  </div>
  <div class="indent"><h3 id="entity-metadata">5.4 Discover Node Metadata<a class="anchor-link" href="#entity-metadata"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The "disco#info" result MAY include detailed metadata about the node, encapsulated in the <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0004.html">Data Forms (XEP-0004)</a></span>  [<a href="#nt-idm896">11</a>] format as described in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0128.html">Service Discovery Extensions (XEP-0128)</a></span>  [<a href="#nt-idm900">12</a>], where the data form context is specified by including a FORM_TYPE of "http://jabber.org/protocol/pubsub#meta-data" in accordance with <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0068.html">Field Standardization for Data Forms (XEP-0068)</a></span>  [<a href="#nt-idm904">13</a>]. If metadata is provided, it SHOULD include values for all configured options as well as "automatic" information such as the node creation date, a list of publishers, and the like.</p>
    <figure class="code-example" id="example-17"><figcaption><strong>Example 17.</strong> Entity queries a node for information<a class="anchor-link" href="#example-17"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='meta1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='princely_musings'/&gt;
&lt;/iq&gt;
</pre></figure>
    <figure class="code-example" id="example-18"><figcaption><strong>Example 18.</strong> Service responds with information and metadata<a class="anchor-link" href="#example-18"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='meta1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'
         node='princely_musings'&gt;
    &lt;identity category='pubsub' type='leaf'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub'/&gt;
    &lt;x xmlns='jabber:x:data' type='result'&gt;
      &lt;field var='FORM_TYPE' type='hidden'&gt;
        &lt;value&gt;http://jabber.org/protocol/pubsub#meta-data&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='pubsub#type' label='Payload type' type='text-single'&gt;
        &lt;value&gt;http://www.w3.org/2005/Atom&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='pubsub#creator' label='Node creator' type='jid-single'&gt;
        &lt;value&gt;hamlet@denmark.lit&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='pubsub#creation_date' label='Creation date' type='text-single'&gt;
        &lt;value&gt;2003-07-29T22:56:10Z&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='pubsub#title' label='A short name for the node' type='text-single'&gt;
        &lt;value&gt;Princely Musings (Atom)&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='pubsub#description' label='A description of the node' type='text-single'&gt;
        &lt;value&gt;Updates for Hamlet&amp;apos;s Princely Musings weblog.&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='pubsub#language' label='Default language' type='list-single'&gt;
        &lt;value&gt;en&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='pubsub#contact' label='People to contact with questions' type='jid-multi'&gt;
        &lt;value&gt;bard@shakespeare.lit&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='pubsub#access_model' label='Access model' type='list-single'&gt;
        &lt;value&gt;open&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='pubsub#publish_model' label='Publish model' type='list-single'&gt;
        &lt;value&gt;publishers&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='pubsub#max_items' label='Max # of items to persist. `max` for no specific limit other than a server imposed maximum.' type='text-single'&gt;
        &lt;value&gt;120&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='pubsub#owner' label='Node owners' type='jid-multi'&gt;
        &lt;value&gt;hamlet@denmark.lit&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='pubsub#publisher' label='Publishers to this node' type='jid-multi'&gt;
        &lt;value&gt;hamlet@denmark.lit&lt;/value&gt;
      &lt;/field&gt;
      &lt;field var='pubsub#num_subscribers' label='Number of subscribers to this node' type='text-single'&gt;
        &lt;value&gt;1066&lt;/value&gt;
      &lt;/field&gt;
    &lt;/x&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">Note: Node metadata can be set in many ways. Some of it is based on node configuration (e.g., the owner's JID) whereas some of it may be dynamic (e.g., the number of subscribers). Any static information to be provided in the node metadata SHOULD be provided as fields in the node configuration form.</p>
    <p class="" style="">Note: The pubsub#language field SHOULD be list-single so that the pubsub service can present an appropriate list of languages and language codes.</p>
  </div>

  <div class="indent"><h3 id="entity-discoveritems">5.5 Discover Items for a Node<a class="anchor-link" href="#entity-discoveritems"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">To discover the published items which exist on the service for a specific node, an entity MAY send a "disco#items" request to the node itself, and the service MAY return each item as a Service Discovery &lt;item/&gt; element. The 'name' attribute of each Service Discovery item MUST contain its ItemID and the item MUST NOT possess a 'node' attribute. This ItemID MAY then be used to retrieve the item using the protocol defined in the <a href="#subscriber-retrieve">Retrieve Items from a Node</a> section of this document.</p>
    <figure class="code-example" id="example-19"><figcaption><strong>Example 19.</strong> Entity requests all of the items for a node<a class="anchor-link" href="#example-19"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='items1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'
         node='princely_musings'/&gt;
&lt;/iq&gt;

&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'
         node='princely_musings'&gt;
    &lt;item jid='pubsub.shakespeare.lit' name='368866411b877c30064a5f62b917cffe'/&gt;
    &lt;item jid='pubsub.shakespeare.lit' name='3300659945416e274474e469a1f0154c'/&gt;
    &lt;item jid='pubsub.shakespeare.lit' name='4e30f35051b7b8b42abe083742187228'/&gt;
    &lt;item jid='pubsub.shakespeare.lit' name='ae890ac52d0df67ed7cfdf51b644e901'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></figure>
  </div>

  <div class="indent"><h3 id="entity-subscriptions">5.6 Retrieve Subscriptions<a class="anchor-link" href="#entity-subscriptions"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">An entity may want to query the service to retrieve its subscriptions for all nodes at the service. Support for this feature ("retrieve-subscriptions") is RECOMMENDED.</p>
    <p class="" style="">In order to make the request, the requesting entity MUST send an IQ-get whose &lt;pubsub/&gt; child contains an empty &lt;subscriptions/&gt; element with no attributes.</p>
    <figure class="code-example" id="example-20"><figcaption><strong>Example 20.</strong> Entity requests all current subscriptions<a class="anchor-link" href="#example-20"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='subscriptions1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscriptions/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">If the service returns a list of subscriptions, it MUST return all subscriptions for all JIDs that match the bare JID (&lt;localpart@domain.tld&gt; or &lt;domain.tld&gt;) portion of the 'from' attribute on the request.</p>
    <p class="" style="">For each subscription, a &lt;subscription/&gt; element is returned specifying the NodeID, the JID that is affiliated (which MAY include a resource, depending on how the entity subscribed), and the current subscription state. If subscription identifiers are supported by the service, the 'subid' attribute MUST be present as well.</p>
    <figure class="code-example" id="example-21"><figcaption><strong>Example 21.</strong> Service returns all current subscriptions<a class="anchor-link" href="#example-21"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit'
    id='subscriptions1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscriptions&gt;
      &lt;subscription node='node1' jid='francisco@denmark.lit' subscription='subscribed'/&gt;
      &lt;subscription node='node2' jid='francisco@denmark.lit' subscription='subscribed'/&gt;
      &lt;subscription node='node5' jid='francisco@denmark.lit' subscription='unconfigured'/&gt;
      &lt;subscription node='node6' jid='francisco@denmark.lit' subscription='subscribed' subid='123-abc'/&gt;
      &lt;subscription node='node6' jid='francisco@denmark.lit' subscription='subscribed' subid='004-yyy'/&gt;
    &lt;/subscriptions&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">If the requesting entity has no subscriptions, the pubsub service MUST return an empty &lt;subscriptions/&gt; element.</p>
    <figure class="code-example" id="example-22"><figcaption><strong>Example 22.</strong> No subscriptions<a class="anchor-link" href="#example-22"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='subscriptions1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscriptions/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">If the service does not support subscriptions retrieval, the service MUST respond with a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "retrieve-subscriptions".</p>
    <figure class="code-example" id="example-23"><figcaption><strong>Example 23.</strong> Subscriptions retrieval not supported<a class="anchor-link" href="#example-23"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='subscriptions1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='retrieve-subscriptions'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">An entity MAY also request all of its subscriptions at a specific node (e.g., if it has subscriptions with multiple SubIDs) by including a 'node' attribute on the &lt;subscriptions/&gt; element.</p>
    <figure class="code-example" id="example-24"><figcaption><strong>Example 24.</strong> Entity requests current subscriptions from a specific node<a class="anchor-link" href="#example-24"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='subscriptions2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscriptions node='princely_musings'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">The service would then return only the entity's subscriptions to that specific node; this acts as a filter on the entity's subscriptions.</p>
    <figure class="code-example" id="example-25"><figcaption><strong>Example 25.</strong> Service returns all current subscriptions to a specific node<a class="anchor-link" href="#example-25"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit'
    id='subscriptions2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscriptions node='node6'&gt;
      &lt;subscription node='node6' jid='francisco@denmark.lit' subscription='subscribed' subid='123-abc'/&gt;
      &lt;subscription node='node6' jid='francisco@denmark.lit' subscription='subscribed' subid='004-yyy'/&gt;
    &lt;/subscriptions&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
  </div>
  <div class="indent"><h3 id="entity-affiliations">5.7 Retrieve Affiliations<a class="anchor-link" href="#entity-affiliations"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">An entity may want to query the service to retrieve its affiliations for all nodes at the service, or query a specific node for its affiliation with that node. Support for this feature ("retrieve-affiliations") is RECOMMENDED.</p>
    <p class="" style="">In order to make the request of the service, the requesting entity includes an empty &lt;affiliations/&gt; element with no attributes.</p>
    <figure class="code-example" id="example-26"><figcaption><strong>Example 26.</strong> Entity requests all current affiliations<a class="anchor-link" href="#example-26"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='affil1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;affiliations/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">If the service returns a list of affiliations, it MUST return all affiliations for all JIDs that match the bare JID (&lt;localpart@domain.tld&gt; or &lt;domain.tld&gt;) portion of the 'from' attribute on the request.</p>
    <p class="" style="">For each affiliation, an &lt;affiliation/&gt; element is returned containing the NodeID and the affiliation state (owner, publisher, publish-only, member, or outcast).</p>
    <figure class="code-example" id="example-27"><figcaption><strong>Example 27.</strong> Service replies with all current affiliations<a class="anchor-link" href="#example-27"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit'
    id='affil1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;affiliations&gt;
      &lt;affiliation node='node1' affiliation='owner'/&gt;
      &lt;affiliation node='node2' affiliation='publisher'/&gt;
      &lt;affiliation node='node5' affiliation='outcast'/&gt;
      &lt;affiliation node='node6' affiliation='owner'/&gt;
    &lt;/affiliations&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">If the requesting entity has no affiliations, the pubsub service MUST return an empty &lt;affiliations/&gt; element.</p>
    <figure class="code-example" id="example-28"><figcaption><strong>Example 28.</strong> No affiliations<a class="anchor-link" href="#example-28"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='affil1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;affiliations/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">If the service does not support affiliations retrieval, the service MUST respond with a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "retrieve-affiliations".</p>
    <figure class="code-example" id="example-29"><figcaption><strong>Example 29.</strong> Affiliations retrieval not supported<a class="anchor-link" href="#example-29"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='affil1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='retrieve-affiliations'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">In order to make an affiliations request of a specific node, the requesting entity includes an empty &lt;affiliations/&gt; element with a 'node' attribute.</p>
    <figure class="code-example" id="example-30"><figcaption><strong>Example 30.</strong> Entity requests affiliation at a specific node<a class="anchor-link" href="#example-30"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='affil2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;affiliations node='node6'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <figure class="code-example" id="example-31"><figcaption><strong>Example 31.</strong> Service replies with current affiliation<a class="anchor-link" href="#example-31"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit'
    id='affil2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;affiliations&gt;
      &lt;affiliation node='node6' affiliation='owner'/&gt;
    &lt;/affiliations&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
  </div>
<h2 id="subscriber">6.
       Subscriber Use Cases<a class="anchor-link" href="#subscriber"><abbr title="Link to this point in the document">¶</abbr></a></h2>

  <p class="" style="">This section defines the use cases for and protocols to be used by potential and actual subscribers. (Note: The <a href="#impl">Implementation Notes</a> section of this document describes many important factors and business rules which a pubsub service MUST observe. In addition, the examples throughout assume the existence of a separate pubsub component and include any relevant 'from' addresses as stamped by a server or network edge.)</p>

  <div class="indent"><h3 id="subscriber-subscribe">6.1 Subscribe to a Node<a class="anchor-link" href="#subscriber-subscribe"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <div class="indent"><h4 id="subscriber-subscribe-request">6.1.1 Request<a class="anchor-link" href="#subscriber-subscribe-request"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">When an XMPP entity wishes to subscribe to a node, it sends a subscription request to the pubsub service. The subscription request is an IQ-set where the &lt;pubsub/&gt; element contains one and only one &lt;subscribe/&gt; element. The &lt;subscribe/&gt; element SHOULD possess a 'node' attribute specifying the node to which the entity wishes to subscribe. The &lt;subscribe/&gt; element MUST also possess a 'jid' attribute specifying the exact XMPP address to be used as the subscribed JID -- often a bare JID (&lt;localpart@domain.tld&gt; or &lt;domain.tld&gt;) or full JID (&lt;localpart@domain.tld/resource&gt; or &lt;domain.tld/resource&gt;).</p>
      <p class="" style="">Here is an example of a subscription request.</p>
      <figure class="code-example" id="example-32"><figcaption><strong>Example 32.</strong> Entity subscribes to a node<a class="anchor-link" href="#example-32"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='sub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscribe
        node='princely_musings'
        jid='francisco@denmark.lit'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="subscriber-subscribe-success">6.1.2 Success Case<a class="anchor-link" href="#subscriber-subscribe-success"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If the subscription request is successfully processed, the server MUST inform the requesting entity that it is now subscribed (which MAY include a service-generated SubID).</p>
      <figure class="code-example" id="example-33"><figcaption><strong>Example 33.</strong> Service replies with success<a class="anchor-link" href="#example-33"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscription
        node='princely_musings'
        jid='francisco@denmark.lit'
        subid='ba49252aaa4f5d320c24d3766f0bdcade78c78d3'
        subscription='subscribed'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="subscriber-subscribe-error">6.1.3 Error Cases<a class="anchor-link" href="#subscriber-subscribe-error"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">There are several reasons why the subscription request might fail:</p>
      <ol start="" class="" style="">
        <li class="" style="">The bare JID portions of the JIDs do not match.</li>
        <li class="" style="">The node has an access model of "presence" and the requesting entity is not subscribed to the owner's presence.</li>
        <li class="" style="">The node has an access model of "roster" and the requesting entity is not in one of the authorized roster groups.</li>
        <li class="" style="">The node has an access model of "whitelist" and the requesting entity is not on the whitelist.</li>
        <li class="" style="">The service requires payment for subscriptions to the node.</li>
        <li class="" style="">The requesting entity is anonymous and the service does not allow anonymous entities to subscribe.</li>
        <li class="" style="">The requesting entity has a pending subscription.</li>
        <li class="" style="">The requesting entity is blocked from subscribing (e.g., because having an affiliation of outcast).</li>
        <li class="" style="">The requesting entity has attempted to establish too many subscriptions.</li>
        <li class="" style="">The node does not support subscriptions.</li>
        <li class="" style="">The node has moved.</li>
        <li class="" style="">The node does not exist.</li>
      </ol>
      <p class="" style="">These error cases are described more fully in the following sections.</p>
      <div class="indent"><h5 id="subscriber-subscribe-error-nomatch">6.1.3.1 JIDs Do Not Match</h5>
        <p class="" style="">If the specified JID is a bare JID or full JID, the service MUST at a minimum check the bare JID portion against the bare JID portion of the 'from' attribute on the received IQ request to make sure that the requesting entity has the same identity as the JID which is being requested to be added to the subscriber list.</p>
        <p class="" style="">If the bare JID portions of the JIDs do not match as described above and the requesting entity does not have some kind of admin or proxy privilege as defined by the implementation, the service MUST return a &lt;bad-request/&gt; error, which SHOULD also include a pubsub-specific error condition of &lt;invalid-jid/&gt;.</p>
        <figure class="code-example" id="example-34"><figcaption><strong>Example 34.</strong> JIDs do not match<a class="anchor-link" href="#example-34"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;invalid-jid xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        <p class="" style="">Note: An implementation MAY enable the service administrator to configure a list of entities that are excluded from this check; those entities may be considered "trusted proxies" that are allowed to subscribe on behalf of other entities. In the same way, implementations MAY enable listing of entities that are not allowed to perform specific operations (such as subscribing or creating nodes).</p>
      </div>
      <div class="indent"><h5 id="subscriber-subscribe-error-presence">6.1.3.2 Presence Subscription Required</h5>
        <p class="" style="">For nodes with an access model of "presence", if the requesting entity is not subscribed to the owner's presence then the pubsub service MUST respond with a &lt;not-authorized/&gt; error, which SHOULD also include a pubsub-specific error condition of &lt;presence-subscription-required/&gt;.</p>
        <figure class="code-example" id="example-35"><figcaption><strong>Example 35.</strong> Entity is not authorized to create a subscription (presence subscription required)<a class="anchor-link" href="#example-35"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;error type='auth'&gt;
    &lt;not-authorized xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;presence-subscription-required xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-subscribe-error-rostergroup">6.1.3.3 Not in Roster Group</h5>
        <p class="" style="">For nodes with an access model of "roster", if the requesting entity is not in one of the authorized roster groups then the pubsub service MUST respond with a &lt;not-authorized/&gt; error, which SHOULD also include a pubsub-specific error condition of &lt;not-in-roster-group/&gt;.</p>
        <figure class="code-example" id="example-36"><figcaption><strong>Example 36.</strong> Entity is not authorized to create a subscription (not in roster group)<a class="anchor-link" href="#example-36"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;error type='auth'&gt;
    &lt;not-authorized xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;not-in-roster-group xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-subscribe-error-whitelist">6.1.3.4 Not on Whitelist</h5>
        <p class="" style="">For nodes with a node access model of "whitelist", if the requesting entity is not on the whitelist then the service MUST return a &lt;not-allowed/&gt; error, specifying a pubsub-specific error condition of &lt;closed-node/&gt;.</p>
        <figure class="code-example" id="example-37"><figcaption><strong>Example 37.</strong> Node has whitelist access model<a class="anchor-link" href="#example-37"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;error type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;closed-node xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-subscribe-error-payment">6.1.3.5 Payment Required</h5>
        <p class="" style="">Commercial deployments may wish to link subscribers to a database of paying customers. If the subscriber needs to provide payment in order to subscribe to the node (e.g., if the subscriber is not in the customer database or the customer's account is not paid up), the service SHOULD return a &lt;payment-required/&gt; error to the subscriber.</p>
        <figure class="code-example" id="example-38"><figcaption><strong>Example 38.</strong> Payment is required for a subscription<a class="anchor-link" href="#example-38"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;error type='auth'&gt;
    &lt;payment-required xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-subscribe-error-anonymous">6.1.3.6 Anonymous Subscriptions Not Allowed</h5>
        <p class="" style="">Some XMPP servers may allow authentication using SASL ANONYMOUS; however, because the resulting entity is unstable (the assigned JID may not be owned by the same principal in a persistent manner), a service MAY prevent anonymous entities from subscribing to nodes and SHOULD use service discovery to determine if an entity has an identity of "account/anonymous". If a requesting entity is anonymous but the service does not allow anonymous entities to subscribe, the service SHOULD return a &lt;forbidden/&gt; error to the subscriber.</p>
        <figure class="code-example" id="example-39"><figcaption><strong>Example 39.</strong> Requesting entity is anonymous<a class="anchor-link" href="#example-39"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='anonymous@denmark.lit/foo'
    id='sub1'&gt;
  &lt;error type='cancel'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-subscribe-error-pending">6.1.3.7 Subscription Pending</h5>
        <p class="" style="">If the requesting entity has a pending subscription, the service MUST return a &lt;not-authorized/&gt; error to the subscriber, specifying a pubsub-specific error condition of &lt;pending-subscription/&gt;.</p>
        <figure class="code-example" id="example-40"><figcaption><strong>Example 40.</strong> Requesting entity has pending subscription<a class="anchor-link" href="#example-40"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;error type='auth'&gt;
    &lt;not-authorized xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;pending-subscription xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-subscribe-error-blocked">6.1.3.8 Blocked</h5>
        <p class="" style="">If the requesting entity is blocked from subscribing (e.g., because having an affiliation of outcast), the service MUST return a &lt;forbidden/&gt; error to the subscriber.</p>
        <figure class="code-example" id="example-41"><figcaption><strong>Example 41.</strong> Requesting entity is blocked<a class="anchor-link" href="#example-41"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-subscribe-error-toomany">6.1.3.9 Too Many Subscriptions</h5>
        <p class="" style="">If the requesting entity has attempted to establish too many subscriptions (where the definition of "too many" is a matter of local service policy), the service MUST return a &lt;policy-violation/&gt; error to the subscriber, specifying a pubsub-specific error condition of &lt;too-many-subscriptions/&gt;.</p>
        <figure class="code-example" id="example-42"><figcaption><strong>Example 42.</strong> Requesting entity has exceeded limit on number of subscriptions<a class="anchor-link" href="#example-42"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;error type='wait'&gt;
    &lt;policy-violation xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;too-many-subscriptions xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        <p class="" style="">The service can match on bare JID or full JID in determining which subscribing entities match for the purpose of determining if an entity has requested too many subscriptions.</p>
      </div>
      <div class="indent"><h5 id="subscriber-subscribe-error-unsupported">6.1.3.10 Subscriptions Not Supported</h5>
        <p class="" style="">If the node does not allow entities to subscribe, the service SHOULD return a &lt;feature-not-implemented/&gt; error to the subscriber, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "subscribe".</p>
        <figure class="code-example" id="example-43"><figcaption><strong>Example 43.</strong> Subscribing not supported<a class="anchor-link" href="#example-43"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='subscribe'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-subscribe-error-redirect">6.1.3.11 Node Has Moved</h5>
        <p class="" style="">If the node has, the service SHOULD return a &lt;gone/&gt; error (if the node has moved permanently) or a &lt;redirect/&gt; error (if the node has moved temporarily).</p>
        <figure class="code-example" id="example-44"><figcaption><strong>Example 44.</strong> Node has moved<a class="anchor-link" href="#example-44"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;error type='modify'&gt;
    &lt;gone xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'&gt;
      xmpp:pubsub.shakespeare.lit?;node=some-other-node
    &lt;/gone&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-subscribe-error-node">6.1.3.12 Node Does Not Exist</h5>
        <p class="" style="">If the node does not exist, the service SHOULD return an &lt;item-not-found/&gt; error to the subscriber.</p>
        <figure class="code-example" id="example-45"><figcaption><strong>Example 45.</strong> Node does not exist<a class="anchor-link" href="#example-45"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
    </div>
    <div class="indent"><h4 id="subscriber-subscribe-approval">6.1.4 Approval Required<a class="anchor-link" href="#subscriber-subscribe-approval"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">For nodes with an access model of "authorize", subscription requests MUST be approved by one of the node owners unless service policy allows entities with affiliations other than "none" to auto-subscribe (e.g., members and publishers might be allowed to auto-subscribe); therefore the pubsub service sends a message to the node owner(s) requesting authorization (see the <a href="#owner-subreq">Manage Subscription Requests</a> section of this document). Because the subscription request may or may not be approved, the service MUST return a pending notification to the subscriber.</p>
      <figure class="code-example" id="example-46"><figcaption><strong>Example 46.</strong> Service replies with pending<a class="anchor-link" href="#example-46"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscription
        node='princely_musings'
        jid='francisco@denmark.lit'
        subscription='pending'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="subscriber-subscribe-configure">6.1.5 Configuration Required<a class="anchor-link" href="#subscriber-subscribe-configure"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If the entity must configure its subscription options (see the <a href="#subscriber-configure">Configure Subscription Options</a> section of this document) before receiving event notifications, the service MUST so inform the entity. It SHOULD do so by returning an IQ-result to the requesting entity with a notation that configuration of subscription options is required.</p>
      <figure class="code-example" id="example-47"><figcaption><strong>Example 47.</strong> Service replies with success and indicates that subscription configuration is required<a class="anchor-link" href="#example-47"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscription
        node='princely_musings'
        jid='francisco@denmark.lit'
        subscription='unconfigured'&gt;
      &lt;subscribe-options&gt;
        &lt;required/&gt;
      &lt;/subscribe-options&gt;
    &lt;/subscription&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">Note: The node shall include the &lt;required/&gt; child element only if the subscriber must configure the subscription before receiving any event notifications. A service MAY time out subscription requests if configuration is required and a configuration request is not submitted within a reasonable amount of time (which shall be determined by the service or node configuration).</p>
      <p class="" style="">Alternatively, if the service is unable to create the subscription without simultaneous configuration, the service MAY return a &lt;not-acceptable/&gt; error, specifying a pubsub-specific error condition of &lt;configuration-required/&gt;.</p>
      <figure class="code-example" id="example-48"><figcaption><strong>Example 48.</strong> Service returns error specifying that subscription configuration is required<a class="anchor-link" href="#example-48"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscribe
        node='princely_musings'
        jid='francisco@denmark.lit'/&gt;
    &lt;options node='princely_musings' jid='francisco@denmark.lit'&gt;
      &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#deliver'&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#digest'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#include_body'&gt;&lt;value&gt;false&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#show-values'&gt;
          &lt;value&gt;chat&lt;/value&gt;
          &lt;value&gt;online&lt;/value&gt;
          &lt;value&gt;away&lt;/value&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/options&gt;
  &lt;/pubsub&gt;
  &lt;error type='modify'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;configuration-required xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">If the &lt;required/&gt; element is not included and no error is returned, the subscription takes effect immediately and the entity may configure the subscription at any time (the service MAY indicate that subscription options are supported by including an empty &lt;subscribe-options/&gt; element in the IQ-result, as shown in the following example).</p>
      <figure class="code-example" id="example-49"><figcaption><strong>Example 49.</strong> Service replies with success and indicates that subscription options are supported but not required<a class="anchor-link" href="#example-49"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscription
        node='princely_musings'
        jid='francisco@denmark.lit'
        subscription='unconfigured'&gt;
      &lt;subscribe-options/&gt;
    &lt;/subscription&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="subscriber-subscribe-multi">6.1.6 Multiple Subscriptions<a class="anchor-link" href="#subscriber-subscribe-multi"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">An entity may wish to subscribe using different subscription options, which it can do by subscribing multiple times to the same node. Support for this feature ("multi-subscribe") is OPTIONAL.</p>
      <p class="" style="">If multiple subscriptions for the same JID are allowed, the service MUST use the 'subid' attribute to differentiate between subscriptions for the same entity (therefore the SubID MUST be unique for each node+JID combination and the SubID MUST be present on the &lt;subscription/&gt; element any time it is sent to the subscriber). It is NOT RECOMMENDED for clients to generate SubIDs, since collisions might result; therefore a service SHOULD generate the SubID on behalf of the subscriber and MAY overwrite SubIDs if they are provided by subscribers. If the service does not allow multiple subscriptions for the same entity and it receives an additional subscription request, the service MUST return the current subscription state (as if the subscription was just approved).</p>
      <p class="" style="">When the pubsub service generates event notifications, it SHOULD send only one event notification to an entity that has multiple subscriptions, rather than one event notification for each subscription. By "entity" here is meant the JID specified for the subscription, whether bare JID or full JID; however, if the same bare JID has multiple subscriptions but those subscriptions are for different full JIDs (e.g., one subscription for user@domain.tld./foo and another subscription for user@domain.tld/bar), the service MUST treat those as separate JIDs for the purpose of generating event notifications.</p>
    </div>
    <div class="indent"><h4 id="subscriber-subscribe-last">6.1.7 Receiving the Last Published Item<a class="anchor-link" href="#subscriber-subscribe-last"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">When a subscription request is successfully processed, the service MAY send the last published item to the new subscriber. The message containing this item SHOULD be stamped with extended information qualified by the 'urn:xmpp:delay' namespace (see <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0203.html">Delayed Delivery (XEP-0203)</a></span>  [<a href="#nt-idm1030">14</a>]) to indicate it is sent with delayed delivery. (Note that in this example the event notification is sent to the bare JID since that is the subscribed JID.)</p>
      <figure class="code-example" id="example-50"><figcaption><strong>Example 50.</strong> Service sends last published item<a class="anchor-link" href="#example-50"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit' to='francisco@denmark.lit'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Soliloquy&lt;/title&gt;
          &lt;summary&gt;
To be, or not to be: that is the question:
Whether 'tis nobler in the mind to suffer
The slings and arrows of outrageous fortune,
Or to take arms against a sea of troubles,
And by opposing end them?
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32397&lt;/id&gt;
          &lt;published&gt;2003-12-13T18:30:02Z&lt;/published&gt;
          &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
  &lt;delay xmlns='urn:xmpp:delay' stamp='2003-12-13T23:58:37Z'/&gt;
&lt;/message&gt;
</pre></figure>
      <p class="" style="">If the service sends the last published item by default for all nodes (subject to overriding by node configuration), it MUST return a feature of "http://jabber.org/protocol/pubsub#last-published" in its responsess to disco#info requests.</p>
    </div>
  </div>

  <div class="indent"><h3 id="subscriber-unsubscribe">6.2 Unsubscribe from a Node<a class="anchor-link" href="#subscriber-unsubscribe"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <div class="indent"><h4 id="subscriber-unsubscribe-request">6.2.1 Request<a class="anchor-link" href="#subscriber-unsubscribe-request"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">To unsubscribe from a node, the subscriber sends an IQ-set whose &lt;pubsub/&gt; child contains an &lt;unsubscribe/&gt; element that specifies the node and the subscribed JID.</p>
      <figure class="code-example" id="example-51"><figcaption><strong>Example 51.</strong> Entity unsubscribes from a node<a class="anchor-link" href="#example-51"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='unsub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
     &lt;unsubscribe
         node='princely_musings'
         jid='francisco@denmark.lit'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="subscriber-unsubscribe-success">6.2.2 Success Case<a class="anchor-link" href="#subscriber-unsubscribe-success"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If the request can be successfully processed, the service MUST return an IQ result and MAY include a &lt;pubsub/&gt; child element with the updated &lt;subscription/&gt; element for that node. If subscription identifiers are supported by the service, the 'subid' attribute MUST be present as well.</p>
      <figure class="code-example" id="example-52"><figcaption><strong>Example 52.</strong> Service replies with success<a class="anchor-link" href="#example-52"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='unsub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscription
        node='princely_musings'
        jid='francisco@denmark.lit'
        subscription='none'
        subid='ba49252aaa4f5d320c24d3766f0bdcade78c78d3'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="subscriber-unsubscribe-error">6.2.3 Error Cases<a class="anchor-link" href="#subscriber-unsubscribe-error"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">There are several reasons why the unsubscribe request might fail:</p>
      <ol start="" class="" style="">
        <li class="" style="">The requesting entity has multiple subscriptions to the node but does not specify a subscription ID.</li>
        <li class="" style="">The request does not specify an existing subscriber.</li>
        <li class="" style="">The requesting entity does not have sufficient privileges to unsubscribe the specified JID.</li>
        <li class="" style="">The node does not exist.</li>
        <li class="" style="">The request specifies a subscription ID that is not valid or current.</li>
      </ol>
      <p class="" style="">These error cases are described more fully in the following sections.</p>
      <div class="indent"><h5 id="subscriber-unsubscribe-error-nosubid">6.2.3.1 No Subscription ID</h5>
        <p class="" style="">If the requesting entity has multiple subscriptions to the node but does not specify a subscription ID, the service MUST return a &lt;bad-request/&gt; error, which SHOULD also include a pubsub-specific error condition of &lt;subid-required/&gt;.</p>
        <figure class="code-example" id="example-53"><figcaption><strong>Example 53.</strong> Entity did not specify SubID<a class="anchor-link" href="#example-53"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='unsub1'&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;subid-required xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-unsubscribe-error-nosub">6.2.3.2 No Such Subscriber</h5>
        <p class="" style="">If the value of the 'jid' attribute does not specify an existing subscriber, the pubsub service MUST return an error stanza, which SHOULD be &lt;unexpected-request/&gt; and which SHOULD also include a pubsub-specific error condition of &lt;not-subscribed/&gt;.</p>
        <figure class="code-example" id="example-54"><figcaption><strong>Example 54.</strong> Requesting entity is not a subscriber<a class="anchor-link" href="#example-54"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='unsub1'&gt;
  &lt;error type='cancel'&gt;
    &lt;unexpected-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;not-subscribed xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-unsubscribe-error-forbidden">6.2.3.3 Insufficient Privileges</h5>
        <p class="" style="">If the requesting entity is prohibited from unsubscribing the specified JID, the service MUST return a &lt;forbidden/&gt; error. The service MUST validate that the entity making the request is authorized to unsubscribe the entity. If the subscriber's JID is of the form (&lt;localpart@domain.tld/resource&gt; or &lt;domain.tld/resource&gt;), a service MUST perform this check by comparing the (&lt;localpart@domain.tld&gt; or &lt;domain.tld&gt;) part of the two JIDs to ensure that they match. If the bare JID portions of the JIDs do not match and the requesting entity is not authorized to unsubscribe the JID (e.g., because it is not a service-wide admin or authorized proxy), the service MUST return a &lt;forbidden/&gt; error.</p>
        <figure class="code-example" id="example-55"><figcaption><strong>Example 55.</strong> Requesting entity is prohibited from unsubscribing entity<a class="anchor-link" href="#example-55"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='unsub1'&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-unsubscribe-error-node">6.2.3.4 Node Does Not Exist</h5>
        <p class="" style="">If the node does not exist, the pubsub service MUST return an &lt;item-not-found/&gt; error.</p>
        <figure class="code-example" id="example-56"><figcaption><strong>Example 56.</strong> Node does not exist<a class="anchor-link" href="#example-56"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='unsub1'&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-unsubscribe-error-badsubid">6.2.3.5 Bad Subscription ID</h5>
        <p class="" style="">If a subscription identifier is associated with the subscription, the unsubscribe request MUST include an appropriate 'subid' attribute. If the unsubscribe request includes a SubID but SubIDs are not supported for the node (or the subscriber did not subscribe using a SubID in the first place), the service SHOULD ignore the SubID and simply unsubscribe the entity. If the subscriber originally subscribed with a SubID but the unsubscribe request includes a SubID that is not valid or current for the subscriber, the service MUST return a &lt;not-acceptable/&gt; error, which SHOULD also include a pubsub-specific error condition of &lt;invalid-subid/&gt;.</p>
        <figure class="code-example" id="example-57"><figcaption><strong>Example 57.</strong> Invalid subscription identifier<a class="anchor-link" href="#example-57"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='unsub1'&gt;
  &lt;error type='modify'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;invalid-subid xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
    </div>
  </div>
  <div class="indent"><h3 id="subscriber-configure">6.3 Configure Subscription Options<a class="anchor-link" href="#subscriber-configure"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">An implementation MAY allow subscribers to configure subscription options. Implementations SHOULD use the <span class="ref">Data Forms</span> protocol to accomplish this configuration (however, an out-of-band mechanism such as a web interface could be offered as well).</p>
    <div class="indent"><h4 id="subscriber-configure-support">6.3.1 Advertising Support<a class="anchor-link" href="#subscriber-configure-support"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If a service supports subscription options it MUST advertise that fact in its response to a "disco#info" query by including a feature whose 'var' attribute is "pubsub#subscription-options".</p>
      <figure class="code-example" id="example-58"><figcaption><strong>Example 58.</strong> Pubsub service indicates support for subscription options<a class="anchor-link" href="#example-58"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='feature1'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    ...
    &lt;feature var='http://jabber.org/protocol/pubsub#subscription-options'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="subscriber-configure-request">6.3.2 Request<a class="anchor-link" href="#subscriber-configure-request"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">A subscriber requests the subscription options by including an &lt;options/&gt; element inside an IQ-get stanza.</p>
      <figure class="code-example" id="example-59"><figcaption><strong>Example 59.</strong> Subscriber requests subscription options form<a class="anchor-link" href="#example-59"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='options1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;options node='princely_musings' jid='francisco@denmark.lit'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="subscriber-configure-success">6.3.3 Success Case<a class="anchor-link" href="#subscriber-configure-success"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If the request can be successfully processed, the service MUST respond with the options.</p>
      <figure class="code-example" id="example-60"><figcaption><strong>Example 60.</strong> Service responds with the options form<a class="anchor-link" href="#example-60"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='options1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;options node='princely_musings' jid='francisco@denmark.lit'&gt;
      &lt;x xmlns='jabber:x:data' type='form'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#deliver' type='boolean'
               label='Enable delivery?'&gt;
          &lt;value&gt;1&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#digest' type='boolean'
               label='Receive digest notifications (approx. one per day)?'&gt;
          &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#include_body' type='boolean'
               label='Receive message body in addition to payload?'&gt;
          &lt;value&gt;false&lt;/value&gt;
        &lt;/field&gt;
        &lt;field
            var='pubsub#show-values'
            type='list-multi'
            label='Select the presence types which are
                   allowed to receive event notifications'&gt;
          &lt;option label='Want to Chat'&gt;&lt;value&gt;chat&lt;/value&gt;&lt;/option&gt;
          &lt;option label='Available'&gt;&lt;value&gt;online&lt;/value&gt;&lt;/option&gt;
          &lt;option label='Away'&gt;&lt;value&gt;away&lt;/value&gt;&lt;/option&gt;
          &lt;option label='Extended Away'&gt;&lt;value&gt;xa&lt;/value&gt;&lt;/option&gt;
          &lt;option label='Do Not Disturb'&gt;&lt;value&gt;dnd&lt;/value&gt;&lt;/option&gt;
          &lt;value&gt;chat&lt;/value&gt;
          &lt;value&gt;online&lt;/value&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/options&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">Note: The foregoing example shows some (but by no means all) of the possible configuration options that MAY be provided. If an implementation provides these options using the <strong>Data Forms</strong> protocol, it MUST use the field variables that are registered with the XMPP Registrar in association with the 'http://jabber.org/protocol/pubsub' namespace (a preliminary representation of those field variables is shown above and in the <a href="#registrar-formtypes-subscribe">pubsub#subscribe_options FORM_TYPE</a> section of this document, but MUST NOT be construed as canonical since the XMPP Registrar may standardize additional fields at a later date without changes to this document).</p>
      <p class="" style="">Note: Many of the relevant data form fields are of type "boolean" and MUST be handled accordingly.  [<a href="#nt-idm1081">15</a>]</p>
    </div>
    <div class="indent"><h4 id="subscriber-configure-error">6.3.4 Error Cases<a class="anchor-link" href="#subscriber-configure-error"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">There are several reasons why the options request might fail:</p>
      <ol start="" class="" style="">
        <li class="" style="">The requesting entity does not have sufficient privileges to modify subscription options for the specified JID.</li>
        <li class="" style="">The requesting entity (or specified subscriber) is not subscribed.</li>
        <li class="" style="">The request does not specify both the NodeID and the subscriber's JID.</li>
        <li class="" style="">The request does not specify a subscription ID but one is required.</li>
        <li class="" style="">The request specifies a subscription ID that is not valid or current.</li>
        <li class="" style="">Subscription options are not supported.</li>
        <li class="" style="">The node does not exist.</li>
      </ol>
      <p class="" style="">These error cases are described more fully in the following sections.</p>
      <div class="indent"><h5 id="subscriber-configure-error-forbidden">6.3.4.1 Insufficient Privileges</h5>
        <p class="" style="">When requesting subscription options, the subscriber MUST specify the JID that is subscribed to the node and SHOULD specify a node (if no node is specified, i.e. via node="", the service MUST assume that the requesting entity wishes to request subscription options for its subscription to the root collection node; refer to <span class="ref">XEP-0248</span> for details).</p>
        <p class="" style="">The service MUST validate that the entity making the request is authorized to set the subscription options for the subscribed entity. If the subscriber's JID is of the form (&lt;localpart@domain.tld/resource&gt; or &lt;domain.tld/resource&gt;), a service MUST perform this check by comparing the (&lt;localpart@domain.tld&gt; or &lt;domain.tld&gt;) part of the two JIDs to ensure that they match. If the bare JID portions of the JIDs do not match and the requesting entity is not authorized to modify subscription options for the JID (e.g., because it is not a service-wide admin or authorized proxy), the service MUST return a &lt;forbidden/&gt; error.</p>
        <figure class="code-example" id="example-61"><figcaption><strong>Example 61.</strong> Requesting entity does not have sufficient privileges to modify subscription options<a class="anchor-link" href="#example-61"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-configure-error-nosub">6.3.4.2 No Such Subscriber</h5>
        <p class="" style="">If the requesting entity (or specified subscriber, if different) is not subscribed, the service MUST return an &lt;unexpected-request/&gt; error, which SHOULD also include a pubsub-specific error condition of &lt;not-subscribed/&gt;.</p>
        <figure class="code-example" id="example-62"><figcaption><strong>Example 62.</strong> No such subscriber<a class="anchor-link" href="#example-62"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='options1'&gt;
  &lt;error type='modify'&gt;
    &lt;unexpected-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;not-subscribed xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-configure-error-jid">6.3.4.3 Subscriber JID Required</h5>
        <p class="" style="">If the subscriber does not specify a subscriber JID, the service MUST return a &lt;bad-request/&gt; error, which SHOULD also include a pubsub-specific error condition of &lt;jid-required/&gt;.</p>
        <figure class="code-example" id="example-63"><figcaption><strong>Example 63.</strong> Subscriber JID not specified<a class="anchor-link" href="#example-63"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='options1'&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;jid-required xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-configure-error-subid">6.3.4.4 Subscription ID Required</h5>
        <p class="" style="">If a subscription identifier is associated with the subscription, the 'subid' attribute MUST be present on the request in order for the service to differentiate subscriptions for the same entity. If the 'subid' is required but not provided, the service MUST return a &lt;bad-request/&gt; error, which SHOULD also include a pubsub-specific error condition of &lt;subid-required/&gt;.</p>
        <figure class="code-example" id="example-64"><figcaption><strong>Example 64.</strong> SubID required<a class="anchor-link" href="#example-64"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;subid-required xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-configure-error-badsubid">6.3.4.5 Invalid Subscription ID</h5>
        <p class="" style="">If a subscription identifier is associated with the subscription but the request includes a SubID that is not valid or current for the subscriber, the service MUST return a &lt;not-acceptable/&gt; error, which SHOULD also include a pubsub-specific error condition of &lt;invalid-subid/&gt;.</p>
        <figure class="code-example" id="example-65"><figcaption><strong>Example 65.</strong> Invalid subscription identifier<a class="anchor-link" href="#example-65"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='unsub1'&gt;
  &lt;error type='modify'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;invalid-subid xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-configure-error-options">6.3.4.6 Subscription Options Not Supported</h5>
        <p class="" style="">If the node or service does not support subscription options, the service MUST respond with a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "subscription-options".</p>
        <figure class="code-example" id="example-66"><figcaption><strong>Example 66.</strong> Subscription options not supported<a class="anchor-link" href="#example-66"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='options1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='subscription-options'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-configure-error-node">6.3.4.7 Node Does Not Exist</h5>
        <p class="" style="">If the node does not exist, the pubsub service MUST return an &lt;item-not-found/&gt; error.</p>
        <figure class="code-example" id="example-67"><figcaption><strong>Example 67.</strong> Node does not exist<a class="anchor-link" href="#example-67"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='options1'&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
    </div>
    <div class="indent"><h4 id="subscriber-configure-submit">6.3.5 Form Submission<a class="anchor-link" href="#subscriber-configure-submit"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">After receiving the configuration form, the requesting entity SHOULD submit the form in order to update the entity's subscription options for that node.</p>
      <figure class="code-example" id="example-68"><figcaption><strong>Example 68.</strong> Subscriber submits completed options form<a class="anchor-link" href="#example-68"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='options2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;options node='princely_musings' jid='francisco@denmark.lit'&gt;
        &lt;x xmlns='jabber:x:data' type='submit'&gt;
          &lt;field var='FORM_TYPE' type='hidden'&gt;
            &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var='pubsub#deliver'&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
          &lt;field var='pubsub#digest'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
          &lt;field var='pubsub#include_body'&gt;&lt;value&gt;false&lt;/value&gt;&lt;/field&gt;
          &lt;field var='pubsub#show-values'&gt;
            &lt;value&gt;chat&lt;/value&gt;
            &lt;value&gt;online&lt;/value&gt;
            &lt;value&gt;away&lt;/value&gt;
          &lt;/field&gt;
        &lt;/x&gt;
     &lt;/options&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="subscriber-configure-process">6.3.6 Form Processing<a class="anchor-link" href="#subscriber-configure-process"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <div class="indent"><h5 id="subscriber-configure-process-success">6.3.6.1 Success</h5>
        <p class="" style="">If the service can successfully process the submission, it MUST respond with success.</p>
        <figure class="code-example" id="example-69"><figcaption><strong>Example 69.</strong> Service responds with success<a class="anchor-link" href="#example-69"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='options2'/&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-configure-process-failure">6.3.6.2 Failure</h5>
        <p class="" style="">If the subscriber attempts to set an invalid group of options, the service MUST respond with a &lt;bad-request/&gt; error.</p>
        <figure class="code-example" id="example-70"><figcaption><strong>Example 70.</strong> Service responds with Bad Request for invalid options<a class="anchor-link" href="#example-70"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='options2'&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;invalid-options xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        <p class="" style="">The other errors already mentioned for getting subscription options also apply to setting subscription options.</p>
      </div>
    </div>
    <div class="indent"><h4 id="subscriber-configure-subandconfig">6.3.7 Subscribe and Configure<a class="anchor-link" href="#subscriber-configure-subandconfig"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">As noted, if a service supports subscription options, an entity MAY subscribe and provide the subscription options in the same stanza.</p>
      <p class="" style="">Note: The &lt;options/&gt; element MUST follow the &lt;subscribe/&gt; element and MUST NOT possess a 'node' attribute or 'jid' attribute, since the value of the &lt;subscribe/&gt; element's 'node' attribute specifies the desired NodeID and the value of the &lt;subscribe/&gt; element's 'jid' attribute specifies the subscriber's JID; if any of these rules are violated, the service MUST return a &lt;bad-request/&gt; error.</p>
      <figure class="code-example" id="example-71"><figcaption><strong>Example 71.</strong> Entity subscribes to node and sets configuration options<a class="anchor-link" href="#example-71"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='sub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscribe node='princely_musings' jid='francisco@denmark.lit'/&gt;
    &lt;options&gt;
      &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#deliver'&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#digest'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#include_body'&gt;&lt;value&gt;false&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#show-values'&gt;
          &lt;value&gt;chat&lt;/value&gt;
          &lt;value&gt;online&lt;/value&gt;
          &lt;value&gt;away&lt;/value&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/options&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">When the service informs the client of success, it SHOULD include a data form of type "result" informing the client of the resulting configuration options.</p>
      <figure class="code-example" id="example-72"><figcaption><strong>Example 72.</strong> Service replies with success (including configuration options)<a class="anchor-link" href="#example-72"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='sub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscription
        node='princely_musings'
        jid='francisco@denmark.lit'
        subid='ba49252aaa4f5d320c24d3766f0bdcade78c78d3'
        subscription='subscribed'/&gt;
    &lt;options&gt;
      &lt;x xmlns='jabber:x:data' type='result'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#deliver'&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#digest'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#include_body'&gt;&lt;value&gt;false&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#show-values'&gt;
          &lt;value&gt;chat&lt;/value&gt;
          &lt;value&gt;online&lt;/value&gt;
          &lt;value&gt;away&lt;/value&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/options&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
  </div>
  <div class="indent"><h3 id="subscribe-default">6.4 Request Default Subscription Configuration Options<a class="anchor-link" href="#subscribe-default"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">An entity might want to request information about the default subscription configuration. Support for this feature is OPTIONAL.</p>
    <div class="indent"><h4 id="subscriber-default-request">6.4.1 Request<a class="anchor-link" href="#subscriber-default-request"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">To get the default subscription options for a node, the entity MUST send an empty &lt;default/&gt; element to the node; in response, the node SHOULD return the default subscription options.</p>
      <figure class="code-example" id="example-73"><figcaption><strong>Example 73.</strong> Entity requests default subscription configuration options<a class="anchor-link" href="#example-73"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='def1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;default node='princely_musings'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">Note: Here the namespace is 'http://jabber.org/protocol/pubsub' (not 'http://jabber.org/protocol/pubsub#owner' as for retrieval of the default node configuration options).</p>
      <p class="" style="">The service itself MAY also have default subscription configuration options. To get the default subscription configuration options all (leaf) nodes at a service, the entity MUST send an empty &lt;default/&gt; element but not specifiy a node; in response, the service SHOULD return the default subscription options.</p>
      <figure class="code-example" id="example-74"><figcaption><strong>Example 74.</strong> Entity requests default subscription configuration options<a class="anchor-link" href="#example-74"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='def2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;default/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">The process for retrieving the default subscription configuration options for collection nodes is described in <span class="ref">XEP-0248</span>.</p>
    </div>
    <div class="indent"><h4 id="subscriber-default-success">6.4.2 Success Case<a class="anchor-link" href="#subscriber-default-success"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If no error occurs, the node MUST return the default subscription configuration options.</p>
      <figure class="code-example" id="example-75"><figcaption><strong>Example 75.</strong> Service responds with default subscription configuration options<a class="anchor-link" href="#example-75"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='def1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;default node='princely_musings'&gt;
      &lt;x xmlns='jabber:x:data' type='result'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#deliver'&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#digest'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#include_body'&gt;&lt;value&gt;false&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#show-values'&gt;
          &lt;value&gt;chat&lt;/value&gt;
          &lt;value&gt;online&lt;/value&gt;
          &lt;value&gt;away&lt;/value&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/default&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="subscriber-default-error">6.4.3 Error Cases<a class="anchor-link" href="#subscriber-default-error"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">There are several reasons why the default subscription configuration options request might fail:</p>
      <ol start="" class="" style="">
        <li class="" style="">The service does not support subscription configuration.</li>
        <li class="" style="">The service does not support retrieval of default subscription configuration.</li>
      </ol>
      <p class="" style="">These error cases are described more fully in the following sections.</p>
      <div class="indent"><h5 id="subscriber-default-error-noconfig">6.4.3.1 Node Configuration Not Supported</h5>
        <p class="" style="">If the node does not support subscription configuration, it MUST return a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "subscription-options".</p>
        <figure class="code-example" id="example-76"><figcaption><strong>Example 76.</strong> Service does not support subscription configuration<a class="anchor-link" href="#example-76"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='def1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='subscription-options'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-default-error-notsupported">6.4.3.2 Default Subscription Configuration Retrieval Not Supported</h5>
        <p class="" style="">If the node does not support retrieval of default subscription configuration options, it MUST return a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "retrieve-default-sub".</p>
        <figure class="code-example" id="example-77"><figcaption><strong>Example 77.</strong> Service does not support retrieval of default subscription configuration options<a class="anchor-link" href="#example-77"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='def1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='retrieve-default-sub'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
    </div>
  </div>
  <div class="indent"><h3 id="subscriber-retrieve">6.5 Retrieve Items from a Node<a class="anchor-link" href="#subscriber-retrieve"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">Implementations of pubsub that choose to persist items MAY allow entities to request existing items from a node (e.g., an entity may wish to do this after successfully subscribing in order to receive all the items in the publishing history for the node).</p>
    <div class="indent"><h4 id="subscriber-retrieve-perms">6.5.1 Permissions<a class="anchor-link" href="#subscriber-retrieve-perms"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">The service MUST conform to the node's access model in determining whether to return items to the entity that requests them. Specifically:</p>
      <ul class="" style="">
        <li class="" style=""><p class="" style="">If the access model is "open", the service SHOULD allow any entity (whether or not it is subscribed) to retrieve items.</p></li>
        <li class="" style=""><p class="" style="">If the access model is "presence", the service SHOULD allow any entity that is subscribed to the owner's presence to retrieve items.</p></li>
        <li class="" style=""><p class="" style="">If the access model is "roster", the service SHOULD allow any entity that is subscribed to the owner's presence and contained in the relevant roster group(s) to retrieve items.</p></li>
        <li class="" style=""><p class="" style="">If the access model is "authorize" or "whitelist", the service MUST allow only subscribed entities to retrieve items.</p></li>
      </ul>
      <p class="" style="">The only exception foreseen to the SHOULD requirements for the foregoing access models is the enforcement of local privacy and security policies as specified more fully in the <a href="#security">Security Considerations</a> section of this document. (In addition, a service MUST always allow the node owner to retrieve items from a node and SHOULD always allow a publisher to do so.)</p>
    </div>
    <div class="indent"><h4 id="subscriber-retrieve-requestall">6.5.2 Requesting All Items<a class="anchor-link" href="#subscriber-retrieve-requestall"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">The subscriber may request all items by specifying only the Node ID without restrictions.</p>
      <figure class="code-example" id="example-78"><figcaption><strong>Example 78.</strong> Subscriber requests all items<a class="anchor-link" href="#example-78"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='items1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='princely_musings'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="subscriber-retrieve-returnall">6.5.3 Returning All Items<a class="anchor-link" href="#subscriber-retrieve-returnall"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">The service then SHOULD return all available items at the node, although it MAY truncate the result set if a large number of items has been published (see next section) and naturally it cannot return items that have been deleted, expired, etc.</p>
      <figure class="code-example" id="example-79"><figcaption><strong>Example 79.</strong> Service returns all items<a class="anchor-link" href="#example-79"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='368866411b877c30064a5f62b917cffe'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;The Uses of This World&lt;/title&gt;
          &lt;summary&gt;
O, that this too too solid flesh would melt
Thaw and resolve itself into a dew!
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32396&lt;/id&gt;
          &lt;published&gt;2003-12-12T17:47:23Z&lt;/published&gt;
          &lt;updated&gt;2003-12-12T17:47:23Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
      &lt;item id='3300659945416e274474e469a1f0154c'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Ghostly Encounters&lt;/title&gt;
          &lt;summary&gt;
O all you host of heaven! O earth! what else?
And shall I couple hell? O, fie! Hold, hold, my heart;
And you, my sinews, grow not instant old,
But bear me stiffly up. Remember thee!
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32396&lt;/id&gt;
          &lt;published&gt;2003-12-12T23:21:34Z&lt;/published&gt;
          &lt;updated&gt;2003-12-12T23:21:34Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
      &lt;item id='4e30f35051b7b8b42abe083742187228'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Alone&lt;/title&gt;
          &lt;summary&gt;
Now I am alone.
O, what a rogue and peasant slave am I!
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32396&lt;/id&gt;
          &lt;published&gt;2003-12-13T11:09:53Z&lt;/published&gt;
          &lt;updated&gt;2003-12-13T11:09:53Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Soliloquy&lt;/title&gt;
          &lt;summary&gt;
To be, or not to be: that is the question:
Whether 'tis nobler in the mind to suffer
The slings and arrows of outrageous fortune,
Or to take arms against a sea of troubles,
And by opposing end them?
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32397&lt;/id&gt;
          &lt;published&gt;2003-12-13T18:30:02Z&lt;/published&gt;
          &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="subscriber-retrieve-returnsome">6.5.4 Returning Some Items<a class="anchor-link" href="#subscriber-retrieve-returnsome"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">A node may have a large number of items associated with it, in which case it may be problematic to return all of the items in response to an items request. In this case, the service SHOULD return some of the items and note that the list of items has been truncated by including a <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0059.html">Result Set Management (XEP-0059)</a></span>  [<a href="#nt-idm1184">16</a>] notation.</p>
      <p class="" style="">A Pubsub entity supporting <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0059.html">Result Set Management (XEP-0059)</a></span>  [<a href="#nt-idm1184">16</a>] SHOULD include a feature of "http://jabber.org/protocol/pubsub#rsm" in its disco#info response, to make it clear that the RSM feature is for PubSub, and not for e.g., <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0313.html">Message Archive Management (XEP-0313)</a></span>  [<a href="#nt-idm1193">17</a>].</p>
      <figure class="code-example" id="example-80"><figcaption><strong>Example 80.</strong> Service returns some items via result set management<a class="anchor-link" href="#example-80"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='368866411b877c30064a5f62b917cffe'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;The Uses of This World&lt;/title&gt;
          &lt;summary&gt;
O, that this too too solid flesh would melt
Thaw and resolve itself into a dew!
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32396&lt;/id&gt;
          &lt;published&gt;2003-12-12T17:47:23Z&lt;/published&gt;
          &lt;updated&gt;2003-12-12T17:47:23Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
      &lt;item id='3300659945416e274474e469a1f0154c'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Ghostly Encounters&lt;/title&gt;
          &lt;summary&gt;
O all you host of heaven! O earth! what else?
And shall I couple hell? O, fie! Hold, hold, my heart;
And you, my sinews, grow not instant old,
But bear me stiffly up. Remember thee!
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32396&lt;/id&gt;
          &lt;published&gt;2003-12-12T23:21:34Z&lt;/published&gt;
          &lt;updated&gt;2003-12-12T23:21:34Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
      &lt;item id='4e30f35051b7b8b42abe083742187228'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Alone&lt;/title&gt;
          &lt;summary&gt;
Now I am alone.
O, what a rogue and peasant slave am I!
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32396&lt;/id&gt;
          &lt;published&gt;2003-12-13T11:09:53Z&lt;/published&gt;
          &lt;updated&gt;2003-12-13T11:09:53Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
    &lt;/items&gt;
    &lt;set xmlns='http://jabber.org/protocol/rsm'&gt;
      &lt;first index='0'&gt;368866411b877c30064a5f62b917cffe&lt;/first&gt;
      &lt;last&gt;4e30f35051b7b8b42abe083742187228&lt;/last&gt;
      &lt;count&gt;19&lt;/count&gt;
    &lt;/set&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="subscriber-retrieve-returnlast">6.5.5 Returning the Last Published Item<a class="anchor-link" href="#subscriber-retrieve-returnlast"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">Even if the service or node does not support persistent items, it MAY return the last published item.</p>
      <figure class="code-example" id="example-81"><figcaption><strong>Example 81.</strong> Service returns last published item<a class="anchor-link" href="#example-81"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Soliloquy&lt;/title&gt;
          &lt;summary&gt;
To be, or not to be: that is the question:
Whether 'tis nobler in the mind to suffer
The slings and arrows of outrageous fortune,
Or to take arms against a sea of troubles,
And by opposing end them?
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32397&lt;/id&gt;
          &lt;published&gt;2003-12-13T18:30:02Z&lt;/published&gt;
          &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="subscriber-retrieve-returnnotify">6.5.6 Returning Notifications Only<a class="anchor-link" href="#subscriber-retrieve-returnnotify"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">A service MAY return event notifications without payloads (e.g., to conserve bandwidth). If so, the client MAY request a specific item (using the ItemID) in order to retrieve the payload. When an entity requests items by ItemID, implementations MUST allow multiple items to be specified in the request.</p>
      <figure class="code-example" id="example-82"><figcaption><strong>Example 82.</strong> Subscriber requests specific items by ItemID<a class="anchor-link" href="#example-82"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='items3'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='368866411b877c30064a5f62b917cffe'/&gt;
      &lt;item id='4e30f35051b7b8b42abe083742187228'/&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <figure class="code-example" id="example-83"><figcaption><strong>Example 83.</strong> Service sends requested item(s)<a class="anchor-link" href="#example-83"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    id='items3'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='368866411b877c30064a5f62b917cffe'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;The Uses of This World&lt;/title&gt;
          &lt;summary&gt;
O, that this too too solid flesh would melt
Thaw and resolve itself into a dew!
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32396&lt;/id&gt;
          &lt;published&gt;2003-12-12T17:47:23Z&lt;/published&gt;
          &lt;updated&gt;2003-12-12T17:47:23Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
      &lt;item id='4e30f35051b7b8b42abe083742187228'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Alone&lt;/title&gt;
          &lt;summary&gt;
Now I am alone.
O, what a rogue and peasant slave am I!
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32396&lt;/id&gt;
          &lt;published&gt;2003-12-13T11:09:53Z&lt;/published&gt;
          &lt;updated&gt;2003-12-13T11:09:53Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="subscriber-retrieve-requestrecent">6.5.7 Requesting the Most Recent Items<a class="anchor-link" href="#subscriber-retrieve-requestrecent"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">A service MAY allow entities to request the most recent N items by using the 'max_items' attribute. When max_items is used, implementations SHOULD return the N most recent (as opposed to the N oldest) items. (Note: A future version of this specification may recommend the use of <span class="ref">XEP-0059</span> instead of the 'max_items' attribute.)</p>
      <figure class="code-example" id="example-84"><figcaption><strong>Example 84.</strong> Subscriber requests two most recent items<a class="anchor-link" href="#example-84"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='items2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='princely_musings' max_items='2'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <figure class="code-example" id="example-85"><figcaption><strong>Example 85.</strong> Service returns two most recent items<a class="anchor-link" href="#example-85"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='4e30f35051b7b8b42abe083742187228'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Alone&lt;/title&gt;
          &lt;summary&gt;
Now I am alone.
O, what a rogue and peasant slave am I!
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32396&lt;/id&gt;
          &lt;published&gt;2003-12-13T11:09:53Z&lt;/published&gt;
          &lt;updated&gt;2003-12-13T11:09:53Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Soliloquy&lt;/title&gt;
          &lt;summary&gt;
To be, or not to be: that is the question:
Whether 'tis nobler in the mind to suffer
The slings and arrows of outrageous fortune,
Or to take arms against a sea of troubles,
And by opposing end them?
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32397&lt;/id&gt;
          &lt;published&gt;2003-12-13T18:30:02Z&lt;/published&gt;
          &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">If there are fewer items in the node than requested, the service should return all of them.</p>
    <figure class="code-example" id="example-86"><figcaption><strong>Example 86.</strong> Service returns no items if it has none<a class="anchor-link" href="#example-86"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='princely_musings'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="subscriber-retrieve-requestone">6.5.8 Requesting a Particular Item<a class="anchor-link" href="#subscriber-retrieve-requestone"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">The subscriber can request a particular item by specifying the Node ID and the appropriate ItemID.</p>
      <figure class="code-example" id="example-87"><figcaption><strong>Example 87.</strong> Subscriber requests a particular item<a class="anchor-link" href="#example-87"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='items3'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'/&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">The service would then return that specific item, if available.</p>
    </div>
    <div class="indent"><h4 id="subscriber-retrieve-error">6.5.9 Error Cases<a class="anchor-link" href="#subscriber-retrieve-error"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">There are several reasons why the items retrieval request might fail:</p>
      <ol start="" class="" style="">
        <li class="" style="">The requesting entity has multiple subscriptions to the node but does not specify a subscription ID.</li>
        <li class="" style="">The requesting entity is subscribed but specifies an invalid subscription ID.</li>
        <li class="" style="">The node does not return items to unsubscribed entities and the requesting entity is not subscribed.</li>
        <li class="" style="">The service or node does not support persistent items and does not return the last published item.</li>
        <li class="" style="">The service or node does not support item retrieval.</li>
        <li class="" style="">The node has an access model of "presence" and the requesting entity is not subscribed to the owner's presence.</li>
        <li class="" style="">The node has an access model of "roster" and the requesting entity is not in one of the authorized roster groups.</li>
        <li class="" style="">The node has an access model of "whitelist" and the requesting entity is not on the whitelist.</li>
        <li class="" style="">The service or node requires payment for item retrieval.</li>
        <li class="" style="">The requesting entity is blocked from retrieving items from the node (e.g., because having an affiliation of outcast).</li>
        <li class="" style="">The node does not exist.</li>
      </ol>
      <p class="" style="">These error cases are described more fully in the following sections.</p>
      <div class="indent"><h5 id="subscriber-retrieve-error-subid">6.5.9.1 Subscription ID Required</h5>
        <p class="" style="">If the requesting entity has multiple subscriptions to the node but does not specify a subscription ID, the service MUST return a &lt;bad-request/&gt; error to the subscriber, which SHOULD also include a pubsub-specific error condition of &lt;subid-required/&gt;.</p>
        <figure class="code-example" id="example-88"><figcaption><strong>Example 88.</strong> Entity did not specify SubID<a class="anchor-link" href="#example-88"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items1'&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;subid-required xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-retrieve-error-badsubid">6.5.9.2 Invalid Subscription ID</h5>
        <p class="" style="">If the requesting entity is subscribed but specifies an invalid subscription ID, the service MUST return a &lt;not-acceptable/&gt; error to the subscriber, which SHOULD also include a pubsub-specific error condition of &lt;invalid-subid/&gt;.</p>
        <figure class="code-example" id="example-89"><figcaption><strong>Example 89.</strong> Entity specified invalid SubID<a class="anchor-link" href="#example-89"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items1'&gt;
  &lt;error type='modify'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;invalid-subid xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-retrieve-error-notsubscribed">6.5.9.3 Entity Not Subscribed</h5>
        <p class="" style="">If the node does not return items to unsubscribed entities and the requesting entity is not subscribed (which includes having a pending subscription), the service MUST return a &lt;not-authorized/&gt; error to the subscriber, which SHOULD also include a pubsub-specific error condition of &lt;not-subscribed/&gt;.</p>
        <figure class="code-example" id="example-90"><figcaption><strong>Example 90.</strong> Entity is not subscribed<a class="anchor-link" href="#example-90"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items1'&gt;
  &lt;error type='auth'&gt;
    &lt;not-authorized xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;not-subscribed xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-retrieve-error-persistent">6.5.9.4 Persistent Items Not Supported</h5>
        <p class="" style="">If the service or node does not support persistent items and does not return the last published item, the service MUST return a &lt;feature-not-implemented/&gt; error to the subscriber, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "persistent-items".</p>
        <figure class="code-example" id="example-91"><figcaption><strong>Example 91.</strong> Persistent items not supported<a class="anchor-link" href="#example-91"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='persistent-items'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-retrieve-error-notsupported">6.5.9.5 Item Retrieval Not Supported</h5>
        <p class="" style="">If the service or node does not support item retrieval (e.g., because the node is a collection node as described in <span class="ref">XEP-0248</span>), the service MUST return a &lt;feature-not-implemented/&gt; error to the subscriber, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "retrieve-items".</p>
        <figure class="code-example" id="example-92"><figcaption><strong>Example 92.</strong> Item retrieval not supported<a class="anchor-link" href="#example-92"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='retrieve-items'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-retrieve-error-presence">6.5.9.6 Presence Subscription Required</h5>
        <p class="" style="">For nodes with an access model of "presence", if the requesting entity is not subscribed to the owner's presence then the pubsub service MUST respond with a &lt;not-authorized/&gt; error, which SHOULD also include a pubsub-specific error condition of &lt;presence-subscription-required/&gt;.</p>
        <figure class="code-example" id="example-93"><figcaption><strong>Example 93.</strong> Entity is not authorized to retrieve items (presence subscription required)<a class="anchor-link" href="#example-93"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items1'&gt;
  &lt;error type='auth'&gt;
    &lt;not-authorized xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;presence-subscription-required xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-retrieve-error-rostergroup">6.5.9.7 Not in Roster Group</h5>
        <p class="" style="">For nodes with an access model of "roster", if the requesting entity is not in one of the authorized roster groups then the pubsub service MUST respond with a &lt;not-authorized/&gt; error, which SHOULD also include a pubsub-specific error condition of &lt;not-in-roster-group/&gt;.</p>
        <figure class="code-example" id="example-94"><figcaption><strong>Example 94.</strong> Entity is not authorized to retrieve items (not in roster group)<a class="anchor-link" href="#example-94"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items1'&gt;
  &lt;error type='auth'&gt;
    &lt;not-authorized xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;not-in-roster-group xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-retrieve-error-whitelist">6.5.9.8 Not on Whitelist</h5>
        <p class="" style="">For nodes with a node access model of "whitelist", if the requesting entity is not on the whitelist then the service MUST return a &lt;not-allowed/&gt; error, specifying a pubsub-specific error condition of &lt;closed-node/&gt;.</p>
        <figure class="code-example" id="example-95"><figcaption><strong>Example 95.</strong> Node has whitelist access model<a class="anchor-link" href="#example-95"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items1'&gt;
  &lt;error type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;closed-node xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-retrieve-error-payment">6.5.9.9 Payment Required</h5>
        <p class="" style="">Commercial deployments may wish to link subscribers to a database of paying customers. If the subscriber needs to provide payment in order to retrieve items from the node (e.g., if the subscriber is not in the customer database or the customer's account is not paid up), the service SHOULD return a &lt;payment-required/&gt; error to the subscriber.</p>
        <figure class="code-example" id="example-96"><figcaption><strong>Example 96.</strong> Payment is required to retrieve items<a class="anchor-link" href="#example-96"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items1'&gt;
  &lt;error type='auth'&gt;
    &lt;payment-required xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-retrieve-error-blocked">6.5.9.10 Blocked</h5>
        <p class="" style="">If the requesting entity is blocked from retrieving items (e.g., because having an affiliation of outcast), the service MUST return a &lt;forbidden/&gt; error to the subscriber.</p>
        <figure class="code-example" id="example-97"><figcaption><strong>Example 97.</strong> Requesting entity is blocked<a class="anchor-link" href="#example-97"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items1'&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-retrieve-error-node">6.5.9.11 Node Does Not Exist</h5>
        <p class="" style="">If the node does not exist, the service SHOULD return an &lt;item-not-found/&gt; error to the subscriber.</p>
        <figure class="code-example" id="example-98"><figcaption><strong>Example 98.</strong> Node does not exist<a class="anchor-link" href="#example-98"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items1'&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="subscriber-retrieve-error-items">6.5.9.12 No Such Item(s)</h5>
        <p class="" style="">If there are no items at the node or the requested items do not exist, the service SHOULD return an IQ stanza of type "result" with an empty &lt;items/&gt; element.</p>
        <figure class="code-example" id="example-99"><figcaption><strong>Example 99.</strong> No such item(s)<a class="anchor-link" href="#example-99"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='pubsub.shakespeare.lit'
    id='items1'
    to='francisco@denmark.lit/barracks'
    type='result'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='princely_musings'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
    </div>
  </div>
<h2 id="publisher">7.
       Publisher Use Cases<a class="anchor-link" href="#publisher"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="publisher-publish">7.1 Publish an Item to a Node<a class="anchor-link" href="#publisher-publish"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <div class="indent"><h4 id="publisher-publish-request">7.1.1 Request<a class="anchor-link" href="#publisher-publish-request"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">Any entity that is allowed to publish items to a node (i.e., a publisher or an owner) may do so at any time by sending an IQ-set to the service containing a pubsub element with a &lt;publish/&gt; child.</p>
      <p class="" style="">The syntax is as follows:</p>
      <ul class="" style="">
        <li class="" style="">The &lt;publish/&gt; element MUST possess a 'node' attribute, specifying the NodeID of the node.</li>
        <li class="" style="">Depending on the node configuration, the &lt;publish/&gt; element MAY contain no &lt;item/&gt; elements or one &lt;item/&gt; element.  [<a href="#nt-idm1274">18</a>]  [<a href="#nt-idm1275">19</a>]</li>
        <li class="" style="">The &lt;item/&gt; element provided by the publisher MAY possess an 'id' attribute, specifying a unique ItemID for the item. If an ItemID is not provided in the publish request, the pubsub service MUST generate one and MUST ensure that it is unique for that node.</li>
      </ul>
      <p class="" style="">An example follows.</p>
      <figure class="code-example" id="example-100"><figcaption><strong>Example 100.</strong> Publisher publishes an item with an ItemID<a class="anchor-link" href="#example-100"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/blogbot'
    to='pubsub.shakespeare.lit'
    id='publish1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='princely_musings'&gt;
      &lt;item id='bnd81g37d61f49fgn581'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Soliloquy&lt;/title&gt;
          &lt;summary&gt;
To be, or not to be: that is the question:
Whether 'tis nobler in the mind to suffer
The slings and arrows of outrageous fortune,
Or to take arms against a sea of troubles,
And by opposing end them?
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32397&lt;/id&gt;
          &lt;published&gt;2003-12-13T18:30:02Z&lt;/published&gt;
          &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="publisher-publish-success">7.1.2 Success Case<a class="anchor-link" href="#publisher-publish-success"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If the pubsub service can successfully process the request, it MUST inform the publisher of success. If the publish request did not include an ItemID, the IQ-result SHOULD include an empty &lt;item/&gt; element that specifies the ItemID of the published item.</p>
      <figure class="code-example" id="example-101"><figcaption><strong>Example 101.</strong> Service replies with success<a class="anchor-link" href="#example-101"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/blogbot'
    id='publish1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'/&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">Note: If the publisher previously published an item with the same ItemID, successfully processing the request means that the service MUST overwrite the old item with the new item and then proceed as follows.</p>
      <p class="" style="">The pubsub service MUST then send one event notification to each entity that meets the criteria for receiving an event notification (typically to each approved subscriber, although there are other contexts in which an entity may receive an event notification as summarized under <a href="#impl-notify">Notification Triggers</a>). Each &lt;message/&gt; stanza generated by a pubsub service SHOULD possess an 'id' attribute with a unique value so that the service can properly track any notification-related errors that may occur (see the <a href="#impl-bounce">Handling Notification-Related Errors</a> section of this document). Depending on the node configuration, the event notification either will or will not contain the payload, as shown below.</p>
      <p class="" style="">Note: In order to facilitate authorization for item removal as described in the <a href="#publisher-delete">Delete an Item from a Node</a> section of this document, implementations that support persistent items SHOULD store the item (if the node is so configured) and maintain a record of the publisher.</p>
      <p class="" style="">Note: If the service or node is configured so that there is a maximum number of items cached at the node and the maximum is reached when an item is published, the service MUST delete one of the existing items. It is RECOMMENDED for the service to follow the "first in, first out" rule and delete the oldest item. Depending on node configuration, deletion of an existing item MAY result in sending of a delete notification to the subscribers.</p>
      <div class="indent"><h5 id="publisher-publish-success-withpayload">7.1.2.1 Notification With Payload</h5>
        <p class="" style="">If the node is configured to include payloads, the subscribers will receive payloads with the event notifications.</p>
        <figure class="code-example" id="example-102"><figcaption><strong>Example 102.</strong> Subscribers receive event notifications with payloads<a class="anchor-link" href="#example-102"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit' to='francisco@denmark.lit' id='foo'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Soliloquy&lt;/title&gt;
          &lt;summary&gt;
To be, or not to be: that is the question:
Whether 'tis nobler in the mind to suffer
The slings and arrows of outrageous fortune,
Or to take arms against a sea of troubles,
And by opposing end them?
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32397&lt;/id&gt;
          &lt;published&gt;2003-12-13T18:30:02Z&lt;/published&gt;
          &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message from='pubsub.shakespeare.lit' to='bernardo@denmark.lit' id='bar'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Soliloquy&lt;/title&gt;
          &lt;summary&gt;
To be, or not to be: that is the question:
Whether 'tis nobler in the mind to suffer
The slings and arrows of outrageous fortune,
Or to take arms against a sea of troubles,
And by opposing end them?
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32397&lt;/id&gt;
          &lt;published&gt;2003-12-13T18:30:02Z&lt;/published&gt;
          &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message from='pubsub.shakespeare.lit' to='horatio@denmark.lit' id='baz'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Soliloquy&lt;/title&gt;
          &lt;summary&gt;
To be, or not to be: that is the question:
Whether 'tis nobler in the mind to suffer
The slings and arrows of outrageous fortune,
Or to take arms against a sea of troubles,
And by opposing end them?
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32397&lt;/id&gt;
          &lt;published&gt;2003-12-13T18:30:02Z&lt;/published&gt;
          &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message from='pubsub.shakespeare.lit' to='bard@shakespeare.lit' id='fez'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Soliloquy&lt;/title&gt;
          &lt;summary&gt;
To be, or not to be: that is the question:
Whether 'tis nobler in the mind to suffer
The slings and arrows of outrageous fortune,
Or to take arms against a sea of troubles,
And by opposing end them?
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32397&lt;/id&gt;
          &lt;published&gt;2003-12-13T18:30:02Z&lt;/published&gt;
          &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="publisher-publish-success-withoutpayload">7.1.2.2 Notification Without Payload</h5>
        <p class="" style="">If the node is configured to not include payloads, the subscribers will receive event notifications only. (If payloads are not included, subscribers may request the published item via the protocol defined in the <a href="#subscriber-retrieve">Retrieve Items from a Node</a> section of this document.)</p>
      <figure class="code-example" id="example-103"><figcaption><strong>Example 103.</strong> Subscribers receive event notifications only<a class="anchor-link" href="#example-103"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit' to='francisco@denmark.lit' id='foo'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message from='pubsub.shakespeare.lit' to='bernardo@denmark.lit' id='bar'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message from='pubsub.shakespeare.lit' to='horatio@denmark.lit' id='baz'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message from='pubsub.shakespeare.lit' to='bard@shakespeare.lit' id='fez'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="publisher-publish-success-publisher">7.1.2.3 Item Publisher</h5>
        <p class="" style="">If configured to do so, the service can include the publisher of the item when it generates event notifications.</p>
    <figure class="code-example" id="example-104"><figcaption><strong>Example 104.</strong> Service Notifies Subscribers<a class="anchor-link" href="#example-104"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit' to='francisco@denmark.lit' id='foo'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'
            publisher='hamlet@denmark.lit'&gt;
        [ ... ENTRY ... ]
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
        <p class="" style="">If so, the service MUST also include the publisher with every other form of item retrieval.</p>
        <figure class="code-example" id="example-105"><figcaption><strong>Example 105.</strong> Service returns items<a class="anchor-link" href="#example-105"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='items1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'
            publisher='hamlet@denmark.lit'&gt;
        [ ... ENTRY ... ]
      &lt;/item&gt;
        [ ... MORE ITEMS ... ]
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
        <p class="" style="">The value of the 'publisher' attribute MUST be generated by the service, not accepted by the service in the published item, since allowing the publisher to assert its JID would open the possibility of spoofing.</p>
        <p class="" style="">The JID stamped by the service can be either (1) the full JID &lt;localpart@domain.tld/resource&gt; of the publisher as taken the 'from' attribute of the IQ-set used to publish the item or (2) the bare JID &lt;localpart@domain.tld&gt; of the publisher as derived from a formal affiliation in the explicit list of whitelisted publishers.</p>
      </div>
      <div class="indent"><h5 id="publisher-publish-success-subid">7.1.2.4 Inclusion of Subscription ID</h5>
        <p class="" style="">If a single entity is subscribed to a node multiple times, the service SHOULD notate the event notification so that the entity can determine which subscription identifier(s) generated this event. If these notations are included, they MUST use the <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0131.html">Stanza Headers and Internet Metadata (XEP-0131)</a></span>  [<a href="#nt-idm1307">20</a>] format and SHOULD be included after the event notification information (i.e., as the last child of the &lt;message/&gt; stanza).</p>
        <figure class="code-example" id="example-106"><figcaption><strong>Example 106.</strong> Subscriber receives notated event notification<a class="anchor-link" href="#example-106"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit' to='francisco@denmark.lit' id='foo'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
  &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
    &lt;header name='SubID'&gt;123-abc&lt;/header&gt;
    &lt;header name='SubID'&gt;004-yyy&lt;/header&gt;
  &lt;/headers&gt;
&lt;/message&gt;
</pre></figure>
      </div>
    </div>
    <div class="indent"><h4 id="publisher-publish-error">7.1.3 Error Cases<a class="anchor-link" href="#publisher-publish-error"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">There are several reasons why the publish request might fail:</p>
      <ol start="" class="" style="">
        <li class="" style="">The requesting entity does not have sufficient privileges to publish.</li>
        <li class="" style="">The node does not support item publication.</li>
        <li class="" style="">The node does not exist.</li>
        <li class="" style="">The payload size exceeds a service-defined limit.</li>
        <li class="" style="">The item contains more than one payload element or the namespace of the root payload element does not match the configured namespace for the node.</li>
        <li class="" style="">The request does not match the node configuration.</li>
      </ol>
      <p class="" style="">These error cases are described more fully in the following sections.</p>
      <p class="" style="">Note: If a publisher publishes an item with an Item ID and the ItemID matches that of an existing item, the pubsub service MUST NOT fail the publication but instead MUST overwrite the existing item and generate a new event notification (i.e., re-publication is equivalent to modification).</p>
      <div class="indent"><h5 id="publisher-publish-error-forbidden">7.1.3.1 Insufficient Privileges</h5>
        <p class="" style="">If the requesting entity does not have sufficient privileges to publish, the service MUST return a &lt;forbidden/&gt; error.</p>
        <figure class="code-example" id="example-107"><figcaption><strong>Example 107.</strong> Entity does not have sufficient privileges to publish to node<a class="anchor-link" href="#example-107"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    id='publish1'&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="publisher-publish-error-notsupported">7.1.3.2 Item Publication Not Supported</h5>
        <p class="" style="">If the node does not support item publication (e.g., because it is a collection node as described in <span class="ref">XEP-0248</span>), the service MUST return a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "publish".</p>
        <figure class="code-example" id="example-108"><figcaption><strong>Example 108.</strong> Node does not support item publication<a class="anchor-link" href="#example-108"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='publish1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='publish'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="publisher-publish-error-node">7.1.3.3 Node Does Not Exist</h5>
        <p class="" style="">If the requesting entity attempts to publish an item to a node that does not exist and the service does not support the "auto-create" feature (see <a href="#publisher-publish-autocreate">Automatic Node Creation</a>), the service MUST return an &lt;item-not-found/&gt; error.</p>
        <figure class="code-example" id="example-109"><figcaption><strong>Example 109.</strong> Entity attempts to publish to a non-existent node<a class="anchor-link" href="#example-109"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='publish1'&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="publisher-publish-error-bigpayload">7.1.3.4 Payload Too Big</h5>
        <p class="" style="">If the payload size exceeds a service-defined limit, the service MUST return a &lt;not-acceptable/&gt; error, which SHOULD also include a pubsub-specific error condition of &lt;payload-too-big/&gt;.</p>
        <figure class="code-example" id="example-110"><figcaption><strong>Example 110.</strong> Entity attempts to publish very large payload<a class="anchor-link" href="#example-110"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='publish1'&gt;
  &lt;error type='modify'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;payload-too-big xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="publisher-publish-error-badpayload">7.1.3.5 Bad Payload</h5>
        <p class="" style="">If the &lt;item/&gt; element does not contain exactly one payload element or the namespace of the root payload element does not match the configured namespace for the node, the service MUST bounce the request with a &lt;bad-request/&gt; error, which SHOULD also include a pubsub-specific error condition of &lt;invalid-payload/&gt;.</p>
        <figure class="code-example" id="example-111"><figcaption><strong>Example 111.</strong> Entity attempts to publish item with multiple payload elements or namespace does not match<a class="anchor-link" href="#example-111"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='publish1'&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;invalid-payload xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="publisher-publish-error-badrequest">7.1.3.6 Request Does Not Match Configuration</h5>
        <p class="" style="">If the request does not conform to the configured <a href="#events">event type</a> for the node, the service MAY bounce the request with a &lt;bad-request/&gt; error, which SHOULD also include a pubsub-specific error condition. The following rules apply:</p>
        <ul class="" style="">
          <li class="" style="">If the event type is persistent (either event notification or payload) and the publisher does not specify an ItemID, the service MUST generate the ItemID and MUST NOT bounce the publication request.</li>
          <li class="" style="">If the event type is persistent (either event notification or payload) and the publisher does not include an item, the service MUST bounce the publication request with a &lt;bad-request/&gt; error and a pubsub-specific error condition of &lt;item-required/&gt;.</li>
          <li class="" style="">If the event type is payload (either persistent or transient) and the publisher does not include a payload, the service SHOULD bounce the publication request with a &lt;bad-request/&gt; error and a pubsub-specific error condition of &lt;payload-required/&gt;.</li>
          <li class="" style="">If the event type is notification + transient and the publisher provides an item, the service MUST bounce the publication request with a &lt;bad-request/&gt; error and a pubsub-specific error condition of &lt;item-forbidden/&gt;.</li>
        </ul>
        <p class="" style="">Examples of these errors are shown below.</p>
        <figure class="code-example" id="example-112"><figcaption><strong>Example 112.</strong> Publisher attempts to publish to persistent node with no item<a class="anchor-link" href="#example-112"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='publish1'&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;item-required xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        <figure class="code-example" id="example-113"><figcaption><strong>Example 113.</strong> Publisher attempts to publish to payload node with no payload<a class="anchor-link" href="#example-113"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='publish1'&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;payload-required xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        <figure class="code-example" id="example-114"><figcaption><strong>Example 114.</strong> Publisher attempts to publish to transient notification node with item<a class="anchor-link" href="#example-114"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='publish1'&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;item-forbidden xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
    </div>
    <div class="indent"><h4 id="publisher-publish-autocreate">7.1.4 Automatic Node Creation<a class="anchor-link" href="#publisher-publish-autocreate"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">A pubsub service MAY automatically create a node when it receives a publish request sent to a node that does not exist (instead of returning an &lt;item-not-found/&gt; error). When doing so, the service SHOULD apply the default node configuration. If a service supports this functionality, it MUST advertise that fact by including a feature of "http://jabber.org/protocol/pubsub#auto-create" in its disco#info responses.</p>
    </div>
    <div class="indent"><h4 id="publisher-publish-options">7.1.5 Publishing Options<a class="anchor-link" href="#publisher-publish-options"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">A pubsub service MAY support the ability to specify options along with a publish request (if so, it MUST advertise support for the "http://jabber.org/protocol/pubsub#publish-options" feature). Here is an example:</p>
      <figure class="code-example" id="example-115"><figcaption><strong>Example 115.</strong> Publishing with options<a class="anchor-link" href="#example-115"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/blogbot'
    to='pubsub.shakespeare.lit'
    id='pub1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Soliloquy&lt;/title&gt;
          &lt;summary&gt;
To be, or not to be: that is the question:
Whether 'tis nobler in the mind to suffer
The slings and arrows of outrageous fortune,
Or to take arms against a sea of troubles,
And by opposing end them?
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32397&lt;/id&gt;
          &lt;published&gt;2003-12-13T18:30:02Z&lt;/published&gt;
          &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
    &lt;publish-options&gt;
      &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#publish-options&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#access_model'&gt;
          &lt;value&gt;presence&lt;/value&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/publish-options&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">The &lt;publish-options/&gt; element MUST contain a data form (see <span class="ref">XEP-0004</span>), whose FORM_TYPE MUST be "http://jabber.org/protocol/pubsub#publish-options" (see <span class="ref">XEP-0068</span>).</p>
      <p class="" style="">Each form field denotes a precondition to publishing the request. A pub-sub service advertising support for publishing options MUST check each precondition field against the node configuration of the same name, and it MUST reject the publication upon encountering unknown fields.</p>
      <p class="" style="">Preconditions MUST be processed as follows:</p>
      <ol start="" class="" style="">
        <li class="" style="">If the node exists and the precondition is not met, then the publish MUST fail with a &lt;conflict/&gt; error condition and a pubsub-specific condition of &lt;precondition-not-met/&gt;.</li>
        <li class="" style="">If the node exists and the precondition is met, then the publish succeeds.</li>
        <li class="" style="">If the node does not exist and the service supports the "auto-create" feature, then the service shall auto-create the node with default configuration in all respects except those specified in the preconditions, and the publish succeeds.</li>
        <li class="" style="">If the node does not exist and the service does not support the "auto-create" feature, then the publish shall fail.</li>
      </ol>
    </div>
  </div>

  <div class="indent"><h3 id="publisher-delete">7.2 Delete an Item from a Node<a class="anchor-link" href="#publisher-delete"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A publisher might want to delete an item once it has been published to a node that supports persistent items. Support for this feature ("delete-items") is RECOMMENDED.</p>
    <div class="indent"><h4 id="publisher-delete-request">7.2.1 Request<a class="anchor-link" href="#publisher-delete-request"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">To delete an item, the publisher sends a retract request as shown in the following examples. The &lt;retract/&gt; element MUST possess a 'node' attribute, MAY possess a 'notify' attribute, and MUST contain one &lt;item/&gt; element; the &lt;item/&gt; element MUST be empty and MUST possess an 'id' attribute.</p>
      <figure class="code-example" id="example-116"><figcaption><strong>Example 116.</strong> Entity deletes an item from a node<a class="anchor-link" href="#example-116"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='retract1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;retract node='princely_musings'&gt;
      &lt;item id='ae890ac52d0df67ed7cfdf51b644e901'/&gt;
    &lt;/retract&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="publisher-delete-success">7.2.2 Success Case<a class="anchor-link" href="#publisher-delete-success"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If no error occurs, the service MUST delete the item.</p>
      <figure class="code-example" id="example-117"><figcaption><strong>Example 117.</strong> Service replies with success<a class="anchor-link" href="#example-117"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='retract1'/&gt;
</pre></figure>
      <div class="indent"><h5 id="publisher-delete-success-notify">7.2.2.1 Delete And Notify</h5>
        <p class="" style="">If no error occurs and the &lt;retract/&gt; element included a 'notify' attribute with a value of "true" or "1"  [<a href="#nt-idm1081">15</a>], then the service MUST delete the item and MUST notify all subscribers as shown below. The syntax is identical to event notifications except that instead of an &lt;item/&gt; element, the &lt;items/&gt; element includes a &lt;retract/&gt; element.</p>
        <figure class="code-example" id="example-118"><figcaption><strong>Example 118.</strong> Subscribers are notified of deletion<a class="anchor-link" href="#example-118"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit' to='francisco@denmark.lit' id='foo'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;retract id='ae890ac52d0df67ed7cfdf51b644e901'/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message from='pubsub.shakespeare.lit' to='bernardo@denmark.lit' id='bar'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;retract id='ae890ac52d0df67ed7cfdf51b644e901'/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="publisher-delete-success-subid">7.2.2.2 Inclusion of Subscription ID</h5>
        <p class="" style="">If a single entity is subscribed to the node multiple times, the service SHOULD notate the item deletion so that the entity can determine which subscription identifier(s) generated this event. As above, if these notations are included, they MUST use the <span class="ref">Stanza Headers and Internet Metadata (SHIM)</span> protocol and SHOULD be included after the notification data (i.e., as the last child of the &lt;message/&gt; stanza).</p>
        <figure class="code-example" id="example-119"><figcaption><strong>Example 119.</strong> Subscriber receives notated event notification<a class="anchor-link" href="#example-119"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit' to='bernardo@denmark.lit' id='bar'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;retract id='ae890ac52d0df67ed7cfdf51b644e901'/&gt;
    &lt;/items&gt;
  &lt;/event&gt;
  &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
    &lt;header name='SubID'&gt;123-abc&lt;/header&gt;
    &lt;header name='SubID'&gt;004-yyy&lt;/header&gt;
  &lt;/headers&gt;
&lt;/message&gt;
</pre></figure>
      </div>
    </div>
    <div class="indent"><h4 id="publisher-delete-error">7.2.3 Error Cases<a class="anchor-link" href="#publisher-delete-error"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">There are several reasons why the item retraction request might fail:</p>
      <ol start="" class="" style="">
        <li class="" style="">The publisher does not have sufficient privileges to delete the requested item.</li>
        <li class="" style="">The node or item does not exist.</li>
        <li class="" style="">The request does not specify a node.</li>
        <li class="" style="">The request does not include an &lt;item/&gt; element or the &lt;item/&gt; element does not specify an ItemID.</li>
        <li class="" style="">The node does not support persistent items.</li>
        <li class="" style="">The service does not support the deletion of items.</li>
      </ol>
      <p class="" style="">These error cases are described more fully in the following sections.</p>
      <div class="indent"><h5 id="publisher-delete-error-forbidden">7.2.3.1 Insufficient Privileges</h5>
        <p class="" style="">If the requesting entity does not have sufficient privileges to delete the item, the service MUST return a &lt;forbidden/&gt; error.</p>
        <figure class="code-example" id="example-120"><figcaption><strong>Example 120.</strong> Requesting entity does not have sufficient privileges<a class="anchor-link" href="#example-120"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='retract1'&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="publisher-delete-error-node">7.2.3.2 Node Does Not Exist</h5>
        <p class="" style="">If the node or item does not exist, the service MUST return an &lt;item-not-found/&gt; error.</p>
    <figure class="code-example" id="example-121"><figcaption><strong>Example 121.</strong> Non-existent node or item<a class="anchor-link" href="#example-121"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='retract1'&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="publisher-delete-error-nodeid">7.2.3.3 NodeID Required</h5>
      <p class="" style="">If the request does not specify a node, the service MUST return a &lt;bad-request/&gt; error, which SHOULD also include a pubsub-specific error condition of &lt;nodeid-required/&gt;.</p>
      <figure class="code-example" id="example-122"><figcaption><strong>Example 122.</strong> Request does not specify a node<a class="anchor-link" href="#example-122"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='retract1'&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;nodeid-required xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="publisher-delete-error-itemid">7.2.3.4 Item or ItemID Required</h5>
      <p class="" style="">If the request does not include an &lt;item/&gt; element or the &lt;item/&gt; element does not specify an ItemID, the service MUST return a &lt;bad-request/&gt; error, which SHOULD also include a pubsub-specific error condition of &lt;item-required/&gt;.</p>
      <figure class="code-example" id="example-123"><figcaption><strong>Example 123.</strong> Request does not specify an item<a class="anchor-link" href="#example-123"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='retract1'&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;item-required xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="publisher-delete-error-persistent">7.2.3.5 Persistent Items Not Supported</h5>
      <p class="" style="">If the node does not support persistent items (e.g., because it is a collection node or a transient node that does not deliver payloads), the service MUST return a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "persistent-items".</p>
      <figure class="code-example" id="example-124"><figcaption><strong>Example 124.</strong> Node does not support persistent items<a class="anchor-link" href="#example-124"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='retract1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='persistent-items'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="publisher-delete-error-notsupported">7.2.3.6 Item Deletion Not Supported</h5>
        <p class="" style="">If the service does not support item deletion, it MUST return a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "delete-items".</p>
        <figure class="code-example" id="example-125"><figcaption><strong>Example 125.</strong> Service does not support item deletion<a class="anchor-link" href="#example-125"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='retract1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='delete-items'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
    </div>
  </div>
<h2 id="owner">8.
       Owner Use Cases<a class="anchor-link" href="#owner"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="owner-create">8.1 Create a Node<a class="anchor-link" href="#owner-create"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <div class="indent"><h4 id="owner-create-general">8.1.1 General Considerations<a class="anchor-link" href="#owner-create-general"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">An entity may want to create a new node. Support for this feature ("create-nodes") is RECOMMENDED. However, a service MAY disallow creation of nodes based on the identity of the requesting entity, or MAY disallow node creation altogether (e.g., reserving that privilege to a service-wide administrator).</p>
      <p class="" style="">There are two ways to create a node:</p>
      <ol start="" class="" style="">
        <li class="" style="">Create a node with default configuration for the specified node type.</li>
        <li class="" style="">Create and configure a node simultaneously.</li>
      </ol>
      <figure class="code-example" id="example-126"><figcaption><strong>Example 126.</strong> Request to create a node<a class="anchor-link" href="#example-126"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='create1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;create node='princely_musings'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">These methods, along with method-specific error conditions, are explained more fully in the following sections.</p>
      <p class="" style="">In addition to method-specific error conditions, there are several general reasons why the node creation request might fail:</p>
      <ul class="" style="">
        <li class="" style="">The service does not support node creation.</li>
        <li class="" style="">Only entities that are registered with the service are allowed to create nodes but the requesting entity is not registered.</li>
        <li class="" style="">The requesting entity does not have sufficient privileges to create nodes.</li>
        <li class="" style="">The requested NodeID already exists.</li>
        <li class="" style="">The request did not include a NodeID and "instant nodes" are not supported.</li>
      </ul>
      <p class="" style="">These general error cases are described more fully below.</p>
      <p class="" style="">If the service does not support node creation, it MUST respond with a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "create-nodes".</p>
      <figure class="code-example" id="example-127"><figcaption><strong>Example 127.</strong> Service does not support node creation<a class="anchor-link" href="#example-127"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='create1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='create-nodes'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">If only entities that are registered with the service may create nodes but the requesting entity has not yet registered, the service MUST respond with a &lt;registration-required/&gt; error.</p>
      <figure class="code-example" id="example-128"><figcaption><strong>Example 128.</strong> Service requires registration<a class="anchor-link" href="#example-128"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='create1'&gt;
  &lt;error type='auth'&gt;
    &lt;registration-required xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">If the requesting entity does not have sufficient privileges to create nodes, the service MUST respond with a &lt;forbidden/&gt; error.</p>
      <figure class="code-example" id="example-129"><figcaption><strong>Example 129.</strong> Requesting entity is prohibited from creating nodes<a class="anchor-link" href="#example-129"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='create1'&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">If the requested NodeID already exists, the service MUST respond with a &lt;conflict/&gt; error.</p>
      <figure class="code-example" id="example-130"><figcaption><strong>Example 130.</strong> NodeID already exists<a class="anchor-link" href="#example-130"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='create1'&gt;
  &lt;error type='cancel'&gt;
    &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">If the node creator does not specify a NodeID but the service does not support instant nodes, the service MUST return a &lt;not-acceptable/&gt; error, specifying a pubsub-specific error condition of &lt;nodeid-required/&gt;.</p>
      <figure class="code-example" id="example-131"><figcaption><strong>Example 131.</strong> Service does not support instant nodes<a class="anchor-link" href="#example-131"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='create2'&gt;
  &lt;error type='modify'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;nodeid-required xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">If the node creator does not specify a NodeID but the service supports instant nodes, the service SHOULD generate a NodeID that is unique within the context of the service on behalf of the node creator.</p>
      <figure class="code-example" id="example-132"><figcaption><strong>Example 132.</strong> Entity requests an instant node<a class="anchor-link" href="#example-132"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='create2'&gt;
    &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
      &lt;create/&gt;
    &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">If no error occurs, the pubsub service SHOULD create the node, generate a NodeID that is unique within the context of that service, and inform the user of success (including the NodeID in the response).</p>
      <figure class="code-example" id="example-133"><figcaption><strong>Example 133.</strong> Service replies with success and generated NodeID<a class="anchor-link" href="#example-133"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='create2'&gt;
    &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
      &lt;create node='25e3d37dabbab9541f7523321421edc5bfeb2dae'/&gt;
    &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">Note: When a service successfully creates a node on behalf of the requesting entity, it MUST return an IQ result (in accordance with XMPP Core). If the node creation request did not specify a NodeID and the service supports creation of instant nodes, the service MUST specify the created NodeID in the IQ result. Similarly, if the node creation request specified a NodeID but the service modified the NodeID before creating the node, the service MUST also specify the modified node in the IQ result. In all other cases, the service MAY specify the NodeID in the IQ result but the node creator MUST NOT depend on receiving it from the service (since the node creator can determine which node was created by tracking the 'id' attribute that it specified for the IQ-set).</p>
    </div>
    <div class="indent"><h4 id="owner-create-default">8.1.2 Create a Node With Default Configuration<a class="anchor-link" href="#owner-create-default"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">As explained above, each node type has its own default configuration. By asking the service to create a node with default configuration, the node creator accepts the default configuration. If the service allows node configuration, the owner may reconfigure the node after creating the node (as described in the <a href="#owner-configure">Configure a Node</a> section of this document). In addition, a service MAY allow entities to determine the default configuration options for a given node type before creating a node (as described in the <a href="#owner-default">Request Default Node Configurations</a> section of this document).</p>
      <p class="" style="">In order to create a node with default configuration, the node creator can simply include an empty &lt;create/&gt; child element.</p>
      <p class="" style="">In the following example, the node creator requests a leaf node (the default type) with an open access model (assumed to be the default type for this service).</p>
      <figure class="code-example" id="example-134"><figcaption><strong>Example 134.</strong> Entity requests leaf node with (default) open access model<a class="anchor-link" href="#example-134"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='create1'&gt;
    &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
      &lt;create node='princely_musings'/&gt;
    &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">Note: The default setting for the 'pubsub#node_type' configuration field is "leaf".</p>
      <p class="" style="">In order to request an access model other than the default for the service, the node creator MUST include a Data Form in the node creation request that specifies a non-default value for the 'pubsub#access_model' field.</p>
      <figure class="code-example" id="example-135"><figcaption><strong>Example 135.</strong> Entity requests leaf node with non-default access model<a class="anchor-link" href="#example-135"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='create2'&gt;
    &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
      &lt;create node='princely_musings'/&gt;
      &lt;configure&gt;
        &lt;x xmlns='jabber:x:data' type='submit'&gt;
          &lt;field var='FORM_TYPE' type='hidden'&gt;
            &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
          &lt;/field&gt;
          &lt;field var='pubsub#access_model'&gt;&lt;value&gt;whitelist&lt;/value&gt;&lt;/field&gt;
        &lt;/x&gt;
      &lt;/configure&gt;
    &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">If the access model is supported and none of the general or method-specific errors has occurred, the service SHOULD create the node and inform the requesting entity of success.</p>
      <figure class="code-example" id="example-136"><figcaption><strong>Example 136.</strong> Service informs requesting entity of success<a class="anchor-link" href="#example-136"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='create1'/&gt;
</pre></figure>
      <p class="" style="">If service does not support the specified access model, it MUST return a &lt;not-acceptable/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported-access-model/&gt;.</p>
      <figure class="code-example" id="example-137"><figcaption><strong>Example 137.</strong> Service does not support specified access model<a class="anchor-link" href="#example-137"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='create2'&gt;
  &lt;error type='modify'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported-access-model xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">(For error handling if the service does not support the specified node type, refer to <span class="ref">XEP-0248</span>.)</p>
    </div>
    <div class="indent"><h4 id="owner-create-and-configure">8.1.3 Create and Configure a Node<a class="anchor-link" href="#owner-create-and-configure"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If an implementation allows node configuration (see the <a href="#owner-configure">Configure a Node</a> section of this document), it SHOULD allow node creation requests to contain the desired node configuration in the node creation request.</p>
      <p class="" style="">Note: The &lt;configure/&gt; element MUST follow the &lt;create/&gt; element and MUST NOT possess a 'node' attribute, since the value of the &lt;create/&gt; element's 'node' attribute specifies the desired NodeID; if any of these rules are violated, the service MUST return a &lt;bad-request/&gt; error.</p>
      <figure class="code-example" id="example-138"><figcaption><strong>Example 138.</strong> Entity requests a new node with non-default configuration.<a class="anchor-link" href="#example-138"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='create1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;create node='princely_musings'/&gt;
    &lt;configure&gt;
      &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#title'&gt;&lt;value&gt;Princely Musings (Atom)&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#deliver_notifications'&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#deliver_payloads'&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#persist_items'&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#max_items'&gt;&lt;value&gt;10&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#item_expire'&gt;&lt;value&gt;604800&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#access_model'&gt;&lt;value&gt;open&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#publish_model'&gt;&lt;value&gt;publishers&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#purge_offline'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#send_last_published_item'&gt;&lt;value&gt;never&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#presence_based_delivery'&gt;&lt;value&gt;false&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#notification_type'&gt;&lt;value&gt;headline&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#notify_config'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#notify_delete'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#notify_retract'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#notify_sub'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#max_payload_size'&gt;&lt;value&gt;1028&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#type'&gt;&lt;value&gt;http://www.w3.org/2005/Atom&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#body_xslt'&gt;
          &lt;value&gt;http://jabxslt.jabberstudio.org/atom_body.xslt&lt;/value&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/configure&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      <figure class="code-example" id="example-139"><figcaption><strong>Example 139.</strong> Service replies with success<a class="anchor-link" href="#example-139"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='create1'/&gt;
</pre></figure>
      <p class="" style="">If a service supports this "create-and-configure" feature, it MUST advertise that fact by returning a feature of "http://jabber.org/protocol/pubsub#create-and-configure" in response to service discovery information requests. If the create-and-configure option is not supported but the requesting entity sends such a request anyway, the service SHOULD ignore the configuration part of the request and proceed as if it had not been included.</p>
    </div>
  </div>
  <div class="indent"><h3 id="owner-configure">8.2 Configure a Node<a class="anchor-link" href="#owner-configure"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">After creating a new node, the node owner may want to modify the node configuration. Support for this feature is RECOMMENDED.</p>
    <div class="indent"><h4 id="owner-configure-request">8.2.1 Request<a class="anchor-link" href="#owner-configure-request"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <figure class="code-example" id="example-140"><figcaption><strong>Example 140.</strong> Owner requests configuration form<a class="anchor-link" href="#example-140"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='config1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;configure node='princely_musings'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="owner-configure-success">8.2.2 Success Case<a class="anchor-link" href="#owner-configure-success"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If no error occurs, the server MUST return a configuration form to the node owner, which SHOULD contain the current node configuration as the default values.</p>
      <p class="" style="">Note: The following example shows some of the possible configuration options that MAY be provided. If an implementation implements these features using the <strong>Data Forms</strong> protocol, that implementation MUST use the fields that are registered with the XMPP Registrar in association with the 'http://jabber.org/protocol/pubsub' namespace (a preliminary representation of those field variables is shown below and in the <a href="#registrar-formtypes-config">pubsub#node_config FORM_TYPE</a> section of this document, but MUST NOT be construed as canonical, since the XMPP Registrar may standardize additional fields at a later date without changes to this document). An implementation MAY choose to specify different labels, values, and even field types, but MUST conform to the defined variable naming scheme.</p>
    <figure class="code-example" id="example-141"><figcaption><strong>Example 141.</strong> Service responds with configuration form<a class="anchor-link" href="#example-141"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='config1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;configure node='princely_musings'&gt;
      &lt;x xmlns='jabber:x:data' type='form'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#title' type='text-single'
               label='A friendly name for the node'/&gt;
        &lt;field var='pubsub#deliver_notifications' type='boolean'
               label='Whether to deliver event notifications'&gt;
          &lt;value&gt;true&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#deliver_payloads' type='boolean'
               label='Whether to deliver payloads with event notifications'&gt;
          &lt;value&gt;true&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#notify_config' type='boolean'
               label='Notify subscribers when the node configuration changes'&gt;
          &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#notify_delete' type='boolean'
               label='Notify subscribers when the node is deleted'&gt;
          &lt;value&gt;false&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#notify_retract' type='boolean'
               label='Notify subscribers when items are removed from the node'&gt;
          &lt;value&gt;false&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#notify_sub' type='boolean'
               label='Notify owners about new subscribers and unsubscribes'&gt;
          &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#persist_items' type='boolean'
               label='Persist items to storage'&gt;
          &lt;value&gt;1&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#max_items' type='text-single'
               label='Max # of items to persist. `max` for no specific limit other than a server imposed maximum.'&gt;
          &lt;value&gt;10&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#item_expire' type='text-single'
               label='Time after which to automatically purge items. `max` for no specific limit other than a server imposed maximum.'&gt;
          &lt;value&gt;604800&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#subscribe' type='boolean'
               label='Whether to allow subscriptions'&gt;
          &lt;value&gt;1&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#access_model' type='list-single'
               label='Specify the subscriber model'&gt;
          &lt;option&gt;&lt;value&gt;authorize&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;open&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;presence&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;roster&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;whitelist&lt;/value&gt;&lt;/option&gt;
          &lt;value&gt;open&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#roster_groups_allowed' type='list-multi'
               label='Roster groups allowed to subscribe'&gt;
          &lt;option&gt;&lt;value&gt;friends&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;courtiers&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;servants&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;enemies&lt;/value&gt;&lt;/option&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#publish_model' type='list-single'
               label='Specify the publisher model'&gt;
          &lt;option&gt;&lt;value&gt;publishers&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;subscribers&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;open&lt;/value&gt;&lt;/option&gt;
          &lt;value&gt;publishers&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#purge_offline' type='boolean'
               label='Purge all items when the relevant publisher goes offline?'&gt;
          &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#max_payload_size' type='text-single'
               label='Max Payload size in bytes'&gt;
          &lt;value&gt;1028&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#send_last_published_item' type='list-single'
               label='When to send the last published item'&gt;
          &lt;option label='Never'&gt;&lt;value&gt;never&lt;/value&gt;&lt;/option&gt;
          &lt;option label='When a new subscription is processed'&gt;&lt;value&gt;on_sub&lt;/value&gt;&lt;/option&gt;
          &lt;option label='When a new subscription is processed and whenever a subscriber comes online'&gt;
            &lt;value&gt;on_sub_and_presence&lt;/value&gt;
          &lt;/option&gt;
          &lt;value&gt;never&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#presence_based_delivery' type='boolean'
               label='Deliver event notifications only to available users'&gt;
          &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#notification_type' type='list-single'
               label='Specify the delivery style for event notifications'&gt;
          &lt;option&gt;&lt;value&gt;normal&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;headline&lt;/value&gt;&lt;/option&gt;
          &lt;value&gt;headline&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#type' type='text-single'
               label='Specify the type of payload data to be provided at this node'&gt;
          &lt;value&gt;http://www.w3.org/2005/Atom&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#dataform_xslt' type='text-single'
               label='Payload XSLT'/&gt;
      &lt;/x&gt;
    &lt;/configure&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="owner-configure-error">8.2.3 Error Cases<a class="anchor-link" href="#owner-configure-error"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">There are several reasons why the node configuration request might fail:</p>
      <ol start="" class="" style="">
        <li class="" style="">The service does not support node configuration.</li>
        <li class="" style="">The requesting entity does not have sufficient privileges to configure the node.</li>
        <li class="" style="">The request did not specify a node.</li>
        <li class="" style="">The node has no configuration options.</li>
        <li class="" style="">The specified node does not exist.</li>
      </ol>
      <p class="" style="">These error cases are described more fully in the following sections.</p>
      <div class="indent"><h5 id="owner-configure-error-notsupported">8.2.3.1 Node Configuration Not Supported</h5>
        <p class="" style="">If the service does not support node configuration, the service MUST return a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "config-node".</p>
        <figure class="code-example" id="example-142"><figcaption><strong>Example 142.</strong> Service does not support node configuration<a class="anchor-link" href="#example-142"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='config1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='config-node'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-configure-error-forbidden">8.2.3.2 Insufficient Privileges</h5>
        <p class="" style="">If the requesting entity does not have sufficient privileges to configure the node, the service MUST respond with a &lt;forbidden/&gt; error.</p>
        <figure class="code-example" id="example-143"><figcaption><strong>Example 143.</strong> Requesting entity is prohibited from configuring this node<a class="anchor-link" href="#example-143"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='config1'&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-configure-error-nodeid">8.2.3.3 NodeID Required</h5>
        <p class="" style="">If the request did not specify a node, the service SHOULD return a &lt;bad-request/&gt; error. It is possible that by not including a NodeID, the requesting entity is asking to configure the root node; however, if the requesting entity is not a service-level admin, it makes sense to return &lt;bad-request/&gt; instead of &lt;forbidden/&gt;.</p>
        <figure class="code-example" id="example-144"><figcaption><strong>Example 144.</strong> Request did not specify a node<a class="anchor-link" href="#example-144"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='config1'&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;nodeid-required xmlns='http://jabber.org/protocol/pubsub#errors'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-configure-error-options">8.2.3.4 No Configuration Options</h5>
        <p class="" style="">If no configuration options are available (e.g., because node configuration is "locked down"), the service MUST return a &lt;not-allowed/&gt; error to the owner.</p>
        <figure class="code-example" id="example-145"><figcaption><strong>Example 145.</strong> Node has no configuration options<a class="anchor-link" href="#example-145"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='config1'&gt;
  &lt;error type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-configure-error-node">8.2.3.5 Node Does Not Exist</h5>
        <p class="" style="">If the node does not exist, the service MUST return an &lt;item-not-found/&gt; error.</p>
        <figure class="code-example" id="example-146"><figcaption><strong>Example 146.</strong> Node does not exist<a class="anchor-link" href="#example-146"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='config1'&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
    </div>
    <div class="indent"><h4 id="owner-configure-submit">8.2.4 Form Submission<a class="anchor-link" href="#owner-configure-submit"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">After receiving the configuration form, the owner SHOULD submit a completed configuration form.</p>
      <figure class="code-example" id="example-147"><figcaption><strong>Example 147.</strong> Owner submits node configuration form<a class="anchor-link" href="#example-147"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='config2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;configure node='princely_musings'&gt;
      &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#title'&gt;&lt;value&gt;Princely Musings (Atom)&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#deliver_notifications'&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#deliver_payloads'&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#persist_items'&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#max_items'&gt;&lt;value&gt;10&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#item_expire'&gt;&lt;value&gt;604800&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#access_model'&gt;&lt;value&gt;roster&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#roster_groups_allowed'&gt;
          &lt;value&gt;friends&lt;/value&gt;
          &lt;value&gt;servants&lt;/value&gt;
          &lt;value&gt;courtiers&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#publish_model'&gt;&lt;value&gt;publishers&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#purge_offline'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#send_last_published_item'&gt;&lt;value&gt;never&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#presence_based_delivery'&gt;&lt;value&gt;false&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#notification_type'&gt;&lt;value&gt;headline&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#notify_config'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#notify_delete'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#notify_retract'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#notify_sub'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#max_payload_size'&gt;&lt;value&gt;1028&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#type'&gt;&lt;value&gt;http://www.w3.org/2005/Atom&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#body_xslt'&gt;
          &lt;value&gt;http://jabxslt.jabberstudio.org/atom_body.xslt&lt;/value&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/configure&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">Alternatively, the owner MAY cancel the configuration process, in which case the existing configuration MUST be applied.</p>
      <figure class="code-example" id="example-148"><figcaption><strong>Example 148.</strong> Owner cancels configuration process<a class="anchor-link" href="#example-148"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='config2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;configure node='princely_musings'&gt;
      &lt;x xmlns='jabber:x:data' type='cancel'/&gt;
    &lt;/configure&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="owner-configure-process">8.2.5 Form Processing<a class="anchor-link" href="#owner-configure-process"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <div class="indent"><h5 id="owner-configure-process-success">8.2.5.1 Success</h5>
        <p class="" style="">If the form can be successfully processed, the service MUST return an IQ-result.</p>
        <figure class="code-example" id="example-149"><figcaption><strong>Example 149.</strong> Service replies with success<a class="anchor-link" href="#example-149"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='config2'/&gt;
</pre></figure>
        <p class="" style="">Note: If the node type was changed from leaf to collection and there are items associated with the node, the service MUST purge the node of all items (with or without notifying the subscribers).</p>
      </div>
      <div class="indent"><h5 id="owner-configure-process-failure">8.2.5.2 Failure</h5>
        <p class="" style="">If the requested node configuration change cannot be processed (e.g., because the node owner has attempted to change the configuration so that there are no node owners), the service MUST return a &lt;not-acceptable/&gt; error to the owner.</p>
        <figure class="code-example" id="example-150"><figcaption><strong>Example 150.</strong> Configuration change cannot be processed<a class="anchor-link" href="#example-150"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='config2'&gt;
  &lt;error type='modify'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-configure-process-notify">8.2.5.3 Success With Notifications</h5>
        <p class="" style="">If the "pubsub#notify_config" option is set to true, the service MUST notify subscribers of the configuration change. (A service SHOULD support this option for leaf nodes and MUST support it for collection nodes as described in <span class="ref">XEP-0248</span>.) If the node configuration is set to notification-only, the notification MUST consist of an empty &lt;configuration/&gt; element whose 'node' attribute is set to the NodeID of the node; if the node configuration is set to full payloads, the &lt;configuration/&gt; element MUST in addition contain the node configuration as represented via the <strong>Data Forms</strong> protocol.</p>
        <figure class="code-example" id="example-151"><figcaption><strong>Example 151.</strong> Service sends configuration change notification (event notification only)<a class="anchor-link" href="#example-151"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit' to='francisco@denmark.lit' id='foo'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;configuration node='princely_musings'/&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
        <figure class="code-example" id="example-152"><figcaption><strong>Example 152.</strong> Service sends configuration change notification (full payload)<a class="anchor-link" href="#example-152"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit' to='francisco@denmark.lit' id='foo'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;configuration node='princely_musings'&gt;
      &lt;x xmlns='jabber:x:data' type='result'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#title'&gt;&lt;value&gt;Princely Musings (Atom)&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#deliver_notifications'&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#deliver_payloads'&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#notify_config'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#notify_delete'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#notify_retract'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#notify_sub'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#persist_items'&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#max_items'&gt;&lt;value&gt;10&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#item_expire'&gt;&lt;value&gt;604800&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#subscribe'&gt;&lt;value&gt;1&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#access_model'&gt;&lt;value&gt;open&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#publish_model'&gt;&lt;value&gt;publishers&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#purge_offline'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#max_payload_size'&gt;&lt;value&gt;9216&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#send_last_published_item'&gt;&lt;value&gt;never&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#presence_based_delivery'&gt;&lt;value&gt;0&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#notification_type'&gt;&lt;value&gt;headline&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#type'&gt;&lt;value&gt;http://www.w3.org/2005/Atom&lt;/value&gt;&lt;/field&gt;
        &lt;field var='pubsub#body_xslt'&gt;
          &lt;value&gt;http://jabxslt.jabberstudio.org/atom_body.xslt&lt;/value&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/configuration&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
      </div>
    </div>
  </div>
  <div class="indent"><h3 id="owner-default">8.3 Request Default Node Configuration Options<a class="anchor-link" href="#owner-default"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">An entity may want to request information about the default node configuration, e.g. in order to determine whether to perform create-and-configure as previously described. Support for this feature is OPTIONAL.</p>
    <div class="indent"><h4 id="owner-default-request">8.3.1 Request<a class="anchor-link" href="#owner-default-request"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">To get the node options, the entity MUST send an empty &lt;default/&gt; element to the service with no NodeID; in response, the service SHOULD return the default node options.</p>
      <figure class="code-example" id="example-153"><figcaption><strong>Example 153.</strong> Entity requests default node configuration options<a class="anchor-link" href="#example-153"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='def1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;default/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="owner-default-success">8.3.2 Success Case<a class="anchor-link" href="#owner-default-success"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If no error occurs, the service MUST return the default node configuration options.</p>
      <figure class="code-example" id="example-154"><figcaption><strong>Example 154.</strong> Service responds with default node configuration options<a class="anchor-link" href="#example-154"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='def1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;default&gt;
      &lt;x xmlns='jabber:x:data' type='form'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
           &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#title' type='text-single'
               label='A friendly name for the node'/&gt;
        &lt;field var='pubsub#deliver_notifications' type='boolean'
               label='Deliver event notifications'&gt;
          &lt;value&gt;true&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#deliver_payloads' type='boolean'
             label='Deliver payloads with event notifications'&gt;
          &lt;value&gt;1&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#description' type='text-single'
             label='A description of the node'/&gt;
        &lt;field var='pubsub#notify_config' type='boolean'
               label='Notify subscribers when the node configuration changes'&gt;
          &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#notify_delete' type='boolean'
               label='Notify subscribers when the node is deleted'&gt;
          &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#notify_retract' type='boolean'
               label='Notify subscribers when items are removed from the node'&gt;
          &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#notify_sub' type='boolean'
               label='Notify owners about new subscribers and unsubscribes'&gt;
          &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#persist_items' type='boolean'
               label='Persist items to storage'&gt;
          &lt;value&gt;1&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#max_items' type='text-single'
               label='Max # of items to persist. `max` for no specific limit other than a server imposed maximum.'&gt;
          &lt;value&gt;10&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#item_expire' type='text-single'
               label='Time after which to automatically purge items. `max` for no specific limit other than a server imposed maximum.'&gt;
          &lt;value&gt;604800&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#subscribe' type='boolean'
               label='Whether to allow subscriptions'&gt;
          &lt;value&gt;1&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#access_model' type='list-single'
               label='Specify the subscriber model'&gt;
          &lt;option&gt;&lt;value&gt;authorize&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;open&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;presence&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;roster&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;whitelist&lt;/value&gt;&lt;/option&gt;
          &lt;value&gt;open&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#roster_groups_allowed' type='list-multi'
               label='Roster groups allowed to subscribe'&gt;
          &lt;option&gt;&lt;value&gt;friends&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;courtiers&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;servants&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;enemies&lt;/value&gt;&lt;/option&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#publish_model' type='list-single'
               label='Specify the publisher model'&gt;
          &lt;option&gt;&lt;value&gt;publishers&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;subscribers&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;open&lt;/value&gt;&lt;/option&gt;
          &lt;value&gt;publishers&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#purge_offline' type='boolean'
               label='Purge all items when the relevant publisher goes offline?'&gt;
          &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#max_payload_size' type='text-single'
               label='Max payload size in bytes'&gt;
          &lt;value&gt;9216&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#send_last_published_item' type='list-single'
               label='When to send the last published item'&gt;
          &lt;option label='Never'&gt;&lt;value&gt;never&lt;/value&gt;&lt;/option&gt;
          &lt;option label='When a new subscription is processed'&gt;&lt;value&gt;on_sub&lt;/value&gt;&lt;/option&gt;
          &lt;option label='When a new subscription is processed and whenever a subscriber comes online'&gt;
            &lt;value&gt;on_sub_and_presence&lt;/value&gt;
          &lt;/option&gt;
          &lt;value&gt;never&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#presence_based_delivery' type='boolean'
               label='Deliver notifications only to available users'&gt;
          &lt;value&gt;0&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#notification_type' type='list-single'
               label='Specify the delivery style for notifications'&gt;
          &lt;option&gt;&lt;value&gt;normal&lt;/value&gt;&lt;/option&gt;
          &lt;option&gt;&lt;value&gt;headline&lt;/value&gt;&lt;/option&gt;
          &lt;value&gt;headline&lt;/value&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/default&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="owner-default-error">8.3.3 Error Cases<a class="anchor-link" href="#owner-default-error"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">There are several reasons why the default node configuration options request might fail:</p>
      <ol start="" class="" style="">
        <li class="" style="">The service does not support node configuration.</li>
        <li class="" style="">The service does not support retrieval of default node configuration.</li>
      </ol>
      <p class="" style="">These error cases are described more fully in the following sections.</p>
      <div class="indent"><h5 id="owner-default-error-noconfig">8.3.3.1 Node Configuration Not Supported</h5>
        <p class="" style="">If the service does not support node configuration, it MUST return a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "config-node".</p>
        <figure class="code-example" id="example-155"><figcaption><strong>Example 155.</strong> Service does not support node configuration<a class="anchor-link" href="#example-155"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='def1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='config-node'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-default-error-notsupported">8.3.3.2 Default Node Configuration Retrieval Not Supported</h5>
        <p class="" style="">If the service does not support retrieval of default node configuration options, it MUST return a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "retrieve-default".</p>
        <figure class="code-example" id="example-156"><figcaption><strong>Example 156.</strong> Service does not support retrieval of default node configuration options<a class="anchor-link" href="#example-156"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='def1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='retrieve-default'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
    </div>
  </div>
  <div class="indent"><h3 id="owner-delete">8.4 Delete a Node<a class="anchor-link" href="#owner-delete"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">If a service supports node creation, it MUST support node deletion. If an implementation persists items, it MUST remove all items from persistent storage before the node itself is deleted.</p>
    <div class="indent"><h4 id="owner-delete-request">8.4.1 Request<a class="anchor-link" href="#owner-delete-request"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">In order to delete a node, a node owner MUST send a node deletion request, consisting of a &lt;delete/&gt; element whose 'node' attribute specifies the NodeID of the node to be deleted.</p>
      <figure class="code-example" id="example-157"><figcaption><strong>Example 157.</strong> Owner deletes a node<a class="anchor-link" href="#example-157"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='delete1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;delete node='princely_musings'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">The deletion request MAY include the URI of a replacement node to which requests might be redirected. Typically this is an XMPP URI or IRI as described under <a href="#impl-uri">PubSub URIs</a>, but it can be an HTTP URI or any other scheme.</p>
      <figure class="code-example" id="example-158"><figcaption><strong>Example 158.</strong> Owner deletes a node with redirection<a class="anchor-link" href="#example-158"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='delete1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;delete node='princely_musings'&gt;
      &lt;redirect uri='xmpp:hamlet@denmark.lit?;node=blog'/&gt;
    &lt;/delete&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">Support for redirection is OPTIONAL on the part of pubsub services.</p>
    </div>
    <div class="indent"><h4 id="owner-delete-success">8.4.2 Success Case<a class="anchor-link" href="#owner-delete-success"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If no error occurs, the service MUST inform the owner of success.</p>
      <figure class="code-example" id="example-159"><figcaption><strong>Example 159.</strong> Service replies with success<a class="anchor-link" href="#example-159"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    id='delete1'/&gt;
</pre></figure>
      <p class="" style="">In addition, the service MUST also send notification of node deletion to all subscribers (which SHOULD include pending and unconfigured subscriptions).</p>
      <figure class="code-example" id="example-160"><figcaption><strong>Example 160.</strong> Subscribers are notified of node deletion<a class="anchor-link" href="#example-160"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit' to='francisco@denmark.lit' id='foo'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;delete node='princely_musings'&gt;
      &lt;redirect uri='xmpp:hamlet@denmark.lit?;node=blog'/&gt;
    &lt;/delete&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message from='pubsub.shakespeare.lit' to='bernardo@denmark.lit' id='bar'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;delete node='princely_musings'&gt;
      &lt;redirect uri='xmpp:hamlet@denmark.lit?;node=blog'/&gt;
    &lt;/delete&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="owner-delete-error">8.4.3 Error Cases<a class="anchor-link" href="#owner-delete-error"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">There are several reasons why the node deletion request might fail:</p>
      <ol start="" class="" style="">
        <li class="" style="">The requesting entity does not have sufficient privileges to delete the node.</li>
        <li class="" style="">The node is the root collection node, which cannot be deleted (see <span class="ref">XEP-0248</span>).</li>
        <li class="" style="">The specified node does not exist.</li>
      </ol>
      <p class="" style="">These error cases are described more fully in the following sections.</p>
      <div class="indent"><h5 id="owner-delete-error-forbidden">8.4.3.1 Insufficient Privileges</h5>
        <p class="" style="">If the requesting entity does not have sufficient privileges to delete the node (e.g., is not an owner), the service MUST return a &lt;forbidden/&gt; error.</p>
        <figure class="code-example" id="example-161"><figcaption><strong>Example 161.</strong> Entity is not an owner<a class="anchor-link" href="#example-161"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='delete1'&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-delete-error-node">8.4.3.2 Node Does Not Exist</h5>
        <p class="" style="">If the requesting entity attempts to delete a node that does not exist, the service MUST return an &lt;item-not-found/&gt; error.</p>
        <figure class="code-example" id="example-162"><figcaption><strong>Example 162.</strong> Owner attempts to delete a non-existent node<a class="anchor-link" href="#example-162"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='delete1'&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
    </div>
  </div>
  <div class="indent"><h3 id="owner-purge">8.5 Purge All Node Items<a class="anchor-link" href="#owner-purge"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">If a service persists published items, a node owner may want to purge the node of all published items (thus removing all items from the persistent store, with the exception of the last published item, which MAY be cached). It is OPTIONAL for a service to implement this feature.</p>
    <div class="indent"><h4 id="owner-purge-request">8.5.1 Request<a class="anchor-link" href="#owner-purge-request"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">In order to purge a node of all items, a node owner sends a node purge request consisting of a &lt;purge/&gt; element whose 'node' attribute specifies the NodeID of the node to be purged.</p>
      <figure class="code-example" id="example-163"><figcaption><strong>Example 163.</strong> Owner purges all items from a node<a class="anchor-link" href="#example-163"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='purge1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;purge node='princely_musings'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="owner-purge-success">8.5.2 Success Case<a class="anchor-link" href="#owner-purge-success"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If no error occurs, the service MUST purge the node and inform the owner of success.</p>
      <figure class="code-example" id="example-164"><figcaption><strong>Example 164.</strong> Service replies with success<a class="anchor-link" href="#example-164"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    id='purge1'/&gt;
</pre></figure>
      <p class="" style="">If the node or service has been configured to notify subscribers on deletion of items, a purge request MUST NOT result in sending the same notifications as are sent when deleting items (since purging a node with many persisted items could result in a large number of notifications); instead, the node MUST send a single notification to each subscriber, containing an empty &lt;purge/&gt; child element.</p>
      <figure class="code-example" id="example-165"><figcaption><strong>Example 165.</strong> Subscribers are notified of node purge<a class="anchor-link" href="#example-165"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit' to='francisco@denmark.lit' id='foo'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;purge node='princely_musings'/&gt;
  &lt;/event&gt;
&lt;/message&gt;

&lt;message from='pubsub.shakespeare.lit' to='bernardo@denmark.lit' id='bar'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;purge node='princely_musings'/&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="owner-purge-error">8.5.3 Error Cases<a class="anchor-link" href="#owner-purge-error"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">There are several reasons why the node purge request might fail:</p>
      <ol start="" class="" style="">
        <li class="" style="">The node or service does not support node purging.</li>
        <li class="" style="">The requesting entity does not have sufficient privileges to purge the node.</li>
        <li class="" style="">The node is not configured to persist items.</li>
        <li class="" style="">The specified node does not exist.</li>
      </ol>
      <p class="" style="">These error cases are described more fully in the following sections.</p>
      <div class="indent"><h5 id="owner-purge-error-notsupported">8.5.3.1 Node Purging Not Supported</h5>
        <p class="" style="">If the node or service does not support node purging, it MUST return a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "purge-nodes".</p>
        <figure class="code-example" id="example-166"><figcaption><strong>Example 166.</strong> Service does not support node purging<a class="anchor-link" href="#example-166"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='purge1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='purge-nodes'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-purge-error-forbidden">8.5.3.2 Insufficient Privileges</h5>
        <p class="" style="">If the requesting entity does not have sufficient privileges to purge the node (e.g., because it is not a node owner), the service MUST return a &lt;forbidden/&gt; error.</p>
        <figure class="code-example" id="example-167"><figcaption><strong>Example 167.</strong> Entity is not an owner<a class="anchor-link" href="#example-167"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    id='purge1'&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-purge-error-nopersist">8.5.3.3 Node Does Not Persist Items</h5>
        <p class="" style="">If the service or node does not persist items (e.g., because the node is a collection node as described in <span class="ref">XEP-0248</span>), it MUST return a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "persistent-items".</p>
        <figure class="code-example" id="example-168"><figcaption><strong>Example 168.</strong> Node is not configured for persistent items<a class="anchor-link" href="#example-168"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    id='purge1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='persistent-items'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-purge-error-node">8.5.3.4 Node Does Not Exist</h5>
        <p class="" style="">If the node does not exist, the service MUST return an &lt;item-not-found/&gt; error.</p>
        <figure class="code-example" id="example-169"><figcaption><strong>Example 169.</strong> Node does not exist<a class="anchor-link" href="#example-169"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    id='purge1'&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
    </div>
  </div>

  <div class="indent"><h3 id="owner-subreq">8.6 Manage Subscription Requests<a class="anchor-link" href="#owner-subreq"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A service MAY send subscription approval requests to the node owner(s) at any time. An approval request consists of a message stanza containing a Data Form scoped by the "http://jabber.org/protocol/pubsub#subscribe_authorization" FORM_TYPE. The form MUST contain a boolean field that has a 'var' attribute of "pubsub#allow", which is the field that designates whether or not to allow the subscription request. The form SHOULD include fields that specify the node identifier and the JID of the pending subscriber. The message MAY include a &lt;body/&gt; element that contains natural-language text explaining that the message contains a pending subscription form.</p>
    <figure class="code-example" id="example-170"><figcaption><strong>Example 170.</strong> Service sends authorization request to node owner<a class="anchor-link" href="#example-170"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message to='hamlet@denmark.lit' from='pubsub.shakespeare.lit' id='approve1'&gt;
  &lt;x xmlns='jabber:x:data' type='form'&gt;
    &lt;title&gt;PubSub subscriber request&lt;/title&gt;
    &lt;instructions&gt;
      To approve this entity&amp;apos;s subscription request,
      click the OK button. To deny the request, click the
      cancel button.
    &lt;/instructions&gt;
    &lt;field var='FORM_TYPE' type='hidden'&gt;
      &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_authorization&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='pubsub#subid' type='hidden'&gt;&lt;value&gt;123-abc&lt;/value&gt;&lt;/field&gt;
    &lt;field var='pubsub#node' type='text-single' label='Node ID'&gt;
      &lt;value&gt;princely_musings&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='pubsub#subscriber_jid' type='jid-single' label='Subscriber Address'&gt;
      &lt;value&gt;horatio@denmark.lit&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='pubsub#allow' type='boolean'
           label='Allow this JID to subscribe to this pubsub node?'&gt;
      &lt;value&gt;false&lt;/value&gt;
    &lt;/field&gt;
  &lt;/x&gt;
&lt;/message&gt;
</pre></figure>
    <p class="" style="">In order to approve the request, the owner shall submit the form and set the "pubsub#allow" field to a value of "1" or "true"; for tracking purposes the message MUST reflect the 'id' attribute originally provided.</p>
    <figure class="code-example" id="example-171"><figcaption><strong>Example 171.</strong> Owner approves subscription request<a class="anchor-link" href="#example-171"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='hamlet@denmark.lit/elsinore' to='pubsub.shakespeare.lit' id='approve1'&gt;
  &lt;x xmlns='jabber:x:data' type='submit'&gt;
    &lt;field var='FORM_TYPE' type='hidden'&gt;
      &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_authorization&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='pubsub#subid'&gt;
      &lt;value&gt;123-abc&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='pubsub#node'&gt;
      &lt;value&gt;princely_musings&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='pubsub#subscriber_jid'&gt;
      &lt;value&gt;horatio@denmark.lit&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='pubsub#allow'&gt;
       &lt;value&gt;true&lt;/value&gt;
    &lt;/field&gt;
  &lt;/x&gt;
&lt;/message&gt;
</pre></figure>
    <p class="" style="">The service then SHOULD notify the approved subscriber (see the <a href="#impl-subchange">Notification of Subscription State Changes</a> section of this document).</p>
    <figure class="code-example" id="example-172"><figcaption><strong>Example 172.</strong> Subscription approval notification<a class="anchor-link" href="#example-172"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message
    from='pubsub.shakespeare.lit'
    to='horatio@denmark.lit'
    id='approvalnotify1'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;subscription node='princely_musings' jid='horatio@denmark.lit' subscription='subscribed'/&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
    <p class="" style="">In order to deny the request, the owner shall submit the form and set the "pubsub#allow" field to a value of "0" or "false"; as above, the message MUST reflect the 'id' attribute originally provided.</p>
    <figure class="code-example" id="example-173"><figcaption><strong>Example 173.</strong> Owner denies subscription request<a class="anchor-link" href="#example-173"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='hamlet@denmark.lit/elsinore' to='pubsub.shakespeare.lit' id='approve1'&gt;
  &lt;x xmlns='jabber:x:data' type='submit'&gt;
    &lt;field var='FORM_TYPE' type='hidden'&gt;
       &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_authorization&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='pubsub#subid'&gt;
      &lt;value&gt;123-abc&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='pubsub#node'&gt;
      &lt;value&gt;princely_musings&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='pubsub#subscriber_jid'&gt;
       &lt;value&gt;horatio@denmark.lit&lt;/value&gt;
    &lt;/field&gt;
    &lt;field var='pubsub#allow'&gt;
        &lt;value&gt;false&lt;/value&gt;
    &lt;/field&gt;
  &lt;/x&gt;
&lt;/message&gt;
</pre></figure>
    <p class="" style="">The service then SHOULD notify the denied subscriber (see the <a href="#impl-subchange">Notification of Subscription State Changes</a> section of this document).</p>
    <figure class="code-example" id="example-174"><figcaption><strong>Example 174.</strong> Subscription cancellation / denial notification<a class="anchor-link" href="#example-174"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message
    from='pubsub.shakespeare.lit'
    to='horatio@denmark.lit'
    id='unsubnotify1'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;subscription node='princely_musings' jid='horatio@denmark.lit' subscription='none'/&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
    <p class="" style="">In order to cancel the form submission, the owner shall reply with the form's 'type' attribute set to "cancel".</p>
    <figure class="code-example" id="example-175"><figcaption><strong>Example 175.</strong> Owner cancels form submission<a class="anchor-link" href="#example-175"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='hamlet@denmark.lit/elsinore' to='pubsub.shakespeare.lit' id='approve1'&gt;
  &lt;x xmlns='jabber:x:data' type='cancel'&gt;
    &lt;field var='FORM_TYPE' type='hidden'&gt;
      &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_authorization&lt;/value&gt;
    &lt;/field&gt;
  &lt;/x&gt;
&lt;/message&gt;
</pre></figure>
    <p class="" style="">The service MUST check the "pubsub#allow" field to see if the subscription should be allowed or denied. If the owner cancels the Data Form, then the subscription request MUST remain in the pending state.</p>
  </div>
  <div class="indent"><h3 id="owner-subreq-process">8.7 Process Pending Subscription Requests<a class="anchor-link" href="#owner-subreq-process"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A node owner may want to request all of the pending subscription requests for all of their nodes at a service. It is OPTIONAL for a service to implement this feature.</p>
    <p class="" style="">This feature MUST be implemented using the <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0050.html">Ad-Hoc Commands (XEP-0050)</a></span>  [<a href="#nt-idm1619">21</a>] protocol, where the command name ('node' attribute of the command element) MUST have a value of "http://jabber.org/protocol/pubsub#get-pending".</p>
    <div class="indent"><h4 id="owner-subreq-request">8.7.1 Request<a class="anchor-link" href="#owner-subreq-request"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <figure class="code-example" id="example-176"><figcaption><strong>Example 176.</strong> Owner requests pending subscription requests<a class="anchor-link" href="#example-176"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='pending1'&gt;
  &lt;command xmlns='http://jabber.org/protocol/commands'
           node='http://jabber.org/protocol/pubsub#get-pending'
           action='execute'/&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="owner-subreq-success">8.7.2 Success Case<a class="anchor-link" href="#owner-subreq-success"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If no error occurs, the service SHOULD return a data form for managing subscription requests, which MUST contain a single field with a 'var' attribute value of "pubsub#node" whose &lt;option/&gt; elements specify the nodes for which the requesting entity has subscription approval privileges (as an optimization, the service MAY specify only the nodes that have subscription requests pending).</p>
      <figure class="code-example" id="example-177"><figcaption><strong>Example 177.</strong> Service responds with data form to be populated<a class="anchor-link" href="#example-177"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='pending1'&gt;
  &lt;command xmlns='http://jabber.org/protocol/commands'
           sessionid='pubsub-get-pending:20031021T150901Z-600'
           node='http://jabber.org/protocol/pubsub#get-pending'
           status='executing'
           action='execute'&gt;
    &lt;x xmlns='jabber:x:data' type='form'&gt;
      &lt;field var='FORM_TYPE' type='hidden'&gt;
        &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_authorization&lt;/value&gt;
      &lt;/field&gt;
      &lt;field type='list-single' var='pubsub#node'&gt;
        &lt;option&gt;&lt;value&gt;princely_musings&lt;/value&gt;&lt;/option&gt;
        &lt;option&gt;&lt;value&gt;news_from_elsinore&lt;/value&gt;&lt;/option&gt;
      &lt;/field&gt;
    &lt;/x&gt;
  &lt;/command&gt;
&lt;/iq&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="owner-subreq-error">8.7.3 Error Cases<a class="anchor-link" href="#owner-subreq-error"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">There are several reasons why the pending subscription approval request might fail:</p>
      <ol start="" class="" style="">
        <li class="" style="">The service does not support the ad-hoc commands protocol.</li>
        <li class="" style="">The service supports ad-hoc commands but does not support the "get-pending" feature.</li>
        <li class="" style="">The requesting entity does not have sufficient privileges to approve subscription requests.</li>
        <li class="" style="">The specified node does not exist.</li>
      </ol>
      <p class="" style="">These error cases are described more fully in the following sections.</p>
      <div class="indent"><h5 id="owner-subreq-error-adhoc">8.7.3.1 Ad-Hoc Commands Not Supported</h5>
        <p class="" style="">If the service does not support the ad-hoc commands protocol, it MUST respond with a &lt;service-unavailable/&gt; error.</p>
        <figure class="code-example" id="example-178"><figcaption><strong>Example 178.</strong> Service responds with node not found<a class="anchor-link" href="#example-178"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='pending1'&gt;
  &lt;error type='cancel'&gt;
    &lt;service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-subreq-error-getpending">8.7.3.2 Get-Pending Not Supported</h5>
        <p class="" style="">If the service does not support the "get-pending" feature, it MUST respond with a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "get-pending".</p>
        <figure class="code-example" id="example-179"><figcaption><strong>Example 179.</strong> Service responds with node not found<a class="anchor-link" href="#example-179"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='pending1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='get-pending'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-subreq-error-forbidden">8.7.3.3 Insufficient Privileges</h5>
        <p class="" style="">If the requesting entity does not have sufficient privileges to approve subscription requests, the service MUST respond with a &lt;forbidden/&gt; error.</p>
        <figure class="code-example" id="example-180"><figcaption><strong>Example 180.</strong> Entity does not have sufficient privileges to approve subscription requests<a class="anchor-link" href="#example-180"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='pending1'&gt;
  &lt;error type='cancel'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-subreq-error-node">8.7.3.4 Node Does Not Exist</h5>
        <p class="" style="">If the requested node does not exist, the service MUST respond with an &lt;item-not-found/&gt; error.</p>
        <figure class="code-example" id="example-181"><figcaption><strong>Example 181.</strong> Service responds with node not found<a class="anchor-link" href="#example-181"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='pending1'&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
    </div>
    <div class="indent"><h4 id="owner-subreq-pernode">8.7.4 Per-Node Request<a class="anchor-link" href="#owner-subreq-pernode"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">Upon receiving the data form for managing subscription requests, the owner then MAY request pending subscription approval requests for a given node.</p>
      <figure class="code-example" id="example-182"><figcaption><strong>Example 182.</strong> Owner requests all pending subscription requests for a node<a class="anchor-link" href="#example-182"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set' to='pubsub.shakespeare.lit' id='pending2'&gt;
  &lt;command xmlns='http://jabber.org/protocol/commands'
           sessionid='pubsub-get-pending:20031021T150901Z-600'
           node='http://jabber.org/protocol/pubsub#get-pending'
           action='execute'&gt;
    &lt;x xmlns='jabber:x:data' type='submit'&gt;
      &lt;field var='pubsub#node'&gt;
        &lt;value&gt;princely_musings&lt;/value&gt;
      &lt;/field&gt;
    &lt;/x&gt;
  &lt;/command&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">If no error occurs, the service shall respond with success.</p>
      <figure class="code-example" id="example-183"><figcaption><strong>Example 183.</strong> Service responds with success<a class="anchor-link" href="#example-183"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='pubsub.shakespeare.lit'
    id='pending2'
    to='hamlet@denmark.lit/elsinore'
    type='result'&gt;
  &lt;command xmlns='http://jabber.org/protocol/commands'
           sessionid='pubsub-get-pending:20031021T150901Z-600'
           node='http://jabber.org/protocol/pubsub#get-pending'
           action='completed'/&gt;
&lt;/iq&gt;
</pre></figure>
      <p class="" style="">The service shall then send one subscription approval message for each pending subscription request, as shown above for a single pending subscription request.</p>
      <p class="" style="">Note: A service SHOULD conform to its affiliation policies in maintaining the list of pending subscriptions. In particular, if the affiliation of an entity with a pending subscription is modified to owner or publisher, the service SHOULD automatically approve the subscription request and remove the entity's previous request from the pending list. Similarly, if the affiliation of an entity with a pending subscription is modified to outcast, the service SHOULD automatically reject the subscription request and remove the entity's previous request from the pending list. (If an entity's subscription request is denied, the service SHOULD send a &lt;message/&gt; to the entity, where the message conforms to the format described in the <a href="#impl-subchange">Notification of Subscription State Changes</a> section of this document.)</p>
    </div>
  </div>

  <div class="indent"><h3 id="owner-subscriptions">8.8 Manage Subscriptions<a class="anchor-link" href="#owner-subscriptions"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A node owner may want to edit the list of subscriptions associated with a given node. Support for this feature ("pubsub#manage-subscriptions") is OPTIONAL.</p>
    <div class="indent"><h4 id="owner-subscriptions-retrieve">8.8.1 Retrieve Subscriptions List<a class="anchor-link" href="#owner-subscriptions-retrieve"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">First the owner retrieves the subscriptions list.</p>
      <div class="indent"><h5 id="owner-subscriptions-retrieve-request">8.8.1.1 Request</h5>
        <p class="" style="">In order to request a list of all subscriptions, a node owner MUST send a subscriptions request, consisting of a &lt;subscriptions/&gt; element whose 'node' attribute specifies the NodeID of the relevant node.</p>
        <figure class="code-example" id="example-184"><figcaption><strong>Example 184.</strong> Owner requests all subscriptions<a class="anchor-link" href="#example-184"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='subman1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;subscriptions node='princely_musings'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-subscriptions-retrieve-success">8.8.1.2 Success Case</h5>
        <p class="" style="">If no error occurs, the service MUST return the list of subscriptions for entities whose subscription state is "subscribed" or "unconfigured" (it MUST NOT return entities whose subscription state is "none" and SHOULD NOT return entities whose subscription state is "pending"). The result MAY specify multiple &lt;subscription/&gt; elements for the same entity (JID), but each element MUST possess a distinct value of the 'subid' attribute (as shown below).</p>
        <figure class="code-example" id="example-185"><figcaption><strong>Example 185.</strong> Service returns list of subscriptions<a class="anchor-link" href="#example-185"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='subman1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;subscriptions node='princely_musings'&gt;
      &lt;subscription jid='hamlet@denmark.lit' subscription='subscribed'/&gt;
      &lt;subscription jid='polonius@denmark.lit' subscription='unconfigured'/&gt;
      &lt;subscription jid='bernardo@denmark.lit' subscription='subscribed' subid='123-abc'/&gt;
      &lt;subscription jid='bernardo@denmark.lit' subscription='subscribed' subid='004-yyy'/&gt;
    &lt;/subscriptions&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-subscriptions-retrieve-error">8.8.1.3 Error Cases</h5>
        <p class="" style="">There are several reasons why the manage subscriptions request might fail:</p>
        <ol start="" class="" style="">
          <li class="" style="">The service does not support subscription management.</li>
          <li class="" style="">The requesting entity does not have sufficient privileges to manage subscriptions.</li>
          <li class="" style="">The specified node does not exist.</li>
        </ol>
        <p class="" style="">These error cases are described more fully in the following sections.</p>
        <div class="indent"><h6 id="owner-subscriptions-retrieve-error-notsupported">8.8.1.3.1 Subscription Management Not Supported</h6>
          <p class="" style="">If an implementation does not support subscription management, it MUST return a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "manage-subscriptions".</p>
          <figure class="code-example" id="example-186"><figcaption><strong>Example 186.</strong> Node or service does not support subscription management<a class="anchor-link" href="#example-186"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    id='subman1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='manage-subscriptions'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        </div>
        <div class="indent"><h6 id="owner-subscriptions-retrieve-error-forbidden">8.8.1.3.2 Insufficient Privileges</h6>
          <p class="" style="">If the requesting entity is not a node owner, the service MUST return a &lt;forbidden/&gt; error.</p>
          <figure class="code-example" id="example-187"><figcaption><strong>Example 187.</strong> Entity is not an owner<a class="anchor-link" href="#example-187"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    id='subman1'&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        </div>
        <div class="indent"><h6 id="owner-subscriptions-retrieve-error-node">8.8.1.3.3 Node Does Not Exist</h6>
          <p class="" style="">If the node does not exist, the service MUST return an &lt;item-not-found/&gt; error.</p>
          <figure class="code-example" id="example-188"><figcaption><strong>Example 188.</strong> Node does not exist<a class="anchor-link" href="#example-188"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    id='subman1'&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        </div>
      </div>
    </div>
    <div class="indent"><h4 id="owner-subscriptions-modify">8.8.2 Modify Subscriptions<a class="anchor-link" href="#owner-subscriptions-modify"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <div class="indent"><h5 id="owner-subscriptions-modify-request">8.8.2.1 Request</h5>
        <p class="" style="">Upon receiving the subscriptions list, the node owner MAY modify subscription states. The owner MUST send only modified subscription states (i.e., a "delta"), not the complete list. (Note: If the 'subscription' attribute is not specified in a modification request, then the value MUST NOT be changed.)</p>
        <figure class="code-example" id="example-189"><figcaption><strong>Example 189.</strong> Owner modifies subscriptions<a class="anchor-link" href="#example-189"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='subman2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;subscriptions node='princely_musings'&gt;
      &lt;subscription jid='bard@shakespeare.lit' subscription='subscribed'/&gt;
    &lt;/subscriptions&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-subscriptions-modify-success">8.8.2.2 Success Case</h5>
        <figure class="code-example" id="example-190"><figcaption><strong>Example 190.</strong> Service responds with success<a class="anchor-link" href="#example-190"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    id='subman2'/&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-subscriptions-modify-error">8.8.2.3 Error Cases</h5>
        <p class="" style="">There are several reasons why the modify subscriptions request might fail:</p>
        <ol start="" class="" style="">
          <li class="" style="">The service does not support subscription management.</li>
          <li class="" style="">The requesting entity does not have sufficient privileges to manage subscriptions.</li>
          <li class="" style="">The specified node does not exist.</li>
        </ol>
        <p class="" style="">These error cases are described more fully in the following sections.</p>
        <div class="indent"><h6 id="owner-subscriptions-modify-error-notsupported">8.8.2.3.1 Subscription Management Not Supported</h6>
          <p class="" style="">If an implementation does not support subscription management, it MUST return a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "manage-subscriptions".</p>
          <figure class="code-example" id="example-191"><figcaption><strong>Example 191.</strong> Node or service does not support subscription management<a class="anchor-link" href="#example-191"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    id='subman2'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='manage-subscriptions'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        </div>
        <div class="indent"><h6 id="owner-subscriptions-retrieve-error-forbidden">8.8.2.3.2 Insufficient Privileges</h6>
          <p class="" style="">If the requesting entity is not a node owner, the service MUST return a &lt;forbidden/&gt; error.</p>
          <figure class="code-example" id="example-192"><figcaption><strong>Example 192.</strong> Entity is not an owner<a class="anchor-link" href="#example-192"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    id='subman1'&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        </div>
        <div class="indent"><h6 id="owner-subscriptions-retrieve-error-node">8.8.2.3.3 Node Does Not Exist</h6>
          <p class="" style="">If the node does not exist, the service MUST return an &lt;item-not-found/&gt; error.</p>
          <figure class="code-example" id="example-193"><figcaption><strong>Example 193.</strong> Node does not exist<a class="anchor-link" href="#example-193"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    id='subman2'&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        </div>
      </div>
      <div class="indent"><h5 id="owner-subscriptions-multi">8.8.2.4 Multiple Simultaneous Modifications</h5>
        <p class="" style="">The owner MAY change multiple subscriptions in a single request. If one of the &lt;subscription/&gt; elements specified is invalid, the service MUST return an IQ error (which SHOULD be &lt;not-acceptable/&gt;) with the invalid entries, where the subscription returned is the original, un-altered subscription.</p>
        <figure class="code-example" id="example-194"><figcaption><strong>Example 194.</strong> Owner sets subscription for multiple entities<a class="anchor-link" href="#example-194"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='subman3'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;subscriptions node='princely_musings'&gt;
      &lt;subscription jid='polonius@denmark.lit' subscription='none'/&gt;
      &lt;subscription jid='bard@shakespeare.lit' subscription='subscribed'/&gt;
    &lt;/subscriptions&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
        <figure class="code-example" id="example-195"><figcaption><strong>Example 195.</strong> Service responds with an error<a class="anchor-link" href="#example-195"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='subman3'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;subscriptions node='princely_musings'&gt;
      &lt;subscription jid='polonius@denmark.lit' subscription='subscribed'/&gt;
    &lt;/subscriptions&gt;
  &lt;/pubsub&gt;
  &lt;error type='modify'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        <p class="" style="">If errors occur during a modification request for multiple entities, the pubsub service MUST return any &lt;subscription/&gt; element(s) which caused the error. Returned entities which failed to be modified MUST include the existing 'subscription' attribute. Any &lt;subscription/&gt; elements which are not returned in an IQ error case MUST be treated as successful modifications. The owner MAY specify multiple &lt;subscription/&gt; elements for the same entity, but each element MUST possess a distinct value of the 'subid' attribute.</p>
      </div>
    </div>
    <div class="indent"><h4 id="owner-subscriptions-delete">8.8.3 Delete a Subscriber<a class="anchor-link" href="#owner-subscriptions-delete"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">In order to remove an entity from the subscriptions list, the owner MUST set the value of the 'subscription' attribute to "none" and the service MUST remove that entity from the subscriptions list and not return it in response to future list requests.</p>
    </div>
    <div class="indent"><h4 id="owner-subscriptions-notifysub">8.8.4 Notifying Subscribers<a class="anchor-link" href="#owner-subscriptions-notifysub"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">An implementation SHOULD notify an entity whose subscription has changed (see the <a href="#impl-subchange">Notification of Subscription State Changes</a> section of this document).</p>
      <figure class="code-example" id="example-196"><figcaption><strong>Example 196.</strong> Service sends notification of subscription change<a class="anchor-link" href="#example-196"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit' to='polonius@denmark.lit'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;subscription node='princely_musings' jid='polonius@denmark.lit' subscription='none'/&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
    </div>
  </div>

  <div class="indent"><h3 id="owner-affiliations">8.9 Manage Affiliations<a class="anchor-link" href="#owner-affiliations"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A node owner may want to manage the affiliations of entities associated with a given node and to set affiliations for new entities. Support for this feature ("pubsub#modify-affiliations") is OPTIONAL.</p>
    <div class="indent"><h4 id="owner-affiliations-retrieve">8.9.1 Retrieve Affiliations List<a class="anchor-link" href="#owner-affiliations-retrieve"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">First the owner retrieves the affiliation list.</p>
      <div class="indent"><h5 id="owner-affiliations-retrieve-request">8.9.1.1 Request</h5>
        <p class="" style="">In order to request a list of all affiliated entities, a node owner MUST send an affiliations request, consisting of an &lt;affiliations/&gt; element whose 'node' attribute specifies the NodeID of the relevant node.</p>
        <figure class="code-example" id="example-197"><figcaption><strong>Example 197.</strong> Owner requests all affiliated entities<a class="anchor-link" href="#example-197"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='ent1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;affiliations node='princely_musings'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-affiliations-retrieve-success">8.9.1.2 Success Case</h5>
        <p class="" style="">If no error occurs, the service MUST return the list of entities whose affiliation is "owner", "member", "publisher", "publish-only", or "outcast" (it MUST NOT return entities whose affiliation is "none").</p>
        <figure class="code-example" id="example-198"><figcaption><strong>Example 198.</strong> Service returns list of affiliated entities<a class="anchor-link" href="#example-198"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='ent1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;affiliations node='princely_musings'&gt;
      &lt;affiliation jid='hamlet@denmark.lit' affiliation='owner'/&gt;
      &lt;affiliation jid='polonius@denmark.lit' affiliation='outcast'/&gt;
    &lt;/affiliations&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-affiliations-retrieve-error">8.9.1.3 Error Cases</h5>
        <p class="" style="">There are several reasons why the affiliated entities request might fail:</p>
        <ol start="" class="" style="">
          <li class="" style="">The service does not support modification of affiliations.</li>
          <li class="" style="">The requesting entity does not have sufficient privileges to modify affiliations.</li>
          <li class="" style="">The specified node does not exist.</li>
        </ol>
        <p class="" style="">These error cases are described more fully in the following sections.</p>
        <div class="indent"><h6 id="owner-affiliations-retrieve-notsupported">8.9.1.3.1 Affiliation Modification Not Supported</h6>
          <p class="" style="">If an implementation does not support modification of affiliations, it MUST return a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "modify-affiliations".</p>
          <figure class="code-example" id="example-199"><figcaption><strong>Example 199.</strong> Node or service does not support affiliation management<a class="anchor-link" href="#example-199"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    id='ent1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='modify-affiliations'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        </div>
        <div class="indent"><h6 id="owner-affiliations-retrieve-forbidden">8.9.1.3.2 Insufficient Privileges</h6>
          <p class="" style="">If the requesting entity is not a node owner, the service MUST return a &lt;forbidden/&gt; error.</p>
          <figure class="code-example" id="example-200"><figcaption><strong>Example 200.</strong> Entity is not an owner<a class="anchor-link" href="#example-200"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    id='ent1'&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        </div>
        <div class="indent"><h6 id="owner-affiliations-retrieve-node">8.9.1.3.3 Node Does Not Exist</h6>
          <p class="" style="">If the node does not exist, the service MUST return an &lt;item-not-found/&gt; error.</p>
          <figure class="code-example" id="example-201"><figcaption><strong>Example 201.</strong> Node does not exist<a class="anchor-link" href="#example-201"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    id='ent1'&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        </div>
      </div>
    </div>
    <div class="indent"><h4 id="owner-affiliations-modify">8.9.2 Modify Affiliation<a class="anchor-link" href="#owner-affiliations-modify"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">A node owner may want to edit the affiliation of an entity associated with a given node or to set the affiliation for a new entity.</p>
      <div class="indent"><h5 id="owner-affiliations-modify-request">8.9.2.1 Request</h5>
        <p class="" style="">In order to modify an affiliation, a node owner MUST send an IQ set containing the modified affiliation or affiliations. The owner MUST send only modified affiliations (i.e., a "delta"), not the complete list. (Note: If the 'affiliation' attribute is not specified in a modification request, then the value MUST NOT be changed.)</p>
        <figure class="code-example" id="example-202"><figcaption><strong>Example 202.</strong> Owner modifies affiliation<a class="anchor-link" href="#example-202"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='ent2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;affiliations node='princely_musings'&gt;
      &lt;affiliation jid='bard@shakespeare.lit' affiliation='publisher'/&gt;
    &lt;/affiliations&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-affiliations-modify-success">8.9.2.2 Success Case</h5>
        <figure class="code-example" id="example-203"><figcaption><strong>Example 203.</strong> Service responds with success<a class="anchor-link" href="#example-203"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    id='ent2'/&gt;
</pre></figure>
      </div>
      <div class="indent"><h5 id="owner-affiliations-modify-error">8.9.2.3 Error Cases</h5>
        <p class="" style="">There are several reasons why the modify-affiliations request might fail:</p>
        <ol start="" class="" style="">
          <li class="" style="">The requested affiliation is not supported by the node or service.</li>
          <li class="" style="">The service does not support modification of affiliations.</li>
          <li class="" style="">The requesting entity does not have sufficient privileges to modify affiliations.</li>
          <li class="" style="">The specified node does not exist.</li>
        </ol>
        <p class="" style="">These error cases are described more fully in the following sections.</p>
        <div class="indent"><h6 id="owner-affiliations-retrieve-notsupported">8.9.2.3.1 Affiliation Modification Not Supported</h6>
          <p class="" style="">If an implementation does not support modification of affiliations, it MUST return a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "modify-affiliations".</p>
          <figure class="code-example" id="example-204"><figcaption><strong>Example 204.</strong> Node or service does not support affiliation management<a class="anchor-link" href="#example-204"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    id='ent1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='modify-affiliations'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        </div>
        <div class="indent"><h6 id="owner-affiliations-nosuchaffil">8.9.2.3.2 Affiliation Not Supported</h6>
          <p class="" style="">If the node or service does not support the requested affiliation, it MUST return a &lt;feature-not-implemented/&gt; error, specifying a pubsub-specific error condition of &lt;unsupported/&gt; and a feature of "member-affiliation", "outcast-affiliation", "publisher-affiliation", or "publish-only-affiliation" as appropriate.</p>
          <figure class="code-example" id="example-205"><figcaption><strong>Example 205.</strong> Node or service does not support the requested affiliation<a class="anchor-link" href="#example-205"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    id='ent1'&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;unsupported xmlns='http://jabber.org/protocol/pubsub#errors'
                 feature='member-affiliation'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        </div>
        <div class="indent"><h6 id="owner-affiliations-retrieve-forbidden">8.9.2.3.3 Insufficient Privileges</h6>
          <p class="" style="">If the requesting entity is not a node owner, the service MUST return a &lt;forbidden/&gt; error.</p>
          <figure class="code-example" id="example-206"><figcaption><strong>Example 206.</strong> Entity is not an owner<a class="anchor-link" href="#example-206"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    id='ent1'&gt;
  &lt;error type='auth'&gt;
    &lt;forbidden xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        </div>
        <div class="indent"><h6 id="owner-affiliations-retrieve-node">8.9.2.3.4 Node Does Not Exist</h6>
          <p class="" style="">If the node does not exist, the service MUST return an &lt;item-not-found/&gt; error.</p>
          <figure class="code-example" id="example-207"><figcaption><strong>Example 207.</strong> Node does not exist<a class="anchor-link" href="#example-207"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    id='ent1'&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        </div>
      </div>
      <div class="indent"><h5 id="owner-affiliations-multi">8.9.2.4 Multiple Simultaneous Modifications</h5>
        <p class="" style="">The owner MAY change multiple affiliations in a single request. If one of the &lt;subscription/&gt; elements specified is invalid, the service MUST return an IQ error (which SHOULD be &lt;not-acceptable/&gt;) with the invalid entries, where the affiliation returned is the original, un-altered affiliation.</p>
        <p class="" style="">The following example shows an entity attempting to make the owner something other than an affiliation of "owner", an action which MUST NOT be allowed if there is only one owner.</p>
        <figure class="code-example" id="example-208"><figcaption><strong>Example 208.</strong> Owner sets affiliation for multiple entities<a class="anchor-link" href="#example-208"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='ent3'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;affiliations node='princely_musings'&gt;
      &lt;affiliation jid='hamlet@denmark.lit' affiliation='none'/&gt;
      &lt;affiliation jid='polonius@denmark.lit' affiliation='none'/&gt;
      &lt;affiliation jid='bard@shakespeare.lit' affiliation='publisher'/&gt;
    &lt;/affiliations&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
        <figure class="code-example" id="example-209"><figcaption><strong>Example 209.</strong> Service responds with an error<a class="anchor-link" href="#example-209"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='error'
    from='pubsub.shakespeare.lit'
    to='hamlet@denmark.lit/elsinore'
    id='ent3'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub#owner'&gt;
    &lt;affiliations node='princely_musings'&gt;
      &lt;affiliation jid='hamlet@denmark.lit' affiliation='owner'/&gt;
    &lt;/affiliations&gt;
  &lt;/pubsub&gt;
  &lt;error type='modify'&gt;
    &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></figure>
        <p class="" style="">The state chart at the beginning of this document is a MUST-IMPLEMENT set of rules for checking possible state transitions. Implementations MAY enforce other (more strict) rules. If errors occur during a modification request for multiple entities, the pubsub service MUST return any &lt;affiliation/&gt; element(s) which caused the error. Returned entities which failed to be modified MUST include the existing 'affiliation' attribute. Any &lt;subscription/&gt; elements which are not returned in an IQ error case MUST be treated as successful modifications. The owner MUST NOT specify multiple &lt;affiliation/&gt; elements for the same entity; otherwise the service MUST return a &lt;bad-request/&gt; error.</p>
      </div>
    </div>
    <div class="indent"><h4 id="owner-affiliations-delete">8.9.3 Delete an Entity<a class="anchor-link" href="#owner-affiliations-delete"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">In order to remove an entity from the affiliations list, the owner MUST set the value of the 'affiliation' attribute to "none" and the service MUST remove that entity from the affiliations list and not return it in response to future list requests.</p>
    </div>
    <div class="indent"><h4 id="owner-affiliations-notify">8.9.4 Notifying Entities<a class="anchor-link" href="#owner-affiliations-notify"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">An implementation MAY send an event notification to an entity whose affiliation has changed, which MAY contain a &lt;body/&gt; element specifying natural-language text regarding the affiliation change and which SHOULD contain the modified affiliation data.</p>
      <figure class="code-example" id="example-210"><figcaption><strong>Example 210.</strong> Service sends notification of affiliation change<a class="anchor-link" href="#example-210"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit' to='polonius@denmark.lit'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;affiliations node='princely_musings'&gt;
      &lt;affilation jid='polonius@denmark.lit' affiliation='none'/&gt;
    &lt;/affiliations&gt;
  &lt;/pubsub&gt;
&lt;/message&gt;
</pre></figure>
    </div>
  </div>
<h2 id="presence">9.
       IM Account Integration<a class="anchor-link" href="#presence"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">Publish-subscribe functionality can be integrated into existing instant messaging and presence services (see <span class="ref">RFC 3921</span>), such that each registered account functions as a virtual pubsub service (sometimes called "pubsub-on-a-JID"). In such deployments, the root pubsub node for each virtual pubsub service has the same address as the bare JID (&lt;localpart@domain.tld&gt; or &lt;domain.tld&gt;) of the account, which is typically associated with an IM user (e.g., &lt;hamlet@denmark.lit&gt;). Since an IM user typically has a roster of "buddies" and shares presence information with those buddies, the virtual pubsub service can use roster and presence information to provide some helpful shortcuts for subscribers, in particular the auto-subscribe and filtered-notifications features described in this section.</p>
  <p class="box" style="">Note: PEP ties the receipt of PEP notifications to the subscriber's presence, but does not tie the generation of PEP notifications to the publisher's presence. If the publisher wishes to stop generating PEP events (or to generate an "empty" event as can be done for some PEP payloads) before ending its presence session, the publisher MUST direct its client to do so and MUST NOT depend on the PEP service to automatically "zero out" its PEP information when the PEP service receives unavailable presence from the publisher.</p>
  <p class="" style="">If an instant messaging and presence account is also a virtual pubsub service, service discovery information ("disco#info") responses from the bare JID of the account MUST include a feature of "http:/jabber.org/protocol/pubsub#pubsub-on-a-jid":</p>
  <figure class="code-example" id="example-211"><figcaption><strong>Example 211.</strong> IM server returns supported features on behalf of IM account<a class="anchor-link" href="#example-211"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='hamlet@denmark.lit'
    id='bvg194j7'
    to='francisco@denmark.lit/barracks'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity category='account' type='registered'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#pubsub-on-a-jid'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></figure>
  <p class="" style="">Note: Because the account owner's bare JID is the default destination address for any stanzas a client generates, clients often omit the "to" attribute on such stanzas; on this point, see <span class="ref">RFC 6120</span> and (with regard to rosters) <span class="ref">RFC 6121</span>.</p>
  <div class="indent"><h3 id="auto-subscribe">9.1 Auto-Subscribe<a class="anchor-link" href="#auto-subscribe"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">When a contact is affiliated with the account owner through sharing of XMPP presence, the "auto-subscribe" feature greatly simplifies the subscription process. In particular, support for the "auto-subscribe" has the following implications:</p>
    <div class="indent"><h4 id="auto-subscribe-owner">9.1.1 Account Owner<a class="anchor-link" href="#auto-subscribe-owner"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">Because the account owner itself is implicitly subscribed to its own XMPP presence (e.g., each XMPP resource receives presence information from all of the account owner's resources), a service MUST consider the account owner to have a pubsub subscription to the account owner's root collection node with a subscription_type of "items" and a subscription_depth of "all". This is true for all access models.</p>
    </div>
    <div class="indent"><h4 id="auto-subscribe-contact">9.1.2 Presence Subscriber<a class="anchor-link" href="#auto-subscribe-contact"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If an entity (i.e., an IM contact) has an XMPP presence subscription to the account owner's bare JID (&lt;localpart@domain.tld&gt; or &lt;domain.tld&gt;), a service MUST consider the contact to have a pubsub subscription to the account owner's root collection node with a subscription_type of "items" and a subscription_depth of "all" if:</p>
      <ol start="" class="" style="">
        <li class="" style="">The node has an access model of "open".</li>
        <li class="" style="">The node has an access model of "presence".</li>
        <li class="" style="">The node has an access model of "roster" and the contact is in the specified roster group.</li>
      </ol>
      <p class="" style="">If the contact does not have permission to receive information from any of the account owner's particular nodes below the level of the root collection node (e.g., because a particular node has an access model of "roster" but the contact is not in the specified roster group), the service MUST NOT send notifications regarding that node to the contact and also MUST NOT return any errors to the contact regarding a potential implicit subscription to that node (e.g., the service MUST NOT return a pubsub subscription error to the contact when the contact sends presence to the account owner).</p>
      <p class="" style="">Note: When an IM contact has a subscription to the account owner's presence, the automated pubsub subscription MUST be based on the JID contained in the 'from' address of the presence subscription request, which for an IM contact will be a bare JID (&lt;localpart@domain.tld&gt; or &lt;domain.tld&gt;).</p>
    </div>
    <div class="indent"><h4 id="auto-subscribe-directed">9.1.3 Presence Sharer<a class="anchor-link" href="#auto-subscribe-directed"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <p class="" style="">If the node has an open access model, the pubsub service SHOULD also consider an entity to be temporarily and implicitly subscribed to the node if the entity has sent presence to the account owner in the absence of a presence subscription. In this case, the subscription SHOULD be based on the 'from' address of the presence stanza, which will be a full JID (&lt;localpart@domain.tld/resource&gt; or &lt;domain.tld/resource&gt;). When the service receives unavailable presence from the full JID, it MUST cancel the temporary subscription.</p>
    </div>
  </div>
  <div class="indent"><h3 id="filtered-notifications">9.2 Filtered Notifications<a class="anchor-link" href="#filtered-notifications"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A contact might not want to receive notifications for all the nodes hosted at a user's virtual pubsub service. A contact SHOULD signal its preferences to the account owner's server by including <span class="ref">XEP-0115</span> information that specifies the NodeIDs for which the contact wishes to receive notifications (if any). This information is used by a pubsub service that supports the "filtered-notifications" feature to send notifications only from those NodeIDs that match the subscriber's preferences.</p>
    <p class="" style="">In order to make this possible, all possible NodeIDs can be appended with the string "+notify" to indicate that the contact wishes to receive notifications for the specified NodeID. Thus if Romeo wants to receive notifications for location data (<span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0080.html">User Geolocation (XEP-0080)</a></span>  [<a href="#nt-idm1806">22</a>]) and tune data (<span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0118.html">User Tune (XEP-0118)</a></span>  [<a href="#nt-idm1810">23</a>]) but not activity data (<span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0108.html">User Activity (XEP-0108)</a></span>  [<a href="#nt-idm1814">24</a>]), his client would advertise support for the following strings in the disco#info results it sends:  [<a href="#nt-idm1816">25</a>]</p>
    <ul class="" style="">
      <li class="" style="">http://jabber.org/protocol/geoloc+notify</li>
      <li class="" style="">http://jabber.org/protocol/tune+notify</li>
    </ul>
    <p class="" style="">This set of strings would then be advertised by including them in the identity+features hash encapsulated via the 'ver' attribute as described in <span class="ref">XEP-0115</span>.</p>
    <figure class="code-example" id="example-212"><figcaption><strong>Example 212.</strong> Contact sends presence with caps<a class="anchor-link" href="#example-212"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;presence from='romeo@montague.lit/orchard'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     node='http://www.chatopus.com/#2.2'
     ver='AFBT0mPr29zQE5aGtCJp97CIS6E='/&gt;
&lt;/presence&gt;
</pre></figure>
    <p class="" style="">It is the responsibility of the account owner's server to cache <span class="ref">XEP-0115</span> information. When the server receives presence from a contact, it MUST check that presence information for entity capabilities data and correlate that data with the desired NodeIDs for the contact's client. The server MUST NOT send notifications related to any NodeIDs that the contact's client has not asked for via the relevant "NodeID+notify" disco#info feature. This enables a client to turn off all notifications (e.g., because of bandwidth restrictions) and to easily receive all desired data formats simply by adding support for the appropriate "NodeID+notify" combination in its disco#info results and client capabililies. However, it also implies that a client can request notifications only on a global basis and cannot request, say, mood information only from certain contacts in the user's roster. Community consensus is that this is an acceptable tradeoff. Also, note that this works only if the account owner has a presence subscription to the contact and the contact has a presence subscription to the account owner.</p>
    <p class="" style="">Some examples may help to illustrate the concept of notification filtering. Here we show presence generated by two of the contacts listed above (benvolio@montague.lit does not have any presence subscriptions to or from juliet@capulet.lit and therefore is not involved in these protocol flows).</p>
    <figure class="code-example" id="example-213"><figcaption><strong>Example 213.</strong> Presence with caps<a class="anchor-link" href="#example-213"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;presence from='nurse@capulet.lit/chamber'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     node='http://exodus.jabberstudio.org/#0.9.1'
     ver='wXj6c5xhT9frdqhvTSjkdejUUP8='/&gt;
&lt;/presence&gt;

&lt;presence from='romeo@montague.lit/orchard'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     node='http://www.chatopus.com/#2.2'
     ver='1FDrLLbYMpzvcI95jgSHABSWDRY='/&gt;
&lt;/presence&gt;
</pre></figure>
    <p class="" style="">We assume that Juliet's server doesn't know anything about these capabilities, so it sends service discovery information requests to each of the clients on Juliet's behalf (realistically, the capulet.lit server will quickly build up a cache of client capabilities, with the result that it will not need to send these service discovery requests):</p>
    <figure class="code-example" id="example-214"><figcaption><strong>Example 214.</strong> Account server queries contact<a class="anchor-link" href="#example-214"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit'
    to='nurse@capulet.lit/chamber'
    type='get'
    id='disco123'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;

&lt;iq from='nurse@capulet.lit/chamber'
    to='juliet@capulet.lit'
    type='result'
    id='disco123'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity category='client' type='pc'/&gt;
    &lt;feature var='http://jabber.org/protocol/activity'/&gt;
    &lt;feature var='http://jabber.org/protocol/activity+notify'/&gt;
    &lt;feature var='http://jabber.org/protocol/geoloc'/&gt;
    &lt;feature var='http://jabber.org/protocol/geoloc+notify'/&gt;
    &lt;feature var='http://jabber.org/protocol/muc'/&gt;
    &lt;feature var='http://jabber.org/protocol/tune'/&gt;
    &lt;feature var='http://jabber.org/protocol/tune+notify'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">The server shall also query the identity+features for &lt;romeo@montague.lit&gt;:</p>
    <figure class="code-example" id="example-215"><figcaption><strong>Example 215.</strong> Account server queries contact<a class="anchor-link" href="#example-215"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit'
    to='romeo@montague.lit/orchard'
    type='get'
    id='disco234'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;

&lt;iq from='romeo@montague.lit/orchard'
    to='juliet@capulet.lit'
    type='result'
    id='disco234'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity category='client' type='pda'/&gt;
    &lt;feature var='http://jabber.org/protocol/geoloc'/&gt;
    &lt;feature var='http://jabber.org/protocol/geoloc+notify'/&gt;
    &lt;feature var='http://jabber.org/protocol/tune'/&gt;
    &lt;feature var='http://jabber.org/protocol/tune+notify'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">(As noted in <span class="ref">XEP-0115</span>, the server MUST check the hash provided in the 'ver' attribute against the generation method to ensure that no poisoning has occurred.)</p>
    <p class="" style="">Now we revisit account owner publication and server generation of notifications, with filtering enabled because the server has caps information:</p>
    <ul class="" style="">
      <li class="" style=""><p class="" style="">If Juliet publishes a tune item to the presence-access "http://jabber.org/protocol/tune" node, her server will send notifications to &lt;nurse@capulet.lit/chamber&gt; and &lt;romeo@montague.lit/orchard&gt; (full JIDs).</p></li>
      <li class="" style=""><p class="" style="">If Juliet publishes an activity item to the presence-access "http://jabber.org/protocol/activity" node, her server will send notifications only to &lt;nurse@capulet.lit/chamber&gt;.</p></li>
      <li class="" style=""><p class="" style="">If Juliet publishes a geolocation item to the roster-access "http://jabber.org/protocol/geoloc" node with the "pubsub#roster_groups_allowed" variable set to a value of "Friends", her server will send notifications only to &lt;romeo@montague.lit/orchard&gt; because the nurse is not in that roster group.</p></li>
    </ul>
  </div>
<h2 id="features">10.
       Feature Summary<a class="anchor-link" href="#features"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">This section summarizes the features described herein, specifies the appropriate requirements level for each feature (REQUIRED, RECOMMENDED, or OPTIONAL), and provides cross-references to the section of this document in which each feature is described.</p>
  <p class="" style="">Note: The feature names are all of the form "http://jabber.org/protocol/pubsub#name", where "name" is the text specified in the first column below.</p>
  <figure class="table"><figcaption id="table-7"><strong>Table 7:</strong> Service Discovery Features<a class="anchor-link" href="#table-7"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><table>
    <tr class="body">
      <th colspan="" rowspan="">Name</th>
      <th colspan="" rowspan="">Description</th>
      <th colspan="" rowspan="">Support</th>
      <th colspan="" rowspan="">Section</th>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">access-authorize</td>
      <td align="" colspan="" rowspan="">The default access model is "authorize".</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#accessmodels">Nodes Access Models</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">access-open</td>
      <td align="" colspan="" rowspan="">The default access model is "open".</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#accessmodels">Nodes Access Models</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">access-presence</td>
      <td align="" colspan="" rowspan="">The default access model is "presence".</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#accessmodels">Nodes Access Models</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">access-roster</td>
      <td align="" colspan="" rowspan="">The default access model is "roster".</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#accessmodels">Nodes Access Models</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">access-whitelist</td>
      <td align="" colspan="" rowspan="">The default access model is "whitelist".</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#accessmodels">Nodes Access Models</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">auto-create</td>
      <td align="" colspan="" rowspan="">The service supports auto-creation of nodes on publish to a non-existent node.</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#publisher-publish-autocreate">Automatic Node Creation</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">auto-subscribe</td>
      <td align="" colspan="" rowspan="">The service supports auto-subscription to a nodes based on presence subscription.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""><a href="#auto-subscribe">Auto-Subscribe</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">collections</td>
      <td align="" colspan="" rowspan="">Collection nodes are supported.</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan="">Refer to <span class="ref">XEP-0248</span></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">config-node</td>
      <td align="" colspan="" rowspan="">Configuration of node options is supported.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""><a href="#owner-configure">Configure a Node</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">create-and-configure</td>
      <td align="" colspan="" rowspan="">Simultaneous creation and configuration of nodes is supported.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""><a href="#owner-create-and-configure">Create and Configure a Node</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">create-nodes</td>
      <td align="" colspan="" rowspan="">Creation of nodes is supported.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""><a href="#owner-create">Create a Node</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">delete-items</td>
      <td align="" colspan="" rowspan="">Deletion of items is supported.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""><a href="#publisher-delete">Delete an Item from a Node</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">delete-nodes</td>
      <td align="" colspan="" rowspan="">Deletion of nodes is supported.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""><a href="#owner-delete">Delete a Node</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">filtered-notifications</td>
      <td align="" colspan="" rowspan="">Notifications are filtered based on Entity Capabilities data.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""><a href="#filtered-notifications">Filtered Notifications</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">get-pending</td>
      <td align="" colspan="" rowspan="">Retrieval of pending subscription approvals is supported.</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#owner-subreq">Manage Subscription Requests</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">instant-nodes</td>
      <td align="" colspan="" rowspan="">Creation of instant nodes is supported.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""><a href="#owner-create">Create a Node</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">item-ids</td>
      <td align="" colspan="" rowspan="">Publishers may specify item identifiers.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""> </td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">last-published</td>
      <td align="" colspan="" rowspan="">By default the last published item is sent to new subscribers and on receipt of available presence from existing subscribers.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""><a href="#events">Event Types</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">leased-subscription</td>
      <td align="" colspan="" rowspan="">Time-based subscriptions are supported.</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#impl-leases">Time-Based Subscriptions (Leases)</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">manage-subscriptions</td>
      <td align="" colspan="" rowspan="">Node owners may manage subscriptions.</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#owner-subscriptions">Manage Subscriptions</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">member-affiliation</td>
      <td align="" colspan="" rowspan="">The member affiliation is supported.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""><a href="#affiliations">Affiliations</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">meta-data</td>
      <td align="" colspan="" rowspan="">Node metadata is supported.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""> </td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">modify-affiliations</td>
      <td align="" colspan="" rowspan="">Node owners may modify affiliations.</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#owner-affiliations">Manage Affiliations</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">multi-collection</td>
      <td align="" colspan="" rowspan="">A single leaf node can be associated with multiple collections.</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan="">Refer to <span class="ref">XEP-0248</span></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">multi-items</td>
      <td align="" colspan="" rowspan="">The service supports the storage of multiple items per node. It requires the pubsub#max_items configuration item to be exposed to the user and allow sensible values (higher than one) to be set in <a href="#owner-configure">Configure a Node</a>.</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""> </td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">multi-subscribe</td>
      <td align="" colspan="" rowspan="">A single entity may subscribe to a node multiple times.</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#subscriber-subscribe-multi">Multiple Subscriptions</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">outcast-affiliation</td>
      <td align="" colspan="" rowspan="">The outcast affiliation is supported.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""><a href="#affiliations">Affiliations</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">persistent-items</td>
      <td align="" colspan="" rowspan="">Persistent items are supported.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""> </td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">presence-notifications</td>
      <td align="" colspan="" rowspan="">Presence-based delivery of event notifications is supported.</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""> </td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">presence-subscribe</td>
      <td align="" colspan="" rowspan="">Authorized contacts are automatically subscribed to a user's virtual pubsub service.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""><a href="#auto-subscribe">Auto-Subscribe</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">publish</td>
      <td align="" colspan="" rowspan="">Publishing items is supported.</td>
      <td align="" colspan="" rowspan="">REQUIRED</td>
      <td align="" colspan="" rowspan=""><a href="#publisher-publish">Publish an Item to a Node</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">publish-options</td>
      <td align="" colspan="" rowspan="">Publishing an item with options is supported.</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#publisher-publish-options">Publishing Options</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">publish-only-affiliation</td>
      <td align="" colspan="" rowspan="">The publish-only affiliation is supported.</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#affiliations">Affiliations</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">publisher-affiliation</td>
      <td align="" colspan="" rowspan="">The publisher affiliation is supported.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""><a href="#affiliations">Affiliations</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">purge-nodes</td>
      <td align="" colspan="" rowspan="">Purging of nodes is supported.</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#owner-purge">Purge All Node Items</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">retract-items</td>
      <td align="" colspan="" rowspan="">Item retraction is supported.</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#publisher-delete">Delete an Item from a Node</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">retrieve-affiliations</td>
      <td align="" colspan="" rowspan="">Retrieval of current affiliations is supported.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""><a href="#entity-affiliations">Retrieve Affiliations</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">retrieve-default</td>
      <td align="" colspan="" rowspan="">Retrieval of default node configuration is supported.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""><a href="#owner-default">Request Default Node Configuration Options</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">retrieve-default-sub</td>
      <td align="" colspan="" rowspan="">Retrieval of default subscription configuration is supported.</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#subscribe-default">Request Default Subscription Configuration Options</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">retrieve-items</td>
      <td align="" colspan="" rowspan="">Item retrieval is supported.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""><a href="#subscriber-retrieve">Retrieve Items from a Node</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">retrieve-subscriptions</td>
      <td align="" colspan="" rowspan="">Retrieval of current subscriptions is supported.</td>
      <td align="" colspan="" rowspan="">RECOMMENDED</td>
      <td align="" colspan="" rowspan=""><a href="#entity-subscriptions">Retrieve Subscriptions</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">subscribe</td>
      <td align="" colspan="" rowspan="">Subscribing and unsubscribing are supported.</td>
      <td align="" colspan="" rowspan="">REQUIRED</td>
      <td align="" colspan="" rowspan=""><a href="#subscriber-subscribe">Subscribe to a Node</a> and <a href="#subscriber-unsubscribe">Unsubscribe from a Node</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">subscription-options</td>
      <td align="" colspan="" rowspan="">Configuration of subscription options is supported.</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#subscriber-configure">Configure Subscription Options</a></td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">subscription-notifications</td>
      <td align="" colspan="" rowspan="">Notification of subscription state changes is supported.</td>
      <td align="" colspan="" rowspan="">OPTIONAL</td>
      <td align="" colspan="" rowspan=""><a href="#impl-subchange">Notification of Subscription State Changes</a></td>
    </tr>
  </table></figure>
<h2 id="errors">11.
       Error Conditions<a class="anchor-link" href="#errors"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <figure class="table"><figcaption id="table-8"><strong>Table 8:</strong> Error conditions and typical causes<a class="anchor-link" href="#table-8"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><table>
    <tr class="body">
      <th colspan="" rowspan="">Condition</th>
      <th colspan="" rowspan="">Description</th>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">&lt;conflict/&gt;</td>
      <td align="" colspan="" rowspan="">The node already exists.</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">&lt;feature-not-implemented/&gt;</td>
      <td align="" colspan="" rowspan="">The operation being attempted on a node (or the system) has failed because the service or node does not support the operation; the error SHOULD also specify which feature is unsupported.</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">&lt;forbidden/&gt;</td>
      <td align="" colspan="" rowspan="">An entity does not have sufficient privileges to perform the action, is requesting an operation for another Jabber ID (e.g., francisco@denmark.lit attempts to subscribe bernardo@denmark.lit to a node), or the requesting entity has an affiliation of "outcast".</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">&lt;item-not-found/&gt;</td>
      <td align="" colspan="" rowspan="">The node or item specified for some operation does not exist.</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">&lt;not-allowed/&gt;</td>
      <td align="" colspan="" rowspan="">An entity has attempted to perform an action which the service implements; however the service-wide admin or the node owner has disabled the action for that service or node.</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">&lt;not-authorized/&gt;</td>
      <td align="" colspan="" rowspan="">An entity has attempted to subscribe to or retrieve items from a node but is not authorized to see the account owner's presence, is not in the appropriate roster group, or is not on the whitelist for subscriptions.</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">&lt;payment-required/&gt;</td>
      <td align="" colspan="" rowspan="">Subscriptions and item retrieval are based on some kind payment service. Payments would be done out-of-band using some agreed-upon method (not defined herein).</td>
    </tr>
    <tr class="body">
      <td align="" colspan="" rowspan="">&lt;registration-required/&gt;</td>
      <td align="" colspan="" rowspan="">Entities are required to register before node creation is allowed.</td>
    </tr>
  </table></figure>
  <p class="" style="">Note: Refer to <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0086.html">Error Condition Mappings (XEP-0086)</a></span>  [<a href="#nt-idm2144">26</a>] for more information regarding error syntax.</p>
<h2 id="impl">12.
       Implementation Notes<a class="anchor-link" href="#impl"><abbr title="Link to this point in the document">¶</abbr></a></h2>

  <div class="indent"><h3 id="impl-notify">12.1 Notification Triggers<a class="anchor-link" href="#impl-notify"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">There are many possible triggers for sending an event notification to an entity for the currently published item or the last published item, as summarized below:</p>
    <ol start="" class="" style="">
      <li class="" style="">The entity explicitly requests one or more items from the node and is authorized to retrieve items; when the service receives such a request, it sends the items to the entity.</li>
      <li class="" style="">The entity is an authorized subscriber to the node (explicitly via subscription or implicitly based on a role of owner or publisher); when the publisher sends a publish request, the service sends the currently published item to the entity (subject to presence checks and notification filtering if appropriate).</li>
      <li class="" style="">The entity is not subscribed but is eligible to do so and has sent presence containing appropriate entity capabilities data to a service that supports filtered notifications (effectively establishing a "temporary subscription" based on an expressed notification interest); when the service first receives such presence, it sends the last published item to the entity (sending it only once upon first receiving such presence, not on subsequent presence updates that contain the same notification interest).</li>
      <li class="" style="">The entity is not subscribed but is eligible to do so and has sent presence containing appropriate entity capabilities data to a service that supports filtered notifications (effectively establishing a "temporary subscription"); when the publisher sends a publish request that matches the entity's expressed notification interest, the service sends the currently published item to the entity.</li>
      <li class="" style="">The entity gains access to the node because of a change to the node access model; as a result, the service sends the last published item to the entity.</li>
      <li class="" style="">The entity is added to the roster group associated with a node access model of "roster"; as a result, the service sends the last published item to the entity.</li>
    </ol>
  </div>

  <div class="indent"><h3 id="impl-recipients">12.2 Intended Recipients for Notifications<a class="anchor-link" href="#impl-recipients"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">When a pubsub service generates notifications, it MUST adhere to the delivery rules implicit in the subscription option configuration for each subscriber. In particular, the 'to' address SHOULD be that of the subscribed JID only. The service SHOULD NOT attempt to guess at the most available resource associated with the subscribed JID (e.g., in the context of instant messaging systems).</p>
  </div>

  <div class="indent"><h3 id="impl-bounce">12.3 Handling Notification-Related Errors<a class="anchor-link" href="#impl-bounce"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">As noted above, a pubsub service SHOULD ensure that the &lt;message/&gt; stanza for each event notification it generates possesses an 'id' attribute with a value. (This notification ID is not to be confused with either the node ID or the item ID.) This ID MUST be unique within the context of the pubsub service in order to ensure proper tracking of any delivery-related errors.</p>
    <p class="" style="">Exactly how a service shall handle delivery-related errors is a matter of implementation. In general, such handling is effectively similar to the bounce processing performed by other message delivery systems, such as mail transfer agents and mailing list software. The following are some suggested guidelines regarding the handling of XMPP-specific error conditions in relation to pubsub event notifications (see <span class="ref">RFC 3920</span> and <span class="ref">XEP-0086</span> regarding XMPP error condition semantics):</p>
    <ul class="" style="">
      <li class="" style="">If the XMPP error is of type "cancel" (e.g., &lt;item-not-found/&gt;), or the error condition is &lt;gone/&gt;, the pubsub service SHOULD terminate the subscription of the entity to that node and MAY terminate the subscription of that entity to all nodes hosted at the service.</li>
      <li class="" style="">If the XMPP error is of type "auth" (e.g., &lt;registration-required/&gt;) or "wait" (e.g., &lt;remote-server-timeout/&gt;), or the error condition is &lt;bad-request/&gt;, &lt;redirect/&gt;, or &lt;not-acceptable/&gt;, the pubsub service SHOULD increment a bounce counter for that entity and MAY attempt to resend the event notification after some configurable amount of time. The service MAY terminate the subscription of the entity to that node if the bounce counter has reached some configurable limit.</li>
    </ul>
  </div>

  <div class="indent"><h3 id="impl-tempsub">12.4 Temporary Subscriptions<a class="anchor-link" href="#impl-tempsub"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">An implementation MAY enable an entity to subscribe to a node temporarily, i.e., only for as long as the subscriber is online in its current presence session. To subscribe temporarily, the subscriber MUST set the "pubsub#expire" subscription configuration option to a literal value of "presence".</p>
    <figure class="code-example" id="example-216"><figcaption><strong>Example 216.</strong> A Temporary Subscription<a class="anchor-link" href="#example-216"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='lease3'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;options node='princely_musings' jid='francisco@denmark.lit'&gt;
        &lt;x xmlns='jabber:x:data' type='submit'&gt;
          &lt;field var='FORM_TYPE' type='hidden'&gt;
            &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
          &lt;/field&gt;
          ...
          &lt;field var='pubsub#expire'&gt;&lt;value&gt;presence&lt;/value&gt;&lt;/field&gt;
          ...
        &lt;/x&gt;
     &lt;/options&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">The service will then automatically cancel the subscription when it receives presence of type "unavailable" from the subscriber.</p>
    <p class="" style="">An implementation MAY enable the node owner to force all subscriptions to be temporary, which is useful for nodes that are also configured to use presence-based delivery. This setting uses the "pubsub#tempsub" node configuration option set to a value of true.</p>
    <figure class="code-example" id="example-217"><figcaption><strong>Example 217.</strong> Owner sets all subscriptions to temporary<a class="anchor-link" href="#example-217"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='hamlet@denmark.lit/elsinore'
    to='pubsub.shakespeare.lit'
    id='configtemp'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;configure node='princely_musings'&gt;
      &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#tempsub'&gt;&lt;value&gt;true&lt;/value&gt;&lt;/field&gt;
      &lt;/x&gt;
    &lt;/configure&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
  </div>

  <div class="indent"><h3 id="impl-presence">12.5 Presence-Based Delivery of Events<a class="anchor-link" href="#impl-presence"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">Implementations of pubsub MAY deliver event notifications only when the subscriber is online. In these cases, the option may be a node configuration option as shown in the examples above. To facilitate this, the pubsub service needs to subscribe to the subscriber's presence and check the subscriber's current presence information before sending any event notifications (as described in <span class="ref">RFC 3921</span>). Presence subscriptions MUST be based on the subscribed JID.</p>
  </div>

  <div class="indent"><h3 id="impl-offline">12.6 Not Routing Events to Offline Storage<a class="anchor-link" href="#impl-offline"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">Sending events to users of existing XMPP servers may force event notifications to be routed to offline storage for later delivery (as described in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0160.html">Best Practices for Handling Offline Messages (XEP-0160)</a></span>  [<a href="#nt-idm2179">27</a>]). This may not always be desirable. The possible ways of preventing this behavior include:</p>
    <ul class="" style="">
      <li class="" style="">Use presence-based subscription options as described above.</li>
      <li class="" style="">Use delivery semantics as defined by <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0079.html">Advanced Message Processing (XEP-0079)</a></span>  [<a href="#nt-idm2186">28</a>].</li>
      <li class="" style="">Specify a message type of "headline", which in most existing server implementations will prevent offline storage.</li>
    </ul>
  </div>

  <div class="indent"><h3 id="impl-body">12.7 Including a Message Body<a class="anchor-link" href="#impl-body"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">If a service understands the semantics for a particular payload type and an entity's subscription is so configured (by the "pubsub#include_body" subscription option to true), the service SHOULD include an appropriate XMPP &lt;body/&gt; child element along with the payloads it sends in event notifications for a given node, where the body's XML character data summarizes or represents the information contained in the payload (this enables clients that do not understand the payload format to present the appropriate information to an end user). For example, the Atom &lt;summary/&gt; element (see <span class="ref">RFC 4287</span>) could be mapped to the XMPP &lt;body/&gt; element. A service MUST NOT provide the "pubsub#include_body" subscription option for a node if it does not have a defined way to transform part or all of the payload format into a sensible message body. A node owner MAY define an XSLT for transforming the payload format into a message body, via the "pubsub#body_xslt" node configuration option. This XSLT is applied by the pubsub service after receiving a publish request and before sending the appropriate notifications, not by the client before sending a publish request.</p>
    <p class="" style="">If the service does not understand the semantics for a particular payload type and therefore cannot transform the payload into a human-readable message body, it SHOULD NOT include a &lt;body/&gt; child.</p>
    <p class="" style="">If a subscriber has multiple subscriptions to the same node, where some of the SubIDs have include_body set to true and others have include_body set to false, the service SHOULD include a body with all notifications.</p>
  </div>

  <div class="indent"><h3 id="impl-uniqueness">12.8 Node ID and Item ID Uniqueness<a class="anchor-link" href="#impl-uniqueness"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">NodeIDs MUST be treated as unique identifiers within the context of a particular pubsub service.</p>
    <p class="" style="">If item identifiers are used, they MUST be treated as unique within the scope of the node. The combination of the NodeID + ItemID MUST be unique within a given service, and MUST specify a single published item at a single node.</p>
    <p class="" style="">If a publisher publishes an item and the ItemID matches that of an existing item, the pubsub service MUST overwrite the existing item and generate a new event notification.</p>
    <p class="" style="">Because it is possible for a node's configuration to change such that ItemIDs are required (e.g., a change from transient to persistent), a service SHOULD use ItemIDs for internal tracking purposes even if it does not include them with the notifications it generates prior to the configuration change.</p>
  </div>

  <div class="indent"><h3 id="impl-caching">12.9 Item Caching<a class="anchor-link" href="#impl-caching"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A service MAY cache the last item published to a node, even if the node is configured for transient publication (i.e., configured to not persist items). The last published item SHOULD be sent to new subscribers upon successful processing of a subscription request or approval by a node owner.</p>
    <p class="" style="">Note: Particular profiles of the generic publish-subscribe protocol MAY define more stringent requirements regarding the "cache-last-item" feature.</p>
  </div>

  <div class="indent"><h3 id="impl-batch">12.10 Batch Processing<a class="anchor-link" href="#impl-batch"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A publisher MAY include multiple &lt;item/&gt; elements in a publish request and MAY include multiple &lt;item/&gt; elements in a retract request. This results in "batch processing" of publications or retractions.</p>
    <p class="" style="">If the service cannot process any one of the items to be published or retracted, the entire batch MUST fail and the service MUST NOT publish or retract any of the items.</p>
    <p class="" style="">If a batch publish contains so many items that publication of all the items would exceed the maximum number of items for the node, the service MUST return a &lt;not-allowed/&gt; error, which SHOULD also include a pubsub-specific error condition of &lt;max-items-exceeded/&gt;.</p>
    <p class="" style="">Note: Batch publication renders the concept of "last published item" problematic; therefore, if information coherence is needed, a publisher SHOULD publish items in separate requests rather than in batch mode.</p>
  </div>

  <div class="indent"><h3 id="impl-autosubscribe">12.11 Auto-Subscribing Owners and Publishers<a class="anchor-link" href="#impl-autosubscribe"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A service MUST allow owners and publishers to subscribe to a node, and to retrieve items from a node even if they are not subscribed. A service MAY auto-subscribe owners and publishers if they are not already subscribed, in which case it SHOULD generate a subscription ID if necessary for the subscription and SHOULD send a notification of successful subscription as described in the <a href="#impl-subchange">Notification of Subscription State Changes</a> section of this document.</p>
  </div>

  <div class="indent"><h3 id="impl-authorize">12.12 Authorizing Subscription Requests (Pending Subscribers)<a class="anchor-link" href="#impl-authorize"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">How subscription requests are sent to node owners is a matter of implementation. Possibilities include:</p>
    <ul class="" style="">
      <li class="" style="">Send requests to all owners (these may be placed in offline storage as described in <span class="ref">XEP-0160</span>) and first approval wins.</li>
      <li class="" style="">The service could subscribe to owner presence, and send only to the owners that are online.</li>
      <li class="" style="">All owners vote on the new subscriber.</li>
      <li class="" style="">Any owner is allowed to veto the subscriber.</li>
    </ul>
    <p class="" style="">An implementation MAY use any of these methods, or some other method not defined herein.</p>
  </div>

  <div class="indent"><h3 id="impl-subchange">12.13 Notification of Subscription State Changes<a class="anchor-link" href="#impl-subchange"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">Various actions and events may result in changes to a subscription state:</p>
    <ul class="" style="">
      <li class="" style=""><p class="" style="">Approval or denial of a subscription request as described in the <a href="#owner-subreq">Manage Subscription Requests</a> use case</p></li>
      <li class="" style=""><p class="" style="">Cancellation of an existing subscription, for which many "triggers" are possible:</p>
        <ul class="" style="">
          <li class="" style="">The entity simply unsubscribes from the node</li>
          <li class="" style="">The node is of type "presence" and the underlying presence subscription is cancelled</li>
          <li class="" style="">The node is of type "roster" and the entity is moved to an unauthorized roster group</li>
        </ul>
      </li>
    </ul>
    <p class="" style="">When a subscription state change occurs, a service SHOULD send a message to the (new, former, or denied) subscriber informing it of the change, where the message contains an &lt;event/&gt; element with a single &lt;subscription/&gt; child that specifies the node, JID, and subscription state. The notification MAY contain a &lt;body/&gt; element specifying natural-language text regarding the subscription change. The JID to which the service sends the notification is the address that was set in the 'jid' attribute of the subscription request. Examples are shown below.</p>
    <figure class="code-example" id="example-218"><figcaption><strong>Example 218.</strong> Subscription approval notification<a class="anchor-link" href="#example-218"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message
    from='pubsub.shakespeare.lit'
    to='horatio@denmark.lit'
    id='approvalnotify1'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;subscription node='princely_musings' jid='horatio@denmark.lit' subscription='subscribed'/&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
    <figure class="code-example" id="example-219"><figcaption><strong>Example 219.</strong> Subscription cancellation / denial notification<a class="anchor-link" href="#example-219"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message
    from='pubsub.shakespeare.lit'
    to='horatio@denmark.lit'
    id='unsubnotify1'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;subscription node='princely_musings' jid='horatio@denmark.lit' subscription='none'/&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
    <p class="" style="">If the service has knowledge of the (former or denied) subscriber's presence, it SHOULD send the message to all of the subscriber's resources; if not, it MUST send the message to the subscriber's affiliated JID.</p>
    <p class="" style="">If a service or node supports this feature, it MUST return a feature of "subscription-notifications" in its response to service discovery information requests.</p>
  </div>

  <div class="indent"><h3 id="impl-semantics">12.14 NodeID Semantics<a class="anchor-link" href="#impl-semantics"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">NodeIDs MAY have semantic meaning in particular profiles, implementations, or deployments of pubsub. However, it is STRONGLY RECOMMENDED that such semantic meaning not be used to encapsulate the hierarchical structure of nodes; instead, node hierarchy SHOULD be encapsulated using collections and their associated child nodes as described in <span class="ref">XEP-0248</span>.</p>
  </div>

  <div class="indent"><h3 id="impl-shim">12.15 Inclusion of SHIM Headers<a class="anchor-link" href="#impl-shim"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">When SubIDs are used, <span class="ref">Stanza Headers and Internet Metadata (SHIM)</span> headers are to be included in order to differentiate notifications sent regarding a particular subscription. The relevant use cases and scenarios are:</p>
    <ul class="" style="">
      <li class="" style="">Sending notifications regarding newly-published items as described in the <a href="#publisher-publish">Publish an Item to a Node</a> use case.</li>
      <li class="" style="">Sending notifications regarding deleted items as described in the <a href="#publisher-delete">Delete an Item from a Node</a> use case.</li>
    </ul>
    <p class="" style="">The SHIM headers are generated by the node to which the subscriber has a subscription, which may be either a leaf node or a collection node (refer to <span class="ref">XEP-0248</span>).</p>
    <p class="" style="">SHIM headers are not to be included when the content does not differ based on subscription ID, e.g., when a node sends notification of a configuration change to the node itself, notification that the node has been purged, or notification that the node has been deleted.</p>
  </div>

  <div class="indent"><h3 id="impl-association">12.16 Associating Events and Payloads with the Generating Entity<a class="anchor-link" href="#impl-association"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">An implementation MAY enable the node configuration to specify an association between the event notification and the entity to which the published information pertains, but such a feature is OPTIONAL. Here are some possible examples:</p>
    <ul class="" style="">
      <li class="" style="">In the context of a geolocation notification service using <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0080.html">User Geolocation (XEP-0080)</a></span>  [<a href="#nt-idm1806">22</a>], the user may generate the geolocation information or the information may be generated by an automated service (e.g., a service offered by a mobile telephony provider), but in either case the information is <em>about</em> the user's geolocation and therefore all replies should go to the user (who is probably the node owner).</li>
      <li class="" style="">In the context of a group weblog, different users might publish to the weblog and replies might go to the publisher of an entry rather than to the weblog owner.</li>
      <li class="" style="">In the context of an integrated pubsub and multi-user chat system, the node owner might be the room owner but all replies need to be sent to the room rather than to the owner.</li>
    </ul>
    <p class="" style="">Therefore we define the "itemreply" node configuration option, with two possible values:</p>
    <ul class="" style="">
      <li class="" style="">"owner" (i.e., the node owner or an alias for the node owners)</li>
      <li class="" style="">"publisher" (i.e., the item publisher)</li>
    </ul>
    <p class="" style="">A node owner MUST NOT define more than one of these options.</p>
    <p class="" style="">An example is shown below.</p>
    <figure class="code-example" id="example-220"><figcaption><strong>Example 220.</strong> Event notification with publisher JID<a class="anchor-link" href="#example-220"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit'
         to='bassanio@merchantofvenice.lit'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='n48ad4fj78zn38st734'&gt;
      &lt;item id='i1s2d3f4g5h6bjeh936'
            publisher='portia@merchantofvenice.lit'&gt;
        &lt;geoloc xmlns='http://jabber.org/protocol/geoloc'&gt;
          &lt;description&gt;Venice&lt;/description&gt;
          &lt;lat&gt;45.44&lt;/lat&gt;
          &lt;lon&gt;12.33&lt;/lon&gt;
        &lt;/geoloc&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
    <p class="" style="">Alternatively, if a service implements the personal eventing subset of this protocol, the virtual pubsub service is the account owner's bare JID and notifications are sent from that JID; for details, refer to <span class="ref">XEP-0163</span>.</p>
  </div>

  <div class="indent"><h3 id="impl-chaining">12.17 Chaining<a class="anchor-link" href="#impl-chaining"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The word "chaining" refers to the practice of subscribing one node to another node. For instance, consider a scenario in which the node &lt;pubsub@example.net/NewsBroadcaster&gt; wants to distribute information received from the node "NewsFeed" at &lt;pubsub.example.com&gt;. While it is theoretically possible for &lt;pubsub@example.net/NewsBroadcaster&gt; to directly subscribe to the NewsFeed node (since the former node is directly addressable as a JID), implementations MUST NOT chain nodes in this fashion. Instead, implementations MUST subscribe from the address of the pubsub service rather than the node (in the example shown here, the subscription would be sent from &lt;pubsub@example.net&gt; rather than &lt;pubsub@example.net/NewsBroadcaster&gt;).</p>

  </div>

  <div class="indent"><h3 id="impl-leases">12.18 Time-Based Subscriptions (Leases)<a class="anchor-link" href="#impl-leases"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">In some systems it may be desirable to provide a subscription "leasing" feature in order to expire old or stale subscriptions. Leases can be implemented using configurable subscription options; specifically, when an entity subscribes, the service would require configuration of subscription options and the configuration form would contain a field of "pubsub#expire". This field MUST contain a dateTime (as specified in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0082.html">XMPP Date and Time Profiles (XEP-0082)</a></span>  [<a href="#nt-idm2276">29</a>]).</p>
    <p class="" style="">The leasing process is shown below.</p>
    <figure class="code-example" id="example-221"><figcaption><strong>Example 221.</strong> Leasing process<a class="anchor-link" href="#example-221"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='lease1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscribe
        node='princely_musings'
        jid='francisco@denmark.lit'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='lease1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscription
        node='princely_musings'
        jid='francisco@denmark.lit'
        subscription='unconfigured'&gt;
      &lt;subscribe-options&gt;
        &lt;required/&gt;
      &lt;/subscribe-options&gt;
    &lt;/subscription&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='lease2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;options node='princely_musings' jid='francisco@denmark.lit'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='lease2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;options node='princely_musings' jid='francisco@denmark.lit'&gt;
      &lt;x xmlns='jabber:x:data' type='form'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
        &lt;/field&gt;
        ...
        &lt;field var='pubsub#expire' type='text-single'
               label='Requested lease period'/&gt;
        ...
      &lt;/x&gt;
    &lt;/options&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq type='set'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='lease3'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;options node='princely_musings' jid='francisco@denmark.lit'&gt;
        &lt;x xmlns='jabber:x:data' type='submit'&gt;
          &lt;field var='FORM_TYPE' type='hidden'&gt;
            &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
          &lt;/field&gt;
          ...
          &lt;field var='pubsub#expire'&gt;&lt;value&gt;2006-02-28T11:59:59Z&lt;/value&gt;&lt;/field&gt;
          ...
        &lt;/x&gt;
     &lt;/options&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='lease3'/&gt;
</pre></figure>
    <p class="" style="">The service MAY send a message to the subscriber when the lease is almost over (e.g., 24 hours before the end of the lease term). This MUST be done by sending a &lt;message/&gt; containing a &lt;subscription/&gt; element qualified by the 'http://jabber.org/protocol/pubsub#event' namespace and including an 'expiry' attribute.</p>
    <figure class="code-example" id="example-222"><figcaption><strong>Example 222.</strong> Service notifies subscriber of impending lease end<a class="anchor-link" href="#example-222"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit' to='francisco@denmark.lit/barracks'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;subscription
        expiry='2006-02-28T23:59:59Z'
        jid='francisco@denmark.lit'
        node='princely_musings'
        subid='ba49252aaa4f5d320c24d3766f0bdcade78c78d3'
        subscription='subscribed'/&gt;
  &lt;/event&gt;
&lt;/message&gt;
</pre></figure>
    <p class="" style="">When the subscriber wants to renew the lease, it would get the current subscription options, change the value of the "pubsub#expire" field, and submit the new subscription options back to the service. If the new expire value exceeds the maximum value allowed for subscription leases, the service MUST change the value of the field to be the current date/time plus the maximum allowed lease period.</p>
    <figure class="code-example" id="example-223"><figcaption><strong>Example 223.</strong> Renewing a lease<a class="anchor-link" href="#example-223"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='get'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='renew1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;options node='princely_musings' jid='francisco@denmark.lit'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='renew1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;options node='princely_musings' jid='francisco@denmark.lit'&gt;
      &lt;x xmlns='jabber:x:data' type='form'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
        &lt;/field&gt;
        ...
        &lt;field var='pubsub#expire' type='text-single'
               label='Requested lease period'/&gt;
        ...
      &lt;/x&gt;
    &lt;/options&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq type='set'
    from='francisco@denmark.lit/barracks'
    to='pubsub.shakespeare.lit'
    id='renew2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;options node='princely_musings' jid='francisco@denmark.lit'&gt;
        &lt;x xmlns='jabber:x:data' type='submit'&gt;
          &lt;field var='FORM_TYPE' type='hidden'&gt;
            &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
          &lt;/field&gt;
          ...
          &lt;field var='pubsub#expire'&gt;&lt;value&gt;2006-03-31T23:59:59Z&lt;/value&gt;&lt;/field&gt;
          ...
        &lt;/x&gt;
     &lt;/options&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='francisco@denmark.lit/barracks'
    id='renew2'/&gt;
</pre></figure>
  </div>

  <div class="indent"><h3 id="impl-content">12.19 Content-Based Pubsub Systems<a class="anchor-link" href="#impl-content"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A service MAY enable entities to subscribe to nodes and apply a filter to notifications (e.g., keyword matching such as "send me all news entries from Slashdot that match the term 'XMPP'"). Such a content-based service SHOULD allow an entity to subscribe more than once to the same node and, if so, MUST use subscription identifiers (SubIDs) to distinguish between multiple subscriptions. In order to prevent collisions, a service that supports content-based subscriptions using SubIDs SHOULD generate SubIDs on behalf of subscribers rather than allowing subscribers to set their own SubIDs.  [<a href="#nt-idm2286">30</a>]</p>
    <p class="" style="">Content-based services SHOULD use subscription options to specify the filter(s) to be applied. Because there many possible filtering mechanisms (many of which may be application-specific), this document does not define any such method. However, filtering mechanisms may be defined in separate specifications.</p>
    <p class="" style="">A fictional example of the subscription options configuration process for content-based pubsub is shown below.</p>
    <figure class="code-example" id="example-224"><figcaption><strong>Example 224.</strong> A content-based subscription<a class="anchor-link" href="#example-224"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='bard@shakespeare.lit/globe'
    to='pubsub.shakespeare.lit'
    id='filter1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscribe
        node='princely_musings'
        jid='francisco@denmark.lit'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='bard@shakespeare.lit/globe'
    id='filter1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscription
        node='princely_musings'
        jid='bard@shakespeare.lit'
        subid='991d7fd1616fd041015064133cd097a10030819e'
        subscription='unconfigured'&gt;
      &lt;subscribe-options&gt;
        &lt;required/&gt;
      &lt;/subscribe-options&gt;
    &lt;/subscription&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq type='get'
    from='bard@shakespeare.lit/globe'
    to='pubsub.shakespeare.lit'
    id='filter2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;options node='princely_musings'
             jid='bard@shakespeare.lit'
             subid='991d7fd1616fd041015064133cd097a10030819e'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='bard@shakespeare.lit/globe'
    id='filter2'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;options node='princely_musings'
             jid='bard@shakespeare.lit'
             subid='991d7fd1616fd041015064133cd097a10030819e'&gt;
      &lt;x xmlns='jabber:x:data' type='form'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
        &lt;/field&gt;
        ...
        &lt;field var='x-http://shakespeare.lit/search#keyword'
               type='text-single'
               label='Keyword to match'/&gt;
        ...
      &lt;/x&gt;
    &lt;/options&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq type='set'
    from='bard@shakespeare.lit/globe'
    to='pubsub.shakespeare.lit'
    id='filter3'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;options node='princely_musings'
             jid='bard@shakespeare.lit'
             subid='991d7fd1616fd041015064133cd097a10030819e'&gt;
        &lt;x xmlns='jabber:x:data' type='submit'&gt;
          &lt;field var='FORM_TYPE' type='hidden'&gt;
            &lt;value&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/value&gt;
          &lt;/field&gt;
          ...
          &lt;field var='x-http://shakespeare.lit/search#keyword'&gt;&lt;value&gt;peasant&lt;/value&gt;&lt;/field&gt;
          ...
        &lt;/x&gt;
     &lt;/options&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;

&lt;iq type='result'
    from='pubsub.shakespeare.lit'
    to='bard@shakespeare.lit/globe'
    id='filter3'/&gt;
</pre></figure>
    <p class="" style="">The subscriber will then be notified about events that match the keyword.</p>
    <figure class="code-example" id="example-225"><figcaption><strong>Example 225.</strong> Event notification for matched keyword<a class="anchor-link" href="#example-225"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;message from='pubsub.shakespeare.lit' to='bard@shakespeare.lit'&gt;
  &lt;event xmlns='http://jabber.org/protocol/pubsub#event'&gt;
    &lt;items node='princely_musings'&gt;
      &lt;item id='4e30f35051b7b8b42abe083742187228'&gt;
        &lt;entry xmlns='http://www.w3.org/2005/Atom'&gt;
          &lt;title&gt;Alone&lt;/title&gt;
          &lt;summary&gt;
Now I am alone.
O, what a rogue and peasant slave am I!
          &lt;/summary&gt;
          &lt;link rel='alternate' type='text/html'
                href='http://denmark.lit/2003/12/13/atom03'/&gt;
          &lt;id&gt;tag:denmark.lit,2003:entry-32396&lt;/id&gt;
          &lt;published&gt;2003-12-13T11:09:53Z&lt;/published&gt;
          &lt;updated&gt;2003-12-13T11:09:53Z&lt;/updated&gt;
        &lt;/entry&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/event&gt;
  &lt;headers xmlns='http://jabber.org/protocol/shim'&gt;
    &lt;header name='SubID'&gt;991d7fd1616fd041015064133cd097a10030819e&lt;/header&gt;
  &lt;/headers&gt;
&lt;/message&gt;
</pre></figure>
  </div>
  <div class="indent"><h3 id="impl-singleton">12.20 Singleton Nodes<a class="anchor-link" href="#impl-singleton"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">For some nodes, it is desirable to have at most one item associated with the node at any one time (for example, a client may want to store its preferences using a node name that is a namespace controlled by that client). When this pattern is desired, it is RECOMMENDED for the publisher to specify an ItemID of "current" to ensure that the publication of a new item will overwrite the existing item.</p>
    <figure class="code-example" id="example-226"><figcaption><strong>Example 226.</strong> Publishing to a Singleton Node<a class="anchor-link" href="#example-226"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq type='set'
    from='horatio@denmark.lit/mobile'
    to='pubsub.shakespeare.lit'
    id='single1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='elsinore-doorbell'&gt;
      &lt;item id='current'/&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">Naturally, the node owner can enforce the singleton node pattern by setting the max_items configuration option to "1".</p>
  </div>
  <div class="indent"><h3 id="impl-uri">12.21 PubSub URIs<a class="anchor-link" href="#impl-uri"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">An XMPP URI (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc5122">RFC 5122</a></span>  [<a href="#nt-idm2300">31</a>]) can be used for the purpose of identification or interaction. Some examples are provided below.</p>
    <p class="" style="">The following URI merely identifies a pubsub node.</p>
    <figure class="code-example" id="example-227"><figcaption><strong>Example 227.</strong> XMPP URI for a node<a class="anchor-link" href="#example-227"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
xmpp:pubsub.shakespeare.lit?;node=princely_musings
</pre></figure>
    <p class="" style="">The following URI identifies a specific item at a node.</p>
    <figure class="code-example" id="example-228"><figcaption><strong>Example 228.</strong> XMPP URI for a pubsub item<a class="anchor-link" href="#example-228"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
xmpp:pubsub.shakespeare.lit?;node=princely_musings;item=ae890ac52d0df67ed7cfdf51b644e901
</pre></figure>
    <p class="" style="">The following URI defines how to subscribe to a node (for details, see the <a href="#registrar-querytypes">URI Query Types</a> section of this document).</p>
    <figure class="code-example" id="example-229"><figcaption><strong>Example 229.</strong> URI for subscribing to a pubsub node<a class="anchor-link" href="#example-229"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
xmpp:pubsub.shakespeare.lit?pubsub;action=subscribe;node=princely_musings
</pre></figure>
    <p class="" style="">The following URI defines how to retrieve a specific item from a node.</p>
    <figure class="code-example" id="example-230"><figcaption><strong>Example 230.</strong> URI for retrieving a pubsub item<a class="anchor-link" href="#example-230"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
xmpp:pubsub.shakespeare.lit?pubsub;action=retrieve;node=princely_musings;item=ae890ac52d0df67ed7cfdf51b644e901
</pre></figure>
  </div>

  <div class="indent"><h3 id="usecase.xdata">12.22 Integration with Data Forms<a class="anchor-link" href="#usecase.xdata"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">This section defines a datatype "integer-or-max" to be used with <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0122.html">Data Forms Validation (XEP-0122)</a></span>  [<a href="#nt-idm2315">32</a>]. An implementation may use this type to validate fields such as "pubsub#children_max", "pubsub#item_expire" or "pubsub#max_items".</p>
    <figure class="code"><figcaption></figcaption><pre class="prettyprint">
&lt;xs:schema xmlns:xs='http://www.w3.org/2001/XMLSchema' targetNamespace="http://jabber.org/protocol/pubsub#integer-or-max"&gt;
  &lt;xs:simpleType name='integer-or-max'&gt;
    &lt;xs:union&gt;
      &lt;xs:simpleType&gt;
        &lt;xs:restriction base='integer'/&gt;
      &lt;/xs:simpleType&gt;
      &lt;xs:simpleType&gt;
        &lt;xs:restriction base='string'&gt;
          &lt;xs:enumeration value='max'/&gt;
        &lt;/xs:restriction&gt;
      &lt;/xs:simpleType&gt;
    &lt;/xs:union&gt;
  &lt;/xs:simpleType&gt;
&lt;/xs:schema&gt;
</pre></figure>
    <p class="" style="">The meaning of a value of this type is defined in each field named above.</p>
    <p class="" style="">When the <a href="xep-0122.html#usecases-validation.range">&lt;range/&gt; element</a> is used in combination with this datatype, it applies to the integer value.</p>
  </div>

<h2 id="i18n">13.
       Internationalization Considerations<a class="anchor-link" href="#i18n"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="i18n-formtypes">13.1 Field Labels<a class="anchor-link" href="#i18n-formtypes"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The Data Forms shown in this specification include English-language labels for various fields; implementations that will display such forms to human users SHOULD provide localized label text for fields that are defined for the registered FORM_TYPEs.</p>
  </div>
<h2 id="security">14.
       Security Considerations<a class="anchor-link" href="#security"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="security-privacy">14.1 Private Information<a class="anchor-link" href="#security-privacy"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The data published to a pubsub node might contain sensitive information (e.g., a user's geolocation). Therefore, node owners SHOULD exercise care in approving subscription requests. Security considerations regarding particular kinds of information are the responsibility of the "using protocol".</p>
  </div>
  <div class="indent"><h3 id="security-authorization">14.2 Authorization<a class="anchor-link" href="#security-authorization"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">XMPP PubSub contains a hierarchy of affiliations for the purpose of authorization and access control. A service MUST NOT allow non-owners or other unauthorized entities to complete any actions defined under the <a href="#owner">Owner Use Cases</a> section of this document.</p>
  </div>
  <div class="indent"><h3 id="security-access">14.3 Access Models<a class="anchor-link" href="#security-access"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A service MUST adhere to the defined access model in determining whether to send event notifications or payloads to an entity, or allow an entity to retrieve items from a node. A service MAY enforce additional privacy and security policies when determining whether an entity is allowed to subscribe to a node or retrieve items from a node; however, any such policies shall be considered specific to an implementation or deployment and are out of scope for this document.</p>
  </div>
  <div class="indent"><h3 id="security-presence">14.4 Presence Leaks<a class="anchor-link" href="#security-presence"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">In the context of instant messaging systems it is possible for the act of publishing an item to reveal the node owner or item publisher's network availability. However, this risk is mitigated by the following factors:</p>
    <ol start="" class="" style="">
      <li class="" style="">A node does not necessarily reveal the existence of the publishing entity.</li>
      <li class="" style="">XMPP PubSub systems are not necessarily tied to instant messaging systems.</li>
      <li class="" style="">Even in the context of IM systems, a node provides information distinct from network availability (e.g., user tunes).</li>
      <li class="" style="">Even then, the actual publisher might not be an IM user (e.g., an automated calendaring or geolocation system).</li>
    </ol>
  </div>
<h2 id="iana">15.
       IANA Considerations<a class="anchor-link" href="#iana"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">This document does not require interaction with the <span class="ref" style=""><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-idm2343">33</a>].</p>
<h2 id="registrar">16.
       XMPP Registrar Considerations<a class="anchor-link" href="#registrar"><abbr title="Link to this point in the document">¶</abbr></a></h2>

  <div class="indent"><h3 id="registrar-ns">16.1 Protocol Namespaces<a class="anchor-link" href="#registrar-ns"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The <span class="ref" style=""><a href="https://xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-idm2350">34</a>] includes the following namespaces in its registry of protocol namespaces (see &lt;<a href="https://xmpp.org/registrar/namespaces.html">https://xmpp.org/registrar/namespaces.html</a>&gt;):</p>
    <ul class="" style="">
      <li class="" style="">http://jabber.org/protocol/pubsub</li>
      <li class="" style="">http://jabber.org/protocol/pubsub#errors</li>
      <li class="" style="">http://jabber.org/protocol/pubsub#event</li>
      <li class="" style="">http://jabber.org/protocol/pubsub#owner</li>
    </ul>
  </div>

  <div class="indent"><h3 id="registrar-disco">16.2 Service Discovery Category/Type<a class="anchor-link" href="#registrar-disco"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The XMPP Registrar includes a category of "pubsub" in its registry of Service Discovery identities (see &lt;<a href="https://xmpp.org/registrar/disco-categories.html">https://xmpp.org/registrar/disco-categories.html</a>&gt;), as well as three specific types within that category:</p>
    <figure class="table"><figcaption id="table-9"><strong>Table 9:</strong> Service Discovery Types in Pubsub Category<a class="anchor-link" href="#table-9"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><table>
      <tr class="body">
        <td align="" colspan="" rowspan="">collection</td>
        <td align="" colspan="" rowspan="">A pubsub node of the "collection" type as described in XEP-0248.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">leaf</td>
        <td align="" colspan="" rowspan="">A pubsub node of the "leaf" type as described in XEP-0060.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">service</td>
        <td align="" colspan="" rowspan="">A pubsub service that supports the functionality defined in XEP-0060.  [<a href="#nt-idm2371">35</a>]</td>
      </tr>
    </table></figure>
    <p class="" style="">The registry submission is as follows:</p>
    <figure class="code"><figcaption></figcaption><pre class="prettyprint">
&lt;category&gt;
  &lt;name&gt;pubsub&lt;/name&gt;
  &lt;desc&gt;Services and nodes that adhere to XEP-0060.&lt;/desc&gt;
  &lt;type&gt;
    &lt;name&gt;collection&lt;/name&gt;
    &lt;desc&gt;A pubsub node of the "collection" type.&lt;/desc&gt;
    &lt;doc&gt;XEP-0248&lt;/doc&gt;
  &lt;/type&gt;
  &lt;type&gt;
    &lt;name&gt;leaf&lt;/name&gt;
    &lt;desc&gt;A pubsub node of the "leaf" type.&lt;/desc&gt;
    &lt;doc&gt;XEP-0060&lt;/doc&gt;
  &lt;/type&gt;
  &lt;type&gt;
    &lt;name&gt;service&lt;/name&gt;
    &lt;desc&gt;A pubsub service that supports the functionality defined in XEP-0060.&lt;/desc&gt;
    &lt;doc&gt;XEP-0060&lt;/doc&gt;
  &lt;/type&gt;
&lt;/category&gt;
</pre></figure>
    <p class="" style="">Future submissions to the XMPP Registrar may register additional types.</p>
  </div>

  <div class="indent"><h3 id="registrar-features">16.3 Service Discovery Features<a class="anchor-link" href="#registrar-features"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The XMPP Registrar maintains a registry of service discovery features (see &lt;<a href="https://xmpp.org/registrar/disco-features.html">https://xmpp.org/registrar/disco-features.html</a>&gt;), which includes a number of features that may be returned by pubsub services. The following registry submission has been provided to the XMPP Registrar for that purpose.</p>
    <figure class="code"><figcaption></figcaption><pre class="prettyprint">
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#access-authorize&lt;/name&gt;
  &lt;desc&gt;The default node access model is authorize.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#access-open&lt;/name&gt;
  &lt;desc&gt;The default node access model is open.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#access-presence&lt;/name&gt;
  &lt;desc&gt;The default node access model is presence.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#access-roster&lt;/name&gt;
  &lt;desc&gt;The default node access model is roster.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#access-whitelist&lt;/name&gt;
  &lt;desc&gt;The default node access model is whitelist.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#auto-create&lt;/name&gt;
  &lt;desc&gt;The service supports automatic creation of nodes on first publish.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#auto-subscribe&lt;/name&gt;
  &lt;desc&gt;The service supports automatic subscription to a nodes based on presence subscription.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#collections&lt;/name&gt;
  &lt;desc&gt;Collection nodes are supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0248&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#config-node&lt;/name&gt;
  &lt;desc&gt;Configuration of node options is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#config-node-max&lt;/name&gt;
  &lt;desc&gt;Server supports `max` being set as a value for node configuration options: pubsub#max_items, pubsub#item_expire and pubsub#children_max&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#create-and-configure&lt;/name&gt;
  &lt;desc&gt;Simultaneous creation and configuration of nodes is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#create-nodes&lt;/name&gt;
  &lt;desc&gt;Creation of nodes is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#delete-items&lt;/name&gt;
  &lt;desc&gt;Deletion of items is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#delete-nodes&lt;/name&gt;
  &lt;desc&gt;Deletion of nodes is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#filtered-notifications&lt;/name&gt;
  &lt;desc&gt;The service supports filtering of notifications based on Entity Capabilities.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#get-pending&lt;/name&gt;
  &lt;desc&gt;Retrieval of pending subscription approvals is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#instant-nodes&lt;/name&gt;
  &lt;desc&gt;Creation of instant nodes is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#item-ids&lt;/name&gt;
  &lt;desc&gt;Publishers may specify item identifiers.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#last-published&lt;/name&gt;
  &lt;desc&gt;
    The service supports sending of the last published item to new
    subscribers and to newly available resources.
  &lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#leased-subscription&lt;/name&gt;
  &lt;desc&gt;Time-based subscriptions are supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#manage-subscriptions&lt;/name&gt;
  &lt;desc&gt;Node owners may manage subscriptions.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#member-affiliation&lt;/name&gt;
  &lt;desc&gt;The member affiliation is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#meta-data&lt;/name&gt;
  &lt;desc&gt;Node metadata is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#modify-affiliations&lt;/name&gt;
  &lt;desc&gt;Node owners may modify affiliations.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#multi-collection&lt;/name&gt;
  &lt;desc&gt;A single leaf node can be associated with multiple collections.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#multi-items&lt;/name&gt;
  &lt;desc&gt;The service supports the storage of multiple items per node.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#multi-subscribe&lt;/name&gt;
  &lt;desc&gt;A single entity may subscribe to a node multiple times.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#outcast-affiliation&lt;/name&gt;
  &lt;desc&gt;The outcast affiliation is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#persistent-items&lt;/name&gt;
  &lt;desc&gt;Persistent items are supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#presence-notifications&lt;/name&gt;
  &lt;desc&gt;Presence-based delivery of event notifications is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#presence-subscribe&lt;/name&gt;
  &lt;desc&gt;Implicit presence-based subscriptions are supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#publish&lt;/name&gt;
  &lt;desc&gt;Publishing items is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#publish-options&lt;/name&gt;
  &lt;desc&gt;Publication with publish options is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#publish-only-affiliation&lt;/name&gt;
  &lt;desc&gt;The publish-only affiliation is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#publisher-affiliation&lt;/name&gt;
  &lt;desc&gt;The publisher affiliation is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#purge-nodes&lt;/name&gt;
  &lt;desc&gt;Purging of nodes is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#retract-items&lt;/name&gt;
  &lt;desc&gt;Item retraction is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#retrieve-affiliations&lt;/name&gt;
  &lt;desc&gt;Retrieval of current affiliations is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#retrieve-default&lt;/name&gt;
  &lt;desc&gt;Retrieval of default node configuration is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#retrieve-default-sub&lt;/name&gt;
  &lt;desc&gt;Retrieval of default subscription configuration is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#retrieve-items&lt;/name&gt;
  &lt;desc&gt;Item retrieval is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#retrieve-subscriptions&lt;/name&gt;
  &lt;desc&gt;Retrieval of current subscriptions is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#subscribe&lt;/name&gt;
  &lt;desc&gt;Subscribing and unsubscribing are supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#subscription-options&lt;/name&gt;
  &lt;desc&gt;Configuration of subscription options is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
&lt;var&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#subscription-notifications&lt;/name&gt;
  &lt;desc&gt;Notification of subscription state changes is supported.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/var&gt;
</pre></figure>
  </div>

  <div class="indent"><h3 id="registrar-formtypes">16.4 Field Standardization<a class="anchor-link" href="#registrar-formtypes"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">XEP-0068 defines a process for standardizing the fields used within Data Forms scoped by a particular namespace, and the XMPP Registrar maintains a registry of such FORM_TYPES (see &lt;<a href="https://xmpp.org/registrar/formtypes.html">https://xmpp.org/registrar/formtypes.html</a>&gt;). Within pubsub, there are four uses of such forms:</p>
    <ol start="" class="" style="">
      <li class="" style="">Authorization of subscriptions using the 'http://jabber.org/protocol/pubsub#subscribe_authorization' namespace.</li>
      <li class="" style="">Configuration of subscription options using the 'http://jabber.org/protocol/pubsub#subscribe_options' namespace.</li>
      <li class="" style="">Configuration of a node using the 'http://jabber.org/protocol/pubsub#node_config' namespace.</li>
      <li class="" style="">Setting of metadata information using the 'http://jabber.org/protocol/pubsub#meta-data' namespace.</li>
    </ol>
    <p class="" style="">The registry submissions associated with these namespaces are defined below.</p>
    <p class="" style="">Note: There is no requirement that configuration fields need to be registered with the XMPP Registrar. However, as specified in Section 3.4 of <span class="ref">XEP-0068</span>, names of custom (unregistered) fields MUST begin with the characters "x-" if the form itself is scoped by a registered FORM_TYPE.</p>

    <div class="indent"><h4 id="registrar-formtypes-auth">16.4.1 pubsub#subscribe_authorization FORM_TYPE<a class="anchor-link" href="#registrar-formtypes-auth"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <figure class="code"><figcaption></figcaption><pre class="prettyprint">
&lt;form_type&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#subscribe_authorization&lt;/name&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
  &lt;desc&gt;Forms enabling authorization of subscriptions to pubsub nodes&lt;/desc&gt;
  &lt;field
      var='pubsub#allow'
      type='boolean'
      label='Whether to allow the subscription'/&gt;
  &lt;field
      var='pubsub#node'
      type='text-single'
      label='The NodeID of the relevant node'/&gt;
  &lt;field
      var='pubsub#subscriber_jid'
      type='jid-single'
      label='The address (JID) of the subscriber'/&gt;
  &lt;field
      var='pubsub#subid'
      type='text-single'
      label='The subscription identifier associated with the subscription request'/&gt;
&lt;/form_type&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="registrar-formtypes-subscribe">16.4.2 pubsub#subscribe_options FORM_TYPE<a class="anchor-link" href="#registrar-formtypes-subscribe"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <figure class="code"><figcaption></figcaption><pre class="prettyprint">
&lt;form_type&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#subscribe_options&lt;/name&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
  &lt;desc&gt;Forms enabling configuration of subscription options for pubsub nodes&lt;/desc&gt;
  &lt;field
      var='pubsub#deliver'
      type='boolean'
      label='Whether an entity wants to receive
             or disable notifications'/&gt;
  &lt;field
      var='pubsub#digest'
      type='boolean'
      label='Whether an entity wants to receive digests
             (aggregations) of notifications or all
             notifications individually'/&gt;
  &lt;field var='pubsub#digest_frequency'
         type='text-single'
         label='The minimum number of milliseconds between
                sending any two notification digests'/&gt;
  &lt;field
      var='pubsub#expire'
      type='text-single'
      label='The DateTime at which a leased subscription
             will end or has ended'/&gt;
  &lt;field
      var='pubsub#include_body'
      type='boolean'
      label='Whether an entity wants to receive an XMPP
             message body in addition to the payload
             format'/&gt;
  &lt;field
      var='pubsub#show-values'
      type='list-multi'
      label='The presence states for which an entity
             wants to receive notifications'&gt;
    &lt;option label='XMPP Show Value of Away'&gt;
      &lt;value&gt;away&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='XMPP Show Value of Chat'&gt;
      &lt;value&gt;chat&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='XMPP Show Value of DND (Do Not Disturb)'&gt;
      &lt;value&gt;dnd&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Mere Availability in XMPP (No Show Value)'&gt;
      &lt;value&gt;online&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='XMPP Show Value of XA (Extended Away)'&gt;
      &lt;value&gt;xa&lt;/value&gt;
    &lt;/option&gt;
  &lt;/field&gt;
  &lt;field var='pubsub#subscription_type'
         type='list-single'&gt;
    &lt;option label='Receive notification of new items only'&gt;
      &lt;value&gt;items&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Receive notification of new nodes only'&gt;
      &lt;value&gt;nodes&lt;/value&gt;
    &lt;/option&gt;
  &lt;/field&gt;
  &lt;field var='pubsub#subscription_depth'
         type='list-single'&gt;
    &lt;option label='Receive notification from direct child nodes only'&gt;
      &lt;value&gt;1&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Receive notification from all descendent nodes'&gt;
      &lt;value&gt;all&lt;/value&gt;
    &lt;/option&gt;
  &lt;/field&gt;
&lt;/form_type&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="registrar-formtypes-metadata">16.4.3 pubsub#meta-data FORM_TYPE<a class="anchor-link" href="#registrar-formtypes-metadata"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <figure class="code"><figcaption></figcaption><pre class="prettyprint">
&lt;form_type&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#meta-data&lt;/name&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
  &lt;desc&gt;Forms enabling setting of metadata information about pubsub nodes&lt;/desc&gt;
  &lt;field var='pubsub#contact'
         type='jid-multi'
         label='The JIDs of those to contact with questions'/&gt;
  &lt;field var='pubsub#creation_date'
         type='text-single'
         label='The datetime when the node was created'/&gt;
  &lt;field var='pubsub#creator'
         type='jid-single'
         label='The JID of the node creator'/&gt;
  &lt;field var='pubsub#description'
         type='text-single'
         label='A description of the node'/&gt;
  &lt;field var='pubsub#language'
         type='list-single'
         label='The default language of the node'/&gt;
  &lt;field var='pubsub#access_model'
         type='list-single'
         label='Access model'/&gt;
  &lt;field var='pubsub#publish_model'
         type='list-single'
         label='Publish model'/&gt;
  &lt;field var='pubsub#num_subscribers'
         type='text-single'
         label='The number of subscribers to the node'/&gt;
  &lt;field var='pubsub#owner'
         type='jid-multi'
         label='The JIDs of those with an affiliation of owner'/&gt;
  &lt;field var='pubsub#publisher'
         type='jid-multi'
         label='The JIDs of those with an affiliation of publisher'/&gt;
  &lt;field var='pubsub#title'
         type='text-single'
         label='The name of the node'/&gt;
  &lt;field var='pubsub#type'
         type='text-single'
         label='Payload type'/&gt;
  &lt;field var='pubsub#max_items'
         type='text-single'
         label='Max # of items to persist'/&gt;
&lt;/form_type&gt;
</pre></figure>
    </div>
    <div class="indent"><h4 id="registrar-formtypes-config">16.4.4 pubsub#node_config FORM_TYPE<a class="anchor-link" href="#registrar-formtypes-config"><abbr title="Link to this point in the document">¶</abbr></a></h4>
      <figure class="code"><figcaption></figcaption><pre class="prettyprint">
&lt;form_type&gt;
  &lt;name&gt;http://jabber.org/protocol/pubsub#node_config&lt;/name&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
  &lt;desc&gt;Forms enabling configuration of pubsub nodes&lt;/desc&gt;
  &lt;field var='pubsub#access_model'
         type='list-single'
         label='Who may subscribe and retrieve items'&gt;
    &lt;option label='Subscription requests must be approved and only subscribers may retrieve items'&gt;
      &lt;value&gt;authorize&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Anyone may subscribe and retrieve items'&gt;
      &lt;value&gt;open&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Anyone with a presence subscription of both or from may subscribe and retrieve items'&gt;
      &lt;value&gt;presence&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Anyone in the specified roster group(s) may subscribe and retrieve items'&gt;
      &lt;value&gt;roster&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Only those on a whitelist may subscribe and retrieve items'&gt;
      &lt;value&gt;whitelist&lt;/value&gt;
    &lt;/option&gt;
  &lt;/field&gt;
  &lt;field var='pubsub#body_xslt'
         type='text-single'
         label='The URL of an XSL transformation which can be
                applied to payloads in order to generate an
                appropriate message body element.'/&gt;
  &lt;field var='pubsub#children_association_policy'
         type='list-single'
         label='Who may associate leaf nodes with a collection'&gt;
    &lt;option label='Anyone may associate leaf nodes with the collection'&gt;
      &lt;value&gt;all&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Only collection node owners may associate leaf nodes with the collection'&gt;
      &lt;value&gt;owners&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Only those on a whitelist may associate leaf nodes with the collection'&gt;
      &lt;value&gt;whitelist&lt;/value&gt;
    &lt;/option&gt;
  &lt;/field&gt;
  &lt;field var='pubsub#children_association_whitelist'
         type='jid-multi'
         label='The list of JIDs that may associate leaf nodes with a collection'/&gt;
  &lt;field var='pubsub#children'
         type='text-multi'
         label='The child nodes (leaf or collection) associated with a collection.'/&gt;
  &lt;field var='pubsub#children_max'
         type='text-single'
         label='The maximum number of child nodes that can be associated with a collection.  `max` for no specific limit other than a server imposed maximum.'/&gt;
  &lt;field var='pubsub#collection'
         type='text-multi'
         label='The collection(s) with which a node is affiliated'/&gt;
  &lt;field var='pubsub#contact'
         type='jid-multi'
         label='The JIDs of those to contact with questions'/&gt;
  &lt;field var='pubsub#dataform_xslt'
         type='text-single'
         label='The URL of an XSL transformation which can be
                applied to the payload format in order to generate
                a valid Data Forms result that the client could
                display using a generic Data Forms rendering
                engine'/&gt;
  &lt;field var='pubsub#deliver_notifications' type='boolean'
         label='Whether to deliver event notifications'&gt;
    &lt;value&gt;true&lt;/value&gt;
  &lt;/field&gt;
  &lt;field var='pubsub#deliver_payloads'
         type='boolean'
         label='Whether to deliver payloads with event notifications; applies only to leaf nodes'/&gt;
  &lt;field var='pubsub#description'
         type='text-single'
         label='A description of the node'/&gt;
  &lt;field var='pubsub#item_expire'
         type='text-single'
         label='Number of seconds after which to automatically purge items. `max` for no specific limit other than a server imposed maximum.'/&gt;
  &lt;field var='pubsub#itemreply'
         type='list-single'
         label='Whether owners or publisher should receive replies to items'&gt;
    &lt;option label='Statically specify a replyto of the node owner(s)'&gt;
      &lt;value&gt;owner&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Dynamically specify a replyto of the item publisher'&gt;
      &lt;value&gt;publisher&lt;/value&gt;
    &lt;/option&gt;
  &lt;/field&gt;
  &lt;field var='pubsub#language'
         type='list-single'
         label='The default language of the node'/&gt;
  &lt;field var='pubsub#max_items'
         type='text-single'
         label='The maximum number of items to persist. `max` for no specific limit other than a server imposed maximum.'/&gt;
  &lt;field var='pubsub#max_payload_size'
         type='text-single'
         label='The maximum payload size in bytes'/&gt;
  &lt;field var='pubsub#node_type'
         type='list-single'
         label='Whether the node is a leaf (default) or a collection'&gt;
    &lt;option label='The node is a leaf node (default)'&gt;
      &lt;value&gt;leaf&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='The node is a collection node'&gt;
      &lt;value&gt;collection&lt;/value&gt;
    &lt;/option&gt;
  &lt;/field&gt;
  &lt;field var='pubsub#notification_type' type='list-single'
         label='Specify the delivery style for notifications'&gt;
    &lt;option label='Messages of type normal'&gt;
      &lt;value&gt;normal&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Messages of type headline'&gt;
      &lt;value&gt;headline&lt;/value&gt;
    &lt;/option&gt;
  &lt;/field&gt;
  &lt;field var='pubsub#notify_config'
         type='boolean'
         label='Whether to notify subscribers when the node configuration changes'/&gt;
  &lt;field var='pubsub#notify_delete'
         type='boolean'
         label='Whether to notify subscribers when the node is deleted'/&gt;
  &lt;field var='pubsub#notify_retract'
         type='boolean'
         label='Whether to notify subscribers when items are removed from the node'/&gt;
  &lt;field var='pubsub#notify_sub'
         type='boolean'
         label='Whether to notify owners about new subscribers and unsubscribes'/&gt;
  &lt;field var='pubsub#persist_items'
         type='boolean'
         label='Whether to persist items to storage'/&gt;
  &lt;field var='pubsub#presence_based_delivery'
         type='boolean'
         label='Whether to deliver notifications to available users only'/&gt;
  &lt;field var='pubsub#publish_model'
         type='list-single'
         label='The publisher model'&gt;
    &lt;option label='Only publishers may publish'&gt;
      &lt;value&gt;publishers&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Subscribers may publish'&gt;
      &lt;value&gt;subscribers&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='Anyone may publish'&gt;
      &lt;value&gt;open&lt;/value&gt;
    &lt;/option&gt;
  &lt;/field&gt;
  &lt;field var='pubsub#purge_offline'
         type='boolean'
         label='Whether to purge all items when the relevant publisher goes offline'/&gt;
  &lt;field var='pubsub#roster_groups_allowed'
         type='list-multi'
         label='The roster group(s) allowed to subscribe and retrieve items'/&gt;
  &lt;field var='pubsub#send_last_published_item'
         type='list-single'
         label='When to send the last published item'&gt;
    &lt;option label='Never'&gt;
      &lt;value&gt;never&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='When a new subscription is processed'&gt;
      &lt;value&gt;on_sub&lt;/value&gt;
    &lt;/option&gt;
    &lt;option label='When a new subscription is processed and whenever a subscriber comes online'&gt;
      &lt;value&gt;on_sub_and_presence&lt;/value&gt;
    &lt;/option&gt;
  &lt;/field&gt;
  &lt;field var='pubsub#tempsub'
         type='boolean'
         label='Whether to make all subscriptions temporary, based on subscriber presence'/&gt;
  &lt;field var='pubsub#subscribe' type='boolean'
         label='Whether to allow subscriptions'&gt;
    &lt;value&gt;1&lt;/value&gt;
  &lt;/field&gt;
  &lt;field var='pubsub#title'
         type='text-single'
         label='A friendly name for the node'/&gt;
  &lt;field var='pubsub#type'
         type='text-single'
         label='The type of node data, usually specified by
                the namespace of the payload (if any)'/&gt;
&lt;/form_type&gt;
</pre></figure>
    </div>
  </div>
  <div class="indent"><h3 id="registrar-shim">16.5 SHIM Headers<a class="anchor-link" href="#registrar-shim"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The XMPP Registrar includes "Collection" and "SubID" in its registry of SHIM headers (see &lt;<a href="https://xmpp.org/registrar/shim.html">https://xmpp.org/registrar/shim.html</a>&gt;). The registry submission is as follows:</p>
    <figure class="code"><figcaption></figcaption><pre class="prettyprint">
&lt;header&gt;
  &lt;name&gt;Collection&lt;/name&gt;
  &lt;desc&gt;The collection via which an event notification was received from the originating node.&lt;/desc&gt;
  &lt;doc&gt;XEP-0248&lt;/doc&gt;
&lt;/header&gt;
&lt;header&gt;
  &lt;name&gt;SubID&lt;/name&gt;
  &lt;desc&gt;A subscription identifer within the pubsub protocol.&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/header&gt;
</pre></figure>
    <p class="" style="">Future submissions to the XMPP Registrar may register additional SHIM headers that can be used in relation to the pubsub protocol, and such submission may occur without updating this specification.</p>
  </div>
  <div class="indent"><h3 id="registrar-querytypes">16.6 URI Query Types<a class="anchor-link" href="#registrar-querytypes"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">As authorized by <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0147.html">XMPP URI Query Components (XEP-0147)</a></span>  [<a href="#nt-idm2407">36</a>], the XMPP Registrar maintains a registry of queries and key-value pairs for use in XMPP URIs (see &lt;<a href="https://xmpp.org/registrar/querytypes.html">https://xmpp.org/registrar/querytypes.html</a>&gt;).</p>
    <p class="" style="">The "pubsub" querytype is defined herein for interaction with pubsub services, with three keys: (1) "action" (whose defined values are "subscribe", "unsubscribe", and "retrieve"), (2) "node" (to specify a pubsub node), and optionally "item" (to specify a particular item at a node).</p>
    <figure class="code-example" id="example-231"><figcaption><strong>Example 231.</strong> Pubsub Subscribe Action: IRI/URI<a class="anchor-link" href="#example-231"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
xmpp:pubsub.shakespeare.lit?pubsub;action=subscribe;node=princely_musings
</pre></figure>
    <figure class="code-example" id="example-232"><figcaption><strong>Example 232.</strong> Pubsub Subscribe Action: Resulting Stanza<a class="anchor-link" href="#example-232"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq to='pubsub.shakespeare.lit' type='set'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;subscribe node='princely_musings'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <figure class="code-example" id="example-233"><figcaption><strong>Example 233.</strong> Pubsub Unsubscribe Action: IRI/URI<a class="anchor-link" href="#example-233"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
xmpp:pubsub.shakespeare.lit?pubsub;action=unsubscribe;node=princely_musings
</pre></figure>
    <figure class="code-example" id="example-234"><figcaption><strong>Example 234.</strong> Pubsub Unsubscribe Action: Resulting Stanza<a class="anchor-link" href="#example-234"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq to='pubsub.shakespeare.lit' type='set'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;unsubscribe node='princely_musings'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <figure class="code-example" id="example-235"><figcaption><strong>Example 235.</strong> Pubsub Retrieve Action: IRI/URI<a class="anchor-link" href="#example-235"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
xmpp:pubsub.shakespeare.lit?pubsub;action=retrieve;node=princely_musings
</pre></figure>
    <figure class="code-example" id="example-236"><figcaption><strong>Example 236.</strong> Pubsub Retrieve Action: Resulting Stanza<a class="anchor-link" href="#example-236"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq to='pubsub.shakespeare.lit' type='get'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='princely_musings'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">The following submission registers the "pubsub" querytype.</p>
    <figure class="code"><figcaption></figcaption><pre class="prettyprint">
&lt;querytype&gt;
  &lt;name&gt;pubsub&lt;/name&gt;
  &lt;proto&gt;http://jabber.org/protocol/pubsub&lt;/proto&gt;
  &lt;desc&gt;enables interaction with a publish-subscribe service&lt;/desc&gt;
  &lt;doc&gt;XEP-0060&lt;/doc&gt;
  &lt;keys&gt;
    &lt;key&gt;
      &lt;name&gt;action&lt;/name&gt;
      &lt;desc&gt;the pubsub action&lt;/desc&gt;
      &lt;values&gt;
        &lt;value&gt;
	  &lt;name&gt;subscribe&lt;/name&gt;
          &lt;desc&gt;enables subscribing to a pubsub node&lt;/desc&gt;
        &lt;/value&gt;
        &lt;value&gt;
	  &lt;name&gt;unsubscribe&lt;/name&gt;
          &lt;desc&gt;enables unsubscribing from a pubsub node&lt;/desc&gt;
        &lt;/value&gt;
        &lt;value&gt;
          &lt;name&gt;retrieve&lt;/name&gt;
          &lt;desc&gt;enables retrieving a specific item from a pubsub node&lt;/desc&gt;
        &lt;/value&gt;
      &lt;/values&gt;
    &lt;/key&gt;
    &lt;key&gt;
      &lt;name&gt;node&lt;/name&gt;
      &lt;desc&gt;the pubsub node&lt;/desc&gt;
    &lt;/key&gt;
    &lt;key&gt;
      &lt;name&gt;item&lt;/name&gt;
      &lt;desc&gt;the pubsub item&lt;/desc&gt;
    &lt;/key&gt;
  &lt;/keys&gt;
&lt;/querytype&gt;
</pre></figure>
  </div>

  <div class="indent"><h3 id="registrar.xdata-validate">16.7 Data Forms Validation Datatypes<a class="anchor-link" href="#registrar.xdata-validate"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The following datatype shall be registered for use with Data Forms Validation:</p>
    <figure class="code"><figcaption>Data Forms Validation Datatypes Registry Submission</figcaption><pre class="prettyprint">
&lt;datatype&gt;
  &lt;name&gt;integer-or-max&lt;/name&gt;
    &lt;desc&gt;
      Datatype used for text-single fields where the accepted value is
      either an integer or the string "max".
    &lt;/desc&gt;
    &lt;doc&gt;XEP-0060&lt;/doc&gt;
&lt;/datatype&gt;
</pre></figure>
  </div>
<h2 id="schemas">17.
       XML Schemas<a class="anchor-link" href="#schemas"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="schemas-pubsub">17.1 http://jabber.org/protocol/pubsub<a class="anchor-link" href="#schemas-pubsub"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <figure class="code"><figcaption></figcaption><pre class="prettyprint">
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    xmlns:xdata='jabber:x:data'
    targetNamespace='http://jabber.org/protocol/pubsub'
    xmlns='http://jabber.org/protocol/pubsub'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      XEP-0060: http://xmpp.org/extensions/xep-0060.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:import
      namespace='jabber:x:data'
      schemaLocation='http://xmpp.org/schemas/x-data.xsd'/&gt;

  &lt;xs:element name='pubsub'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element ref='create'/&gt;
          &lt;xs:element ref='configure' minOccurs='0'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element ref='subscribe' minOccurs='0'/&gt;
          &lt;xs:element ref='options' minOccurs='0'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element ref='publish'/&gt;
          &lt;xs:element ref='publish-options' minOccurs='0'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:choice minOccurs='0'&gt;
          &lt;xs:element ref='affiliations'/&gt;
          &lt;xs:element ref='default'/&gt;
          &lt;xs:element ref='items'/&gt;
          &lt;xs:element ref='retract'/&gt;
          &lt;xs:element ref='subscription'/&gt;
          &lt;xs:element ref='subscriptions'/&gt;
          &lt;xs:element ref='unsubscribe'/&gt;
        &lt;/xs:choice&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='affiliations'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='affiliation' minOccurs='0' maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='node' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='affiliation'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='affiliation' use='required'&gt;
            &lt;xs:simpleType&gt;
              &lt;xs:restriction base='xs:NCName'&gt;
                &lt;xs:enumeration value='member'/&gt;
                &lt;xs:enumeration value='none'/&gt;
                &lt;xs:enumeration value='outcast'/&gt;
                &lt;xs:enumeration value='owner'/&gt;
                &lt;xs:enumeration value='publisher'/&gt;
                &lt;xs:enumeration value='publish-only'/&gt;
              &lt;/xs:restriction&gt;
            &lt;/xs:simpleType&gt;
          &lt;/xs:attribute&gt;
          &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='configure'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0' xmlns:xdata='jabber:x:data'&gt;
        &lt;xs:element ref='xdata:x'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='create'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='node' type='xs:string' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='default'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0'&gt;
        &lt;xs:element ref='xdata:x'/&gt;
      &lt;/xs:choice&gt;
      &lt;xs:attribute name='node' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='type'
                    use='optional'
                    default='leaf'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='collection'/&gt;
            &lt;xs:enumeration value='leaf'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='items'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='item' minOccurs='0' maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='max_items' type='xs:positiveInteger' use='optional'/&gt;
      &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
      &lt;xs:attribute name='subid' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='item'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence minOccurs='0'&gt;
        &lt;xs:any namespace='##other'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='id' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='publisher' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='options'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence minOccurs='0'&gt;
        &lt;xs:any namespace='jabber:x:data'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
      &lt;xs:attribute name='node' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='subid' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='publish'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='item' minOccurs='0' maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='publish-options'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0' xmlns:xdata='jabber:x:data'&gt;
        &lt;xs:element ref='xdata:x'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='retract'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='item' minOccurs='1' maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
      &lt;xs:attribute name='notify' type='xs:boolean' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='subscribe-options'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element name='required' type='empty' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='subscribe'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='node' type='xs:string' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='subscriptions'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence minOccurs='0' maxOccurs='unbounded'&gt;
        &lt;xs:element ref='subscription'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='node' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='subscription'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='subscribe-options' minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
      &lt;xs:attribute name='node' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='subid' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='subscription' use='optional'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='none'/&gt;
            &lt;xs:enumeration value='pending'/&gt;
            &lt;xs:enumeration value='subscribed'/&gt;
            &lt;xs:enumeration value='unconfigured'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='unsubscribe'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='node' type='xs:string' use='optional'/&gt;
          &lt;xs:attribute name='subid' type='xs:string' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
</pre></figure>
  </div>

  <div class="indent"><h3 id="schemas-error">17.2 http://jabber.org/protocol/pubsub#errors<a class="anchor-link" href="#schemas-error"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <figure class="code"><figcaption></figcaption><pre class="prettyprint">
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/pubsub#errors'
    xmlns='http://jabber.org/protocol/pubsub#errors'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      This namespace is used for error reporting only, as
      defined in XEP-0060:

      http://xmpp.org/extensions/xep-0060.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name='closed-node' type='empty'/&gt;
  &lt;xs:element name='configuration-required' type='empty'/&gt;
  &lt;xs:element name='invalid-jid' type='empty'/&gt;
  &lt;xs:element name='invalid-options' type='empty'/&gt;
  &lt;xs:element name='invalid-payload' type='empty'/&gt;
  &lt;xs:element name='invalid-subid' type='empty'/&gt;
  &lt;xs:element name='item-forbidden' type='empty'/&gt;
  &lt;xs:element name='item-required' type='empty'/&gt;
  &lt;xs:element name='jid-required' type='empty'/&gt;
  &lt;xs:element name='max-items-exceeded' type='empty'/&gt;
  &lt;xs:element name='max-nodes-exceeded' type='empty'/&gt;
  &lt;xs:element name='nodeid-required' type='empty'/&gt;
  &lt;xs:element name='not-in-roster-group' type='empty'/&gt;
  &lt;xs:element name='not-subscribed' type='empty'/&gt;
  &lt;xs:element name='payload-too-big' type='empty'/&gt;
  &lt;xs:element name='payload-required' type='empty'/&gt;
  &lt;xs:element name='pending-subscription' type='empty'/&gt;
  &lt;xs:element name='precondition-not-met' type='empty'/&gt;
  &lt;xs:element name='presence-subscription-required' type='empty'/&gt;
  &lt;xs:element name='subid-required' type='empty'/&gt;
  &lt;xs:element name='too-many-subscriptions' type='empty'/&gt;
  &lt;xs:element name='unsupported'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='feature' use='required'&gt;
            &lt;xs:simpleType&gt;
              &lt;xs:restriction base='xs:NCName'&gt;
                &lt;xs:enumeration value='access-authorize'/&gt;
                &lt;xs:enumeration value='access-open'/&gt;
                &lt;xs:enumeration value='access-presence'/&gt;
                &lt;xs:enumeration value='access-roster'/&gt;
                &lt;xs:enumeration value='access-whitelist'/&gt;
                &lt;xs:enumeration value='auto-create'/&gt;
                &lt;xs:enumeration value='auto-subscribe'/&gt;
                &lt;xs:enumeration value='collections'/&gt;
                &lt;xs:enumeration value='config-node'/&gt;
                &lt;xs:enumeration value='create-and-configure'/&gt;
                &lt;xs:enumeration value='create-nodes'/&gt;
                &lt;xs:enumeration value='delete-items'/&gt;
                &lt;xs:enumeration value='delete-nodes'/&gt;
                &lt;xs:enumeration value='filtered-notifications'/&gt;
                &lt;xs:enumeration value='get-pending'/&gt;
                &lt;xs:enumeration value='instant-nodes'/&gt;
                &lt;xs:enumeration value='item-ids'/&gt;
                &lt;xs:enumeration value='last-published'/&gt;
                &lt;xs:enumeration value='leased-subscription'/&gt;
                &lt;xs:enumeration value='manage-subscriptions'/&gt;
                &lt;xs:enumeration value='member-affiliation'/&gt;
                &lt;xs:enumeration value='meta-data'/&gt;
                &lt;xs:enumeration value='modify-affiliations'/&gt;
                &lt;xs:enumeration value='multi-collection'/&gt;
                &lt;xs:enumeration value='multi-items'/&gt;
                &lt;xs:enumeration value='multi-subscribe'/&gt;
                &lt;xs:enumeration value='outcast-affiliation'/&gt;
                &lt;xs:enumeration value='persistent-items'/&gt;
                &lt;xs:enumeration value='presence-notifications'/&gt;
                &lt;xs:enumeration value='presence-subscribe'/&gt;
                &lt;xs:enumeration value='publish'/&gt;
                &lt;xs:enumeration value='publish-options'/&gt;
                &lt;xs:enumeration value='publish-only-affiliation'/&gt;
                &lt;xs:enumeration value='publisher-affiliation'/&gt;
                &lt;xs:enumeration value='purge-nodes'/&gt;
                &lt;xs:enumeration value='retract-items'/&gt;
                &lt;xs:enumeration value='retrieve-affiliations'/&gt;
                &lt;xs:enumeration value='retrieve-default'/&gt;
                &lt;xs:enumeration value='retrieve-default-sub'/&gt;
                &lt;xs:enumeration value='retrieve-items'/&gt;
                &lt;xs:enumeration value='retrieve-subscriptions'/&gt;
                &lt;xs:enumeration value='subscribe'/&gt;
                &lt;xs:enumeration value='subscription-options'/&gt;
                &lt;xs:enumeration value='subscription-notifications'/&gt;
              &lt;/xs:restriction&gt;
            &lt;/xs:simpleType&gt;
          &lt;/xs:attribute&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='unsupported-access-model' type='empty'/&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
</pre></figure>
  </div>

  <div class="indent"><h3 id="schemas-event">17.3 http://jabber.org/protocol/pubsub#event<a class="anchor-link" href="#schemas-event"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <figure class="code"><figcaption></figcaption><pre class="prettyprint">
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/pubsub#event'
    xmlns='http://jabber.org/protocol/pubsub#event'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      XEP-0060: http://xmpp.org/extensions/xep-0060.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:import
      namespace='jabber:x:data'
      schemaLocation='http://xmpp.org/schemas/x-data.xsd'/&gt;

  &lt;xs:element name='event'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice&gt;
        &lt;xs:element ref='collection'/&gt;
        &lt;xs:element ref='configuration'/&gt;
        &lt;xs:element ref='delete'/&gt;
        &lt;xs:element ref='items'/&gt;
        &lt;xs:element ref='purge'/&gt;
        &lt;xs:element ref='subscription'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='collection'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice&gt;
        &lt;xs:element ref='associate'/&gt;
        &lt;xs:element ref='disassociate'/&gt;
      &lt;/xs:choice&gt;
      &lt;xs:attribute name='node' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='associate'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='disassociate'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='configuration'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence minOccurs='0' xmlns:xdata='jabber:x:data'&gt;
        &lt;xs:element ref='xdata:x'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='node' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='delete'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='redirect' minOccurs='0' maxOccurs='1'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='items'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice&gt;
        &lt;xs:element ref='item' minOccurs='0' maxOccurs='unbounded'/&gt;
        &lt;xs:element ref='retract' minOccurs='0' maxOccurs='unbounded'/&gt;
      &lt;/xs:choice&gt;
      &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='item'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0'&gt;
        &lt;xs:any namespace='##other'/&gt;
      &lt;/xs:choice&gt;
      &lt;xs:attribute name='id' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='publisher' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='purge'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='redirect'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='uri' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='retract'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='id' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='subscription'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='expiry' type='xs:dateTime' use='optional'/&gt;
          &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
          &lt;xs:attribute name='node' type='xs:string' use='optional'/&gt;
          &lt;xs:attribute name='subid' type='xs:string' use='optional'/&gt;
          &lt;xs:attribute name='subscription' use='optional'&gt;
            &lt;xs:simpleType&gt;
              &lt;xs:restriction base='xs:NCName'&gt;
                &lt;xs:enumeration value='none'/&gt;
                &lt;xs:enumeration value='pending'/&gt;
                &lt;xs:enumeration value='subscribed'/&gt;
                &lt;xs:enumeration value='unconfigured'/&gt;
              &lt;/xs:restriction&gt;
            &lt;/xs:simpleType&gt;
          &lt;/xs:attribute&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
</pre></figure>
  </div>

  <div class="indent"><h3 id="schemas-owner">17.4 http://jabber.org/protocol/pubsub#owner<a class="anchor-link" href="#schemas-owner"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <figure class="code"><figcaption></figcaption><pre class="prettyprint">
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='http://jabber.org/protocol/pubsub#owner'
    xmlns='http://jabber.org/protocol/pubsub#owner'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      XEP-0060: http://xmpp.org/extensions/xep-0060.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:import
      namespace='jabber:x:data'
      schemaLocation='http://xmpp.org/schemas/x-data.xsd'/&gt;

  &lt;xs:element name='pubsub'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice&gt;
        &lt;xs:element ref='affiliations'/&gt;
        &lt;xs:element ref='configure'/&gt;
        &lt;xs:element ref='default'/&gt;
        &lt;xs:element ref='delete'/&gt;
        &lt;xs:element ref='purge'/&gt;
        &lt;xs:element ref='subscriptions'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='affiliations'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='affiliation' minOccurs='0' maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='affiliation'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='affiliation' use='required'&gt;
            &lt;xs:simpleType&gt;
              &lt;xs:restriction base='xs:NCName'&gt;
                &lt;xs:enumeration value='member'/&gt;
                &lt;xs:enumeration value='none'/&gt;
                &lt;xs:enumeration value='outcast'/&gt;
                &lt;xs:enumeration value='owner'/&gt;
                &lt;xs:enumeration value='publisher'/&gt;
                &lt;xs:enumeration value='publish-only'/&gt;
              &lt;/xs:restriction&gt;
            &lt;/xs:simpleType&gt;
          &lt;/xs:attribute&gt;
          &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='configure'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0' xmlns:xdata='jabber:x:data'&gt;
        &lt;xs:element ref='xdata:x'/&gt;
      &lt;/xs:choice&gt;
      &lt;xs:attribute name='node' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='default'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0' xmlns:xdata='jabber:x:data'&gt;
        &lt;xs:element ref='xdata:x'/&gt;
      &lt;/xs:choice&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='delete'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='redirect' minOccurs='0' maxOccurs='1'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='purge'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='redirect'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='uri' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='subscriptions'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='subscription' minOccurs='0' maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='node' type='xs:string' use='required'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='subscription'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='empty'&gt;
          &lt;xs:attribute name='subscription' use='required'&gt;
            &lt;xs:simpleType&gt;
              &lt;xs:restriction base='xs:NCName'&gt;
                &lt;xs:enumeration value='none'/&gt;
                &lt;xs:enumeration value='pending'/&gt;
                &lt;xs:enumeration value='subscribed'/&gt;
                &lt;xs:enumeration value='unconfigured'/&gt;
              &lt;/xs:restriction&gt;
            &lt;/xs:simpleType&gt;
          &lt;/xs:attribute&gt;
          &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
</pre></figure>
  </div>

<h2 id="ack">18.
       Acknowledgements<a class="anchor-link" href="#ack"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">Thanks to Kirk Bateman, Robin Collier, Blaine Cook, Ovidiu Craciun, Brian Cully, Dave Cridland, Guillaume Desmottes, Gaston Dombiak, William Edney, Seth Fitzsimmons, Fabio Forno, Nathan Fritz, Julien Genestoux, Anastasia Gornostaeva, Joe Hildebrand, Curtis King, Tuomas Koski, Petri Liimatta, Tobias Markmann, Pedro Melo, Dirk Meyer, Tory Patnoe, Peter Petrov, Sonny Piers, Christophe Romain, Pavel Šimerda, Andy Skelton, Kevin Smith, Chris Teegarden, Simon Tennant, Matt Tucker, Melvin Vermeeren, Matthew Wild, Bob Wyman, Matus Zamborsky, and Brett Zamir for their feedback.</p>
<h2 id="authornote">19.
       Author Note<a class="anchor-link" href="#authornote"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">Peter Millard, primary author of this specification from version 0.1 through version 1.7, died on April 26, 2006. The remaining co-authors are indebted to him for his many years of work on publish-subscribe technologies.</p>
<hr><a name="appendices"></a><h2>Appendices</h2><h3 id="appendix-docinfo">Appendix A: Document Information<a class="anchor-link" href="#appendix-docinfo"><abbr title="Link to this point in the document">¶</abbr></a></h3><dl class="compact"><dt>Series</dt><dd><a href="https://xmpp.org/extensions/">XEP</a></dd><dt>Number</dt><dd>0060</dd><dt>Publisher</dt><dd><a href="/xsf/">XMPP Standards Foundation</a></dd><dt>Status</dt><dd><a href="https://xmpp.org/extensions/xep-0001.html#states-Draft">Draft</a></dd><dt>Type</dt><dd><a href="https://xmpp.org/extensions/xep-0001.html#types-Standards%20Track">Standards Track</a></dd><dt>Version</dt><dd>1.21.0</dd><dt>Last Updated</dt><dd>2021-08-03</dd><dt>Approving Body</dt><dd><a href="https://xmpp.org/council/">XMPP Council</a></dd><dt>Dependencies</dt><dd>XMPP Core, XEP-0004, XEP-0030, XEP-0059, XEP-0068, XEP-0082, XEP-0131</dd><dt>Supersedes</dt><dd>None</dd><dt>Superseded By</dt><dd>None</dd><dt>Short Name</dt><dd>pubsub</dd><dt>Schema</dt><dd>
        XML Schema for the 'pubsub' namespace: &lt;<a href="http://xmpp.org/schemas/pubsub.xsd">http://xmpp.org/schemas/pubsub.xsd</a>&gt;<br></dd><dd>
        XML Schema for the 'pubsub#errors' namespace: &lt;<a href="http://xmpp.org/schemas/pubsub-errors.xsd">http://xmpp.org/schemas/pubsub-errors.xsd</a>&gt;<br></dd><dd>
        XML Schema for the 'pubsub#event' namespace: &lt;<a href="http://xmpp.org/schemas/pubsub-event.xsd">http://xmpp.org/schemas/pubsub-event.xsd</a>&gt;<br></dd><dd>
        XML Schema for the 'pubsub#owner' namespace: &lt;<a href="http://xmpp.org/schemas/pubsub-owner.xsd">http://xmpp.org/schemas/pubsub-owner.xsd</a>&gt;<br></dd><dt>Source Control</dt><dd><a class="standardsButton" href="https://github.com/xsf/xeps/blob/master/xep-0060.xml">HTML</a></dd></dl><p>
          This document in other formats:
          <a class="standardsButton" href="https://xmpp.org/extensions/xep-0060.xml">XML</a> 
          <a class="standardsButton" href="https://xmpp.org/extensions/xep-0060.pdf">PDF</a></p><h3 id="appendix-authorinfo">Appendix B: Author Information<a class="anchor-link" href="#appendix-authorinfo"><abbr title="Link to this point in the document">¶</abbr></a></h3><h5>Peter Millard</h5>
      See <a href="#authornote">Author Note</a><br><dl class="compact"></dl><h5>Peter Saint-Andre</h5><dl class="compact"><dt>Email</dt><dd><a href="mailto:xsf@stpeter.im">xsf@stpeter.im</a></dd><dt>JabberID</dt><dd><a href="xmpp:peter@jabber.org">peter@jabber.org</a></dd><dt>URI</dt><dd><a href="http://stpeter.im/">http://stpeter.im/</a></dd></dl><h5>Ralph Meijer</h5><dl class="compact"><dt>Email</dt><dd><a href="mailto:ralphm@ik.nu">ralphm@ik.nu</a></dd><dt>JabberID</dt><dd><a href="xmpp:ralphm@ik.nu">ralphm@ik.nu</a></dd></dl><h3 id="appendix-legal">Appendix C: Legal Notices<a class="anchor-link" href="#appendix-legal"><abbr title="Link to this point in the document">¶</abbr></a></h3><div class="indent"><h4>Copyright</h4><p>This XMPP Extension Protocol is copyright © 1999 – 2020 by the <a href="https://xmpp.org/">XMPP Standards Foundation</a> (XSF).</p><h4>Permissions</h4><p>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.</p><h4>Disclaimer of Warranty</h4><p class="box info">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. ##</p><h4>Limitation of Liability</h4><p>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.</p><h4>IPR Conformance</h4><p>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which can be found at &lt;<a href="https://xmpp.org/about/xsf/ipr-policy">https://xmpp.org/about/xsf/ipr-policy</a>&gt; or obtained by writing to XMPP Standards Foundation, P.O. Box 787, Parker, CO 80134 USA).</p><h4>Visual Presentation</h4><p>The HTML representation (you are looking at) is maintained by the XSF. It is based on the <a href="http://yaml.de">YAML CSS Framework</a>, which is licensed under the terms of the <a href="https://creativecommons.org/licenses/by/2.0/">CC-BY-SA 2.0</a> license.</p></div><h3 id="appendix-xmpp">Appendix D: Relation to XMPP<a class="anchor-link" href="#appendix-xmpp"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 6120) and XMPP IM (RFC 6121) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><h3 id="appendix-discuss">Appendix E: Discussion Venue<a class="anchor-link" href="#appendix-discuss"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">There exists a special venue for discussion related to the technology described in this document: the &lt;<a href="https://mail.jabber.org/mailman/listinfo/pubsub">pubsub@xmpp.org</a>&gt; mailing list.</p><p class="indent">The primary venue for discussion of XMPP Extension Protocols is the &lt;<a href="https://mail.jabber.org/mailman/listinfo/standards">standards@xmpp.org</a>&gt; discussion list.</p><p class="indent">Discussion on other xmpp.org discussion lists might also be appropriate; see &lt;<a href="https://xmpp.org/about/discuss.shtml">https://xmpp.org/about/discuss.shtml</a>&gt; for a complete list.</p><p class="indent">Errata can be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><h3 id="appendix-conformance">Appendix F: Requirements Conformance<a class="anchor-link" href="#appendix-conformance"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">The following requirements keywords as used in this document are to be interpreted as described in <a href="https://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><h3 id="appendix-notes">Appendix G: Notes<a class="anchor-link" href="#appendix-notes"><abbr title="Link to this point in the document">¶</abbr></a></h3><div class="indent"><p><a name="nt-idm504">1</a>. RFC 4287: The Atom Syndication Format &lt;<a href="http://tools.ietf.org/html/rfc4287">http://tools.ietf.org/html/rfc4287</a>&gt;.</p><p><a name="nt-idm527">2</a>. RFC 6120: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://tools.ietf.org/html/rfc6120">http://tools.ietf.org/html/rfc6120</a>&gt;.</p><p><a name="nt-idm531">3</a>. XEP-0030: Service Discovery &lt;<a href="https://xmpp.org/extensions/xep-0030.html">https://xmpp.org/extensions/xep-0030.html</a>&gt;.</p><p><a name="nt-idm538">4</a>. XEP-0248: PubSub Collection Nodes &lt;<a href="https://xmpp.org/extensions/xep-0248.html">https://xmpp.org/extensions/xep-0248.html</a>&gt;.</p><p><a name="nt-idm585">5</a>. XEP-0163: Personal Eventing Protocol &lt;<a href="https://xmpp.org/extensions/xep-0163.html">https://xmpp.org/extensions/xep-0163.html</a>&gt;.</p><p><a name="nt-idm592">6</a>. RFC 3921: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://tools.ietf.org/html/rfc3921">http://tools.ietf.org/html/rfc3921</a>&gt;.</p><p><a name="nt-idm639">7</a>. XEP-0045: Multi-User Chat &lt;<a href="https://xmpp.org/extensions/xep-0045.html">https://xmpp.org/extensions/xep-0045.html</a>&gt;.</p><p><a name="nt-idm840">8</a>. These nodes are equivalent to those used in <span class="ref">XEP-0030: Service Discovery</span>.</p><p><a name="nt-idm844">9</a>. This rule does not apply to the root collection node, if any.</p><p><a name="nt-idm871">10</a>. XEP-0055: Jabber Search &lt;<a href="https://xmpp.org/extensions/xep-0055.html">https://xmpp.org/extensions/xep-0055.html</a>&gt;.</p><p><a name="nt-idm896">11</a>. XEP-0004: Data Forms &lt;<a href="https://xmpp.org/extensions/xep-0004.html">https://xmpp.org/extensions/xep-0004.html</a>&gt;.</p><p><a name="nt-idm900">12</a>. XEP-0128: Service Discovery Extensions &lt;<a href="https://xmpp.org/extensions/xep-0128.html">https://xmpp.org/extensions/xep-0128.html</a>&gt;.</p><p><a name="nt-idm904">13</a>. XEP-0068: Field Data Standardization for Data Forms &lt;<a href="https://xmpp.org/extensions/xep-0068.html">https://xmpp.org/extensions/xep-0068.html</a>&gt;.</p><p><a name="nt-idm1030">14</a>. XEP-0203: Delayed Delivery &lt;<a href="https://xmpp.org/extensions/xep-0203.html">https://xmpp.org/extensions/xep-0203.html</a>&gt;.</p><p><a name="nt-idm1081">15</a>. In accordance with Section 3.2.2.1 of <span class="ref">XML Schema Part 2: Datatypes</span>, the allowable lexical representations for the xs:boolean datatype are the strings "0" and "false" for the concept 'false' and the strings "1" and "true" for the concept 'true'; implementations MUST support both styles of lexical representation.</p><p><a name="nt-idm1184">16</a>. XEP-0059: Result Set Management &lt;<a href="https://xmpp.org/extensions/xep-0059.html">https://xmpp.org/extensions/xep-0059.html</a>&gt;.</p><p><a name="nt-idm1193">17</a>. XEP-0313: Message Archive Management &lt;<a href="https://xmpp.org/extensions/xep-0313.html">https://xmpp.org/extensions/xep-0313.html</a>&gt;.</p><p><a name="nt-idm1274">18</a>. The inclusion of more than one &lt;item/&gt; element is no longer allowed, given the removal of batch publishing from version 1.13 of this specification.</p><p><a name="nt-idm1275">19</a>. It is not necessary for a publication request to include a payload or even an &lt;item/&gt; element in order to trigger an event notification. For example, the result of publishing to a transient, notification-only node will be an event notification that does not include even an &lt;item/&gt; element. However, for the sake of convenience we refer to the act of publication as "publishing an item" (rather than, say, "triggering an event notification") even though a publication request will not always contain an &lt;item/&gt; element.</p><p><a name="nt-idm1307">20</a>. XEP-0131: Stanza Headers and Internet Metadata &lt;<a href="https://xmpp.org/extensions/xep-0131.html">https://xmpp.org/extensions/xep-0131.html</a>&gt;.</p><p><a name="nt-idm1619">21</a>. XEP-0050: Ad-Hoc Commands &lt;<a href="https://xmpp.org/extensions/xep-0050.html">https://xmpp.org/extensions/xep-0050.html</a>&gt;.</p><p><a name="nt-idm1806">22</a>. XEP-0080: User Geolocation &lt;<a href="https://xmpp.org/extensions/xep-0080.html">https://xmpp.org/extensions/xep-0080.html</a>&gt;.</p><p><a name="nt-idm1810">23</a>. XEP-0118: User Tune &lt;<a href="https://xmpp.org/extensions/xep-0118.html">https://xmpp.org/extensions/xep-0118.html</a>&gt;.</p><p><a name="nt-idm1814">24</a>. XEP-0108: User Activity &lt;<a href="https://xmpp.org/extensions/xep-0108.html">https://xmpp.org/extensions/xep-0108.html</a>&gt;.</p><p><a name="nt-idm1816">25</a>. Including, say, the 'http://jabber.org/protocol/geoloc' NodeID indicates that the client understands the geolocation namespace described in <span class="ref">XEP-0080</span>, whereas including the 'http://jabber.org/protocol/geoloc+notify' namespace indicates that the client wishes to receive notifications related to geolocation, where the NodeID is the same as the geolocation namespace 'http://jabber.org/protocol/geoloc' (in this case there is a one-to-one correspondence between the namespace name and the NodeID).</p><p><a name="nt-idm2144">26</a>. XEP-0086: Error Condition Mappings &lt;<a href="https://xmpp.org/extensions/xep-0086.html">https://xmpp.org/extensions/xep-0086.html</a>&gt;.</p><p><a name="nt-idm2179">27</a>. XEP-0160: Best Practices for Handling Offline Messages &lt;<a href="https://xmpp.org/extensions/xep-0160.html">https://xmpp.org/extensions/xep-0160.html</a>&gt;.</p><p><a name="nt-idm2186">28</a>. XEP-0079: Advanced Message Processing &lt;<a href="https://xmpp.org/extensions/xep-0079.html">https://xmpp.org/extensions/xep-0079.html</a>&gt;.</p><p><a name="nt-idm2276">29</a>. XEP-0082: XMPP Date and Time Profiles &lt;<a href="https://xmpp.org/extensions/xep-0082.html">https://xmpp.org/extensions/xep-0082.html</a>&gt;.</p><p><a name="nt-idm2286">30</a>. Another way to implement content-based subscriptions is to host one node per keyword or other filter; however, this is likely to require an extremely large number of nodes.</p><p><a name="nt-idm2300">31</a>. RFC 5122: Internationalized Resource Identifiers (IRIs) and Uniform Resource Identifiers (URIs) for the Extensible Messaging and Presence Protocol (XMPP) &lt;<a href="http://tools.ietf.org/html/rfc5122">http://tools.ietf.org/html/rfc5122</a>&gt;.</p><p><a name="nt-idm2315">32</a>. XEP-0122: Data Forms Validation &lt;<a href="https://xmpp.org/extensions/xep-0122.html">https://xmpp.org/extensions/xep-0122.html</a>&gt;.</p><p><a name="nt-idm2343">33</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p><p><a name="nt-idm2350">34</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="https://xmpp.org/registrar/">https://xmpp.org/registrar/</a>&gt;.</p><p><a name="nt-idm2371">35</a>. Prior to version 1.5 of XEP-0060, this type was called "generic".</p><p><a name="nt-idm2407">36</a>. XEP-0147: XMPP URI Query Components &lt;<a href="https://xmpp.org/extensions/xep-0147.html">https://xmpp.org/extensions/xep-0147.html</a>&gt;.</p></div><h3 id="appendix-revs">Appendix H: Revision History<a class="anchor-link" href="#appendix-revs"><abbr title="Link to this point in the document">¶</abbr></a></h3><p>Note: Older versions of this specification might be available at <a href="https://xmpp.org/extensions/attic/">https://xmpp.org/extensions/attic/</a></p><ol class="revision-history"><li id="revision-history-v1.21.0"><div class="revision-head">Version 1.21.0 (2021-08-03)<a class="anchor-link" href="#revision-history-v1.21.0"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Revert change from version 1.15.5 which changed meta-data to metadata in wire protocol. That was an unintended breaking change which has now been reverted.</p><div class="revision-author">pep</div></li><li id="revision-history-v1.20.0"><div class="revision-head">Version 1.20.0 (2021-06-08)<a class="anchor-link" href="#revision-history-v1.20.0"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Add integer-or-max datatype to use with Data Forms Validation.</p><div class="revision-author">pep</div></li><li id="revision-history-v1.19.1"><div class="revision-head">Version 1.19.1 (2021-03-04)<a class="anchor-link" href="#revision-history-v1.19.1"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Cross-document editorial adjustments for inclusive language.</p><div class="revision-author">mw</div></li><li id="revision-history-v1.19.0"><div class="revision-head">Version 1.19.0 (2020-08-16)<a class="anchor-link" href="#revision-history-v1.19.0"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Add missing 'item' key and 'retrieve' action to query type registry.</p><div class="revision-author">ps</div></li><li id="revision-history-v1.18.1"><div class="revision-head">Version 1.18.1 (2020-08-25)<a class="anchor-link" href="#revision-history-v1.18.1"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Fix trivial typo</p><div class="revision-author">lnjx</div></li><li id="revision-history-v1.18.0"><div class="revision-head">Version 1.18.0 (2020-02-27)<a class="anchor-link" href="#revision-history-v1.18.0"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Properly specifiy that an empty &lt;item/&gt; is invalid on publish.</p><div class="revision-author">jsc</div></li><li id="revision-history-v1.17.0"><div class="revision-head">Version 1.17.0 (2019-10-06)<a class="anchor-link" href="#revision-history-v1.17.0"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Clarify node config behaviour with regards to unlimited behaviour for fields that specify a maximum.</p><div class="revision-author">dg</div></li><li id="revision-history-v1.16.0"><div class="revision-head">Version 1.16.0 (2019-09-11)<a class="anchor-link" href="#revision-history-v1.16.0"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Add a pubsub#rsm disco#info feature to clear confusion</p><div class="revision-author">edhelas</div></li><li id="revision-history-v1.15.8"><div class="revision-head">Version 1.15.8 (2019-06-19)<a class="anchor-link" href="#revision-history-v1.15.8"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Add pubsub#access_model and pubsub#publish_model to examples</p><div class="revision-author">edhelas</div></li><li id="revision-history-v1.15.7"><div class="revision-head">Version 1.15.7 (2019-01-27)<a class="anchor-link" href="#revision-history-v1.15.7"><abbr title="Link to this point in the document">¶</abbr></a></div>
      <p class="" style="">Add 'publisher' attribute to &lt;item/&gt; in the http://jabber.org/protocol/pubsub schema, forgotten in revision 1.13.</p>
    <div class="revision-author">egp</div></li><li id="revision-history-v1.15.6"><div class="revision-head">Version 1.15.6 (2018-11-22)<a class="anchor-link" href="#revision-history-v1.15.6"><abbr title="Link to this point in the document">¶</abbr></a></div>
      <ul class="" style=""><li class="" style="">Correct several "entity element(s)" to "&lt;subscription/&gt; element(s)" (mw)</li>
      <li class="" style="">Remove unused and never defined 'node' attribute in pubsub#event item schema. This had been added in version 1.8 of the JEP, but never used. (egp)</li></ul>
    <div class="revision-author">jsc (Editor)</div></li><li id="revision-history-v1.15.5"><div class="revision-head">Version 1.15.5 (2018-11-03)<a class="anchor-link" href="#revision-history-v1.15.5"><abbr title="Link to this point in the document">¶</abbr></a></div>Fix a bunch of typos, batch-style.<div class="revision-author">pep</div></li><li id="revision-history-v1.15.4"><div class="revision-head">Version 1.15.4 (2018-08-11)<a class="anchor-link" href="#revision-history-v1.15.4"><abbr title="Link to this point in the document">¶</abbr></a></div>Add example where fewer than the number of requested items are returned.<div class="revision-author">egp</div></li><li id="revision-history-v1.15.3"><div class="revision-head">Version 1.15.3 (2018-08-18)<a class="anchor-link" href="#revision-history-v1.15.3"><abbr title="Link to this point in the document">¶</abbr></a></div>
      <p class="" style="">Add a new sentence and example about what to do if there are fewer items than requested present in a node.</p>
    <div class="revision-author">egp</div></li><li id="revision-history-v1.15.2"><div class="revision-head">Version 1.15.2 (2018-05-14)<a class="anchor-link" href="#revision-history-v1.15.2"><abbr title="Link to this point in the document">¶</abbr></a></div>
      <p class="" style="">Fix a few things in the schema:</p>
      <ul class="" style="">
        <li class="" style="">Remove duplicated &lt;publish/&gt; element.</li>
        <li class="" style="">Make &lt;affiliations/&gt;’s node attribute optional.</li>
        <li class="" style="">Add a missing optional dataform in &lt;default/&gt;.</li>
      </ul>
    <div class="revision-author">egp</div></li><li id="revision-history-v1.15.1"><div class="revision-head">Version 1.15.1 (2018-02-02)<a class="anchor-link" href="#revision-history-v1.15.1"><abbr title="Link to this point in the document">¶</abbr></a></div>
        <p class="" style="">Add missing "retrieve-default-sub" feature to the XML Schema</p>
    <div class="revision-author">sc</div></li><li id="revision-history-v1.15.0"><div class="revision-head">Version 1.15.0 (2017-12-12)<a class="anchor-link" href="#revision-history-v1.15.0"><abbr title="Link to this point in the document">¶</abbr></a></div>
      <ul class="" style="">
        <li class="" style="">Specify that unregistered publish-options are mapped 1:1 to node configurations</li>
        <li class="" style="">Get rid of per-item OVERRIDE</li>
        <li class="" style="">Get rid of METADATA publish-options</li>
        <li class="" style="">Remove registration for the obsolete pubsub#access_model publish-options</li>
      </ul>
    <div class="revision-author">dg</div></li><li id="revision-history-v1.14"><div class="revision-head">Version 1.14 (2017-11-29)<a class="anchor-link" href="#revision-history-v1.14"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Add pubsub#multi-items to features.</p><div class="revision-author">jt</div></li><li id="revision-history-v1.13.8"><div class="revision-head">Version 1.13.8 (2017-10-10)<a class="anchor-link" href="#revision-history-v1.13.8"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Add missing dependency on XEP-0059.</p><div class="revision-author">fs (XEP Editor: jwi)</div></li><li id="revision-history-v1.13.7"><div class="revision-head">Version 1.13.7 (2017-08-24)<a class="anchor-link" href="#revision-history-v1.13.7"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Fix examples using invalid XEP-0082 dates.</p><div class="revision-author">egp</div></li><li id="revision-history-v1.13.6"><div class="revision-head">Version 1.13.6 (2017-06-22)<a class="anchor-link" href="#revision-history-v1.13.6"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Clarify behaviour of publish-options. Fields must be registered</p><div class="revision-author">dg</div></li><li id="revision-history-v1.13.5"><div class="revision-head">Version 1.13.5 (2016-12-21)<a class="anchor-link" href="#revision-history-v1.13.5"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Add missing options to schema.</p><div class="revision-author">psa (XEP Editor: ssw)</div></li><li id="revision-history-v1.13.4"><div class="revision-head">Version 1.13.4 (2016-12-02)<a class="anchor-link" href="#revision-history-v1.13.4"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Make Multiple Simultaneous Modifications examples consistent with text.</p><div class="revision-author">psa</div></li><li id="revision-history-v1.13.3"><div class="revision-head">Version 1.13.3 (2016-12-08)<a class="anchor-link" href="#revision-history-v1.13.3"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Include publisher with any item retrieval.</p><div class="revision-author">ss (XEP Editor: ssw)</div></li><li id="revision-history-v1.13.2"><div class="revision-head">Version 1.13.2 (2016-10-11)<a class="anchor-link" href="#revision-history-v1.13.2"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Be more consistent with reply.</p><div class="revision-author">ss (XEP Editor: ssw)</div></li><li id="revision-history-v1.13.1"><div class="revision-head">Version 1.13.1 (2016-07-21)<a class="anchor-link" href="#revision-history-v1.13.1"><abbr title="Link to this point in the document">¶</abbr></a></div>
        <ul class="" style="">
            <li class="" style="">Fix wording, replace Jabber with XMPP where applicable.</li>
        </ul>
    <div class="revision-author">ss</div></li><li id="revision-history-v1.13"><div class="revision-head">Version 1.13 (2010-07-12)<a class="anchor-link" href="#revision-history-v1.13"><abbr title="Link to this point in the document">¶</abbr></a></div>
      <ul class="" style="">
        <li class="" style="">Pending further discussion: added but then removed change to allow notifications via IQ stanzas; removed but then retained batch publishing; removed but then retained SubIDs in subscription approvals.</li>
        <li class="" style="">Corrected a large number of reported errata.</li>
        <li class="" style="">Removed delete-any feature.</li>
        <li class="" style="">Added missing delete-items feature.</li>
        <li class="" style="">Added special value of "presence" for the pubsub#expire option to support temporary subscriptions.</li>
        <li class="" style="">Removed replyto and replyroom config options.</li>
        <li class="" style="">Removed multiple node discovery since it depended on the deprecated Service Discovery Publishing feature.</li>
        <li class="" style="">Defined "room" value for itemreply config option.</li>
        <li class="" style="">Added optional 'publisher' attribute to &lt;item/&gt; element.</li>
        <li class="" style="">Added optional &lt;redirect/&gt; child to &lt;delete/&gt; element.</li>
        <li class="" style="">Based redirects on URIs for consistency with RFC 6120 gone and redirect errors.</li>
        <li class="" style="">Clarified meaning of filtered notifications (they are based on NodeIDs, not payload namespaces).</li>
        <li class="" style="">Added pubsub-on-a-jid service discovery feature for explicit discovery that an IM and presence account also functions as a virtual pubsub service.</li>
        <li class="" style="">Added purge_offline node configuration option for purging the node when the relevant publisher goes offline, for use in certain extended presence applications.</li>
        <li class="" style="">Added item_expire node configuration option for automatically removing items after a certain number of seconds.</li>
        <li class="" style="">Added notification_type node configuration option for defining which value of the &lt;message/&gt; type attribute shall be used for notifications.</li>
        <li class="" style="">Added retrieve-default-sub feature for retrieving default subscription configuration from a node (as you can retrieve default node configuration from the service).</li>
        <li class="" style="">Clarified suggested rules for payload definitions.</li>
        <li class="" style="">Mentioned that singleton pattern can be enforced by setting max_items to 1.</li>
        <li class="" style="">Removed the notion of batch publishing because it makes information coherence and atom handling excessively difficult.</li>
        <li class="" style="">Added error handling for too-many-subscriptions to help prevent a certain denial of service attack.</li>
        <li class="" style="">Added process for retrieving default subscription configuration options for leaf nodes, by omitting the 'node' attribute on the &lt;default/&gt; element (also added the &lt;default/&gt; element to the schema for the http://jabber.org/protocol/pubsub namespace, since it was missing).</li>
        <li class="" style="">Removed informational mapping of node metadata to Dublin Core.</li>
      </ul>
    <div class="revision-author">psa</div></li><li id="revision-history-v1.12"><div class="revision-head">Version 1.12 (2008-09-03)<a class="anchor-link" href="#revision-history-v1.12"><abbr title="Link to this point in the document">¶</abbr></a></div>
      <ul class="" style="">
        <li class="" style="">Specified that service should return ItemID on successful publish if no ItemID was provided in request.</li>
        <li class="" style="">Described the use of Result Set Management to return some but not all published items.</li>
        <li class="" style="">Defined pubsub#notify_sub config option so that owners can receive notifications of new subscriptions, unsubscribes, and other subscription changes.</li>
        <li class="" style="">Harmonized definition of +notify feature with implementation reality.</li>
        <li class="" style="">Moved text about collections to XEP-0248.</li>
      </ul>
    <div class="revision-author">psa</div></li><li id="revision-history-v1.11"><div class="revision-head">Version 1.11 (2008-03-05)<a class="anchor-link" href="#revision-history-v1.11"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">For collection nodes, changed name of node child element to associate and added disassociate child element to handle disassociation use case; corrected SHIM examples to conform to XEP-0131; modified lease expiry notification for consistency with other subscription-related notifications (i.e., not using SHIM header); renamed SHIM headers to Collection and SubID for consistency with HTTP and Email headers.</p><div class="revision-author">rm/psa</div></li><li id="revision-history-v1.10"><div class="revision-head">Version 1.10 (2007-09-26)<a class="anchor-link" href="#revision-history-v1.10"><abbr title="Link to this point in the document">¶</abbr></a></div>
      <ul class="" style="">
        <li class="" style="">In accordance with XMPP Council consensus, moved the auto-create, auto-subscribe, filtered-notifications, and last-published features from XEP-0163 to this specification</li>
        <li class="" style="">Clarified implications of auto-subscribe feature for handling of account owners, stable presence subscribers, and transient presence sharers</li>
        <li class="" style="">Updated filtered-notifications text and examples to track changes to XEP-0115</li>
        <li class="" style="">Added publish-options functionality</li>
        <li class="" style="">Added developer-friendly How It Works section</li>
        <li class="" style="">Defined member affiliation to properly implement whitelist feature</li>
        <li class="" style="">Split several long sections into smaller sub-sections.</li>
        <li class="" style="">Clarified that a pubsub service must generate an ItemID if the publisher does not provide one.</li>
        <li class="" style="">Specified recommended ItemID for singleton nodes.</li>
        <li class="" style="">Summarized triggers for sending notifications.</li>
      </ul>
    <div class="revision-author">psa</div></li><li id="revision-history-v1.9"><div class="revision-head">Version 1.9 (2006-09-13)<a class="anchor-link" href="#revision-history-v1.9"><abbr title="Link to this point in the document">¶</abbr></a></div>
      <ul class="" style="">
        <li class="" style="">Replaced boolean send_item_subscribe node configuration option with more comprehensive send_last_published_item option per list discussion</li>
        <li class="" style="">Added deliver_notifications node configuration option to enable quiet nodes without notifications, if desired enabling pull-model item retrieval only.</li>
        <li class="" style="">Modified subscription and affiliation retrieval to return empty element if no results.</li>
      </ul>
    <div class="revision-author">psa</div></li><li id="revision-history-v1.8"><div class="revision-head">Version 1.8 (2006-06-27)<a class="anchor-link" href="#revision-history-v1.8"><abbr title="Link to this point in the document">¶</abbr></a></div>
      <ul class="" style="">
        <li class="" style="">Defined five access models: open, presence, roster, authorize, and whitelist</li>
        <li class="" style="">Renamed pubsub#subscription_model feature to pubsub#access_model</li>
        <li class="" style="">Separated affiliations retrieval from subscriptions retrieval</li>
        <li class="" style="">Removed subscription information from affiliations management</li>
        <li class="" style="">Changed &lt;entity/&gt; element to &lt;subscription/&gt; element in response to subscription request</li>
        <li class="" style="">Clarified batch processing of item publication and item deletion</li>
        <li class="" style="">Added basic example to introduction</li>
        <li class="" style="">More fully specified node creation flows</li>
        <li class="" style="">More fully specified recommended behavior for caching last published item, including use of jabber:x:delay protocol</li>
        <li class="" style="">Specified that semantic meaning of NodeIDs must not be used to encapsulate hierarchy</li>
        <li class="" style="">More fully specified error conditions</li>
        <li class="" style="">Changed some feature-related conditions to &lt;unsupported/&gt; plus feature attribute</li>
        <li class="" style="">Changed some error conditions from &lt;not-authorized/&gt; to &lt;forbidden/&gt;</li>
        <li class="" style="">Harmonized error conditions for unsubscribe if entity is not subscribed (unexpected-request rather than not-found)</li>
        <li class="" style="">Further defined error conditions related to item publication</li>
        <li class="" style="">Specified structure of &lt;affiliations/&gt;, &lt;delete/&gt;, &lt;purge/&gt;, and &lt;subscriptions/&gt; elements qualified by pubsub#owner namespace</li>
        <li class="" style="">Changed retrieval of default node configuration options to use &lt;default/&gt; element, not &lt;configure/&gt; element</li>
        <li class="" style="">Allowed caching of last published item</li>
        <li class="" style="">Added pubsub#deliver subscription option</li>
        <li class="" style="">Added metadata fields for pubsub#owners and pubsub#contact</li>
        <li class="" style="">Changed element for retrieval of default node configuration options from &lt;configure/&gt; to &lt;default/&gt; to prevent ambiguity related to configuration of root collection node</li>
        <li class="" style="">Specified pubsub#node_type configuration field</li>
        <li class="" style="">Specified pubsub#collection SHIM header</li>
        <li class="" style="">Specified conformance with Resourceprep for nodes addressable as JIDs</li>
        <li class="" style="">Added pubsub#modify-affiliations feature</li>
        <li class="" style="">Added pubsub#digest_frequency field to subscribe_options FORM_TYPE</li>
        <li class="" style="">Added pubsub#roster_groups_allowed field to node_config FORM_TYPE</li>
        <li class="" style="">More clearly specified the requirements level (MUST, SHOULD, MAY) for each service discovery feature</li>
        <li class="" style="">Defined pubsub#include_body subscription option and the pubsub#body_xslt node configuration option to transform payload format into an XMPP message body, and clarified rules for inclusion of message bodies</li>
        <li class="" style="">Clarified nature of collections and association of a node to a collection</li>
        <li class="" style="">Specified that simultaneous subscriptions of type nodes and items are allowed to collection nodes</li>
        <li class="" style="">Added examples and further explanation of time-based and content-based subscriptions</li>
        <li class="" style="">Added Internationalization Considerations</li>
        <li class="" style="">Clarified terminology</li>
        <li class="" style="">Corrected and updated the schemas</li>
      </ul>
    <div class="revision-author">psa</div></li><li id="revision-history-v1.7"><div class="revision-head">Version 1.7 (2005-03-03)<a class="anchor-link" href="#revision-history-v1.7"><abbr title="Link to this point in the document">¶</abbr></a></div>
      <ul class="" style="">
        <li class="" style="">Reinstated pubsub#subscribe feature (deleted in error)</li>
        <li class="" style="">Added type attribute for the &lt;create/&gt; and &lt;configure/&gt; elements to differentiate between leaf nodes and collection nodes</li>
        <li class="" style="">In Section 8.1.7, changed affiliations retrieval support to SHOULD and added pubsub#retrieve-affiliations feature</li>
        <li class="" style="">In Section 8.1.10, removed two duplicate examples</li>
        <li class="" style="">In Section 8.1.12, clarified relationship between normal disco#info data and node metadata (which uses a service discovery extension)</li>
        <li class="" style="">In Section 8.2.4, specified that node purgation MUST result in one event notification, not a notification per item</li>
        <li class="" style="">In Section 8.1.8, further specified handling of SubIDs</li>
        <li class="" style="">Clarified nature of the pubsub#type field</li>
        <li class="" style="">Mentioned that the forbidden error should be returned in response to certain operations requested by an outcast</li>
        <li class="" style="">Corrected datatype of max_items attribute from xs:string to xs:positiveInteger</li>
        <li class="" style="">Corrected &lt;requesting-entity-not-subscribed/&gt; error to &lt;not-subscribed/&gt; since the subscribed JID need not be that of the requesting entity</li>
        <li class="" style="">Added service discovery features for more optional use cases: retracting items, purging nodes, deleting nodes</li>
        <li class="" style="">Updated relevant registries</li>
      </ul>
    <div class="revision-author">psa/rm</div></li><li id="revision-history-v1.6"><div class="revision-head">Version 1.6 (2004-07-13)<a class="anchor-link" href="#revision-history-v1.6"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Added service discovery features for pubsub#meta-data, and pubsub#retrieve-items. Added pubsub#subscription_depth configuration option. Specified pubsub-specific error condition elements qualified by pubsub#errors namespace.</p><div class="revision-author">pgm/psa</div></li><li id="revision-history-v1.5"><div class="revision-head">Version 1.5 (2004-07-07)<a class="anchor-link" href="#revision-history-v1.5"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Fixed typos. Added more details to the section on collections. Added paragraph to create node use case to allow the service to change the requested node-id to something which it creates. Added text about bouncing publish requests when the request does not match the event-type for that node. Added disco features for the jabber registrar. Changed affiliation verbiage to allow publishers to remove any item. Tweaked verbiage for create node, eliminated extra example. Fully defined XMPP Registrar submissions. Corrected schemas.</p><div class="revision-author">pgm/psa</div></li><li id="revision-history-v1.4"><div class="revision-head">Version 1.4 (2004-06-22)<a class="anchor-link" href="#revision-history-v1.4"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Added subid syntax in a variety of places. Added more information about disco#info and disco#items support. Added more info about subscription options. Added collection information. Added implementation notes about subscription leases, and content-based pubsub services.</p><div class="revision-author">pgm</div></li><li id="revision-history-v1.3"><div class="revision-head">Version 1.3 (2004-04-25)<a class="anchor-link" href="#revision-history-v1.3"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Editorial review; added one implementation note.</p><div class="revision-author">psa</div></li><li id="revision-history-v1.2"><div class="revision-head">Version 1.2 (2004-03-09)<a class="anchor-link" href="#revision-history-v1.2"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Added XMPP error handling.</p><div class="revision-author">psa</div></li><li id="revision-history-v1.1"><div class="revision-head">Version 1.1 (2004-01-14)<a class="anchor-link" href="#revision-history-v1.1"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Added XMPP Registrar Considerations subsection for Service Discovery category/type registration.</p><div class="revision-author">psa</div></li><li id="revision-history-v1.0"><div class="revision-head">Version 1.0 (2003-10-28)<a class="anchor-link" href="#revision-history-v1.0"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Per a vote of the Jabber Council, advanced status to Draft.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.16"><div class="revision-head">Version 0.16 (2003-10-23)<a class="anchor-link" href="#revision-history-v0.16"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Clarified JID addressing usage for nodes. Added specific MAY requirement for disco usage. Added sentence about implementations verifying that an entity has a subscription before getting the current items.</p><div class="revision-author">pgm</div></li><li id="revision-history-v0.15"><div class="revision-head">Version 0.15 (2003-10-21)<a class="anchor-link" href="#revision-history-v0.15"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Fixed invalid XML in examples for subscription deny/allow.</p><div class="revision-author">pgm</div></li><li id="revision-history-v0.14"><div class="revision-head">Version 0.14 (2003-10-21)<a class="anchor-link" href="#revision-history-v0.14"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Clarified restrictions on addressing nodes by JID. Added section on Approving and Denying Subscription Requests. Changed get-pending to use Ad-Hoc Commands. Changed semantics when sending in a form type='cancel' for pending subscriptions.</p><div class="revision-author">pgm</div></li><li id="revision-history-v0.13"><div class="revision-head">Version 0.13 (2003-09-30)<a class="anchor-link" href="#revision-history-v0.13"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Removed item as a possible child of subscribe and unsubscribe and pubsub in the schemas. Removed retract as a possible child of item in the pubsub#event schema. Added verbiage to requirements for addressing nodes either via JIDs or disco nodes.</p><div class="revision-author">pgm</div></li><li id="revision-history-v0.12"><div class="revision-head">Version 0.12 (2003-08-13)<a class="anchor-link" href="#revision-history-v0.12"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Defined public vs. private nodes; described how changes to existing nodes might trigger meta-node events (e.g., configuration changes); changed &lt;x/&gt; to &lt;event/&gt; for #events namespace; added metadata about meta-nodes; fully defined XMPP Registrar considerations.</p><div class="revision-author">pgm/psa</div></li><li id="revision-history-v0.11"><div class="revision-head">Version 0.11 (2003-06-25)<a class="anchor-link" href="#revision-history-v0.11"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Removed subscription notifications since they have inherent issues. Removed empty implementation note sub-section.</p><div class="revision-author">pgm</div></li><li id="revision-history-v0.10"><div class="revision-head">Version 0.10 (2003-06-11)<a class="anchor-link" href="#revision-history-v0.10"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Fixed error example when returning 501 from an items-get request. Added note about receiving subscription requests when an entity is already subscribed. Fixed some entity elements in various subscription examples. Many were missing the node attribute. Added subscription change notification verbiage and example. Added verbiage and example of subscription state notification being sent to the requesting entity. Added disco#items information for getting a list of item identifiers for a single node. Added verbiage for returning the current entity element when a curent subscriber attempts to subscribe again.</p><div class="revision-author">pgm</div></li><li id="revision-history-v0.9"><div class="revision-head">Version 0.9 (2003-04-30)<a class="anchor-link" href="#revision-history-v0.9"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Include JID attributes in the entity elements when receiving your affiliations. Changed error code 406 (which was wrong) to 404, which is correct. Changed many 405 errors to 401, and modified the error table to make it more implementable (rules are more concrete). Added subscribe-options element for indicating subscriptions may be configured.</p><div class="revision-author">pgm</div></li><li id="revision-history-v0.8"><div class="revision-head">Version 0.8 (2003-04-03)<a class="anchor-link" href="#revision-history-v0.8"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Clarified the affiliations table and the semantics around subscribing and unsubscribing. Added protocol to get all of your affiliations in the service. Added protocol for services informing subscribers that configurable subscription options are available. Added protocol for obtaining existing node configuration settings and for concatenating configuration and node creation requests into a single stanza. Added meta-node implementation notes and specified the interaction with the XMPP Registrar and the meta NodeIDs. Added authorization notes to subscription options.</p><div class="revision-author">pgm</div></li><li id="revision-history-v0.7"><div class="revision-head">Version 0.7 (2003-02-14)<a class="anchor-link" href="#revision-history-v0.7"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Clarified requirements around what affiliations must be supported. Moved requirements about specifying entities which can subscribe and publish out of the MUSTs to MAYs. Changed SHOULD to MAY when talking about allowing entities to create nodes. Added ability to send configuration requests in the same stanza as a creation request.</p><div class="revision-author">pgm</div></li><li id="revision-history-v0.6"><div class="revision-head">Version 0.6 (2003-02-06)<a class="anchor-link" href="#revision-history-v0.6"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Added more details and an example about publishing without NodeID. Added more implementation notes about NodeIDs and persistent storage.</p><div class="revision-author">pgm</div></li><li id="revision-history-v0.5"><div class="revision-head">Version 0.5 (2003-01-22)<a class="anchor-link" href="#revision-history-v0.5"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Fixed header for delete item example. Added examples showing subscribers being notified of deleted items. Added examples for notification of node deletion, and configuration for node deletion. Added Subscriber option semantics and examples. Added examples for 402 and 407 errors on subscribe and create respectively. Added clarification about ItemID handling to impl notes.</p><div class="revision-author">pgm</div></li><li id="revision-history-v0.4"><div class="revision-head">Version 0.4 (2003-01-21)<a class="anchor-link" href="#revision-history-v0.4"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Clarified in-band and out-of-band configuration requirement. Added Delete Item privilege for all affiliations to the table. Added Delete item protocol for publishers and owners. Added 401 error case for subscribing to an illegal jid. Changed subscription request form. Added defaults to configuration form, and clarified role of the XMPP Registrar for the features show. Added text explaining the max_items attribute. Changed "last items" to "most recent items". Removed default configuration acceptance -- owners should just cancel. Added the notify_retract configuration option. Clarified error handling for affiliation modifications. </p><div class="revision-author">pgm</div></li><li id="revision-history-v0.3"><div class="revision-head">Version 0.3 (2003-01-20)<a class="anchor-link" href="#revision-history-v0.3"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Added subscription attribute for entities. Removed subscriber from the affiliations table. Clarified configuration details. Clarified JabberID usages. Added XMPP Registrar Considerations. Added link to XEP-0068 about the FORM_TYPE element in subscription request notifications. Fixed some typos in examples. Added unsupported configuration namespace to example.  Added a default node configuration example. </p><div class="revision-author">pgm</div></li><li id="revision-history-v0.2"><div class="revision-head">Version 0.2 (2003-01-02)<a class="anchor-link" href="#revision-history-v0.2"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Added numerous implementation notes; added get-pending action with regard to subscriptions; added error table; changed purge and delete to use IQ type='set'.</p><div class="revision-author">pgm</div></li><li id="revision-history-v0.1"><div class="revision-head">Version 0.1 (2002-11-19)<a class="anchor-link" href="#revision-history-v0.1"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Initial version.</p><div class="revision-author">pgm</div></li></ol><h3 id="appendix-biblatex">Appendix I: Bib(La)TeX Entry</h3><pre>
@report{millard2002pubsub,
  title = {Publish-Subscribe},
  author = {Millard, Peter and Saint-Andre, Peter and Meijer, Ralph},
  type = {XEP},
  number = {0060},
  version = {1.21.0},
  institution = {XMPP Standards Foundation},
  url = {https://xmpp.org/extensions/xep-0060.html},
  date = {2002-11-19/2021-08-03},
}</pre><p>END</p></body></html>
