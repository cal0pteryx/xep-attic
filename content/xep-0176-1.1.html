<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>XEP-0176: Jingle ICE-UDP Transport Method</title><style type="text/css">
/* don't mind this hack */
nav#toc h2:before {
display: none;
content: "XEP-0176";
}
        </style><link rel="stylesheet" type="text/css" href="xmpp.css"><link href="prettify.css" type="text/css" rel="stylesheet"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"><script type="text/javascript" src="prettify.js"></script><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0"><meta name="DC.Title" content="Jingle ICE-UDP Transport Method"><meta name="DC.Creator" content="Joe Beda"><meta name="DC.Creator" content="Scott Ludwig"><meta name="DC.Creator" content="Peter Saint-Andre"><meta name="DC.Creator" content="Joe Hildebrand"><meta name="DC.Creator" content="Sean Egan"><meta name="DC.Creator" content="Robert McQueen"><meta name="DC.Description" content="This specification defines a Jingle transport method that results in sending media data using raw datagram associations via the User Datagram Protocol (UDP). This transport method is negotiated via the Interactive Connectivity Establishment (ICE) methodology, which provides robust NAT traversal for media traffic."><meta name="DC.Publisher" content="XMPP Standards Foundation"><meta name="DC.Contributor" content="XMPP Extensions Editor"><meta name="DC.Date" content="2020-11-27"><meta name="DC.Type" content="XMPP Extension Protocol"><meta name="DC.Format" content="XHTML"><meta name="DC.Identifier" content="XEP-0176"><meta name="DC.Language" content="en"><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright © 1999 – 2020 by the XMPP Standards Foundation (XSF)."></head><body onload="prettyPrint()"><h1>XEP-0176: Jingle ICE-UDP Transport Method</h1><div class="docmeta-wrap"><dl id="docmeta" class="compact"><dt>Abstract</dt><dd>This specification defines a Jingle transport method that results in sending media data using raw datagram associations via the User Datagram Protocol (UDP). This transport method is negotiated via the Interactive Connectivity Establishment (ICE) methodology, which provides robust NAT traversal for media traffic.</dd><dt>Authors</dt><dd><ul class="authors"><li>Joe Beda</li><li>Scott Ludwig</li><li>Peter Saint-Andre</li><li>Joe Hildebrand</li><li>Sean Egan</li><li>Robert McQueen</li></ul></dd><dt>Copyright</dt><dd>© 1999 – 2020 XMPP Standards Foundation. <a href="#appendix-legal">SEE LEGAL NOTICES</a>.</dd><dt>Status</dt><dd><p>Draft</p><div id="status-notice" class="draft standards track">NOTICE: The protocol defined herein is a <strong>Draft Standard</strong> of the XMPP Standards Foundation. Implementations are encouraged and the protocol is appropriate for deployment in production systems, but some changes to the protocol are possible before it becomes a Final Standard.</div></dd><dt>Type</dt><dd>Standards Track</dd><dt>Version</dt><dd>1.1 (2020-11-27)</dd></dl><div class="timeline-wrap"><div class="timeline-head">Document Lifecycle</div><ol class="timeline"><li>Experimental</li><li>Proposed</li><li class="current">Draft</li><li>Final</li></ol></div></div><nav id="toc"><a href="#top"><h2>Table of Contents</h2></a><ol class="toc"><li><a href="#intro">Introduction</a></li><li><a href="#terms">Glossary</a></li><li><a href="#reqs">Requirements</a></li><li><a href="#conformance">Jingle Conformance</a></li><li><a href="#protocol">Protocol Description</a><ol><li><a href="#protocol-flow">Overall Flow</a></li><li><a href="#protocol-initiate">Session Initiation</a></li><li><a href="#protocol-syntax">Syntax</a></li><li><a href="#protocol-response">Response</a></li><li><a href="#protocol-candidates">Candidate Negotiation</a></li><li><a href="#protocol-checks">Connectivity Checks</a></li><li><a href="#protocol-acceptance">Acceptance of Successful Candidate</a></li><li><a href="#protocol-renegotiate">Negotiating a New Candidate</a></li><li><a href="#protocol-restarts">ICE Restarts</a></li></ol></li><li><a href="#fallback">Fallback to Raw UDP</a></li><li><a href="#support">Determining Support</a><ol><li><a href="#support-ice">ICE Support</a></li><li><a href="#support-sdp">SDP Offer / Answer Support</a></li></ol></li><li><a href="#impl">Implementation Notes</a></li><li><a href="#deploy">Deployment Notes</a></li><li><a href="#security">Security Considerations</a><ol><li><a href="#security-sharing">Sharing IP Addresses</a></li><li><a href="#security-media">Encryption of Media</a></li></ol></li><li><a href="#iana">IANA Considerations</a></li><li><a href="#registrar">XMPP Registrar Considerations</a><ol><li><a href="#registrar-ns">Protocol Namespaces</a></li><li><a href="#registrar-versioning">Protocol Versioning</a></li><li><a href="#registrar-features">Service Discovery Features</a></li><li><a href="#registrar-transports">Jingle Transport Methods</a></li></ol></li><li><a href="#schema">XML Schema</a></li><li><a href="#ack">Acknowledgements</a></li></ol><h6><a href="#appendices">Appendices</a></h6><ol class="toc-appendices"><li><a href="#appendix-docinfo">Document Information</a></li><li><a href="#appendix-authorinfo">Author Information</a></li><li><a href="#appendix-legal">Legal Notices</a></li><li><a href="#appendix-xmpp">Relation to XMPP</a></li><li><a href="#appendix-discuss">Discussion Venue</a></li><li><a href="#appendix-conformance">Requirements Conformance</a></li><li><a href="#appendix-notes">Notes</a></li><li><a href="#appendix-revs">Revision History</a></li></ol></nav><h2 id="intro">1.
       Introduction<a class="anchor-link" href="#intro"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style=""><span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0166.html">Jingle (XEP-0166)</a></span>  [<a href="#nt-idm246">2</a>] defines a framework for negotiating and managing out-of-band data sessions over XMPP. In order to provide a flexible framework, the base Jingle specification defines neither data transport methods nor application formats, leaving that up to separate specifications.</p>
  <p class="" style="">The current document defines a transport method for establishing and managing data exchanges between XMPP entities over the User Datagram Protocol (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc0768">RFC 768</a></span>  [<a href="#nt-idm251">3</a>]), using the ICE methodology developed within the IETF and specified in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc5245">RFC 5245</a></span>  [<a href="#nt-idm255">4</a>] (hereafter referred to as <span class="ref">ICE-CORE</span>). Use of this "ice-udp" method results in a datagram transport suitable for media applications where some packet loss is tolerable (e.g., audio and video).</p>
  <p class="" style="">Note: <span class="ref">ICE-CORE</span> has been approved for publication as an RFC but has not yet been published as an RFC. While every effort has been made to keep this document synchronized with <span class="ref">ICE-CORE</span>, the interested reader is referred to <span class="ref">ICE-CORE</span> for a detailed description of the ICE methodology.</p>
  <p class="" style="">The process for ICE negotiation is largely the same in Jingle as it is in ICE. There are several differences:</p>
  <ul class="" style="">
    <li class="" style="">Instead of using the Session Initiation Protocol (SIP) as the signalling channel, Jingle uses XMPP as the signalling channel.</li>
    <li class="" style="">Syntax from the Session Description Protocol (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc4566">RFC 4566</a></span>  [<a href="#nt-idm268">5</a>]) is mapped to an XML syntax suitable for sending over the XMPP signalling channel.</li>
    <li class="" style="">In Jingle, lists of "preferred" candidates are typically sent in the Jingle session-initiate and session-accept messages, in a way that is consistent with the SDP offer / answer model described in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3264">RFC 3264</a></span>  [<a href="#nt-idm273">6</a>] and the process described in <span class="ref">ICE-CORE</span>.</li>
    <li class="" style="">Candidates can also be sent in separate transport-info messages either before sending the session-accept message (to expedite negotiation) or after media begins to flow (to find modify existing candidates, find superior candidates, or adjust to changing network conditions).</li>
  </ul>
<h2 id="terms">2.
       Glossary<a class="anchor-link" href="#terms"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">The reader is referred to <span class="ref">ICE-CORE</span> for a description of various terms used in the context of ICE. Those terms are not reproduced here.</p>
<h2 id="reqs">3.
       Requirements<a class="anchor-link" href="#reqs"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">The Jingle transport method defined herein is designed to meet the following requirements:</p>
  <ol start="" class="" style="">
    <li class="" style="">Make it possible to establish and manage out-of-band connections between two XMPP entities, even if they are behind Network Address Translators (NATs) or firewalls.</li>
    <li class="" style="">Enable use of UDP as the transport protocol.</li>
    <li class="" style="">Make it relatively easy to implement support in standard Jabber/XMPP clients.</li>
    <li class="" style="">Where communication with non-XMPP entities is needed, push as much complexity as possible onto server-side gateways between the XMPP network and the non-XMPP network.</li>
  </ol>
<h2 id="conformance">4.
       Jingle Conformance<a class="anchor-link" href="#conformance"><abbr title="Link to this point in the document">¶</abbr></a></h2>
   <p class="" style="">In accordance with Section 10 of <span class="ref">XEP-0166</span>, this document specifies the following information related to the Jingle ice-udp transport method:</p>
   <ol start="" class="" style="">
     <li class="" style=""><p class="" style="">The transport negotiation process is defined in the <a href="#protocol">Protocol Description</a> section of this document.</p></li>
     <li class="" style=""><p class="" style="">The semantics of the &lt;transport/&gt; element are defined in the <a href="#protocol-negotiate">ICE Negotiation</a> section of this document.</p></li>
     <li class="" style=""><p class="" style="">Successful negotiation of the ice-udp method results in use of a datagram transport that is suitable for applications where some packet loss is tolerable, such as audio and video.</p></li>
     <li class="" style=""><p class="" style="">If multiple components are to be communicated by the application type that uses the transport, the transport shall support those components and assign identifiers for them as described in the specification that defines the application type.</p></li>
   </ol>
<h2 id="protocol">5.
       Protocol Description<a class="anchor-link" href="#protocol"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="protocol-flow">5.1 Overall Flow<a class="anchor-link" href="#protocol-flow"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The overall protocol flow for negotiation of the Jingle ICE-UDP Transport Method is as follows (note: many of these events happen simultaneously, not in sequence).</p>
    <figure class="code"><figcaption></figcaption><pre class="prettyprint">
INITIATOR                              RESPONDER
    |                                      |
    |  Jingle session-initiate stanza      |
    |  (with zero or more candidates)      |
    |-------------------------------------&gt;|
    |  Jingle ack (XMPP IQ-result)         |
    |&lt;-------------------------------------|
    |  Jingle session-accept stanza        |
    |  (with one or more candidates)       |
    |&lt;-------------------------------------|
    |  Jingle ack (XMPP IQ-result)         |
    |-------------------------------------&gt;|
    |  multiple STUN Binding Requests      |
    |&lt;====================================&gt;|
    |  multiple STUN Binding Results       |
    |&lt;====================================&gt;|
    |&lt;=========MEDIA NOW FLOWS============&gt;|
    |  optional Jingle transport-info      |
    |  stanzas (one candidate per stanaza) |
    |&lt;------------------------------------&gt;|
    |                                      |
</pre></figure>
    <p class="" style="">Note: The examples in this document follow the scenario described in Section 17 of <span class="ref">ICE-CORE</span>, except that we substitute the Shakespearean characters "Romeo" and "Juliet" for the generic entities "L" and "R".</p>
  </div>
  <div class="indent"><h3 id="protocol-initiate">5.2 Session Initiation<a class="anchor-link" href="#protocol-initiate"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">In order for the initiator in a Jingle exchange to start the negotiation, it sends a Jingle "session-initiate" stanza that includes at least one content type, as described in <span class="ref">XEP-0166</span>. If the initiator wishes to negotiate the ice-udp transport method for an application format, it MUST include a &lt;transport/&gt; child element qualified by the 'urn:xmpp:jingle:transports:ice-udp:1' namespace (see <a href="#registrar-versioning">Namespace Versioning</a> regarding the possibility of incrementing the version number). This element SHOULD in turn contain one &lt;candidate/&gt; element for each of the initiator's higher-priority transport candidates as determined in accordance with the ICE methodology, but MAY instead be empty (with each candidate to be sent as the payload of a transport-info message).</p>
    <figure class="code-example" id="example-1"><figcaption><strong>Example 1.</strong> Initiation<a class="anchor-link" href="#example-1"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='romeo@montague.lit/orchard'
    id='ixt174g9'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:1'
          action='session-initiate'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
      &lt;description xmlns='urn:xmpp:jingle:apps:rtp:1' media='audio'&gt;
        &lt;payload-type id='96' name='speex' clockrate='16000'/&gt;
        &lt;payload-type id='97' name='speex' clockrate='8000'/&gt;
        &lt;payload-type id='18' name='G729'/&gt;
        &lt;payload-type id='0' name='PCMU' /&gt;
        &lt;payload-type id='103' name='L16' clockrate='16000' channels='2'/&gt;
        &lt;payload-type id='98' name='x-ISAC' clockrate='8000'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:1'
                 pwd='asd88fgpdd777uzjYhagZg'
                 ufrag='8hhy'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='0'
                   id='el0747fg11'
                   ip='10.0.1.1'
                   network='1'
                   port='8998'
                   priority='2130706431'
                   protocol='udp'
                   type='host'/&gt;
        &lt;candidate component='1'
                   foundation='2'
                   generation='0'
                   id='y3s2b30v3r'
                   ip='192.0.2.3'
                   network='1'
                   port='45664'
                   priority='1694498815'
                   protocol='udp'
                   rel-addr='10.0.1.1'
                   rel-port='8998'
                   type='srflx'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
</pre></figure>
  </div>
  <div class="indent"><h3 id="protocol-syntax">5.3 Syntax<a class="anchor-link" href="#protocol-syntax"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The &lt;transport/&gt; element's 'pwd' and 'ufrag' attributes MUST be included whenever sending one or more candidates to the other party, e.g. in a session-initiate, session-accept, transport-info, content-add, or transport-replace message. The values for these attributes are separately generated for both the initiator and the responder, in accordance with <span class="ref">ICE-CORE</span> and as shown in the examples. The attributes of the &lt;transport/&gt; element are as follows.</p>
    <figure class="table"><figcaption id="table-1"><strong>Table 1:</strong> Transport Attributes<a class="anchor-link" href="#table-1"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><table>
      <tr class="body">
        <th colspan="" rowspan="">Name</th>
        <th colspan="" rowspan="">Description</th>
        <th colspan="" rowspan="">SDP Syntax</th>
        <th colspan="" rowspan="">Example</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">pwd</td>
        <td align="" colspan="" rowspan="">A Password as defined in <span class="ref">ICE-CORE</span>.</td>
        <td align="" colspan="" rowspan="">a=ice-pwd line</td>
        <td align="" colspan="" rowspan="">asd88fgpdd777uzjYhagZg</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">ufrag</td>
        <td align="" colspan="" rowspan="">A User Fragment as defined in <span class="ref">ICE-CORE</span>.</td>
        <td align="" colspan="" rowspan="">a=ice-ufrag line</td>
        <td align="" colspan="" rowspan="">8hhy</td>
      </tr>
    </table></figure>
    <p class="" style="">The attributes of the &lt;candidate/&gt; element are as follows.</p>
    <figure class="table"><figcaption id="table-2"><strong>Table 2:</strong> Candidate Attributes<a class="anchor-link" href="#table-2"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><table>
      <tr class="body">
        <th colspan="" rowspan="">Name</th>
        <th colspan="" rowspan="">Description</th>
        <th colspan="" rowspan="">SDP Syntax</th>
        <th colspan="" rowspan="">Example</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">component</td>
        <td align="" colspan="" rowspan="">A Component ID as defined in <span class="ref">ICE-CORE</span>.</td>
        <td align="" colspan="" rowspan="">Component ID value in a=candidate line</td>
        <td align="" colspan="" rowspan="">1</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">foundation</td>
        <td align="" colspan="" rowspan="">A Foundation as defined in <span class="ref">ICE-CORE</span>.</td>
        <td align="" colspan="" rowspan="">Foundation value in a=candidate line</td>
        <td align="" colspan="" rowspan="">1</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">generation</td>
        <td align="" colspan="" rowspan="">An index, starting at 0, that enables the parties to keep track of updates to the candidate throughout the life of the session. For details, see the <a href="#protocol-restarts">ICE Restarts</a> section of this document.</td>
        <td align="" colspan="" rowspan="">extended name/value pair in a=candidate line</td>
        <td align="" colspan="" rowspan="">0</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">id</td>
        <td align="" colspan="" rowspan="">A unique identifier for the candidate.</td>
        <td align="" colspan="" rowspan="">N/A</td>
        <td align="" colspan="" rowspan="">el0747fg11</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">ip</td>
        <td align="" colspan="" rowspan="">The Internet Protocol (IP) address for the candidate transport mechanism; this can be either an IPv4 address or an IPv6 address.</td>
        <td align="" colspan="" rowspan="">IP Address value in a=candidate line</td>
        <td align="" colspan="" rowspan="">192.0.2.3</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">network</td>
        <td align="" colspan="" rowspan="">An index, starting at 0, referencing which network this candidate is on for a given peer (used for diagnostic purposes if the calling hardware has more than one Network Interface Card).</td>
        <td align="" colspan="" rowspan="">"extension-att-name network extension-att-value &lt;the network&gt;" in a=candidate line</td>
        <td align="" colspan="" rowspan="">0</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">port</td>
        <td align="" colspan="" rowspan="">The port at the candidate IP address.</td>
        <td align="" colspan="" rowspan="">Port value in a=candidate line</td>
        <td align="" colspan="" rowspan="">45664</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">priority</td>
        <td align="" colspan="" rowspan="">A Priority as defined in <span class="ref">ICE-CORE</span>.
           [<a href="#nt-idm382">7</a>]
        </td>
        <td align="" colspan="" rowspan="">Priority value in a=candidate line</td>
        <td align="" colspan="" rowspan="">2130706431</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">protocol</td>
        <td align="" colspan="" rowspan="">The protocol to be used. The only value defined by this specification is "udp".  [<a href="#nt-idm389">8</a>]</td>
        <td align="" colspan="" rowspan="">Transport protocol field in a=candidate line</td>
        <td align="" colspan="" rowspan="">udp</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">rel-addr</td>
        <td align="" colspan="" rowspan="">A related address as defined in <span class="ref">ICE-CORE</span>.</td>
        <td align="" colspan="" rowspan="">raddr value in a=candidate line</td>
        <td align="" colspan="" rowspan="">10.0.1.1</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">rel-port</td>
        <td align="" colspan="" rowspan="">A related port as defined in <span class="ref">ICE-CORE</span>.</td>
        <td align="" colspan="" rowspan="">rport value in a=candidate line</td>
        <td align="" colspan="" rowspan="">8998</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">type</td>
        <td align="" colspan="" rowspan="">A Candidate Type as defined in <span class="ref">ICE-CORE</span>. The allowable values are "host" for host candidates, "prflx" for peer reflexive candidates, "relay" for relayed candidates, and "srflx" for server reflexive candidates.</td>
        <td align="" colspan="" rowspan="">Typ field in a=candidate line</td>
        <td align="" colspan="" rowspan="">srflx</td>
      </tr>
    </table></figure>
  </div>
  <div class="indent"><h3 id="protocol-response">5.4 Response<a class="anchor-link" href="#protocol-response"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">As described in <span class="ref">XEP-0166</span>, to acknowledge receipt of the session initiation request, the responder immediately returns an IQ-result.</p>
    <figure class="code-example" id="example-2"><figcaption><strong>Example 2.</strong> Responder acknowledges receipt of session-initiate request<a class="anchor-link" href="#example-2"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    id='ixt174g9'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
</pre></figure>
    <p class="" style="">Depending on the application type, a user agent controlled by a human user might need to wait for the user to affirm a desire to proceed with the session before continuing. When the user agent has received such affirmation (or if the user agent can automatically proceed for any reason, e.g. because no human intervention is expected or because a human user has configured the user agent to automatically accept sessions with a given entity), it returns a Jingle session-accept message. This message MUST contain a &lt;transport/&gt; element qualified by the 'urn:xmpp:jingle:transports:ice-udp:1' namespace, which SHOULD in turn contain one &lt;candidate/&gt; element for each ICE-UDP candidate generated by or known to the responder, but MAY instead be empty (with each candidate to be sent as the payload of a transport-info message).</p>
     <p class="" style="">Note: See the <a href="#security">Security Considerations</a> section of this document regarding the exposure of IP addresses by the responder's client.</p>
    <figure class="code-example" id="example-3"><figcaption><strong>Example 3.</strong> Responder accepts the session request<a class="anchor-link" href="#example-3"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    id='rw782g55'
    to='romeo@montague.lit/orchard'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:1'
          action='session-accept'
          initiator='romeo@montague.lit/orchard'
          responder='juliet@capulet.lit/balcony'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
      &lt;description xmlns='urn:xmpp:jingle:apps:rtp:1' media='audio'&gt;
        &lt;payload-type id='97' name='speex' clockrate='8000'/&gt;
        &lt;payload-type id='18' name='G729'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:1'
                 pwd='YH75Fviy6338Vbrhrlp8Yh'
                 ufrag='9uB6'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='0'
                   id='or2ii2syr1'
                   ip='192.0.2.1'
                   network='0'
                   port='3478'
                   priority='2130706431'
                   protocol='udp'
                   type='host'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
</pre></figure>
  </div>
  <div class="indent"><h3 id="protocol-candidates">5.5 Candidate Negotiation<a class="anchor-link" href="#protocol-candidates"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The initiator and responder negotiate connectivity over ICE by exchanging XML-formatted transport candidates for the channel. This negotiation proceeds immediately in order to maximize the possibility that connectivity can be established (and therefore media can be exchanged) as quickly as possible. In order to expedite session establishment, the initiator SHOULD include transport candidates in its session-initiate message but MAY also send additional transport candidates as soon as it learns of them, even before receiving acknowledgement of the session-initiate message (i.e., the initiator MUST consider the session to be live as soon as it sends the session-initiate message).  [<a href="#nt-idm420">9</a>]</p>
    <p class="" style="">The first step in negotiating connectivity is for each party to send transport candidates to the other party.  [<a href="#nt-idm426">11</a>] These candidates SHOULD be gathered by following the procedure specified in Section 4.1.1 of <span class="ref">ICE-CORE</span> (typically by communicating with a standalone STUN server in order to discover the client's public IP address and port) and prioritized by following the procedure specified in Section 4.1.2 of <span class="ref">ICE-CORE</span>.</p>
      <p class="" style="">Each candidate shall be sent as a &lt;candidate/&gt; child of a &lt;transport/&gt; element qualified by the 'urn:xmpp:jingle:transports:ice-udp:1' namespace. The &lt;transport/&gt; element is sent via a Jingle message of type session-initiate, session-accept, or transport-info.</p>
      <p class="" style="">Either party MAY include multiple &lt;candidate/&gt; elements in one &lt;transport/&gt; element, especially in the session-initiate and session-accept messages sent at the beginning of the session negotiation. Including multiple candidates in the session-initiate and session-accept messages can help to ensure interoperability with entities that implement the SDP offer/answer model described in <span class="ref">RFC 3264</span>; in particular, an entity SHOULD include multiple candidates in its session-initiate or session-accept message if the other party advertises support for the "urn:ietf:rfc:3264" service discovery feature as described in the <a href="#support-sdp">SDP Offer / Answer Support</a> section of this document. However, including one candidate per subsequent transport-info message typically results in a faster negotiation because the candidates most likely to succeed are sent first (in the session-info and session-accept messages) and it is not necessary to gather all candidates before beginning to send any candidates; furthermore, because certain candidates can be more "expensive" in terms of bandwidth or processing power, either party might not want to advertise the existence of such candidates unless it is necessary to do so after other candidates have failed.</p>
      <p class="" style="">If the party that receives a candidate in a Jingle message can successfully process a given candidate or set of candidates, it returns an IQ-result (if not, for example because the candidate data is improperly formatted, it returns an IQ-error). At this point, the receiving entity is only indicating receipt of the candidate or set of candidates, not telling the other party that the candidate will be used.</p>
      <p class="" style="">The initiator can keep sending candidates (without stopping to receive an acknowledgement of receipt from the responder for each candidate) until it has exhausted its supply of possible or desirable transport candidates. The responder can also keep sending potential candidates, which the initiator will acknowledge.</p>
  </div>
  <div class="indent"><h3 id="protocol-checks">5.6 Connectivity Checks<a class="anchor-link" href="#protocol-checks"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">As the initiator and responder receive candidates, they probe the candidates for connectivity. In performing these connectivity checks, each party SHOULD follow the procedure specified in Section 7 of <span class="ref">ICE-CORE</span>. The following business rules apply:</p>
    <ol start="" class="" style="">
      <li class="" style="">Each party sends a STUN Binding Request (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc5389">RFC 5389</a></span>  [<a href="#nt-idm443">12</a>]) from each local candidate it generated to each remote candidate it received.</li>
      <li class="" style="">In accordance with <span class="ref">ICE-CORE</span>, the STUN Binding Requests MUST include the PRIORITY attribute (computed according to Section 7.1.1.1. of <span class="ref">ICE-CORE</span>).</li>
      <li class="" style="">For the purposes of the Jingle ICE-UDP Transport Method, both parties are full ICE implementations and therefore the controlling role MUST be assumed by the initiator and the controlled role MUST be assumed by the responder.</li>
      <li class="" style="">The STUN Binding Requests generated by the initiator MAY include the USE-CANDIDATE attribute to indicate that the initiator wishes to cease checks for this component.</li>
      <li class="" style="">The STUN Binding Requests generated by the initiator MUST include the ICE-CONTROLLING attribute.</li>
      <li class="" style="">The STUN Binding Requests generated by the responder MUST include the ICE-CONTROLLED attribute.</li>
      <li class="" style="">The parties MUST use STUN short term credentials to authenticate requests and perform message integrity checks. As in <span class="ref">ICE-CORE</span>, the username in the STUN Binding Request is of the form "ufrag-of-peer:ufrag-of-sender" and the password is the value of the 'pwd' attribute provided by the peer.  [<a href="#nt-idm454">13</a>]</li>
    </ol>
    <p class="" style="">When it receives a STUN Binding Request, each party MUST return a STUN Binding Response, which indicates either an error case or the success case. As described in Section 7.1.2.2 of <span class="ref">ICE-CORE</span>, a connectivity check succeeds if <em>all</em> of the following are true:</p>
    <ol start="" class="" style="">
      <li class="" style="">The STUN transaction generated a success response.</li>
      <li class="" style="">The source IP address and port of the response equals the destination IP address and port to which the Binding Request was sent.</li>
      <li class="" style="">The destination IP address and port of the response match the source IP address and port from which the Binding Request was sent.</li>
    </ol>
    <p class="" style="">For the candidates exchanged in the previous section, the connectivity checks would be as follows (this diagram mirrors the example in <span class="ref">ICE-CORE</span>).</p>
    <figure class="code"><figcaption></figcaption><pre class="prettyprint">
INITIATOR                  NAT                  RESPONDER
    |                       |                       |
    |                       | STUN Binding Request  |
    |                       | from 192.0.2.1:3478   |
    |                       | to   10.0.1.1:8998    |
    |                       |   (dropped)           |
    |                       |  x====================|
    | STUN Binding Request  |                       |
    | from 10.0.1.1:8998    |                       |
    | to   192.0.2.1:3478   |                       |
    | USE-CANDIDATE         |                       |
    |======================&gt;|                       |
    |                       | STUN Binding Request  |
    |                       | from 192.0.2.3:45664  |
    |                       | to   192.0.2.1:3478   |
    |                       | USE-CANDIDATE         |
    |                       |======================&gt;|
    |                       | STUN Binding Response |
    |                       | from 192.0.2.1:3478   |
    |                       | to   192.0.2.3:45664  |
    |                       |&lt;======================|
    | STUN Binding Response |                       |
    | from 192.0.2.1:3478   |                       |
    | to   10.0.1.1:8998    |                       |
    | map  192.0.2.3:45664  |                       |
    |&lt;======================|                       |
    |                       |                       |
    |&lt;==Media Now Can Flow==|                       |
    |                       |                       |
    |                       | STUN Binding Request  |
    |                       | from 192.0.2.1:3478   |
    |                       | to   192.0.2.3:45664  |
    |                       |&lt;======================|
    | STUN Binding Request  |                       |
    | from 192.0.2.1:3478   |                       |
    | to   10.0.1.1:8998    |                       |
    |&lt;======================|                       |
    | STUN Binding Response |                       |
    | from 10.0.1.1:8998    |                       |
    | to   192.0.2.1:3478   |                       |
    | map  192.0.2.1:3478   |                       |
    |======================&gt;|                       |
    |                       | STUN Binding Response |
    |                       | from 192.0.2.3:45664  |
    |                       | to   192.0.2.1:3478   |
    |                       | map  192.0.2.1:3478   |
    |                       |======================&gt;|
    |                       |                       |
    |                       |==Media Now Can Flow==&gt;|
    |                       |                       |
</pre></figure>
    <p class="" style="">Note: Here the initiator (controlling agent) is using "aggressive nomination" as described in Section 8.1.1.2 of <span class="ref">ICE-CORE</span> and therefore includes the USE-CANDIDATE attribute in the STUN Binding Requests it sends.</p>
  </div>
  <div class="indent"><h3 id="protocol-acceptance">5.7 Acceptance of Successful Candidate<a class="anchor-link" href="#protocol-acceptance"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">If, based on STUN connectivity checks, the parties determine that they will be able to exchange media between a given pair of local candidates and remote candidates (i.e., the pair is "nominated" and ICE processing is "completed"), they can then begin using that candidate pair to exchange media.</p>
    <p class="" style="">Once the parties have connectivity and therefore the initiator has completed ICE as explained in <span class="ref">ICE-CORE</span>, the initiator MAY communicate the in-use candidate pair in the signalling channel by sending a transport-info message that contains a &lt;remote-candidate/&gt; element (this maps to the SDP "remote-candidates" attribute as described in Section B.6 of <span class="ref">ICE-CORE</span>, i.e., remote candidates are "the actual candidates at R that were selected by the offerer", of which there will be only one at this stage of the ICE-UDP negotiation).</p>
    <figure class="code-example" id="example-4"><figcaption><strong>Example 4.</strong> Initiator communicates in-use candidate<a class="anchor-link" href="#example-4"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='romeo@montague.lit/orchard'
    id='pd81b49s'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
 &lt;jingle xmlns='urn:xmpp:jingle:1'
         action='transport-info'
         initiator='romeo@montague.lit/orchard'
         sid='a73sjjvkla37jfea'&gt;
   &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
     &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:1'
                pwd='asd88fgpdd777uzjYhagZg'
                ufrag='8hhy'&gt;
       &lt;remote-candidate component='1'
                         ip='10.0.1.2'
                         port='9001'/&gt;
     &lt;/transport&gt;
   &lt;/content&gt;
 &lt;/jingle&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">(In accordance with Jingle core, the responder will also acknowledge the transport-info message.)</p>
    <p class="" style="">In the unlikely event that one of the parties determines that it cannot establish connectivity even after sending and checking lower-priority candidates, it SHOULD terminate the session as described in <span class="ref">XEP-0166</span>.</p>
  </div>
  <div class="indent"><h3 id="protocol-renegotiate">5.8 Negotiating a New Candidate<a class="anchor-link" href="#protocol-renegotiate"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">Even after media has begun to flow, either party MAY continue to send additional candidates to the other party (e.g., because the user agent has become aware of a new media proxy or network interface card). Such candidates are shared by sending a transport-info message.</p>
    <figure class="code-example" id="example-5"><figcaption><strong>Example 5.</strong> Initiator sends a subsequent candidate<a class="anchor-link" href="#example-5"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='romeo@montague.lit/orchard'
    id='uh3g1f48'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:1'
          action='transport-info'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:1'
                 pwd='asd88fgpdd777uzjYhagZg'
                 ufrag='8hhy'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='0'
                   id='m3110wc4nd'
                   ip='2001:db8::9:1'
                   network='0'
                   port='9001'
                   priority='21149780477'
                   protocol='udp'
                   type='host'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">The receiving party MUST acknowledge receipt of the candidate.</p>
    <figure class="code-example" id="example-6"><figcaption><strong>Example 6.</strong> Recipient acknowledges receipt<a class="anchor-link" href="#example-6"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    id='uh3g1f48'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
</pre></figure>
    <p class="" style="">The parties would check the newly-offered candidate for connectivity, as described previously. If the parties determine that media can flow over the candidate, they MAY then use the new candidate in subsequent communications.</p>
  </div>
  <div class="indent"><h3 id="protocol-restarts">5.9 ICE Restarts<a class="anchor-link" href="#protocol-restarts"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">At any time, either party MAY restart the process of ICE negotiation by sending a candidate with a 'generation' value that is greater than the previous generation of candidates; when it does so, it MUST generate new values for the 'pwd' and 'ufrag' attributes, consistent with the definition of an ICE restart in Section 9.1.1.1 of <span class="ref">ICE-CORE</span>. As explained in <span class="ref">ICE-CORE</span>, typically the ICE negotiation would be restarted to change the media target (e.g., an IP address change for one of the parties) and certain third-party-call-control scenarios.</p>
    <figure class="code-example" id="example-7"><figcaption><strong>Example 7.</strong> Initiator restarts ICE negotiation<a class="anchor-link" href="#example-7"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='romeo@montague.lit/orchard'
    id='kl23fs71'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:1'
          action='transport-info'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:1'
                 pwd='bv71hdn38hgb39hf6xlk33'
                 ufrag='g7qs'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='1'
                   id='y3s2b30v3r'
                   ip='192.0.2.3'
                   network='1'
                   port='45665'
                   priority='1694498815'
                   protocol='udp'
                   type='srflx'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">The recipient then acknowledges receipt.</p>
    <figure class="code-example" id="example-8"><figcaption><strong>Example 8.</strong> Recipient acknowledges transport-info<a class="anchor-link" href="#example-8"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    id='kl23fs71'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
</pre></figure>
    <p class="" style="">The parties would then exchange new candidates to renegotiate connectivity and would check the new candidates for connectivity, as described previously. If the parties determine that media can flow over one of the new candidates, they can then use the successful candidate in subsequent communications. However, while ICE is being renegotiated the parties can continue to send media with the existing candidate-in-use.</p>
  </div>
<h2 id="fallback">6.
       Fallback to Raw UDP<a class="anchor-link" href="#fallback"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">It can happen that the responder does not support ICE, in which case it can be necessary to fall back to use of the <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0177.html">Jingle Raw UDP Transport Method  (XEP-0177)</a></span>  [<a href="#nt-idm494">14</a>]. One typical scenario is communication between an ICE-aware Jingle endpoint and a non-ICE-aware SIP endpoint through a Jingle-to-SIP gateway, as follows:</p>
  <ol start="" class="" style="">
    <li class="" style="">The Jingle endpoint sends a session-initiate request to the SIP endpoint, specifying a transport method of ICE-UDP.</li>
    <li class="" style="">Based on capabilities information, the gateway knows that the SIP endpoint does not support ICE, so it enables the endpoints to use its media relay. It does this by:
      <ul class="" style="">
        <li class="" style="">Sending a transport-replace message to the Jingle endpoint on behalf of the SIP endpoint, specifying a transport method of Raw UDP and a candidate whose IP address and port are hosted at the gateway.</li>
        <li class="" style="">Sending SIP INVITE to the SIP endpoint on behalf of the Jingle endpoint, speciying an IP address and port at the gateway.</li>
      </ul>
    </li>
  </ol>
  <p class="" style="">The session flow is as follows.</p>
  <figure class="code"><figcaption></figcaption><pre class="prettyprint">
Romeo                    Gateway                    Juliet
  |                         |                         |
  |   session-initiate      |                         |
  |   (audio definition)    |                         |
  |------------------------&gt;|                         |
  |   ack                   |                         |
  |&lt;------------------------|                         |
  |   transport-replace     |                         |
  |   (Raw UDP)             |                         |
  |&lt;------------------------|                         |
  |   ack                   |                         |
  |------------------------&gt;|                         |
  |   transport-accept      |                         |
  |------------------------&gt;|                         |
  |   ack                   |                         |
  |&lt;------------------------|   SIP INVITE            |
  |                         |------------------------&gt;|
  |                         |   200 OK                |
  |                         |&lt;------------------------|
  |   session-accept        |                         |
  |&lt;------------------------|                         |
  |   ack                   |                         |
  |------------------------&gt;|                         |
  |                    MEDIA SESSION                  |
  |&lt;=================================================&gt;|
  |                         |   SIP BYE               |
  |                         |&lt;------------------------|
  |   session-terminate     |                         |
  |&lt;------------------------|                         |
  |   ack                   |                         |
  |------------------------&gt;|   ack                   |
  |                         |------------------------&gt;|
  |                         |                         |
</pre></figure>
    <p class="" style="">The protocol flow is as follows, showing only the stanzas sent between Romeo and the gateway (acting on Juliet's behalf).</p>
    <figure class="code-example" id="example-9"><figcaption><strong>Example 9.</strong> Initiator sends session-initiate<a class="anchor-link" href="#example-9"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='romeo@montague.lit/orchard'
    id='p01hf63x'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:1'
          action='session-initiate'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='voice'&gt;
      &lt;description xmlns='urn:xmpp:jingle:apps:rtp:1' media='audio'&gt;
        &lt;payload-type id='96' name='speex' clockrate='16000'/&gt;
        &lt;payload-type id='97' name='speex' clockrate='8000'/&gt;
        &lt;payload-type id='18' name='G729'/&gt;
        &lt;payload-type id='103' name='L16' clockrate='16000' channels='2'/&gt;
        &lt;payload-type id='98' name='x-ISAC' clockrate='8000'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:1'
                 pwd='asd88fgpdd777uzjYhagZg'
                 ufrag='8hhy'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='0'
                   id='el0747fg11'
                   ip='10.0.1.1'
                   network='1'
                   port='8998'
                   priority='2130706431'
                   protocol='udp'
                   type='host'/&gt;
        &lt;candidate component='1'
                   foundation='2'
                   generation='0'
                   id='y3s2b30v3r'
                   ip='192.0.2.3'
                   network='1'
                   port='45664'
                   priority='1694498815'
                   protocol='udp'
                   rel-addr='10.0.1.1'
                   rel-port='8998'
                   type='srflx'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
</pre></figure>
    <figure class="code-example" id="example-10"><figcaption><strong>Example 10.</strong> Responder acknowledges session-initiate<a class="anchor-link" href="#example-10"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    id='p01hf63x'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
</pre></figure>
    <p class="" style="">Immediately the gateway sends a transport-replace message to Romeo, specifying a transport of Raw UDP with a candidate whose IP address and port identify a media relay at the gateway.</p>
    <figure class="code-example" id="example-11"><figcaption><strong>Example 11.</strong> Gateway sends transport-replace on behalf of responder<a class="anchor-link" href="#example-11"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    id='hy2gd714'
    to='romeo@montague.lit/orchard'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:1'
          action='transport-replace'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='voice1'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:raw-udp:1'&gt;
        &lt;candidate generation='0'
                   id='a9j3mnbtu1'
                   ip='10.1.1.104'
                   port='13540'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">Romeo then acknowledges the transport-replace message and immediately also sends a transport-accept.</p>
    <figure class="code-example" id="example-12"><figcaption><strong>Example 12.</strong> Initiator acknowledges transport-replace<a class="anchor-link" href="#example-12"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='romeo@montague.lit/orchard'
    id='hy2gd714'
    to='juliet@capulet.lit/balcony'
    type='result'/&gt;
</pre></figure>
    <figure class="code-example" id="example-13"><figcaption><strong>Example 13.</strong> Initiator accepts new transport<a class="anchor-link" href="#example-13"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='romeo@montague.lit/orchard'
    id='rb391gs5'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:1'
          action='transport-accept'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='responder' name='voice2'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:raw-udp:1'&gt;
        &lt;candidate generation='0'
                   id='a9j3mnbtu1'
                   ip='10.1.1.104'
                   port='13540'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">The gateway then acknowledges the acceptance on behalf of Juliet.</p>
    <figure class="code-example" id="example-14"><figcaption><strong>Example 14.</strong> Gateway acknowledges transport-accept<a class="anchor-link" href="#example-14"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    id='rb391gs5'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
</pre></figure>
    <p class="" style="">The responder then sends a session-accept through the gateway.</p>
    <figure class="code-example" id="example-15"><figcaption><strong>Example 15.</strong> Responder sends session-accept<a class="anchor-link" href="#example-15"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    id='ijf61d43'
    to='romeo@montague.lit/orchard'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:1'
          action='session-accept'
          initiator='romeo@montague.lit/orchard'
          responder='juliet@capulet.lit/balcony'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='voice'&gt;
      &lt;description xmlns='urn:xmpp:jingle:apps:rtp:1' media='audio'&gt;
        &lt;payload-type id='18' name='G729'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:raw-udp:1'/&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
</pre></figure>
    <figure class="code-example" id="example-16"><figcaption><strong>Example 16.</strong> Initiator acknowledges session-accept<a class="anchor-link" href="#example-16"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='romeo@montague.lit/orchard'
    id='ijf61d43'
    to='juliet@capulet.lit/balcony'
    type='result'/&gt;
</pre></figure>
    <p class="" style="">The endpoints now begin to exchange session media, and can continue the session as long as desired.</p>
<h2 id="support">7.
       Determining Support<a class="anchor-link" href="#support"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="support-ice">7.1 ICE Support<a class="anchor-link" href="#support-ice"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">To advertise its support for the Jingle ICE-UDP Transport Method, when replying to <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0030.html">Service Discovery (XEP-0030)</a></span>  [<a href="#nt-idm523">15</a>] information requests an entity MUST return URNs for any version of this protocol that the entity supports -- e.g., "urn:xmpp:jingle:transports:ice-udp:1" for this version and "urn:xmpp:jingle:transports:ice-udp:0" for the previous version (see <a href="#registrar-versioning">Namespace Versioning</a> regarding the possibility of incrementing the version number).</p>
    <figure class="code-example" id="example-17"><figcaption><strong>Example 17.</strong> Service discovery information request<a class="anchor-link" href="#example-17"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='romeo@montague.lit/orchard'
    id='cv5x41g9'
    to='juliet@capulet.lit/balcony'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
</pre></figure>
  <figure class="code-example" id="example-18"><figcaption><strong>Example 18.</strong> Service discovery information response<a class="anchor-link" href="#example-18"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    id='cv5x41g9'
    to='romeo@montague.lit/orchard'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;feature var='urn:xmpp:jingle:1'/&gt;
    &lt;feature var='urn:xmpp:jingle:transports:ice-udp:0'/&gt;
    &lt;feature var='urn:xmpp:jingle:transports:ice-udp:1'/&gt;
    &lt;feature var='urn:xmpp:jingle:apps:rtp:1'/&gt;
    &lt;feature var='urn:xmpp:jingle:apps:rtp:audio'/&gt;
    &lt;feature var='urn:xmpp:jingle:apps:rtp:video'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></figure>
    <p class="" style="">In order for an application to determine whether an entity supports this protocol, where possible it SHOULD use the dynamic, presence-based profile of service discovery defined in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0115.html">Entity Capabilities (XEP-0115)</a></span>  [<a href="#nt-idm531">16</a>]. However, if an application has not received entity capabilities information from an entity, it SHOULD use explicit service discovery instead.</p>
  </div>
  <div class="indent"><h3 id="support-sdp">7.2 SDP Offer / Answer Support<a class="anchor-link" href="#support-sdp"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">If an entity supports the SDP offer / answer model described in <span class="ref">RFC 3264</span> and therefore prefers to receive multiple candidates in a single transport-info message, it MUST advertise support for the "urn:ietf:rfc:3264" service discovery feature. Typically this feature will be advertised only by gateways between Jingle and SIP.</p>
    <figure class="code-example" id="example-19"><figcaption><strong>Example 19.</strong> Service discovery information request<a class="anchor-link" href="#example-19"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='romeo@montague.lit/orchard'
    id='ce81f5d6'
    to='sip.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
</pre></figure>
  <figure class="code-example" id="example-20"><figcaption><strong>Example 20.</strong> Service discovery information response<a class="anchor-link" href="#example-20"><abbr title="Link to this point in the document">¶</abbr></a></figcaption><pre class="prettyprint">
&lt;iq from='sip.shakespeare.lit'
    id='ce81f5d6'
    to='romeo@montague.lit/orchard'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;feature var='urn:ietf:rfc:3264'/&gt;
    &lt;feature var='urn:xmpp:jingle:1'/&gt;
    &lt;feature var='urn:xmpp:jingle:transports:ice-udp:0'/&gt;
    &lt;feature var='urn:xmpp:jingle:transports:ice-udp:1'/&gt;
    &lt;feature var='urn:xmpp:jingle:apps:rtp:1'/&gt;
    &lt;feature var='urn:xmpp:jingle:apps:rtp:audio'/&gt;
    &lt;feature var='urn:xmpp:jingle:apps:rtp:video'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></figure>
  </div>
<h2 id="impl">8.
       Implementation Notes<a class="anchor-link" href="#impl"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">In order to speed the negotiation process so that media can flow as quickly as possible, the initiator SHOULD gather and prioritize candidates in advance, or as soon as the principal begins the process of initiating a session.</p>
<h2 id="deploy">9.
       Deployment Notes<a class="anchor-link" href="#deploy"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">This specification applies exclusively to Jingle clients and places no additional requirements on XMPP servers. However, service administrators might wish to deploy a STUN server in order to ease the client-to-client negotiation process and a TURN server for media relaying (see <span class="ref" style=""><a href="http://tools.ietf.org/html/draft-ietf-behave-turn">TURN</a></span>  [<a href="#nt-idm544">17</a>]). Deployment of support for <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0215.html">External Service Discovery (XEP-0215)</a></span>  [<a href="#nt-idm548">18</a>] might also be helpful.</p>
<h2 id="security">10.
       Security Considerations<a class="anchor-link" href="#security"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="security-sharing">10.1 Sharing IP Addresses<a class="anchor-link" href="#security-sharing"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">By definition, the exchange of transport candidates results in exposure of the sender's IP addresses, which comprise a form of personally identifying information. A Jingle client MUST enable a user to control which entities will be allowed to receive such information. If a human user explicitly accepts a session request, then the client SHOULD consider that action to imply approval of IP address sharing. However, waiting for a human user to explicitly accept the session request can result in delays during session setup, since it is more efficient to immediately begin sharing transport candidates. Therefore, it is RECOMMENDED for the client to immediately send transport candidates to a contact (without waiting for explicit user approval of the session request) in the following cases:</p>
    <ol start="" class="" style="">
      <li class="" style="">The user has permanently and formally authorized the contact to view the user's presence information via a presence subscription as reflected in an XMPP roster item (see <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc6121">XMPP IM</a></span>  [<a href="#nt-idm557">19</a>]).</li>
      <li class="" style="">The user has temporarily and dynamically shared presence with the contact via "directed presence" as described in <span class="ref">RFC 3921</span>.</li>
      <li class="" style="">The user has explicitly added the contact to a "whitelist" of entities who are allowed to access the user's personally-identifying information.</li>
    </ol>
  </div>
  <div class="indent"><h3 id="security-media">10.2 Encryption of Media<a class="anchor-link" href="#security-media"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">A Jingle implementation SHOULD support security preconditions that are enforced before application media is allowed to flow over a UDP association, such as those described in <span class="ref" style=""><a href="http://tools.ietf.org/html/draft-meyer-xmpp-e2e-encryption">Jingle XTLS</a></span>  [<a href="#nt-idm566">20</a>].</p>
    <p class="" style="">Application types that use the Jingle ICE-UDP transport method MAY also define their own application-specific encryption methods, such as the Secure Real-time Transport Protocol (SRTP) for RTP exchanges as described in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0167.html">Jingle RTP Sessions (XEP-0167)</a></span>  [<a href="#nt-idm571">21</a>].</p>
  </div>
<h2 id="iana">11.
       IANA Considerations<a class="anchor-link" href="#iana"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">This document requires no interaction with the <span class="ref" style=""><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-idm577">22</a>].</p>
<h2 id="registrar">12.
       XMPP Registrar Considerations<a class="anchor-link" href="#registrar"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <div class="indent"><h3 id="registrar-ns">12.1 Protocol Namespaces<a class="anchor-link" href="#registrar-ns"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">This specification defines the following XML namespace:</p>
    <ul class="" style="">
      <li class="" style="">urn:xmpp:jingle:transports:ice-udp:1</li>
    </ul>
    <p class="" style="">The <span class="ref" style=""><a href="https://xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-idm587">23</a>] includes the foregoing namespace in its registry at &lt;<a href="https://xmpp.org/registrar/namespaces.html">https://xmpp.org/registrar/namespaces.html</a>&gt;, as governed by <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0053.html">XMPP Registrar Function (XEP-0053)</a></span>  [<a href="#nt-idm592">24</a>].</p>
  </div>
  <div class="indent"><h3 id="registrar-versioning">12.2 Protocol Versioning<a class="anchor-link" href="#registrar-versioning"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">If the protocol defined in this specification undergoes a revision that is not fully backwards-compatible with an older version, the XMPP Registrar shall increment the protocol version number found at the end of the XML namespaces defined herein, as described in Section 4 of <span class="ref">XEP-0053</span>.</p>
  </div>
  <div class="indent"><h3 id="registrar-features">12.3 Service Discovery Features<a class="anchor-link" href="#registrar-features"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">If an entity supports the SDP offer / answer model described in <span class="ref">RFC 3264</span> and therefore prefers to receive one transport-info message with multiple candidates, it MUST advertise support for the "urn:ietf:rfc:3264" feature.</p>
    <p class="" style="">The registry submission is as follows.</p>
    <figure class="code"><figcaption>Registry Submission</figcaption><pre class="prettyprint">
&lt;var&gt;
  &lt;name&gt;urn:ietf:rfc:3264&lt;/name&gt;
  &lt;desc&gt;
    Signals support for the SDP offer / answer model
    described in RFC 3264
  &lt;/desc&gt;
  &lt;doc&gt;XEP-0176&lt;/doc&gt;
&lt;/var&gt;
</pre></figure>
  </div>
  <div class="indent"><h3 id="registrar-transports">12.4 Jingle Transport Methods<a class="anchor-link" href="#registrar-transports"><abbr title="Link to this point in the document">¶</abbr></a></h3>
    <p class="" style="">The XMPP Registrar includes "ice-udp" in its registry of Jingle transport methods at &lt;<a href="https://xmpp.org/registrar/jingle-transports.html">https://xmpp.org/registrar/jingle-transports.html</a>&gt;. The registry submission is as follows:</p>
    <figure class="code"><figcaption></figcaption><pre class="prettyprint">
&lt;transport&gt;
  &lt;name&gt;ice-udp&lt;/name&gt;
  &lt;desc&gt;
    A method for negotiation of out-of-band UDP connections
    with built-in NAT and firewall traversal, equivalent to
    the IETF's Interactive Connectivity Establishment (ICE)
    methodology when resulting in the use of UDP as the
    transport protocol.
  &lt;/desc&gt;
  &lt;type&gt;datagram&lt;/type&gt;
  &lt;doc&gt;XEP-0176&lt;/doc&gt;
&lt;/transport&gt;
</pre></figure>
  </div>
<h2 id="schema">13.
       XML Schema<a class="anchor-link" href="#schema"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <figure class="code"><figcaption></figcaption><pre class="prettyprint">
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='urn:xmpp:jingle:transports:ice-udp:1'
    xmlns='urn:xmpp:jingle:transports:ice-udp:1'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      XEP-0176: http://www.xmpp.org/extensions/xep-0176.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name='transport'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0'&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name='candidate'
                      type='candidateElementType'
                      minOccurs='1'
                      maxOccurs='unbounded'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name='remote-candidate'
                      type='remoteCandidateElementType'
                      minOccurs='1'
                      maxOccurs='1'/&gt;
        &lt;/xs:sequence&gt;
      &lt;/xs:choice&gt;
      &lt;xs:attribute name='pwd' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='ufrag' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:complexType name='candidateElementType'&gt;
    &lt;xs:simpleContent&gt;
      &lt;xs:extension base='empty'&gt;
        &lt;xs:attribute name='component' type='xs:unsignedByte' use='required'/&gt;
        &lt;xs:attribute name='foundation' type='xs:string' use='required'/&gt;
        &lt;xs:attribute name='generation' type='xs:unsignedByte' use='required'/&gt;
        &lt;xs:attribute name='id' type='xs:NCName' use='required'/&gt;
        &lt;xs:attribute name='ip' type='xs:string' use='required'/&gt;
        &lt;xs:attribute name='port' type='xs:unsignedShort' use='required'/&gt;
        &lt;xs:attribute name='priority' type='xs:positiveInteger' use='required'/&gt;
        &lt;xs:attribute name='protocol' type='xs:NCName' use='required'/&gt;
        &lt;xs:attribute name='rel-addr' type='xs:string' use='optional'/&gt;
        &lt;xs:attribute name='rel-port' type='xs:unsignedShort' use='optional'/&gt;
        &lt;xs:attribute name='network' type='xs:unsignedByte' use='optional'/&gt;
        &lt;xs:attribute name='type' use='required'&gt;
          &lt;xs:simpleType&gt;
            &lt;xs:restriction base='xs:NCName'&gt;
              &lt;xs:enumeration value='host'/&gt;
              &lt;xs:enumeration value='prflx'/&gt;
              &lt;xs:enumeration value='relay'/&gt;
              &lt;xs:enumeration value='srflx'/&gt;
            &lt;/xs:restriction&gt;
          &lt;/xs:simpleType&gt;
        &lt;/xs:attribute&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:simpleContent&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:complexType name='remoteCandidateElementType'&gt;
    &lt;xs:simpleContent&gt;
      &lt;xs:extension base='empty'&gt;
        &lt;xs:attribute name='component' type='xs:unsignedByte' use='required'/&gt;
        &lt;xs:attribute name='ip' type='xs:string' use='required'/&gt;
        &lt;xs:attribute name='port' type='xs:unsignedShort' use='required'/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:simpleContent&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
</pre></figure>
<h2 id="ack">14.
       Acknowledgements<a class="anchor-link" href="#ack"><abbr title="Link to this point in the document">¶</abbr></a></h2>
  <p class="" style="">Thanks to Diana Cionoiu, Olivier Crête, Tim Julien, Steffen Larsen, Robert McQueen, Mike Ruprecht, Justin Uberti, Unnikrishnan Vikrama Panicker, and Paul Witty for their feedback.</p>
<hr><a name="appendices"></a><h2>Appendices</h2><h3 id="appendix-docinfo">Appendix A: Document Information<a class="anchor-link" href="#appendix-docinfo"><abbr title="Link to this point in the document">¶</abbr></a></h3><dl class="compact"><dt>Series</dt><dd><a href="http://xmpp.org/extensions/">XEP</a></dd><dt>Number</dt><dd>0176</dd><dt>Publisher</dt><dd><a href="/xsf/">XMPP Standards Foundation</a></dd><dt>Status</dt><dd><a href="http://xmpp.org/extensions/xep-0001.html#states-Draft">Draft</a></dd><dt>Type</dt><dd><a href="http://xmpp.org/extensions/xep-0001.html#types-Standards%20Track">Standards Track</a></dd><dt>Version</dt><dd>1.1</dd><dt>Last Updated</dt><dd>2020-11-27</dd><dt>Approving Body</dt><dd><a href="http://xmpp.org/council/">XMPP Council</a></dd><dt>Dependencies</dt><dd>XMPP Core, XEP-0166</dd><dt>Supersedes</dt><dd>None</dd><dt>Superseded By</dt><dd>None</dd><dt>Short Name</dt><dd>jingle-ice-udp</dd><dt>Schema</dt><dd>
        XML Schema for the 'jingle:transports:ice-udp' namespace: &lt;<a href="http://xmpp.org/schemas/jingle-transports-ice-udp.xsd">http://xmpp.org/schemas/jingle-transports-ice-udp.xsd</a>&gt;<br></dd><dt>Source Control</dt><dd><a class="standardsButton" href="https://github.com/xsf/xeps/blob/master/xep-0176.xml">HTML</a></dd></dl><p>
          This document in other formats:
          <a class="standardsButton" href="http://xmpp.org/extensions/xep-0176.xml">XML</a> 
          <a class="standardsButton" href="http://xmpp.org/extensions/xep-0176.pdf">PDF</a></p><h3 id="appendix-authorinfo">Appendix B: Author Information<a class="anchor-link" href="#appendix-authorinfo"><abbr title="Link to this point in the document">¶</abbr></a></h3><h5>Joe Beda</h5><dl class="compact"><dt>Email</dt><dd><a href="mailto:jbeda@google.com">jbeda@google.com</a></dd><dt>JabberID</dt><dd><a href="xmpp:jbeda@google.com">jbeda@google.com</a></dd></dl><h5>Scott Ludwig</h5><dl class="compact"><dt>Email</dt><dd><a href="mailto:scottlu@google.com">scottlu@google.com</a></dd><dt>JabberID</dt><dd><a href="xmpp:scottlu@google.com">scottlu@google.com</a></dd></dl><h5>Peter Saint-Andre</h5><dl class="compact"><dt>Email</dt><dd><a href="mailto:xsf@stpeter.im">xsf@stpeter.im</a></dd><dt>JabberID</dt><dd><a href="xmpp:peter@jabber.org">peter@jabber.org</a></dd><dt>URI</dt><dd><a href="http://stpeter.im/">http://stpeter.im/</a></dd></dl><h5>Joe Hildebrand</h5><dl class="compact"><dt>Email</dt><dd><a href="mailto:jhildebr@cisco.com">jhildebr@cisco.com</a></dd><dt>JabberID</dt><dd><a href="xmpp:hildjj@jabber.org">hildjj@jabber.org</a></dd></dl><h5>Sean Egan</h5><dl class="compact"><dt>Email</dt><dd><a href="mailto:seanegan@google.com">seanegan@google.com</a></dd><dt>JabberID</dt><dd><a href="xmpp:seanegan@google.com">seanegan@google.com</a></dd></dl><h5>Robert McQueen</h5><dl class="compact"><dt>Email</dt><dd><a href="mailto:robert.mcqueen@collabora.co.uk">robert.mcqueen@collabora.co.uk</a></dd><dt>JabberID</dt><dd><a href="xmpp:robert.mcqueen@collabora.co.uk">robert.mcqueen@collabora.co.uk</a></dd></dl><h3 id="appendix-legal">Appendix C: Legal Notices<a class="anchor-link" href="#appendix-legal"><abbr title="Link to this point in the document">¶</abbr></a></h3><div class="indent"><h4>Copyright</h4><p>This XMPP Extension Protocol is copyright © 1999 – 2020 by the <a href="https://xmpp.org/">XMPP Standards Foundation</a> (XSF).</p><h4>Permissions</h4><p>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.</p><h4>Disclaimer of Warranty</h4><p class="box info">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. ##</p><h4>Limitation of Liability</h4><p>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.</p><h4>IPR Conformance</h4><p>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which can be found at &lt;<a href="https://xmpp.org/about/xsf/ipr-policy">https://xmpp.org/about/xsf/ipr-policy</a>&gt; or obtained by writing to XMPP Standards Foundation, P.O. Box 787, Parker, CO 80134 USA).</p><h4>Visual Presentation</h4><p>The HTML representation (you are looking at) is maintained by the XSF. It is based on the <a href="http://yaml.de">YAML CSS Framework</a>, which is licensed under the terms of the <a href="https://creativecommons.org/licenses/by/2.0/">CC-BY-SA 2.0</a> license.</p></div><h3 id="appendix-xmpp">Appendix D: Relation to XMPP<a class="anchor-link" href="#appendix-xmpp"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 6120) and XMPP IM (RFC 6121) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><h3 id="appendix-discuss">Appendix E: Discussion Venue<a class="anchor-link" href="#appendix-discuss"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">There exists a special venue for discussion related to the technology described in this document: the &lt;<a href="http://mail.jabber.org/mailman/listinfo/jingle">jingle@xmpp.org</a>&gt; mailing list.</p><p class="indent">The primary venue for discussion of XMPP Extension Protocols is the &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">standards@xmpp.org</a>&gt; discussion list.</p><p class="indent">Discussion on other xmpp.org discussion lists might also be appropriate; see &lt;<a href="http://xmpp.org/about/discuss.shtml">http://xmpp.org/about/discuss.shtml</a>&gt; for a complete list.</p><p class="indent">Errata can be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><h3 id="appendix-conformance">Appendix F: Requirements Conformance<a class="anchor-link" href="#appendix-conformance"><abbr title="Link to this point in the document">¶</abbr></a></h3><p class="indent">The following requirements keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><h3 id="appendix-notes">Appendix G: Notes<a class="anchor-link" href="#appendix-notes"><abbr title="Link to this point in the document">¶</abbr></a></h3><div class="indent"><p><a name="nt-idm68">1</a>. RFC 8445: Interactive Connectivity Establishment (ICE) &lt;<a href="http://tools.ietf.org/html/rfc8445">http://tools.ietf.org/html/rfc8445</a>&gt;.</p><p><a name="nt-idm246">2</a>. XEP-0166: Jingle &lt;<a href="https://xmpp.org/extensions/xep-0166.html">https://xmpp.org/extensions/xep-0166.html</a>&gt;.</p><p><a name="nt-idm251">3</a>. RFC 768: User Datagram Protocol &lt;<a href="http://tools.ietf.org/html/rfc0768">http://tools.ietf.org/html/rfc0768</a>&gt;.</p><p><a name="nt-idm255">4</a>. RFC 5245: Interactive Connectivity Establishment (ICE) &lt;<a href="http://tools.ietf.org/html/rfc5245">http://tools.ietf.org/html/rfc5245</a>&gt;.</p><p><a name="nt-idm268">5</a>. RFC 4566: SDP: Session Description Protocol &lt;<a href="http://tools.ietf.org/html/rfc4566">http://tools.ietf.org/html/rfc4566</a>&gt;.</p><p><a name="nt-idm273">6</a>. RFC 3264: An Offer/Answer Model with the Session Description Protocol (SDP) &lt;<a href="http://tools.ietf.org/html/rfc3264">http://tools.ietf.org/html/rfc3264</a>&gt;.</p><p><a name="nt-idm382">7</a>. In accordance with the rules specified in Section 4.1.1 of <span class="ref">ICE-CORE</span>, the priority values shown in the examples within this document have been calculated as follows. The "type preference" for host candidates is stipulated to be "126" and for server reflexive candidates "100". The "local preference" for network 0 is stipulated to be "4096", for network 1 "2048", and for network 2 "1024".</p><p><a name="nt-idm389">8</a>. Future specifications might define other values such as "tcp".</p><p><a name="nt-idm420">9</a>. Given in-order delivery as mandated by <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc6120">XMPP Core</a></span>  [<a href="#nt-idm423">10</a>], the responder will receive such transport-info messages after receiving the session-initiate message; if not, it is appropriate for the responder to return &lt;unknown-session/&gt; errors since according to its state machine the session does not exist.</p><p><a name="nt-idm423">10</a>. RFC 6120: Extensible Messaging and Presence Protocol (XMPP): Core &lt;<a href="http://tools.ietf.org/html/rfc6120">http://tools.ietf.org/html/rfc6120</a>&gt;.</p><p><a name="nt-idm426">11</a>. The fact that both parties send candidates means that Jingle requires each party to be a full implementation of ICE, not a lite implementation as specified in <span class="ref">ICE-CORE</span>.</p><p><a name="nt-idm443">12</a>. RFC 5389: Session Traversal Utilities for NAT (STUN) &lt;<a href="http://tools.ietf.org/html/rfc5389">http://tools.ietf.org/html/rfc5389</a>&gt;.</p><p><a name="nt-idm454">13</a>. Thus when Romeo sends a STUN Binding Request to Juliet the credentials will be STUN username "9uB6:8hhy" (ufrag provided by Juliet concatenated with ufrag provided by Romeo) and password "YH75Fviy6338Vbrhrlp8Yh" (pwd provided by Juliet) whereas when Juliet sends a STUN Binding Request to Romeo the credentials will be STUN username "8hhy:9uB6" (ufrag provided by Romeo concatenated with ufrag provided by Juliet) and password "asd88fgpdd777uzjYhagZg" (pwd provided by Romeo).</p><p><a name="nt-idm494">14</a>. XEP-0177: Jingle Raw UDP Transport Method &lt;<a href="https://xmpp.org/extensions/xep-0177.html">https://xmpp.org/extensions/xep-0177.html</a>&gt;.</p><p><a name="nt-idm523">15</a>. XEP-0030: Service Discovery &lt;<a href="https://xmpp.org/extensions/xep-0030.html">https://xmpp.org/extensions/xep-0030.html</a>&gt;.</p><p><a name="nt-idm531">16</a>. XEP-0115: Entity Capabilities &lt;<a href="https://xmpp.org/extensions/xep-0115.html">https://xmpp.org/extensions/xep-0115.html</a>&gt;.</p><p><a name="nt-idm544">17</a>. Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN) &lt;<a href="http://tools.ietf.org/html/draft-ietf-behave-turn">http://tools.ietf.org/html/draft-ietf-behave-turn</a>&gt;. Work in progress.</p><p><a name="nt-idm548">18</a>. XEP-0215: External Service Discovery &lt;<a href="https://xmpp.org/extensions/xep-0215.html">https://xmpp.org/extensions/xep-0215.html</a>&gt;.</p><p><a name="nt-idm557">19</a>. RFC 6121: Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence &lt;<a href="http://tools.ietf.org/html/rfc6121">http://tools.ietf.org/html/rfc6121</a>&gt;.</p><p><a name="nt-idm566">20</a>. Extensible Messaging and Presence Protocol (XMPP) End-to-End Encryption Using Transport Layer Security ("XTLS") &lt;<a href="http://tools.ietf.org/html/draft-meyer-xmpp-e2e-encryption">http://tools.ietf.org/html/draft-meyer-xmpp-e2e-encryption</a>&gt;.</p><p><a name="nt-idm571">21</a>. XEP-0167: Jingle RTP Sessions &lt;<a href="https://xmpp.org/extensions/xep-0167.html">https://xmpp.org/extensions/xep-0167.html</a>&gt;.</p><p><a name="nt-idm577">22</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p><p><a name="nt-idm587">23</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="https://xmpp.org/registrar/">https://xmpp.org/registrar/</a>&gt;.</p><p><a name="nt-idm592">24</a>. XEP-0053: XMPP Registrar Function &lt;<a href="https://xmpp.org/extensions/xep-0053.html">https://xmpp.org/extensions/xep-0053.html</a>&gt;.</p></div><h3 id="appendix-revs">Appendix H: Revision History<a class="anchor-link" href="#appendix-revs"><abbr title="Link to this point in the document">¶</abbr></a></h3><p>Note: Older versions of this specification might be available at <a href="http://xmpp.org/extensions/attic/">http://xmpp.org/extensions/attic/</a></p><ol class="revision-history"><li id="revision-history-v1.1"><div class="revision-head">Version 1.1 (2020-11-27)<a class="anchor-link" href="#revision-history-v1.1"><abbr title="Link to this point in the document">¶</abbr></a></div>
      <ul class="" style="">
        <li class="" style="">Make the 'foundation' attribute a string instead of an unsignedByte, in accordance with <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc8445">RFC 8445</a></span>  [<a href="#nt-idm68">1</a>].</li>
        <li class="" style="">Make the 'network' attribute optional, and add a mapping to SDP.</li>
      </ul>
    <div class="revision-author">egp</div></li><li id="revision-history-v1.0"><div class="revision-head">Version 1.0 (2009-06-10)<a class="anchor-link" href="#revision-history-v1.0"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Per a vote of the XMPP Council, advanced specification from Experimental to Draft.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.27"><div class="revision-head">Version 0.27 (2009-05-27)<a class="anchor-link" href="#revision-history-v0.27"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Clarified ICE restarts and use of the generation attribute, in accordance with the ICE specification.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.26"><div class="revision-head">Version 0.26 (2009-03-09)<a class="anchor-link" href="#revision-history-v0.26"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Minor changes to track modifications to XEP-0166.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.25"><div class="revision-head">Version 0.25 (2009-02-26)<a class="anchor-link" href="#revision-history-v0.25"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Specified that pwd and ufrag attributes must be included when sending the first candidate; removed rem-addr and rem-port attributes and instead defined transport-info payload for communication of the remote candidate.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.24"><div class="revision-head">Version 0.24 (2009-02-17)<a class="anchor-link" href="#revision-history-v0.24"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Simplified flow by including candidates in session-initiate and session-accept.</p><div class="revision-author">psa/rm</div></li><li id="revision-history-v0.23"><div class="revision-head">Version 0.23 (2008-12-19)<a class="anchor-link" href="#revision-history-v0.23"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Specified id attribute and added it to the examples; updated namespaces to reflect changes to other Jingle specifications; completed editorial review.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.22"><div class="revision-head">Version 0.22 (2008-09-30)<a class="anchor-link" href="#revision-history-v0.22"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Corrected fallback scenario to use transport-replace and transport-accept.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.21"><div class="revision-head">Version 0.21 (2008-09-25)<a class="anchor-link" href="#revision-history-v0.21"><abbr title="Link to this point in the document">¶</abbr></a></div>
      <ul class="" style="">
        <li class="" style="">Added section on fallback to Raw UDP transport method.</li>
        <li class="" style="">Modified namespaces to incorporate namespace versioning.</li>
        <li class="" style="">Cleaned up XML schemas.</li>
      </ul>
    <div class="revision-author">psa</div></li><li id="revision-history-v0.20"><div class="revision-head">Version 0.20 (2008-07-31)<a class="anchor-link" href="#revision-history-v0.20"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">For consistency with XEP-0166, removed profile attribute, changed content-replace to transport-replace, and changed content-accept to transport-accept.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.19"><div class="revision-head">Version 0.19 (2008-06-04)<a class="anchor-link" href="#revision-history-v0.19"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Allowed batching of multiple candidates in a single transport-info message for optional interworking with the SDP offer-answer model, and added urn:ietf:rfc:3264 service discovery feature to advertise such support; updated security considerations regarding sharing of IP addresses.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.18"><div class="revision-head">Version 0.18 (2008-05-28)<a class="anchor-link" href="#revision-history-v0.18"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Removed content-replace message from acceptance flow, since in ICE that information is sent via STUN, not in the signalling channel.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.17"><div class="revision-head">Version 0.17 (2008-03-20)<a class="anchor-link" href="#revision-history-v0.17"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Moved pwd and ufrag attributes from candidate element to transport element since they describe session-level or media-level information.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.16"><div class="revision-head">Version 0.16 (2008-02-29)<a class="anchor-link" href="#revision-history-v0.16"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Changed content-modify to content-replace per XEP-0166.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.15"><div class="revision-head">Version 0.15 (2008-01-06)<a class="anchor-link" href="#revision-history-v0.15"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Clarified several small points regarding candidate gathering procedures and STUN connectivity checks.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.14"><div class="revision-head">Version 0.14 (2008-01-02)<a class="anchor-link" href="#revision-history-v0.14"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Modified flow for ICE completion to require content-modify from initiator to responder, thus mapping to sending of revised offer in SIP; added rem-addr and rem-port attributes to map to a=remote-candidates information in SDP; changed raddr and rport attributes to rel-addr and rel-port to prevent confusion with rem-addr and rem-port attributes.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.13"><div class="revision-head">Version 0.13 (2007-12-28)<a class="anchor-link" href="#revision-history-v0.13"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Added further details about connectivity checks; defined raddr and rport attributes for complete mapping to SDP.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.12"><div class="revision-head">Version 0.12 (2007-11-28)<a class="anchor-link" href="#revision-history-v0.12"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Moved ice-tcp definition to a separate specification.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.11"><div class="revision-head">Version 0.11 (2007-11-27)<a class="anchor-link" href="#revision-history-v0.11"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Further editorial review; also added sections on modification of existing candidates and exchange of subsequent candidates.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.10"><div class="revision-head">Version 0.10 (2007-11-15)<a class="anchor-link" href="#revision-history-v0.10"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Editorial review and consistency check.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.9"><div class="revision-head">Version 0.9 (2007-06-28)<a class="anchor-link" href="#revision-history-v0.9"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Updated to track ICE-16.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.8"><div class="revision-head">Version 0.8 (2007-04-17)<a class="anchor-link" href="#revision-history-v0.8"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Separately defined ice-tcp and ice-udp transport methods to enable clearer definition of transport methods and reuse by application types; specified Jingle conformance, including definition of ice-udp as datagram and ice-tcp as streaming.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.7"><div class="revision-head">Version 0.7 (2007-03-23)<a class="anchor-link" href="#revision-history-v0.7"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Updated to track ICE-14 and ICE-TCP-03; moved text on discovery of STUN servers to separate specification.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.6"><div class="revision-head">Version 0.6 (2006-12-21)<a class="anchor-link" href="#revision-history-v0.6"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Modified spec to use provisional namespace before advancement to Draft (per XEP-0053).</p><div class="revision-author">psa</div></li><li id="revision-history-v0.5"><div class="revision-head">Version 0.5 (2006-10-31)<a class="anchor-link" href="#revision-history-v0.5"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Updated to track ICE-12; corrected service discovery process; completed editorial review; removed mention of DTMF, which is for audio only.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.4"><div class="revision-head">Version 0.4 (2006-09-13)<a class="anchor-link" href="#revision-history-v0.4"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Updated to track ICE-10; added section on service discovery.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.3"><div class="revision-head">Version 0.3 (2006-07-12)<a class="anchor-link" href="#revision-history-v0.3"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Specified that DTMF must use in-band signalling (XEP-0181).</p><div class="revision-author">se/psa</div></li><li id="revision-history-v0.2"><div class="revision-head">Version 0.2 (2006-03-24)<a class="anchor-link" href="#revision-history-v0.2"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Recommended use of RTP-native methods for DTMF.</p><div class="revision-author">psa</div></li><li id="revision-history-v0.1"><div class="revision-head">Version 0.1 (2006-03-01)<a class="anchor-link" href="#revision-history-v0.1"><abbr title="Link to this point in the document">¶</abbr></a></div><p class="" style="">Initial version (split from XEP-0166).</p><div class="revision-author">psa/jb</div></li></ol><p>END</p></body></html>
