<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0327: Rayo</title><link rel="stylesheet" type="text/css" href="xmpp.css" /><link href="prettify.css" type="text/css" rel="stylesheet" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><script type="text/javascript" src="prettify.js"></script><meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0" /><meta name="DC.Title" content="Rayo" /><meta name="DC.Creator" content="Ben Langfeld" /><meta name="DC.Creator" content="Jose de Castro" /><meta name="DC.Description" content="This specification defines an XMPP protocol extension for the third-party control of telephone calls and other similar media sessions. The protocol includes support for session management/signaling, as well as advanced media resources such as speech recognizers, speech synthesizers and audio/video recorders. The protocol serves a different purpose from that of first-party protocols such as Jingle or SIP, and is compatible with those protocols." /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2018-11-03" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0327" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright &#xA9; 1999 &#x2013; 2018 by the XMPP Standards Foundation (XSF)." /></head><body onload="prettyPrint()"><h1>XEP-0327: Rayo</h1><table><tr valign="top"><td><strong>Abstract:</strong></td><td>This specification defines an XMPP protocol extension for the third-party control of telephone calls and other similar media sessions. The protocol includes support for session management/signaling, as well as advanced media resources such as speech recognizers, speech synthesizers and audio/video recorders. The protocol serves a different purpose from that of first-party protocols such as Jingle or SIP, and is compatible with those protocols.</td></tr><tr valign="top"><td><strong>Authors:</strong></td><td>Ben Langfeld, Jose de Castro</td></tr><tr valign="top"><td><strong>Copyright:</strong></td><td>© 1999 – 2018 XMPP Standards Foundation. <a href="#appendix-legal">SEE LEGAL NOTICES</a>.</td></tr><tr valign="top"><td><strong>Status:</strong></td><td>Deferred</td></tr><tr valign="top"><td><strong>Type:</strong></td><td>Standards Track</td></tr><tr valign="top"><td><strong>Version:</strong></td><td>0.8.1</td></tr><tr valign="top"><td><strong>Last Updated:</strong></td><td>2018-11-03</td></tr></table><hr /><p style="color:red">WARNING: This document has been automatically Deferred after 12 months of inactivity in its previous Experimental state. Implementation of the protocol described herein is not recommended for production systems. However, exploratory implementations are encouraged to resume the standards process.</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#intro">Introduction</a><br />2.  <a href="#howitworks">How it works</a><br />3.  <a href="#reqs">Requirements</a><br />4.  <a href="#terms">Terminology</a><br />   
      4.1.  <a href="#terms-glossary">Glossary</a><br />   
      4.2.  <a href="#terms-conventions">Conventions</a><br />5.  <a href="#concepts">Concepts and Approach</a><br />   
      5.1.  <a href="#concepts-actors">Actors</a><br />      
      5.1.1.  <a href="#concepts-actors-server">Server</a><br />      
      5.1.2.  <a href="#concepts-actors-client">Client(s)</a><br />      
      5.1.3.  <a href="#concepts-actors-calls">Calls</a><br />      
      5.1.4.  <a href="#concepts-actors-mixers">Mixers</a><br />      
      5.1.5.  <a href="#concepts-actors-commands">Commands</a><br />      
      5.1.6.  <a href="#concepts-actors-components">Components</a><br />      
      5.1.7.  <a href="#concepts-actors-remote-party">Remote Party</a><br />   
      5.2.  <a href="#addressing">Addressing Scheme</a><br />   
      5.3.  <a href="#concepts-delivery">Delivery Mechanism</a><br />6.  <a href="#session">Session Flow</a><br />   
      6.1.  <a href="#session-registration">Client Registration</a><br />   
      6.2.  <a href="#session-establishment">Session Establishment</a><br />      
      6.2.1.  <a href="#session-establishment-outbound">Outbound Call</a><br />        
      6.2.1.1.  <a href="#session-establishment-outbound-errors">Errors</a><br />        
      6.2.1.2.  <a href="#session-establishment-outbound-nested-join">Nested join</a><br />      
      6.2.2.  <a href="#session-establishment-inbound">Inbound Call</a><br />   
      6.3.  <a href="#session-joining">Joining Calls</a><br />      
      6.3.1.  <a href="#session-joining-errors">Errors</a><br />      
      6.3.2.  <a href="#session-joining-unjoin-command">Unjoin Command</a><br />        
      6.3.2.1.  <a href="#session-joining-unjoin-command-errors">Errors</a><br />      
      6.3.3.  <a href="#session-joining-unjoined-event">Unjoined Event</a><br />      
      6.3.4.  <a href="#session-joining-multiple">Multiple Joins</a><br />   
      6.4.  <a href="#session-mixers">Mixers</a><br />   
      6.5.  <a href="#session-component-execution">Component Execution</a><br />      
      6.5.1.  <a href="#session-component-initial-errors">Initial Errors</a><br />      
      6.5.2.  <a href="#session-component-command-errors">Command Errors</a><br />      
      6.5.3.  <a href="#session-component-execution-output">Output Component</a><br />        
      6.5.3.1.  <a href="#session-component-exection-output-joins">Join considerations</a><br />        
      6.5.3.2.  <a href="#session-component-execution-output-commands">Commands</a><br />        
      6.5.3.3.  <a href="#session-component-execution-output-events">Events</a><br />        
      6.5.3.4.  <a href="#session-component-execution-output-completion">Completion</a><br />      
      6.5.4.  <a href="#session-component-execution-input">Input Component</a><br />        
      6.5.4.1.  <a href="#session-component-exection-input-joins">Join considerations</a><br />        
      6.5.4.2.  <a href="#session-component-execution-input-commands">Commands</a><br />        
      6.5.4.3.  <a href="#session-component-execution-input-events">Events</a><br />        
      6.5.4.4.  <a href="#session-component-execution-input-completion">Completion</a><br />      
      6.5.5.  <a href="#session-component-execution-prompt">Prompt Component</a><br />        
      6.5.5.1.  <a href="#session-component-exection-prompt-joins">Join considerations</a><br />        
      6.5.5.2.  <a href="#session-component-execution-prompt-commands">Commands</a><br />        
      6.5.5.3.  <a href="#session-component-execution-prompt-events">Events</a><br />        
      6.5.5.4.  <a href="#session-component-execution-prompt-completion">Completion</a><br />      
      6.5.6.  <a href="#session-component-execution-record">Record Component</a><br />        
      6.5.6.1.  <a href="#session-component-exection-record-joins">Join considerations</a><br />        
      6.5.6.2.  <a href="#session-component-execution-record-commands">Commands</a><br />        
      6.5.6.3.  <a href="#session-component-execution-record-events">Events</a><br />        
      6.5.6.4.  <a href="#session-component-execution-record-completion">Completion</a><br />   
      6.6.  <a href="#session-termination">Session Termination</a><br />      
      6.6.1.  <a href="#session-termination-redirection">Call Redirection</a><br />      
      6.6.2.  <a href="#session-termination-rejection">Call Rejection</a><br />      
      6.6.3.  <a href="#session-termination-hangup">Call Hangup</a><br />      
      6.6.4.  <a href="#session-termination-end">Call End Notification</a><br />   
      6.7.  <a href="#session-headers">Headers</a><br />   
      6.8.  <a href="#session-im">Instant Messages</a><br />      
      6.8.1.  <a href="#session-im-call-bound">Call-bound Messages</a><br />7.  <a href="#def">Formal Definition</a><br />   
      7.1.  <a href="#def-header">Header Element</a><br />   
      7.2.  <a href="#def-offer">Offer Element</a><br />   
      7.3.  <a href="#def-ringing">Ringing Element</a><br />   
      7.4.  <a href="#def-answered">Answered Element</a><br />   
      7.5.  <a href="#def-end">End Element</a><br />      
      7.5.1.  <a href="#def-end-reason">End Reason Element</a><br />   
      7.6.  <a href="#def-accept">Accept Element</a><br />   
      7.7.  <a href="#def-answer">Answer Element</a><br />   
      7.8.  <a href="#def-redirect">Redirect Element</a><br />   
      7.9.  <a href="#def-reject">Reject Element</a><br />      
      7.9.1.  <a href="#def-reject-reason">Reject Reason Element</a><br />   
      7.10.  <a href="#def-hangup">Hangup Element</a><br />   
      7.11.  <a href="#def-dial">Dial Element</a><br />   
      7.12.  <a href="#def-join">Join Element</a><br />   
      7.13.  <a href="#def-unjoin">Unjoin Element</a><br />   
      7.14.  <a href="#def-joined">Joined Element</a><br />   
      7.15.  <a href="#def-unjoined">Unjoined Element</a><br />   
      7.16.  <a href="#def-started-speaking">Started Speaking Element</a><br />   
      7.17.  <a href="#def-stopped-speaking">Stopped Speaking Element</a><br />   
      7.18.  <a href="#def-ref">Ref Element</a><br />   
      7.19.  <a href="#def-components">Components</a><br />      
      7.19.1.  <a href="#def-components-stop">Stop Element</a><br />      
      7.19.2.  <a href="#def-components-complete">Complete Element</a><br />        
      7.19.2.1.  <a href="#def-components-complete-reason">Complete Reason Element</a><br />      
      7.19.3.  <a href="#def-component-output">Media Output</a><br />        
      7.19.3.1.  <a href="#def-component-output-output">Output Element</a><br />        
      7.19.3.2.  <a href="#def-component-output-pause">Pause Element</a><br />        
      7.19.3.3.  <a href="#def-component-output-resume">Resume Element</a><br />        
      7.19.3.4.  <a href="#def-component-output-speedup">SpeedUp Element</a><br />        
      7.19.3.5.  <a href="#def-component-output-speeddown">SpeedDown Element</a><br />        
      7.19.3.6.  <a href="#def-component-output-volumeup">VolumeUp Element</a><br />        
      7.19.3.7.  <a href="#def-component-output-volumedown">VolumeDown Element</a><br />        
      7.19.3.8.  <a href="#def-component-output-seek">Seek Element</a><br />        
      7.19.3.9.  <a href="#def-component-output-finish">Finish Element</a><br />        
      7.19.3.10.  <a href="#def-component-output-maxtime">MaxTime Element</a><br />      
      7.19.4.  <a href="#def-component-input">Media Input</a><br />        
      7.19.4.1.  <a href="#def-component-input-input">Input Element</a><br />        
      7.19.4.2.  <a href="#def-component-input-match">Match</a><br />        
      7.19.4.3.  <a href="#def-component-input-noinput">Noinput</a><br />        
      7.19.4.4.  <a href="#def-component-input-nomatch">Nomatch</a><br />      
      7.19.5.  <a href="#def-component-prompt">Prompt</a><br />        
      7.19.5.1.  <a href="#def-component-input-input">Prompt Element</a><br />        
      7.19.5.2.  <a href="#def-component-prompt-input-timers-started">Input Timers Started Element</a><br />      
      7.19.6.  <a href="#def-component-record">Media Recording</a><br />        
      7.19.6.1.  <a href="#def-component-record-record">Record Element</a><br />        
      7.19.6.2.  <a href="#def-component-record-pause">Pause Element</a><br />        
      7.19.6.3.  <a href="#def-component-record-resume">Resume Element</a><br />        
      7.19.6.4.  <a href="#def-component-record-recording">Recording Element</a><br />        
      7.19.6.5.  <a href="#def-component-record-max-duration">Max Duration Element</a><br />        
      7.19.6.6.  <a href="#def-component-record-initial-timeout">Initial Timeout Element</a><br />        
      7.19.6.7.  <a href="#def-component-record-final-timeout">Final Timeout Element</a><br />8.  <a href="#support">Determining Support</a><br />9.  <a href="#extensions">Extending Rayo</a><br />10.  <a href="#impl">Implementation Notes</a><br />11.  <a href="#security">Security Considerations</a><br />   
      11.1.  <a href="#security-dos">Denial of Service</a><br />   
      11.2.  <a href="#security-gateways">Communication Through Gateways</a><br />   
      11.3.  <a href="#security-info">Information Exposure</a><br />12.  <a href="#iana">IANA Considerations</a><br />13.  <a href="#registrar">XMPP Registrar Considerations</a><br />   
      13.1.  <a href="#registrar-ns">Protocol Namespaces</a><br />   
      13.2.  <a href="#registrar-versioning">Namespace Versioning</a><br />   
      13.3.  <a href="#registrar-components">Rayo Components Registry</a><br />14.  <a href="#schema">XML Schema</a><br />   
      14.1.  <a href="#schema-rayo">Rayo</a><br />   
      14.2.  <a href="#schema-rayo-ext">Rayo Ext</a><br />   
      14.3.  <a href="#schema-rayo-ext-complete">Rayo Ext Complete</a><br />   
      14.4.  <a href="#schema-rayo-output">Rayo Output</a><br />   
      14.5.  <a href="#schema-rayo-output-complete">Rayo Output Complete</a><br />   
      14.6.  <a href="#schema-rayo-input">Rayo Input</a><br />   
      14.7.  <a href="#schema-rayo-input-complete">Rayo Input Complete</a><br />   
      14.8.  <a href="#schema-rayo-prompt">Rayo Prompt</a><br />   
      14.9.  <a href="#schema-rayo-record">Rayo Record</a><br />   
      14.10.  <a href="#schema-rayo-record-complete">Rayo Record Complete</a><br />15.  <a href="#history">History</a><br />16.  <a href="#acknowledgements">Acknowledgements</a></p><p><a href="#appendices">Appendices</a><br />    <a href="#appendix-docinfo">A: Document Information</a><br />    <a href="#appendix-authorinfo">B: Author Information</a><br />    <a href="#appendix-legal">C: Legal Notices</a><br />    <a href="#appendix-xmpp">D: Relation to XMPP</a><br />    <a href="#appendix-discuss">E: Discussion Venue</a><br />    <a href="#appendix-conformance">F: Requirements Conformance</a><br />    <a href="#appendix-notes">G: Notes</a><br />    <a href="#appendix-revs">H: Revision History</a></p></div><hr /><h2>1.
       <a name="intro" id="intro">Introduction</a></h2>
  <p class="" style="">Rayo is a protocol to allow third-party remote control over media sessions, audio/video mixers and a variety of advanced media resources such as speech recognizers, speech synthesizers and audio/video recorders. These capabilities can be combined to create a wide variety of applications such as menu-based phone systems, in-game conferencing and anonymous dating services. Unlike <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0166.html">Jingle (XEP-0166)</a></span>  [<a href="#nt-idm97">1</a>] or even SIP (<span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3261">RFC 3261</a></span>  [<a href="#nt-idm101">2</a>]), a Rayo client is not concerned with being a party to either the session negotiation or the media stream itself.</p>

  <ul class="" style="">
    <li class="" style="">A Rayo server takes on the role of negotiating a media session between itself and some other endpoint, or between two external endpoints, by way of an implementation-specific means, be that Jingle, SIP, the public-switched telephone network, or anything else. The server may even bridge multiple networks.</li>
    <li class="" style="">The server then presents the Rayo protocol as an interface to a Rayo client, allowing it to monitor and/or exercise third-party control over the established media sessions.</li>
    <li class="" style="">The client has the option to accept/reject/answer inbound session requests, request the creation of outbound sessions and monitor their progress, execute media operations such as speech synthesis, speech recognition &amp; recording, and to end sessions.</li>
  </ul>

  <p class="" style="">The relationship between the calling parties, the Rayo server and the Rayo client looks something like this:</p>
  <p class="caption"></p><div class="indent"><pre class="prettyprint">
    [caller] ----e.g. SIP---- [rayo server] ( -----e.g. Jingle---- [callee] ) optional
                              |
                              |
                          rayo client
  </pre></div>

  <p class="" style="">This document defines the core Rayo protocol, and contains provisions for its extension by further specifications.</p>
<h2>2.
       <a name="howitworks" id="howitworks">How it works</a></h2>
  <p class="" style="">In order to understand the nature of a Rayo interaction, here we show a simple example of a control session.</p>

  <p class="caption"><a name="example-1" id="example-1"></a>Example 1. New call announces itself to a potential controlling party</p><div class="indent"><pre class="prettyprint">
&lt;presence from='9f00061@call.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     hash='sha-1'
     node='urn:xmpp:rayo:call:1'
     ver='QgayPKawpkPSDYmwT/WM94uAlu0='/&gt;
  &lt;offer xmlns='urn:xmpp:rayo:1'
         to='tel:+18003211212'
         from='tel:+13058881212'/&gt;
&lt;/presence&gt;
</pre></div>

  <p class="" style="">In this example, a call from 'tel:+13058881212' has reached the Rayo server 'shakespeare.lit' by calling 'tel:+18003211212', and been assigned an ID '9f00061'. The server has determined that 'juliet@capulet.lit' is a valid candidate to be the client to whom the server delegates control of the call, and so has directed an <a href="#def-offer">offer event</a> to her 'balcony' resource.</p>

  <p class="" style="">The client, 'juliet@capulet.lit', then decides that it is able to handle the incoming call, and so accepts it from the server, thus gaining exclusive control and indicating to the calling party that the call will be processed and that it should ring.</p>

  <p class="caption"><a name="example-2" id="example-2"></a>Example 2. Potential controlling party attempts to become definitive controlling party by sending the call an accept command</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit'
    type='set'
    id='hd721'&gt;
  &lt;accept xmlns='urn:xmpp:rayo:1'/&gt;
&lt;/iq&gt;
</pre></div>

  <p class="caption"><a name="example-3" id="example-3"></a>Example 3. Call acknowledges accept command to the (now) definitive controlling party</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='hd721'/&gt;
</pre></div>

  <p class="" style="">Following confirmation from the server that the attempt to gain control of the call was successful, the client proceeds to answer the call, opening up the media stream between the caller and the server.</p>

  <p class="caption"><a name="example-4" id="example-4"></a>Example 4. Controlling party answers the call</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit'
    type='set'
    id='43jo3'&gt;
  &lt;answer xmlns='urn:xmpp:rayo:1'/&gt;
&lt;/iq&gt;
</pre></div>

  <p class="caption"><a name="example-5" id="example-5"></a>Example 5. Call acknowledges answer command to controlling party</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='43jo3'/&gt;
</pre></div>

  <p class="" style="">Once the client has confirmation that the call has been answered, it triggers the start of a media output component in order to play a message to the caller using a Text-to-speech (TTS) engine.</p>

  <p class="caption"><a name="example-6" id="example-6"></a>Example 6. Controlling party requests a new output component</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit'
    type='set'
    id='j9d3j'&gt;
  &lt;output xmlns='urn:xmpp:rayo:output:1'
          voice='allison'&gt;
    &lt;document content-type="text/plain"&gt;
      &lt;![CDATA[
        You have no new messages. Goodbye!
      ]]&gt;
    &lt;/document&gt;
  &lt;/output&gt;
&lt;/iq&gt;
</pre></div>

  <p class="caption"><a name="example-7" id="example-7"></a>Example 7. Call acknowledges request for new output component and provides its ID</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='j9d3j'&gt;
  &lt;ref xmlns='urn:xmpp:rayo:1' uri='xmpp:9f00061@call.shakespeare.lit/fgh4590'/&gt;
&lt;/iq&gt;
</pre></div>

  <p class="" style="">After confirmation that the output component was successfully created, the client then awaits notification of its completion.</p>

  <p class="caption"><a name="example-8" id="example-8"></a>Example 8. Output component announces its completion, giving the reason</p><div class="indent"><pre class="prettyprint">
&lt;presence from='9f00061@call.shakespeare.lit/fgh4590'
          to='juliet@capulet.lit/balcony'
          type='unavailable'&gt;
 &lt;complete xmlns='urn:xmpp:rayo:ext:1'&gt;
   &lt;finish xmlns='urn:xmpp:rayo:output:complete:1' /&gt;
 &lt;/complete&gt;
&lt;/presence&gt;
</pre></div>

  <p class="" style="">The client then decides it has no further operations to perform on the call, and that the call should end. It instructs the server to hang up the call gracefully.</p>

  <p class="caption"><a name="example-9" id="example-9"></a>Example 9. Controlling party hangs up the call</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit'
    type='set'
    id='f3wh8'&gt;
  &lt;hangup xmlns='urn:xmpp:rayo:1'/&gt;
&lt;/iq&gt;
</pre></div>

  <p class="caption"><a name="example-10" id="example-10"></a>Example 10. Call acknowledges hangup command to controlling party</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='f3wh8'/&gt;
</pre></div>

  <p class="caption"><a name="example-11" id="example-11"></a>Example 11. Controlling party receives notification of the call being terminated</p><div class="indent"><pre class="prettyprint">
&lt;presence from='9f00061@call.shakespeare.lit'
          to='juliet@capulet.lit/balcony'
          type='unavailable'&gt;
  &lt;end xmlns='urn:xmpp:rayo:1'&gt;
    &lt;hangup-command/&gt;
  &lt;/end&gt;
&lt;/presence&gt;
</pre></div>
<h2>3.
       <a name="reqs" id="reqs">Requirements</a></h2>
  <p class="" style="">The protocol defined herein is designed to provide the following features:</p>
  <ol start="" class="" style="">
    <li class="" style=""><span class="strong">Call Control:</span> Incoming calls are "offered" to clients at which point they can be answered, rejected, redirected to another destination, etc. Outbound calls may also be made and monitored. Every attempt is made to be shield the Rayo client from the low level telephony protocol (e.g. SIP, Jingle, PSTN, etc).</li>
    <li class="" style=""><span class="strong">Audio File Playback:</span> A compatible Rayo server will fetch a file from a a specified URL and play the containing audio to the caller.</li>
    <li class="" style=""><span class="strong">Speech Synthesis / TTS:</span> In cases where dynamic data must be spoken, a Speech Synthesis engine may be used to play computer generated speech to the caller.</li>
    <li class="" style=""><span class="strong">Touch-tone Events / DTMF:</span> Rayo surfaces real-time event when the caller presses keys on their touch-tone keypad.</li>
    <li class="" style=""><span class="strong">Speech Recognition:</span> Enables the phone application to take spoken queues allowing for sophisticated voice-driven menus and directory services.</li>
    <li class="" style=""><span class="strong">Call Recording:</span> Can be used to capture the caller's voice (e.g. Voicemail) or both sides of the call for auditing and compliance purposes.</li>
    <li class="" style=""><span class="strong">Mixing:</span> Typically referred to as an audio "conference"; calls can be joined together so that the participants can hear each other in real-time.</li>
  </ol>

  <p class="" style="">Many third-party call control protocols have preceeded Rayo (see Asterisk's AGI/AMI, FreeSWITCH's eventsocket, Microsoft's TAPI, Java's JTAPI, Novell/AT&amp;T's TSAPI, CSTA, etc). None of these protocols is ideal, and all have one or more of the following drawbacks:</p>
  <ul class="" style="">
    <li class="" style=""><span class="strong">Totally ground-up wire protocol</span> requiring implementation all the way down to the socket.</li>
    <li class="" style=""><span class="strong">Platform/vendor/hardware specific</span> - each system implements its own proprietary protocol (in many cases, without a formal published specification) which does not allow easily porting an application from one back-end to another.</li>
    <li class="" style=""><span class="strong">Synchronous interface</span> - Operations on calls or other entities are often blocking, and one must serialise all control messages.</li>
    <li class="" style=""><span class="strong">Inconsistent</span> - evolved, rather than designed.</li>
    <li class="" style=""><span class="strong">Lacking in scalability</span> - client/server sometimes tied one-to-one, servers rarely clustered, advanced message routing not possible.</li>
    <li class="" style=""><span class="strong">Poor security</span> - lack of wire-level encryption, lack of or sub-standard authentication mechanisms, lack of or limited authorization mechanisms, lack of or poor sandboxing between multiple tenants on one system.</li>
    <li class="" style=""><span class="strong">Inextensible</span> - The specification of extensions to the core protocol is either impossible or very difficult.</li>
  </ul>

  <p class="" style="">Rayo has been designed with these failings in mind, and intends to address many concerns not addressed by these earlier attempts. The following considerations were made:</p>
  <ul class="" style="">
    <li class="" style=""><span class="strong">Simple client library implementation</span> - XMPP client libraries exist in all modern languages, and many are of a high standard of quality and maturity.</li>
    <li class="" style=""><span class="strong">Cross-platform standard</span> - The protocol must not expose any platform specifics and all elements should be candidates for implementation on any suitable platform. Addiditionally, the protocol must be ratified as a standard following a community discussion.</li>
    <li class="" style=""><span class="strong">Asynchronous interface</span> - The protocol should present an asynchronous interface for the purposes of performance and flexibility in performing parallel operations.</li>
    <li class="" style=""><span class="strong">Consistent</span> - The protocol must provide a considered, unobtrusive, logically and philisophically consistent interface.</li>
    <li class="" style=""><span class="strong">Federated</span> - The protocol must support communication between client and server entities on separately owned, operated and addressed networks.</li>
    <li class="" style=""><span class="strong">Flexible routing</span> - The protocol must lend itself to routing across wide networks such as the internet, and to potential complex routing such as proxying or redirection. Additionally, the client and server should each be aware of the presence of the other and be able to use such information to make routing decisions.</li>
    <li class="" style=""><span class="strong">Extensible</span> - The protocol must provide for the possibility of extra functionality being added by future specifications or an individual implementation.</li>
    <li class="" style=""><span class="strong">Secure</span> - The protocol should include appropriate measures for authentication and authorization of participants, as well as preventing third-parties from intercepting control messages.</li>
  </ul>

  <p class="" style="">Many of the features in the above list are available to Rayo at no specification or implementation cost, since they are core to XMPP itself and thus Rayo inherits these 'for free'.</p>

  <p class="" style="">Additionally, the protocol is required to abstract away the complexity of the back-end negotiation, especially the details of the transport protocols such as SIP or Jingle, but to map conceptually to such protocols.</p>
<h2>4.
       <a name="terms" id="terms">Terminology</a></h2>
  <div class="indent"><h3>4.1 <a name="terms-glossary" id="terms-glossary">Glossary</a></h3>
    <div class="indent"><dl>
      <di>
        <dt><strong>Third-party call control (3PCC)</strong></dt>
        <dd>The observation and/or control of a live media session by an entity which is not a direct party to the session.</dd>
      </di>
      <di>
        <dt><strong>Command</strong></dt>
        <dd>Commands instruct the receiving entity to perform some atomic action. Commands may be executed against a given call, component or mixer and can be considered completed as soon as they receive a response. Some commands create components, and return a reference to the component in their response.</dd>
      </di>
      <di>
        <dt><strong>Component</strong></dt>
        <dd>Components extend the Rayo protocol by providing additional media and call control functionality. Components are created by an appropriate command, which returns a reference to the component. Components are executed asynchronously, and have a lifecycle attached to them, with the ability to trigger events or have commands issued to it. Once a component is stopped or comes to an end naturally, it will issue a special &lt;complete/&gt; event, indicating that it has ceased executing and deliver any required data.</dd>
      </di>
      <di>
        <dt><strong>Potential controlling party (PCP)</strong></dt>
        <dd>An XMPP entity to which an offer to control an incoming call may be sent.</dd>
      </di>
      <di>
        <dt><strong>Definitive controlling party (DCP)</strong></dt>
        <dd>The XMPP entity which gains a lock on control of a session, either by requesting the session's creation, or being the first respondent to an offer.</dd>
      </di>
      <di>
        <dt><strong>Security Zone</strong></dt>
        <dd>A security zone is the conceptual border around a call which defines which parties may interact with the call's media or signaling. A security zone MUST contain the rayo server's internal implementation, the media server to which the call is joined, the DCP, and any JID whose bare form is the same as the DCP. A server MAY relax this definition further, for example to consider all JIDs at the same domain to be in the same security zone.</dd>
      </di>
    </dl></div>
  </div>

  <div class="indent"><h3>4.2 <a name="terms-conventions" id="terms-conventions">Conventions</a></h3>
    <p class="" style="">In examples, the following JIDs are used:</p>
    <ul class="" style="">
      <li class="" style=""><span class="strong">juliet@capulet.lit/balcony, romeo@montague.lit/orchard</span> - Potential controlling parties</li>
      <li class="" style=""><span class="strong">shakespeare.lit</span> - The root domain of the Rayo service</li>
    </ul>
  </div>
<h2>5.
       <a name="concepts" id="concepts">Concepts and Approach</a></h2>
  <p class="" style="">A complete Rayo deployment has several elements and interacting entities which must be understood.</p>

  <div class="indent"><h3>5.1 <a name="concepts-actors" id="concepts-actors">Actors</a></h3>
    <div class="indent"><h3>5.1.1 <a name="concepts-actors-server" id="concepts-actors-server">Server</a></h3>
      <p class="" style="">A Rayo server is an entity which is capable of receiving and initiating calls and being party to their media stream, while exposing a Rayo interface to a client in order to permit control over its calls. The Rayo server may handle calls in any way supported by the implementation, such as SIP, Jingle, etc, and should expose a full XMPP domain at the root level of the service deployment (eg shakespeare.lit).</p>
      <p class="" style="">The Rayo server is responsible for keeping track of valid clients, routing calls to the correct potential controlling parties, performing authorization measures on received stanzas, etc.</p>
      <p class="" style="">For the purposes of this specification, complex server-side deployments such as clusters, proxies, gateways, protocol translators, etc are not considered. Further details of such concepts may be found in their (present or future) relevant specifications.</p>
    </div>
    <div class="indent"><h3>5.1.2 <a name="concepts-actors-client" id="concepts-actors-client">Client(s)</a></h3>
      <p class="" style="">A Rayo client is an entity which implements the Rayo protocol for the purpose of asserting control over calls made available by a Rayo server. The method by which such control measures are determined is outside the scope of this document, but may be the result of human interaction or some automated decision-making process.</p>
      <p class="" style="">A Rayo client is responsible for indicating its availability to a Rayo server and responding to offer messages appropriately.</p>
    </div>
    <div class="indent"><h3>5.1.3 <a name="concepts-actors-calls" id="concepts-actors-calls">Calls</a></h3>
      <p class="" style="">A Rayo call is a short-lived XMPP entity within the scope of the deployment's root domain, perhaps at a sub-domain, with the purpose of representing a single session. It is usually a simple alias for the main server process.</p>
      <p class="" style="">A Rayo call is the entity with which most client interactions are made, and is responsible for sending its events to and receiving commands from a client. Calls may host components.</p>
      <p class="" style="">Calls have separate presence from the root domain of the service and thus appear to be separate entities.</p>
    </div>
    <div class="indent"><h3>5.1.4 <a name="concepts-actors-mixers" id="concepts-actors-mixers">Mixers</a></h3>
      <p class="" style="">A Rayo mixer is an XMPP entity within the scope of the deployment's root domain, perhaps at a sub-domain, with the purpose of representing a service for the linking of media streams from several calls. It is usually a simple alias for the main server process.</p>
      <p class="" style="">A Rayo mixer is responsible for sending its events to and receiving commands from one or more clients, and can host components.</p>
      <p class="" style="">Mixers have separate presence from the root domain of the service and its calls and thus appear to be separate entities.</p>
    </div>
    <div class="indent"><h3>5.1.5 <a name="concepts-actors-commands" id="concepts-actors-commands">Commands</a></h3>
      <p class="" style="">A Rayo command is a simple combination of request and response and may be issued directly to the service domain, a call, a mixer or a component attached to any of the former. Commands are executed serially and are generally very short-lived.</p>
    </div>
    <div class="indent"><h3>5.1.6 <a name="concepts-actors-components" id="concepts-actors-components">Components</a></h3>
      <p class="" style="">Components extend the Rayo protocol by providing additional media and call control functionality.</p>

      <p class="" style="">Components have a lifecycle and are started by sending a specialized command to a call or mixer. Thus, a request for creation of a component will return a reference to the component's ID, and the component will continue to execute until it completes, potentially sending events and processing commands along the way (such as an instruction to pause or terminate), before finally issuing an event indicating its completion and thus unavailability. Multiple components may be active on a call or mixer at any one time, and commands may be executed on any entity during the execution of a component.</p>
    </div>
    <div class="indent"><h3>5.1.7 <a name="concepts-actors-remote-party" id="concepts-actors-remote-party">Remote Party</a></h3>
      <p class="" style="">A call's Remote Party is the software or device with which the Call's signalling (and optionally media) connection is established. This might be a software or hardware phone, a PBX, a gateway or some other such system.</p>
    </div>
  </div>

  <div class="indent"><h3>5.2 <a name="addressing" id="addressing">Addressing Scheme</a></h3>
    <p class="" style="">All of the actors described in the previous section (with the exception of commands) are represented by XMPP entities with a JID of their own. Thus, a scheme for determining the JIDs of each of these entities is required. The following is the required naming scheme for Rayo deployments, where elements in square brackets are optional.</p>
    <div class="indent"><p class="caption"><a name="table-1" id="table-1"></a>Table 1: </p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Actor</th>
        <th colspan="" rowspan="">JID format</th>
        <th colspan="" rowspan="">Example JID</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Server</td>
        <td align="" colspan="" rowspan="">[service domain]</td>
        <td align="" colspan="" rowspan="">shakespeare.lit</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Client</td>
        <td align="" colspan="" rowspan="">any JID</td>
        <td align="" colspan="" rowspan="">juliet@capulet.lit/balcony</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Call</td>
        <td align="" colspan="" rowspan="">&lt;call ID&gt;@[&lt;call sub-domain&gt;.]&lt;service domain&gt;</td>
        <td align="" colspan="" rowspan="">f88eh2@call.shakespeare.lit</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Mixer</td>
        <td align="" colspan="" rowspan="">&lt;mixer name&gt;@[&lt;mixer sub-domain&gt;.]&lt;service domain&gt;</td>
        <td align="" colspan="" rowspan="">conf1@mixer.shakespeare.lit</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Call Component</td>
        <td align="" colspan="" rowspan="">&lt;call ID&gt;@[&lt;call sub-domain&gt;.]&lt;service domain&gt;/&lt;component ID&gt;</td>
        <td align="" colspan="" rowspan="">f88eh2@call.shakespeare.lit/8f83jf</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Mixer Component</td>
        <td align="" colspan="" rowspan="">&lt;mixer name&gt;@[&lt;mixer sub-domain&gt;.]&lt;service domain&gt;/&lt;component ID&gt;</td>
        <td align="" colspan="" rowspan="">conf1@mixer.shakespeare.lit/932eu</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Server Component</td>
        <td align="" colspan="" rowspan="">&lt;service domain&gt;/&lt;component ID&gt;</td>
        <td align="" colspan="" rowspan="">shakespeare.lit/f3fg4</td>
      </tr>
    </table></div>
    <p class="" style="">Commands should be addressed to the entity on which they should be enacted. Individual commands only apply to certain object (for example instructing a component to hangup will return an error). In general, commands may be sent from a client to the service, a call, a mixer or a component. Events may be sent from a call, a mixer or a component to a client.</p>
  </div>

  <div class="indent"><h3>5.3 <a name="concepts-delivery" id="concepts-delivery">Delivery Mechanism</a></h3>
    <p class="" style="">Rayo defines several events and commands which may be executed on one of the above actors. These payloads must be sent within an XMPP primitive element, and the rules are as such:</p>
    <ul class="" style="">
      <li class="" style=""><span class="strong">Events:</span> Sent as directed presence from the entity producing the event to a client. Rayo servers SHOULD timestamp all events using <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0203.html">Delayed Delivery (XEP-0203)</a></span>  [<a href="#nt-idm279">3</a>] in order to allow clients to reliably use Rayo events for billing purposes.</li>
      <li class="" style=""><span class="strong">Commands:</span> Sent as an &lt;iq/&gt; with the 'type' attribute 'set' from the client to the entity to be acted on. Responses returned as an &lt;iq/&gt; with the 'type' attribute either 'result' or 'error'.</li>
    </ul>
  </div>
<h2>6.
       <a name="session" id="session">Session Flow</a></h2>
  <p class="" style="">This section describes the form, function and order of Rayo stanzas sent across the wire, and the circumstances in which they apply and/or may arise.</p>

  <div class="indent"><h3>6.1 <a name="session-registration" id="session-registration">Client Registration</a></h3>
    <p class="" style="">In order for a Rayo client to be considered a potential controlling party for incoming sessions, it MUST first notify the Rayo server that it is available for the receipt of calls. This is done by sending directed presence to the Rayo server with a &lt;show/&gt; element containing 'chat' as in the example:</p>
    <p class="caption"><a name="example-12" id="example-12"></a>Example 12. Client presents itself as available to the Rayo server</p><div class="indent"><pre class="prettyprint">
&lt;presence from='juliet@capulet.lit/balcony'
          to='shakespeare.lit'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     hash='sha-1'
     node='urn:xmpp:rayo:client:1'
     ver='QgayPKawpkPSDYmwT/WM94uAlu0='/&gt;
 &lt;show&gt;chat&lt;/show&gt;
&lt;/presence&gt;
</pre></div>

    <p class="" style="">Conversely, when a Rayo client wishes not to be considered a potential controlling party, it SHOULD send directed presence to the Rayo server with a &lt;show/&gt; element containing 'dnd' as in the example:</p>
    <p class="caption"><a name="example-13" id="example-13"></a>Example 13. Client presents itself as unavailable to the Rayo server</p><div class="indent"><pre class="prettyprint">
&lt;presence from='juliet@capulet.lit/balcony'
          to='shakespeare.lit'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     hash='sha-1'
     node='urn:xmpp:rayo:client:1'
     ver='QgayPKawpkPSDYmwT/WM94uAlu0='/&gt;
 &lt;show&gt;dnd&lt;/show&gt;
&lt;/presence&gt;
</pre></div>
  </div>

  <div class="indent"><h3>6.2 <a name="session-establishment" id="session-establishment">Session Establishment</a></h3>
    <p class="" style="">Sessions may be established either at the request of the Rayo client (an outbound call) or as a result of a 3rd party request (an inbound call). Each scenario differs in the Rayo protocol only up to the point at which the session is established and media begins to flow. First we shall examine the sequence of stanzas passed between server and client in each of these scenarios.</p>

    <div class="indent"><h3>6.2.1 <a name="session-establishment-outbound" id="session-establishment-outbound">Outbound Call</a></h3>
      <p class="" style="">In order for a client to establish a new outbound call, it MUST first send a <a href="#def-dial">dial command</a> to the server, indicating the proposed target for the call, its apparent source, and any metadata to send to the target as headers.</p>

      <p class="caption"><a name="example-14" id="example-14"></a>Example 14. Client requests establishment of a new outbound session</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;dial xmlns='urn:xmpp:rayo:1'
        to='tel:+13055195825'
        from='tel:+14152226789'&gt;
    &lt;header name="x-skill" value="agent" /&gt;
    &lt;header name="x-customer-id" value="8877" /&gt;
  &lt;/dial&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">On successfully receiving and parsing the dial command, the server SHOULD perform its own proprietary authorization measures to ensure that only desirable outbound sessions are created. If it is established that the command should not be allowed, the server MUST return an error giving an authorization reason.</p>

      <p class="" style="">If a 'uri' attribute is set on the dial command, the server MUST attempt to create the call at the requested URI. This allows clients to know the URI of the call prior to it coming into existence, for clients where this distinction might be important. Such a URI MUST be a valid Rayo call address.</p>

      <p class="" style="">The specified metadata in the form of the 'from' attribute and any &lt;header/&gt; elements SHOULD be mapped to the underlying signalling protocol for communication to the remote party.</p>

      <div class="indent"><h3>6.2.1.1 <a name="session-establishment-outbound-errors" id="session-establishment-outbound-errors">Errors</a></h3>
        <p class="" style="">There are several reasons why the server might immediately return an error instead of acknowledging the creation of a new call:</p>
        <ul class="" style="">
          <li class="" style="">The client is unknown to the server and the server does not permit session creation by unknown clients.</li>
          <li class="" style="">The client is not authorized to create this new session.</li>
          <li class="" style="">The server does not support outbound calls.</li>
          <li class="" style="">The server does not have sufficient resources to create a new session.</li>
          <li class="" style="">The dial command was malformed.</li>
          <li class="" style="">The requested URI conflicts with an existing call.</li>
        </ul>

        <p class="" style="">If the client is unknown to the server and the server does not permit session creation by unknown clients, the server MUST return a &lt;registration-required/&gt; error with a type of 'auth'.</p>
        <p class="caption"><a name="example-15" id="example-15"></a>Example 15. Server indicates client is unknown and the server does not permit session creation by unknown clients</p><div class="indent"><pre class="prettyprint">
&lt;iq from='shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;dial xmlns='urn:xmpp:rayo:1'
        to='tel:+13055195825'
        from='tel:+14152226789'&gt;
    &lt;header name="x-skill" value="agent" /&gt;
    &lt;header name="x-customer-id" value="8877" /&gt;
  &lt;/dial&gt;
  &lt;error type='auth'&gt;
    &lt;registration-required xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

        <p class="" style="">If the client is not authorized (as determined by an implementation/deployment-specific algorithm) to create a new outbound session given the parameters provided, the server MUST return a &lt;not-authorized/&gt; error with a type of 'auth'.</p>
        <p class="caption"><a name="example-16" id="example-16"></a>Example 16. Server indicates client is not authorized to create a new outbound session given the parameters provided</p><div class="indent"><pre class="prettyprint">
&lt;iq from='shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;dial xmlns='urn:xmpp:rayo:1'
        to='tel:+13055195825'
        from='tel:+14152226789'&gt;
    &lt;header name="x-skill" value="agent" /&gt;
    &lt;header name="x-customer-id" value="8877" /&gt;
  &lt;/dial&gt;
  &lt;error type='auth'&gt;
    &lt;not-authorized xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

        <p class="" style="">If the server does not support outbound calls, the server MUST return a &lt;feature-not-implemented/&gt; error with a type of 'cancel'.</p>
        <p class="caption"><a name="example-17" id="example-17"></a>Example 17. Server indicates that it does not support outbound calls</p><div class="indent"><pre class="prettyprint">
&lt;iq from='shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;dial xmlns='urn:xmpp:rayo:1'
        to='tel:+13055195825'
        from='tel:+14152226789'&gt;
    &lt;header name="x-skill" value="agent" /&gt;
    &lt;header name="x-customer-id" value="8877" /&gt;
  &lt;/dial&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

        <p class="" style="">If the server does not have sufficient resources to create a new session, the server MUST return a &lt;resource-constraint/&gt; error with a type of 'wait'.</p>
        <p class="caption"><a name="example-18" id="example-18"></a>Example 18. Server indicates that it does not have sufficient resources to create a new session</p><div class="indent"><pre class="prettyprint">
&lt;iq from='shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;dial xmlns='urn:xmpp:rayo:1'
        to='tel:+13055195825'
        from='tel:+14152226789'&gt;
    &lt;header name="x-skill" value="agent" /&gt;
    &lt;header name="x-customer-id" value="8877" /&gt;
  &lt;/dial&gt;
  &lt;error type='wait'&gt;
    &lt;resource-constraint xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

        <p class="" style="">If the dial command was malformed, the server MUST return a &lt;bad-request/&gt; error with a type of 'modify'.</p>
        <p class="caption"><a name="example-19" id="example-19"></a>Example 19. Server indicates the dial command was malformed</p><div class="indent"><pre class="prettyprint">
&lt;iq from='shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;dial xmlns='urn:xmpp:rayo:1'
        to='foo:bar'
        from='tel:+14152226789'&gt;
    &lt;header name="x-skill" value="agent" /&gt;
    &lt;header name="x-customer-id" value="8877" /&gt;
  &lt;/dial&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

        <p class="" style="">If the requested URI conflicts with an existing call, the server MUST return a &lt;conflict/&gt; error with a type of 'modify'.</p>
        <p class="caption"><a name="example-20" id="example-20"></a>Example 20. Server indicates the requested URI conflicts with an existing call</p><div class="indent"><pre class="prettyprint">
&lt;iq from='shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;dial xmlns='urn:xmpp:rayo:1'
        to='foo:bar'
        from='tel:+14152226789'
        uri='xmpp:somecall@capulet.lit'&gt;
    &lt;header name="x-skill" value="agent" /&gt;
    &lt;header name="x-customer-id" value="8877" /&gt;
  &lt;/dial&gt;
  &lt;error type='modify'&gt;
    &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>
      </div>

      <p class="" style="">If the command is successful and the call is queued, however, confirmation of such should be sent to the client, including a reference to the unique ID of the call. This call ID may be used to execute commands and filter events for the duration of the session.</p>
      <p class="caption"><a name="example-21" id="example-21"></a>Example 21. Confirmation of successful dial request and call ID</p><div class="indent"><pre class="prettyprint">
&lt;iq from='shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'&gt;
  &lt;ref xmlns='urn:xmpp:rayo:1' uri='xmpp:9f00061@call.shakespeare.lit'/&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">Once the server receives notification that the session has been accepted by the remote party, it should send a ringing event to the client to indicate such:</p>
      <p class="caption"><a name="example-22" id="example-22"></a>Example 22. Call announces its ringing state (accepted by 3rd party but not yet answered).</p><div class="indent"><pre class="prettyprint">
&lt;presence from='9f00061@call.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;ringing xmlns='urn:xmpp:rayo:1'/&gt;
&lt;/presence&gt;
</pre></div>

      <p class="" style="">Similarly, once the server receives notification that the session has been answered, it should negotiate media between the remote party and its local media server. Once media negotiation is complete, it should send an answered event to the client to indicate such:</p>
      <p class="caption"><a name="example-23" id="example-23"></a>Example 23. Call announces its answered state (media connected).</p><div class="indent"><pre class="prettyprint">
&lt;presence from='9f00061@call.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;answered xmlns='urn:xmpp:rayo:1'/&gt;
&lt;/presence&gt;
</pre></div>

      <div class="indent"><h3>6.2.1.2 <a name="session-establishment-outbound-nested-join" id="session-establishment-outbound-nested-join">Nested join</a></h3>
        <p class="" style="">When sending a dial request, a client MAY specify a join target within the dial element:</p>
        <p class="caption"><a name="example-24" id="example-24"></a>Example 24. Client requests establishment of a new outbound session, with a nested join</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;dial xmlns='urn:xmpp:rayo:1'
        to='tel:+13055195825'
        from='tel:+14152226789'&gt;
    &lt;join call-uri='xmpp:e8u398d902i90@call.shakespeare.lit' /&gt;
  &lt;/dial&gt;
&lt;/iq&gt;
</pre></div>

        <p class="" style="">In this case, the server MUST negotiate media as specified by the join element, in accordance with the rules defined in <a href="#session-joining">joining calls</a>. Media MUST NOT be negotiated with the local media server, unless the join specifies so. The join operation MUST behave as described in <a href="#session-joining">joining calls</a>.</p>
      </div>
    </div>

    <div class="indent"><h3>6.2.2 <a name="session-establishment-inbound" id="session-establishment-inbound">Inbound Call</a></h3>
      <p class="" style="">When the Server receives a call from one of its connected networks, it MUST then expose that requested session to Rayo clients. It SHOULD use an implementation-specific routing mechanism to map incoming calls to some set of registered JIDs which are considered appropriate controlling parties. From this set, it SHOULD then remove any parties whom it can identify as being temporarily inappropriate for control (either unavailable based on presence, under too much load, or any other metric which the server has available). If, as a result, the set of Potentially Controlling Parties is empty, the server MUST reject the call indicating that the requested service was unavailable.</p>

      <p class="" style="">If the server can identify active Potential Controlling Parties, it MUST offer them control of the call according to its particular distribution method, which MAY be simultaneous or staged. The server must broadcast an offer on behalf of the call to all Potential Controlling Parties, using applicable to/from/header data from the incoming session. The server MUST also include entity capabilities information in the presence stanza containing the offer, in order to advertise the fact that the entity is a call, qualified by the node name "urn:xmpp:rayo:call:1".</p>
      <p class="caption"><a name="example-25" id="example-25"></a>Example 25. New call announces itself to a potential controlling party</p><div class="indent"><pre class="prettyprint">
&lt;presence from='9f00061@call.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     hash='sha-1'
     node='urn:xmpp:rayo:call:1'
     ver='QgayPKawpkPSDYmwT/WM94uAlu0='/&gt;
  &lt;offer xmlns='urn:xmpp:rayo:1'
         to='tel:+18003211212'
         from='tel:+13058881212'&gt;
    &lt;header name="x-skill" value="agent" /&gt;
    &lt;header name="x-customer-id" value="8877" /&gt;
  &lt;/offer&gt;
&lt;/presence&gt;
</pre></div>

      <p class="" style="">Once the server has offered control, it MUST wait for a response from a PCP or for the remote party to end the call. The server SHOULD monitor the availability of PCPs to whom offers have been sent. If they all cease to be PCPs (eg by going offline) then the call should be rejected in the same way as if there had not been any available PCPs to begin with.</p>

      <p class="" style="">If an offered PCP executes a command against the call, by sending a command node to the call's JID inside an IQ 'set', the server should execute the following routine:</p>
      <ol start="" class="" style="">
        <li class="" style="">If the call does not have a DCP, set it to the PCP from which the command originated.</li>
        <li class="" style="">If the call has a DCP, and the command did not originate from the DCP, return a conflict (cancel) error in response to the command of the following format:
        <p class="caption"><a name="example-26" id="example-26"></a>Example 26. Server indicates that the call already has another DCP and that control of the call is no longer available.</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;accept xmlns='urn:xmpp:rayo:1'/&gt;
  &lt;error type='cancel'&gt;
    &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>
        otherwise;
        </li>
        <li class="" style="">If the command is an accept command, notify the remote calling party that the call has been accepted. Return an empty IQ result to the command issuing party to confirm successful execution.</li>
        <li class="" style="">If the command is an answer command, notify the remote calling party that the call has been answered and negotiate media between the calling party and the server's local media server. Return an empty IQ result to the command issuing party to confirm successful execution.</li>
        <li class="" style="">If the command is any other, handle it in the manner detailed in the following sections.</li>
      </ol>
    </div>
  </div>

  <div class="indent"><h3>6.3 <a name="session-joining" id="session-joining">Joining Calls</a></h3>
    <p class="" style="">Calls on a Rayo Server are capable of having their media streams moved/manipulated. Once such manipulation is to join the media streams of two calls. In a scenario where callA and callB should be joined, the client MUST send a join command to either call (not both) specifying the call ID of the other call, and optionally media attributes (direction and media) specified in the schema, like so:</p>
    <p class="caption"><a name="example-27" id="example-27"></a>Example 27. Client instructs callA to join to callB and the server acknowledges the join was completed</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='callA@call.shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;join xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callB@call.shakespeare.lit'/&gt;
&lt;/iq&gt;

&lt;iq from='callA@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;
</pre></div>

    <p class="" style="">If the calls to be joined to each other are in the same security zone, the server MUST join the media streams of the two calls and return an empty IQ result to confirm that the operation has been successful. If the parties to be joined are not within the same security zone, an error should be returned as detailed below.</p>

    <p class="" style="">When calls are joined to each other by any mechanism, each call MUST dispatch a joined event specifying who they have been joined to:</p>
    <p class="caption"><a name="example-28" id="example-28"></a>Example 28. Call A and B were joined, both calls emit joined events</p><div class="indent"><pre class="prettyprint">
&lt;presence from='callA@call.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;joined xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callB@call.shakespeare.lit'/&gt;
&lt;/presence&gt;

&lt;presence from='callB@call.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;joined xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callA@call.shakespeare.lit'/&gt;
&lt;/presence&gt;
</pre></div>

    <p class="" style="">By default, the server MUST join the calls by bridging their audio through its local media server, with bidirectional media. In order to specify alternative behaviour, the client MAY specify a media option (either 'bridge' or 'direct') and/or a direction option (either 'duplex', 'send' or 'recv'), and the server MUST bridge accordingly.</p>

    <div class="indent"><h3>6.3.1 <a name="session-joining-errors" id="session-joining-errors">Errors</a></h3>
      <p class="" style="">There are several reasons why the call might return an error instead of acknowledging a join:</p>
        <ul class="" style="">
          <li class="" style="">The specified join party does not exist or cannot be found.</li>
          <li class="" style="">The specified join party is inaccessible for the purposes of being joined due to security restrictions.</li>
          <li class="" style="">The server does not have sufficient resources to complete the join.</li>
          <li class="" style="">The join command was malformed.</li>
          <li class="" style="">The specified media/direction options or their combination are not possible/supported.</li>
        </ul>

        <p class="" style="">If the specified join party does not exist or cannot be found, the server MUST return a &lt;service-unavailable/&gt; error with a type of 'cancel'.</p>
        <p class="caption"><a name="example-29" id="example-29"></a>Example 29. Call indicates that the specified join party does not exist or cannot be found</p><div class="indent"><pre class="prettyprint">
&lt;iq from='callA@shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;join xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callC@call.shakespeare.lit'/&gt;
  &lt;error type='cancel'&gt;
    &lt;service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

        <p class="" style="">If the specified join party is inaccessible for the purposes of being joined due to security restrictions, the server MUST return a &lt;not-allowed/&gt; error with a type of 'cancel'.</p>
        <p class="caption"><a name="example-30" id="example-30"></a>Example 30. Call indicates that the specified join party is inaccessible for the purposes of being joined due to security restrictionss</p><div class="indent"><pre class="prettyprint">
&lt;iq from='callA@shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;join xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callC@call.shakespeare.lit'/&gt;
  &lt;error type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

        <p class="" style="">If the server does not have sufficient resources to complete the join, the server MUST return a &lt;resource-constraint/&gt; error with a type of 'wait'.</p>
        <p class="caption"><a name="example-31" id="example-31"></a>Example 31. Call indicates that there are not sufficient resources to complete the join</p><div class="indent"><pre class="prettyprint">
&lt;iq from='callA@shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;join xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callB@call.shakespeare.lit'/&gt;
  &lt;error type='wait'&gt;
    &lt;resource-constraint xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

        <p class="" style="">If the join command was malformed (eg no call URI specified), the server MUST return a &lt;bad-request/&gt; error with a type of 'modify'.</p>
        <p class="caption"><a name="example-32" id="example-32"></a>Example 32. Call indicates that the join command was malformed</p><div class="indent"><pre class="prettyprint">
&lt;iq from='callA@shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;join xmlns='urn:xmpp:rayo:1' call-uri='xmpp:'/&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

        <p class="" style="">If the specified media/direction options or their combination are not possible/supported, the server MUST return a &lt;feature-not-implemented/&gt; error with a type of 'modify'.</p>
        <p class="caption"><a name="example-33" id="example-33"></a>Example 33. Call indicates that the specified media/direction options or their combination are not possible/supported.</p><div class="indent"><pre class="prettyprint">
&lt;iq from='callA@shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;join xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callB@call.shakespeare.lit' media='direct' direction='recv'/&gt;
  &lt;error type='modify'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>
    </div>

    <div class="indent"><h3>6.3.2 <a name="session-joining-unjoin-command" id="session-joining-unjoin-command">Unjoin Command</a></h3>
      <p class="" style="">When the client wishes to terminate an existing join, it MUST send an unjoin command specifying the join to break (call-id).</p>
      <p class="caption"><a name="example-34" id="example-34"></a>Example 34. Client instructs callA to unjoin from callB</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='callA@call.shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;unjoin xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callB@call.shakespeare.lit'/&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">The server MUST unjoin the media streams of the two calls, rejoin both to the media server and return an empty IQ result to confirm that the operation has been successful:</p>
      <p class="caption"><a name="example-35" id="example-35"></a>Example 35. CallA acknowledges unjoin from callB</p><div class="indent"><pre class="prettyprint">
&lt;iq from='callA@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;
</pre></div>

      <p class="" style="">Optionally, if no join is specified on the unjoin command, all existing joins must be broken:</p>
      <p class="caption"><a name="example-36" id="example-36"></a>Example 36. Client instructs callA to unjoin from every existing join</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='callA@call.shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;unjoin xmlns='urn:xmpp:rayo:1'/&gt;
&lt;/iq&gt;

&lt;iq from='callA@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;
</pre></div>

      <div class="indent"><h3>6.3.2.1 <a name="session-joining-unjoin-command-errors" id="session-joining-unjoin-command-errors">Errors</a></h3>
        <p class="" style="">There are several reasons why the call might return an error instead of acknowledging an unjoin command:</p>
          <ul class="" style="">
            <li class="" style="">The specified join does not exist.</li>
            <li class="" style="">The unjoin command was malformed.</li>
          </ul>

          <p class="" style="">If the specified join does not exist, the server MUST return a &lt;service-unavailable/&gt; error with a type of 'cancel'.</p>
          <p class="caption"><a name="example-37" id="example-37"></a>Example 37. Call indicates that the specified join does not exist</p><div class="indent"><pre class="prettyprint">
  &lt;iq from='callA@shakespeare.lit'
      to='juliet@capulet.lit/balcony'
      type='error'
      id='h7ed2'&gt;
    &lt;join xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callC@call.shakespeare.lit'/&gt;
    &lt;error type='cancel'&gt;
      &lt;service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;/error&gt;
  &lt;/iq&gt;
</pre></div>

          <p class="" style="">If the unjoin command was malformed (eg an empty call URI specified), the server MUST return a &lt;bad-request/&gt; error with a type of 'modify'.</p>
          <p class="caption"><a name="example-38" id="example-38"></a>Example 38. Call indicates that the join command was malformed</p><div class="indent"><pre class="prettyprint">
  &lt;iq from='callA@shakespeare.lit'
      to='juliet@capulet.lit/balcony'
      type='error'
      id='h7ed2'&gt;
    &lt;unjoin xmlns='urn:xmpp:rayo:1' call-uri='xmpp:'/&gt;
    &lt;error type='modify'&gt;
      &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;/error&gt;
  &lt;/iq&gt;
</pre></div>
      </div>
    </div>

    <div class="indent"><h3>6.3.3 <a name="session-joining-unjoined-event" id="session-joining-unjoined-event">Unjoined Event</a></h3>
      <p class="" style="">Calls may be unjoined from other calls either in response to an unjoin command, as the result of one of the calls disconnecting, or as the result of an error. The server MUST monitor calls for being unjoined from another call, and emit an unjoined event when this is detected.</p>
      <p class="caption"><a name="example-39" id="example-39"></a>Example 39. CallA announces that it has been unjoined from callB, and vice versa</p><div class="indent"><pre class="prettyprint">
&lt;presence from='callA@call.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;unjoined xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callB@call.shakespeare.lit'/&gt;
&lt;/presence&gt;

&lt;presence from='callB@call.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;unjoined xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callA@call.shakespeare.lit'/&gt;
&lt;/presence&gt;
</pre></div>
    </div>

    <div class="indent"><h3>6.3.4 <a name="session-joining-multiple" id="session-joining-multiple">Multiple Joins</a></h3>
      <p class="" style="">If a client wishes to modify the parameters of a join, it MUST send a new join command to the target call with the new parameters. The server MUST renegotiate media using the new parameters, and acknowledge the command's completion. The server MUST NOT re-send joined events.</p>
      <p class="caption"><a name="example-40" id="example-40"></a>Example 40. Client joins callA to callB in receive-only mode, and then 'upgrades' the join to full-duplex</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='callA@call.shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;join xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callB@call.shakespeare.lit' direction='recv'/&gt;
&lt;/iq&gt;

&lt;iq from='callA@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;

&lt;presence from='callA@call.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;joined xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callB@call.shakespeare.lit'/&gt;
&lt;/presence&gt;

&lt;presence from='callB@call.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;joined xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callA@call.shakespeare.lit'/&gt;
&lt;/presence&gt;

&lt;iq from='juliet@capulet.lit/balcony'
    to='callA@call.shakespeare.lit'
    type='set'
    id='h7ed3'&gt;
  &lt;join xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callB@call.shakespeare.lit' direction='duplex'/&gt;
&lt;/iq&gt;

&lt;iq from='callA@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed3'/&gt;
</pre></div>

      <p class="" style="">Rayo calls SHOULD support being joined to more than one other call at a time, each join having different parameters. Creating a new join MUST NOT destroy existing joins. If a join is requested but cannot be created without destroying existing joins, the call MUST return a conflict (cancel) error.</p>

      <p class="caption"><a name="example-41" id="example-41"></a>Example 41. Call indicates that the requested joins cannot be created in parallel</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='callA@call.shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;join xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callB@call.shakespeare.lit'/&gt;
&lt;/iq&gt;

&lt;iq from='callA@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;

&lt;presence from='callA@call.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;joined xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callB@call.shakespeare.lit'/&gt;
&lt;/presence&gt;

&lt;presence from='callB@call.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;joined xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callA@call.shakespeare.lit'/&gt;
&lt;/presence&gt;

&lt;iq from='juliet@capulet.lit/balcony'
    to='callA@call.shakespeare.lit'
    type='set'
    id='h7ed3'&gt;
  &lt;join xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callC@call.shakespeare.lit'/&gt;
&lt;/iq&gt;

&lt;iq from='callA@shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed3'&gt;
  &lt;join xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callC@call.shakespeare.lit'/&gt;
  &lt;error type='cancel'&gt;
    &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>
    </div>
  </div>

  <div class="indent"><h3>6.4 <a name="session-mixers" id="session-mixers">Mixers</a></h3>
    <p class="" style="">While calls may generally be joined peer-to-peer in any desirable combination, such an implementation is not necessarily scalable or practical to manage. Rayo, therefore, includes the concept of mixers, which are entities like calls, to which calls or other mixers may be joined in the same way as joining multiple calls directly. A mixer MUST be implicitly created the first time a call attempts to join it, MUST immediately broadcast presence to all controlling parties who have calls joined to it, and must respond to the join command with a reference to the mixer. If a mixer cannot be created, an error similar to those specified for &lt;dial/&gt; should be returned in response to the &lt;join/&gt; command. The server MUST include entity capabilities information in the first presence stanza it sends, in order to advertise the fact that the entity is a mixer, qualified by the node name "urn:xmpp:rayo:mixer:1". A mixer MUST emit events (joined, unjoined) to all controlling parties who have calls joined to it, using the same semantics as joining calls.</p>

    <p class="" style="">In order to support friendly-named mixers without causing naming collisions between security zones, a server SHOULD represent a mixer internally using some alternative name scoped to the client's security zone and mapped to the friendly name/URI presented to the client for the emission of events and processing of commands. A server MUST NOT allow clients to interact with mixers allocated within other security zones either by observing their status or media.</p>

    <p class="caption"><a name="example-42" id="example-42"></a>Example 42. Client instructs call to join a mixer</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='callA@call.shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;join xmlns='urn:xmpp:rayo:1' mixer-name='myMixer'/&gt;
&lt;/iq&gt;

&lt;presence from='myMixer@mixer.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     hash='sha-1'
     node='urn:xmpp:rayo:mixer:1'
     ver='QgayPKawpkPSDYmwT/WM94uAlu0='/&gt;
&lt;/presence&gt;

&lt;iq from='callA@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'&gt;
  &lt;ref xmlns='urn:xmpp:rayo:1' uri='xmpp:myMixer@mixer.shakespeare.lit'/&gt;
&lt;/iq&gt;

&lt;presence from='callA@call.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;joined xmlns='urn:xmpp:rayo:1' mixer-name='myMixer'/&gt;
&lt;/presence&gt;

&lt;presence from='myMixer@mixer.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;joined xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callA@call.shakespeare.lit'/&gt;
&lt;/presence&gt;
</pre></div>

    <p class="" style="">Mixers MUST respect the normal rules of XMPP presence subscriptions, and presence subscriptions from clients within the same security zone as the mixer must be implicitly permitted.</p>

    <p class="" style="">The error conditions on joining a mixer are the same as for calls, as are the unjoin and join modification semantics. Additionally, mixers SHOULD be able to host components just like calls, following the rules defined for each component.</p>

    <p class="caption"><a name="example-43" id="example-43"></a>Example 43. Client renders output to a mixer</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='myMixer@mixer.shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;output xmlns='urn:xmpp:rayo:output:1'&gt;
    &lt;document content-type='text/plain'&gt;
      Thanks for calling, goodbye!
    &lt;/document&gt;
  &lt;/output&gt;
&lt;/iq&gt;

&lt;iq from='myMixer@mixer.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'&gt;
  &lt;ref xmlns='urn:xmpp:rayo:1' uri='xmpp:myMixer@mixer.shakespeare.lit/d38d3'/&gt;
&lt;/iq&gt;
</pre></div>

    <p class="" style="">If the media server providing the mixer supports active speaker detection, it MUST emit active speaker events to all clients with a presence subscription. Such events MUST indicate the start and end of speaking for a particular call ID joined to the mixer.</p>

    <p class="caption"><a name="example-44" id="example-44"></a>Example 44. Mixer indicates overlapping speaking status of two joined calls</p><div class="indent"><pre class="prettyprint">
&lt;presence from='myMixer@mixer.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;started-speaking xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callA@call.shakespeare.lit'/&gt;
&lt;/presence&gt;

&lt;presence from='myMixer@mixer.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;started-speaking xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callB@call.shakespeare.lit'/&gt;
&lt;/presence&gt;

&lt;presence from='myMixer@mixer.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;stopped-speaking xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callB@call.shakespeare.lit'/&gt;
&lt;/presence&gt;

&lt;presence from='myMixer@mixer.shakespeare.lit'
          to='juliet@capulet.lit/balcony'&gt;
  &lt;stopped-speaking xmlns='urn:xmpp:rayo:1' call-uri='xmpp:callA@call.shakespeare.lit'/&gt;
&lt;/presence&gt;
</pre></div>
  </div>

  <p class="" style="">Once the last participant unjoins from the mixer, the mixer SHOULD be destroyed. When a mixer is destroyed, it MUST send unavailable presence to all entities which have a presence subscription.</p>

  <div class="indent"><h3>6.5 <a name="session-component-execution" id="session-component-execution">Component Execution</a></h3>
    <p class="" style="">Components are long-lived elements of a call or mixer which may execute in parallel, have a lifecycle (may send events and/or process commands during their execution, indicate their completion asynchronously) and typically implement media operations. A server SHOULD implement components in such a way that it is acceptable to execute multiple components of the same type or of differing types simultaneously. A server SHOULD implement all core components.</p>

    <p class="" style="">In the event that a call or mixer receives a command which triggers the execution of a component, it MUST use the normal command handling routine, schedule the component for immediate execution and return a reference to the requesting client as confirmation of the component's creation:</p>

    <p class="caption"><a name="example-45" id="example-45"></a>Example 45. Client requests execution of an output component</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;output xmlns='urn:xmpp:rayo:output:1'&gt;
    &lt;document content-type='text/plain'&gt;
      Thanks for calling, goodbye!
    &lt;/document&gt;
  &lt;/output&gt;
&lt;/iq&gt;
</pre></div>

    <p class="caption"><a name="example-46" id="example-46"></a>Example 46. Server provides reference to output component</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'&gt;
  &lt;ref xmlns='urn:xmpp:rayo:1' uri='xmpp:9f00061@call.shakespeare.lit/eh3u82'/&gt;
&lt;/iq&gt;
</pre></div>

    <p class="" style="">If a component execution command is received prior to the call being answered, the server MUST NOT answer the call, and SHOULD attempt to use early-media techniques to perform the relevant operation without answering the call. If such early-media is not possible, it MUST return an error indicating that the call state is incorrect (unexpected-request).</p>

    <p class="" style="">The whole command MUST be parsed up-front, and any applicable validation performed before acknowledgement of the command.</p>

    <div class="indent"><h3>6.5.1 <a name="session-component-initial-errors" id="session-component-initial-errors">Initial Errors</a></h3>
      <p class="" style="">There are several reasons why the server might immediately return an error instead of acknowledging the creation of a new component:</p>
      <ul class="" style="">
        <li class="" style="">The server does not implement the component.</li>
        <li class="" style="">The server does not implement a particular option value for the component.</li>
        <li class="" style="">Some aspect of the component does not comply with this specification.</li>
        <li class="" style="">The server does not have sufficient resources to create a new component on this call/mixer.</li>
        <li class="" style="">The component would cause a resource conflict with another component on this call/mixer.</li>
        <li class="" style="">The call/mixer is not in the correct state to begin executing the component.</li>
      </ul>

      <p class="" style="">If the server does not implement the command/component, it should return a feature-not-implemented (cancel) error:</p>
      <p class="caption"><a name="example-47" id="example-47"></a>Example 47. Server indicates a lack of support for the requested component/command</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;output xmlns='urn:xmpp:rayo:output:1'&gt;
    &lt;document content-type='text/plain'&gt;
      Thanks for calling, goodbye!
    &lt;/document&gt;
  &lt;/output&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">If the server does not implement a particular option value for the command/component, it should return a feature-not-implemented (modify) error:</p>
      <p class="caption"><a name="example-48" id="example-48"></a>Example 48. Server indicates a lack of support for some aspect of the requested component/command</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;output xmlns='urn:xmpp:rayo:output:1'
          repeat-times='4'/&gt;
  &lt;error type='modify'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">If the command does not meet the specification, the server should return a bad-request (modify) error:</p>
      <p class="caption"><a name="example-49" id="example-49"></a>Example 49. Server indicates the requested component/command does not meet the specification</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;output xmlns='urn:xmpp:rayo:output:1'
          repeat-times='foo'/&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">If the server does not have sufficient resources to create the component, it should return a resource-constraint (wait) error:</p>
      <p class="caption"><a name="example-50" id="example-50"></a>Example 50. Server indicates a lack of resources to create the requested component</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;output xmlns='urn:xmpp:rayo:output:1'&gt;
    &lt;document content-type='text/plain'&gt;
      Thanks for calling, goodbye!
    &lt;/document&gt;
  &lt;/output&gt;
  &lt;error type='wait'&gt;
    &lt;resource-constraint xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">If the server is not able to create the component due to a resource conflict with another component, it should return a resource-constraint (wait) error:</p>
      <p class="caption"><a name="example-51" id="example-51"></a>Example 51. Server indicates a resource conflict with another component</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;output xmlns='urn:xmpp:rayo:output:1'&gt;
    &lt;document content-type='text/plain'&gt;
      Thanks for calling, goodbye!
    &lt;/document&gt;
  &lt;/output&gt;
  &lt;error type='wait'&gt;
    &lt;resource-constraint xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">If the server is not able to create the component due to the call being in an incorrect state, it should return an unexpected-request (wait) error:</p>
      <p class="caption"><a name="example-52" id="example-52"></a>Example 52. Server indicates incorrect call state</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;output xmlns='urn:xmpp:rayo:output:1'&gt;
    &lt;document content-type='text/plain'&gt;
      Thanks for calling, goodbye!
    &lt;/document&gt;
  &lt;/output&gt;
  &lt;error type='wait'&gt;
    &lt;unexpected-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

    </div>

    <p class="" style="">Once acknowleged, the component MUST begin execution according to its particular specification. During its execution, it MAY emit events relevant to its progress, and an implementation MUST be capable of emitting events specified for each component. Any events should be sent inside a directed presence element to the executing party.</p>

    <p class="" style="">During execution, the component MUST respond to commands addressed to it. Each component has its own set of commands, but all components have the 'stop' command in common. On receipt of the stop command, the component MUST acknowledge that it has been instructed to stop and gracefully cease its execution in whatever way is appropriate to the particular component.</p>

    <p class="caption"><a name="example-53" id="example-53"></a>Example 53. Client requests component stop, server confirms</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit/eh3u28'
    type='set'
    id='h7ed2'&gt;
  &lt;stop xmlns='urn:xmpp:rayo:ext:1'/&gt;
&lt;/iq&gt;

&lt;iq from='9f00061@call.shakespeare.lit/eh3u28'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;
</pre></div>

    <div class="indent"><h3>6.5.2 <a name="session-component-command-errors" id="session-component-command-errors">Command Errors</a></h3>
      <p class="" style="">There are several reasons why a component might return an error instead of acknowledging a command:</p>
      <ul class="" style="">
        <li class="" style="">The component does not implement the command.</li>
        <li class="" style="">The component does not implement a particular option value for the command.</li>
        <li class="" style="">Some aspect of the command does not comply with the components specification.</li>
        <li class="" style="">The command is not appropriate for the component at its current stage of execution.</li>
        <li class="" style="">The command is issued by a party other than that which created the component.</li>
      </ul>

      <p class="" style="">If the component does not implement the command, it should return a feature-not-implemented (cancel) error:</p>
      <p class="caption"><a name="example-54" id="example-54"></a>Example 54. Component indicates a lack of support for the requested command</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit/eh3u28'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;stop xmlns='urn:xmpp:rayo:ext:1'/&gt;
  &lt;error type='cancel'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">If the component does not implement a particular option/value for the command, it should return a feature-not-implemented (modify) error:</p>
      <p class="caption"><a name="example-55" id="example-55"></a>Example 55. Component indicates a lack of support for some option/value on the command</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit/eh3u28'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;stop xmlns='urn:xmpp:rayo:ext:1'/&gt;
  &lt;error type='modify'&gt;
    &lt;feature-not-implemented xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">If some aspect of the command does not comply with the component's spec, it should return a bad-request (modify) error:</p>
      <p class="caption"><a name="example-56" id="example-56"></a>Example 56. Component indicates some aspect of the command is not spec compliant</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit/eh3u28'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;stop xmlns='urn:xmpp:rayo:ext:1'/&gt;
  &lt;error type='modify'&gt;
    &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">If the command is not appropriate for the component's current stage of execution, it should return a unexpected-request (wait) error:</p>
      <p class="caption"><a name="example-57" id="example-57"></a>Example 57. Component indicates that the command is not appropriate for the component's current stage of execution</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit/eh3u28'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;stop xmlns='urn:xmpp:rayo:ext:1'/&gt;
  &lt;error type='wait'&gt;
    &lt;unexpected-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">If the command is issued by a party other than the component creator, it should return a conflict (cancel) error:</p>
      <p class="caption"><a name="example-58" id="example-58"></a>Example 58. Component indicates command cannot be executed by anyone other than the component owner</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit/eh3u28'
    to='juliet@capulet.lit/courtyard'
    type='error'
    id='h7ed2'&gt;
  &lt;stop xmlns='urn:xmpp:rayo:ext:1'/&gt;
  &lt;error type='cancel'&gt;
    &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

    </div>

    <p class="" style="">When the component ceases to execute, it MUST send a <a href="#def-components-complete">complete event</a> with a valid reason to the requesting party as directed presence with a type of 'unavailable'.</p>
    <p class="caption"><a name="example-59" id="example-59"></a>Example 59. Component indicates it has completed due to being stopped</p><div class="indent"><pre class="prettyprint">
&lt;presence from='9f00061@call.shakespeare.lit/eh3u28'
          to='juliet@capulet.lit/courtyard'
          type='unavailable'&gt;
  &lt;complete xmlns='urn:xmpp:rayo:ext:1'&gt;
    &lt;stop xmlns='urn:xmpp:rayo:ext:complete:1'/&gt;
  &lt;/complete&gt;
&lt;/presence&gt;
</pre></div>

    <p class="" style="">Once a component is completed, or if it did not exist, the server should return an item-not-found (cancel) error as response to any commands:</p>
    <p class="caption"><a name="example-60" id="example-60"></a>Example 60. Non-existant component receives a command</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit/eh3u28'
    type='set'
    id='h7ed2'&gt;
  &lt;stop xmlns='urn:xmpp:rayo:ext:1'/&gt;
&lt;/iq&gt;

&lt;iq from='9f00061@call.shakespeare.lit/eh3u28'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;stop xmlns='urn:xmpp:rayo:ext:1'/&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>

    <div class="indent"><h3>6.5.3 <a name="session-component-execution-output" id="session-component-execution-output">Output Component</a></h3>
      <p class="" style="">Media output is a core concept in Rayo, and is provided by the output component. The component allows media to be rendered to a call or a mixer, using the server's local media server. A server MUST support audio file playback and MUST support the text/uri-list document format. A server MAY support speech synthesis and MAY support <a href="http://www.w3.org/TR/speech-synthesis/">SSML</a> (in which case the document should be escaped or enclosed in CDATA). The component is created using an <a href="def-component-output">&lt;output/&gt; command</a>, containing one or more documents to render, along with a set of options to determine the nature of the rendering.</p>

      <p class="caption"><a name="example-61" id="example-61"></a>Example 61. Client renders a simple SSML document to a call</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;output xmlns='urn:xmpp:rayo:output:1'&gt;
    &lt;document content-type='application/ssml+xml'&gt;
      &lt;![CDATA[
        &lt;?xml version="1.0"?&gt;
        &lt;!DOCTYPE speak PUBLIC "-//W3C//DTD SYNTHESIS 1.0//EN"
                          "http://www.w3.org/TR/speech-synthesis/synthesis.dtd"&gt;
        &lt;speak version="1.0"
               xmlns="http://www.w3.org/2001/10/synthesis"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xsi:schemaLocation="http://www.w3.org/2001/10/synthesis
                           http://www.w3.org/TR/speech-synthesis/synthesis.xsd"
               xml:lang="en-US"&gt;
          &lt;p&gt;
            &lt;s&gt;You have 4 new messages.&lt;/s&gt;
            &lt;s&gt;The first is from Stephanie Williams and arrived at &lt;break/&gt; 3:45pm.&lt;/s&gt;
            &lt;s&gt;
              The subject is &lt;prosody rate="-20%"&gt;ski trip&lt;/prosody&gt;
            &lt;/s&gt;
          &lt;/p&gt;
        &lt;/speak&gt;
      ]]&gt;
    &lt;/document&gt;
  &lt;/output&gt;
&lt;/iq&gt;
</pre></div>

      <p class="caption"><a name="example-62" id="example-62"></a>Example 62. Client renders a plain text document to a call</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;output xmlns='urn:xmpp:rayo:output:1'&gt;
    &lt;document content-type='text/plain'&gt;
      Thanks for calling, goodbye!
    &lt;/document&gt;
  &lt;/output&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">The server MUST validate that it has apropriate resources/mechanisms to render the requested document before acknowledging the component creation.</p>

      <div class="indent"><h3>6.5.3.1 <a name="session-component-exection-output-joins" id="session-component-exection-output-joins">Join considerations</a></h3>
        <p class="" style="">In the case that an output component is executed on a call joined to other calls or mixers, the output MUST be rendered only to the call and not the joined parties (also known as 'whisper'). In the case that an output component is executed on a mixer, the output should be rendered into the mixer, such that all participants receive the output (also known as 'announce').</p>
      </div>

      <div class="indent"><h3>6.5.3.2 <a name="session-component-execution-output-commands" id="session-component-execution-output-commands">Commands</a></h3>
        <p class="" style="">The output component implements several commands for manipulating the output during its execution.</p>

        
          <p class="" style="">A client may instruct an output component to pause by sending a pause command. The server MUST cause the media server to pause rendering, maintaining position within the document and allowing for later resumption.</p>

          <p class="caption"><a name="example-63" id="example-63"></a>Example 63. Client requests output component pause, server confirms</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit/eh3u28'
    type='set'
    id='h7ed2'&gt;
  &lt;pause xmlns='urn:xmpp:rayo:output:1'/&gt;
&lt;/iq&gt;

&lt;iq from='9f00061@call.shakespeare.lit/eh3u28'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;
</pre></div>
        

        
          <p class="" style="">A client may instruct an output component to resume rendering if it has previously been paused. The server MUST cause the media server to resume rendering at the last pause marker.</p>

          <p class="caption"><a name="example-64" id="example-64"></a>Example 64. Client requests output component resume, server confirms</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit/eh3u28'
    type='set'
    id='h7ed2'&gt;
  &lt;resume xmlns='urn:xmpp:rayo:output:1'/&gt;
&lt;/iq&gt;

&lt;iq from='9f00061@call.shakespeare.lit/eh3u28'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;
</pre></div>
        

        
          <p class="" style="">A client may instruct an output component to increase the rendering rate by a unit amount, defined by the media server. The server MUST cause the media server to perform the rate increase and acknowledge the command.</p>

          <p class="caption"><a name="example-65" id="example-65"></a>Example 65. Client requests output component speed up, server confirms</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit/eh3u28'
    type='set'
    id='h7ed2'&gt;
  &lt;speed-up xmlns='urn:xmpp:rayo:output:1'/&gt;
&lt;/iq&gt;

&lt;iq from='9f00061@call.shakespeare.lit/eh3u28'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;
</pre></div>
        

        
          <p class="" style="">A client may instruct an output component to decrease the rendering rate by a unit amount, defined by the media server. The server MUST cause the media server to perform the rate decrease and acknowledge the command.</p>

          <p class="caption"><a name="example-66" id="example-66"></a>Example 66. Client requests output component speed down, server confirms</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit/eh3u28'
    type='set'
    id='h7ed2'&gt;
  &lt;speed-down xmlns='urn:xmpp:rayo:output:1'/&gt;
&lt;/iq&gt;

&lt;iq from='9f00061@call.shakespeare.lit/eh3u28'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;
</pre></div>
        

        
          <p class="" style="">A client may instruct an output component to increase the rendering volume by a unit amount, defined by the media server. The server MUST cause the media server to perform the volume increase and acknowledge the command.</p>

          <p class="caption"><a name="example-67" id="example-67"></a>Example 67. Client requests output component volume up, server confirms</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit/eh3u28'
    type='set'
    id='h7ed2'&gt;
  &lt;volume-up xmlns='urn:xmpp:rayo:output:1'/&gt;
&lt;/iq&gt;

&lt;iq from='9f00061@call.shakespeare.lit/eh3u28'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;
</pre></div>
        

        
          <p class="" style="">A client may instruct an output component to decrease the rendering volume by a unit amount, defined by the media server. The server MUST cause the media server to perform the volume decrease and acknowledge the command.</p>

          <p class="caption"><a name="example-68" id="example-68"></a>Example 68. Client requests output component volume down, server confirms</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit/eh3u28'
    type='set'
    id='h7ed2'&gt;
  &lt;volume-down xmlns='urn:xmpp:rayo:output:1'/&gt;
&lt;/iq&gt;

&lt;iq from='9f00061@call.shakespeare.lit/eh3u28'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;
</pre></div>
        

        
          <p class="" style="">A client may instruct an output component to move the play marker forward or back in time by a specified amount before resuming output. The server MUST cause the media to seek as instructed and acknowledge the command.</p>
          <p class="" style="">The attributes of the &lt;seek/&gt; element are as follows.</p>
          <p class="caption"><a name="example-69" id="example-69"></a>Example 69. Client requests output seek forward by 20s, server confirms</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit/eh3u28'
    type='set'
    id='h7ed2'&gt;
  &lt;seek xmlns='urn:xmpp:rayo:output:1' direction='forward' amount='20000'/&gt;
&lt;/iq&gt;

&lt;iq from='9f00061@call.shakespeare.lit/eh3u28'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;
</pre></div>
        
      </div>

      <div class="indent"><h3>6.5.3.3 <a name="session-component-execution-output-events" id="session-component-execution-output-events">Events</a></h3>
        <p class="" style="">The output component does not provide any intermediate events.</p>
      </div>

      <div class="indent"><h3>6.5.3.4 <a name="session-component-execution-output-completion" id="session-component-execution-output-completion">Completion</a></h3>
        <p class="" style="">The output completion reason MUST be one of the <a href="#def-components-complete-reason">core Rayo reasons</a>, <a href="#def-component-output-finish">finish</a> (indicating that the document finished rendering naturally) or <a href="#def-component-output-maxtime">max-time</a> (indicating that the maximum time was exceeded). Output component completion does not provide any metadata.</p>

        <p class="caption"><a name="example-70" id="example-70"></a>Example 70. Component indicates it has completed due to reaching the end of the document</p><div class="indent"><pre class="prettyprint">
&lt;presence from='9f00061@call.shakespeare.lit/eh3u28'
          to='juliet@capulet.lit/courtyard'
          type='unavailable'&gt;
  &lt;complete xmlns='urn:xmpp:rayo:ext:1'&gt;
    &lt;finish xmlns='urn:xmpp:rayo:output:complete:1'/&gt;
  &lt;/complete&gt;
&lt;/presence&gt;
</pre></div>
      </div>
    </div>

    <div class="indent"><h3>6.5.4 <a name="session-component-execution-input" id="session-component-execution-input">Input Component</a></h3>
      <p class="" style="">Media input is a core concept in Rayo, and is provided by the input component. The component allows input to be collected from a call by way of either <a href="http://www.itu.int/rec/T-REC-Q.23-198811-I/en">DTMF</a> (dual-tone multi-frequency) or ASR (automatic speech recognition), using the server's local media server. A Rayo server MUST support DTMF input and MUST support <a href="http://www.w3.org/TR/speech-grammar/">SRGS</a> XML grammars (application/srgs+xml). A server MAY suport speech input, and MAY support other grammar formats. The component is created using an <a href="def-component-input">&lt;input/&gt; command</a>, containing one or more grammar documents by which to control input, along with a set of options to determine the nature of the collection.</p>

      <p class="caption"><a name="example-71" id="example-71"></a>Example 71. Client requests DTMF input collection from a call</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;input xmlns='urn:xmpp:rayo:input:1' mode='dtmf'&gt;
    &lt;grammar content-type='application/srgs+xml'&gt;
      &lt;![CDATA[
        &lt;?xml version="1.0"?&gt;
        &lt;grammar mode="dtmf" version="1.0"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="http://www.w3.org/2001/06/grammar
                                     http://www.w3.org/TR/speech-grammar/grammar.xsd"
                 xmlns="http://www.w3.org/2001/06/grammar"&gt;

          &lt;rule id="digit"&gt;
            &lt;one-of&gt;
              &lt;item&gt; 0 &lt;/item&gt;
              &lt;item&gt; 1 &lt;/item&gt;
              &lt;item&gt; 2 &lt;/item&gt;
              &lt;item&gt; 3 &lt;/item&gt;
              &lt;item&gt; 4 &lt;/item&gt;
              &lt;item&gt; 5 &lt;/item&gt;
              &lt;item&gt; 6 &lt;/item&gt;
              &lt;item&gt; 7 &lt;/item&gt;
              &lt;item&gt; 8 &lt;/item&gt;
              &lt;item&gt; 9 &lt;/item&gt;
            &lt;/one-of&gt;
          &lt;/rule&gt;

          &lt;rule id="pin" scope="public"&gt;
            &lt;one-of&gt;
              &lt;item&gt;
                &lt;item repeat="4"&gt;&lt;ruleref uri="#digit"/&gt;&lt;/item&gt;
                #
              &lt;/item&gt;
              &lt;item&gt;
                * 9
              &lt;/item&gt;
            &lt;/one-of&gt;
          &lt;/rule&gt;
        &lt;/grammar&gt;
      ]]&gt;
    &lt;/grammar&gt;
  &lt;/input&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">The server MUST validate that it has appropriate resources/mechanisms to collect the requested input before acknowledging the component creation.</p>

      <div class="indent"><h3>6.5.4.1 <a name="session-component-exection-input-joins" id="session-component-exection-input-joins">Join considerations</a></h3>
        <p class="" style="">In the case that an input component is executed on a call joined to other calls or mixers, the input MUST be collected only from the call and not the joined parties. Input components executed on a mixer MUST collect and combine input from all participants joined to the mixer.</p>
      </div>

      <div class="indent"><h3>6.5.4.2 <a name="session-component-execution-input-commands" id="session-component-execution-input-commands">Commands</a></h3>
        <p class="" style="">The input component does not implement any intermediate commands, other than those specified for all components.</p>
      </div>

      <div class="indent"><h3>6.5.4.3 <a name="session-component-execution-input-events" id="session-component-execution-input-events">Events</a></h3>
        <p class="" style="">The input component does not provide any intermediate events.</p>
      </div>

      <div class="indent"><h3>6.5.4.4 <a name="session-component-execution-input-completion" id="session-component-execution-input-completion">Completion</a></h3>
        <p class="" style="">The input completion reason MUST be one of the <a href="#def-components-complete-reason">core Rayo reasons</a>, or one of the following reasons. Input component completion provides match metadata for the &lt;finish/&gt; reason only.</p>
        <ul class="" style="">
          <li class="" style="">
            <a href="#def-component-input-match">match</a> (indicating that one of the grammars matched the received input).
          </li>
          <li class="" style="">
            <a href="#def-component-input-noinput">noinput</a> (indicating that no input was received before a timeout was encountered).
          </li>
          <li class="" style="">
            <a href="#def-component-input-nomatch">nomatch</a> (indicating that input was received which did not match any of the specified grammars).
          </li>
        </ul>

        <p class="" style="">If the media server reports a match to one of the provided grammars, the server MUST present the results of the match to the client by way of a match document in the format requested by the client. A server MUST be capable of supporting NLSML, and may support other formats.</p>
        <p class="caption"><a name="example-72" id="example-72"></a>Example 72. Component indicates it has completed due to one of the grammars returning a match</p><div class="indent"><pre class="prettyprint">
&lt;presence from='9f00061@call.shakespeare.lit/eh3u28'
          to='juliet@capulet.lit/courtyard'
          type='unavailable'&gt;
  &lt;complete xmlns='urn:xmpp:rayo:ext:1'&gt;
    &lt;match xmlns='urn:xmpp:rayo:input:complete:1' content-type="application/nlsml+xml"&gt;
      &lt;![CDATA[
        &lt;result xmlns="http://www.ietf.org/xml/ns/mrcpv2" grammar="http://foodorder"&gt;
          &lt;interpretation&gt;
            &lt;input mode="dtmf" confidence="100"&gt;1 2 3 4&lt;/input&gt;
          &lt;/interpretation&gt;
        &lt;/result&gt;
      ]]&gt;
    &lt;/match&gt;
  &lt;/complete&gt;
&lt;/presence&gt;
</pre></div>
      </div>
    </div>

    <div class="indent"><h3>6.5.5 <a name="session-component-execution-prompt" id="session-component-execution-prompt">Prompt Component</a></h3>
      <p class="" style="">Prompt is a convenience component to wrap input and output components, combine their lifecycles, and allow input to barge-in on an output component in the standard sense.</p>

      <p class="caption"><a name="example-73" id="example-73"></a>Example 73. Client requests DTMF input collection from a call</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;prompt xmlns='urn:xmpp:rayo:prompt:1'&gt;
    &lt;output xmlns='urn:xmpp:rayo:output:1'&gt;
      &lt;document content-type='application/ssml+xml'&gt;
        &lt;![CDATA[
          &lt;?xml version="1.0"?&gt;
          &lt;!DOCTYPE speak PUBLIC "-//W3C//DTD SYNTHESIS 1.0//EN"
                            "http://www.w3.org/TR/speech-synthesis/synthesis.dtd"&gt;
          &lt;speak version="1.0"
                 xmlns="http://www.w3.org/2001/10/synthesis"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="http://www.w3.org/2001/10/synthesis
                             http://www.w3.org/TR/speech-synthesis/synthesis.xsd"
                 xml:lang="en-US"&gt;
            &lt;p&gt;
              &lt;s&gt;Please enter your pin number now.&lt;/s&gt;
            &lt;/p&gt;
          &lt;/speak&gt;
        ]]&gt;
      &lt;/document&gt;
    &lt;/output&gt;

    &lt;input xmlns='urn:xmpp:rayo:input:1' mode='dtmf'&gt;
      &lt;grammar content-type='application/srgs+xml'&gt;
        &lt;![CDATA[
          &lt;?xml version="1.0"?&gt;
          &lt;grammar mode="dtmf" version="1.0"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.w3.org/2001/06/grammar
                                       http://www.w3.org/TR/speech-grammar/grammar.xsd"
                   xmlns="http://www.w3.org/2001/06/grammar"&gt;

            &lt;rule id="digit"&gt;
              &lt;one-of&gt;
                &lt;item&gt; 0 &lt;/item&gt;
                &lt;item&gt; 1 &lt;/item&gt;
                &lt;item&gt; 2 &lt;/item&gt;
                &lt;item&gt; 3 &lt;/item&gt;
                &lt;item&gt; 4 &lt;/item&gt;
                &lt;item&gt; 5 &lt;/item&gt;
                &lt;item&gt; 6 &lt;/item&gt;
                &lt;item&gt; 7 &lt;/item&gt;
                &lt;item&gt; 8 &lt;/item&gt;
                &lt;item&gt; 9 &lt;/item&gt;
              &lt;/one-of&gt;
            &lt;/rule&gt;

            &lt;rule id="pin" scope="public"&gt;
              &lt;one-of&gt;
                &lt;item&gt;
                  &lt;item repeat="4"&gt;&lt;ruleref uri="#digit"/&gt;&lt;/item&gt;
                  #
                &lt;/item&gt;
                &lt;item&gt;
                  * 9
                &lt;/item&gt;
              &lt;/one-of&gt;
            &lt;/rule&gt;
          &lt;/grammar&gt;
        ]]&gt;
      &lt;/grammar&gt;
    &lt;/input&gt;
  &lt;/prompt&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">The server MUST validate that it has appropriate resources/mechanisms to render the requested output and collect the requested input before acknowledging the component creation.</p>

      <div class="indent"><h3>6.5.5.1 <a name="session-component-exection-prompt-joins" id="session-component-exection-prompt-joins">Join considerations</a></h3>
        <p class="" style="">The prompt component follows the same combined join considerations as output and input components.</p>
      </div>

      <div class="indent"><h3>6.5.5.2 <a name="session-component-execution-prompt-commands" id="session-component-execution-prompt-commands">Commands</a></h3>
        <p class="" style="">The prompt component implements implements all intermediate commands from output and input and behaves the same. If output component commands are executed after the output component has ceased executing, a &lt;unexpected-request&gt; error MUST be returned.</p>
      </div>

      <div class="indent"><h3>6.5.5.3 <a name="session-component-execution-prompt-events" id="session-component-execution-prompt-events">Events</a></h3>
        <p class="" style="">The prompt component emits intermediate events from the nested output and input components.</p>
        <p class="" style="">It also emits an 'input-timers-started' event when the input component's timers are started, which corresponds to the completion of the output sub-component.</p>

        <p class="caption"><a name="example-74" id="example-74"></a>Example 74. Prompt component announces that the input timers have started</p><div class="indent"><pre class="prettyprint">
&lt;presence from='9f00061@call.shakespeare.lit/eh3u28'
          to='juliet@capulet.lit/courtyard'&gt;
  &lt;input-timers-started xmlns='urn:xmpp:rayo:prompt:1'/&gt;
&lt;/presence&gt;
</pre></div>
      </div>

      <div class="indent"><h3>6.5.5.4 <a name="session-component-execution-prompt-completion" id="session-component-execution-prompt-completion">Completion</a></h3>
        <p class="" style="">The input completion reason MUST be one of the <a href="#def-components-complete-reason">core Rayo reasons</a>, or one of the <a href="#session-component-execution-input-completion">Input component reasons</a>. Events signalling completion of the output components are suppressed.</p>
      </div>
    </div>

    <div class="indent"><h3>6.5.6 <a name="session-component-execution-record" id="session-component-execution-record">Record Component</a></h3>
      <p class="" style="">Call recording is a core concept in Rayo, and is provided by the record component. The component allows media to be captured from a call or a mixer, using the server's local media server, stored, and made available to clients. The component is created using a <a href="def-component-record">&lt;record/&gt; command</a>, potentially with a set of options to determine the nature of the recording.</p>

      <p class="caption"><a name="example-75" id="example-75"></a>Example 75. Client requests a simple recording</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;record xmlns='urn:xmpp:rayo:record:1'/&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">The server MUST validate that it has apropriate resources/mechanisms to make the recording before acknowledging the component creation. The component MUST ignore any hints that it does not understand.</p>

      <div class="indent"><h3>6.5.6.1 <a name="session-component-exection-record-joins" id="session-component-exection-record-joins">Join considerations</a></h3>
        <p class="" style="">In the case that a record component is executed on a call joined to other calls or mixers, the direction attibute will specify if the sent audio, received audio, or both will be present in the recording.</p>
        <p class="" style="">In send mode, only the audio sent by the caller is recorded.</p>
        <p class="" style="">In recv mode, when just joined to the media server, should record TTS, audio playback, etc; when joined to another call, should record that other call's sending audio (probably a human talking) also. When joined to a mixer, should record the audio send from the mixer (other people talking) also.</p>
        <p class="" style="">Duplex mode is a combination of send and recv. The platform may mix these or record them as separate channels.</p>
        <p class="" style="">When executing a record against a mixer, send mode is not supported. Recv mode records audio from all mixer participants. Duplex is a clone of recv.</p>
      </div>

      <div class="indent"><h3>6.5.6.2 <a name="session-component-execution-record-commands" id="session-component-execution-record-commands">Commands</a></h3>
        <p class="" style="">The record component implements several commands for manipulating the recording during its execution.</p>

        
          <p class="" style="">A client may instruct a record component to pause by sending a pause command. The server MUST cause the media server to pause recording, allowing for later appending.</p>

          <p class="caption"><a name="example-76" id="example-76"></a>Example 76. Client requests record component pause, server confirms</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit/eh3u28'
    type='set'
    id='h7ed2'&gt;
  &lt;pause xmlns='urn:xmpp:rayo:record:1'/&gt;
&lt;/iq&gt;

&lt;iq from='9f00061@call.shakespeare.lit/eh3u28'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;
</pre></div>
        

        
          <p class="" style="">A client may instruct a record component to resume recording if it has previously been paused. The server MUST cause the media server to resume recording, appending to the original file.</p>

          <p class="caption"><a name="example-77" id="example-77"></a>Example 77. Client requests record component resume, server confirms</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit/eh3u28'
    type='set'
    id='h7ed2'&gt;
  &lt;resume xmlns='urn:xmpp:rayo:record:1'/&gt;
&lt;/iq&gt;

&lt;iq from='9f00061@call.shakespeare.lit/eh3u28'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;
</pre></div>
        
      </div>

      <div class="indent"><h3>6.5.6.3 <a name="session-component-execution-record-events" id="session-component-execution-record-events">Events</a></h3>
        <p class="" style="">The record component does not provide any intermediate events.</p>
      </div>

      <div class="indent"><h3>6.5.6.4 <a name="session-component-execution-record-completion" id="session-component-execution-record-completion">Completion</a></h3>
        <p class="" style="">The record completion reason MUST be one of the <a href="#def-components-complete-reason">core Rayo reasons</a>, or one of the following reasons. Record component completion provides recording metadata in all cases.</p>
        <ul class="" style="">
          <li class="" style="">
            <a href="#def-component-record-max-duration">max-duration</a> (indicating that the max duration was reached).
          </li>
          <li class="" style="">
            <a href="#def-component-record-initial-timeout">initial-timeout</a> (indicating that the initial timeout was triggered).
          </li>
          <li class="" style="">
            <a href="#def-component-record-final-timeout">final-timeout</a> (indicating that the final timeout was triggered).
          </li>
        </ul>

        <p class="" style="">The server MUST present the recording for consumption by the client by way of recording metadata on the complete reason, including a URI at which the recording may be fetched. It MUST provide uri, duration &amp; size data as specified on the <a href="#def-component-record-recording">recording element</a>.</p>
        <p class="caption"><a name="example-78" id="example-78"></a>Example 78. Component indicates it has completed due to being stopped, providing the recording</p><div class="indent"><pre class="prettyprint">
&lt;presence from='9f00061@call.shakespeare.lit/eh3u28'
          to='juliet@capulet.lit/courtyard'
          type='unavailable'&gt;
  &lt;complete xmlns='urn:xmpp:rayo:ext:1'&gt;
    &lt;stop xmlns='urn:xmpp:rayo:ext:complete:1'/&gt;
    &lt;recording xmlns='urn:xmpp:rayo:record:complete:1' uri='xmpp:http://rayo.io/recordings/foo.wav' duration='20000' size='12287492817'/&gt;
  &lt;/complete&gt;
&lt;/presence&gt;
</pre></div>
      </div>
    </div>
  </div>

  <div class="indent"><h3>6.6 <a name="session-termination" id="session-termination">Session Termination</a></h3>
    <p class="" style="">Session termination may occur by one of several methods:</p>
    <ul class="" style="">
      <li class="" style="">An inbound call may be <a href="#session-termination-redirection">redirected</a> by a PCP to some other target.</li>
      <li class="" style="">An inbound call may be <a href="#session-termination-rejection">rejected</a> by a PCP.</li>
      <li class="" style="">An active call, whether inbound or outbound, may be <a href="#session-termination-hangup">hung up</a> (gracefully ended) by a DCP.</li>
      <li class="" style="">An active call may be hung up (gracefully ended) by the remote party.</li>
      <li class="" style="">An outbound call may be rejected by the remote party.</li>
    </ul>

    <p class="" style="">A <a href="#session-termination-end">call end notification</a> will be dispatched to the PCP if one of the following conditions is met:</p>
    <ul class="" style="">
      <li class="" style="">The call has been accepted and has a PCP.</li>
      <li class="" style="">The call is outbound and implicitly has a PCP (the requesting party).</li>
    </ul>

    <div class="indent"><h3>6.6.1 <a name="session-termination-redirection" id="session-termination-redirection">Call Redirection</a></h3>
      <p class="" style="">If a client can determine a more appropriate target for an incoming call, it may wish to relay this information to the caller in the form of a URI (eg SIP). The target URI must be specified in the 'to' attribute of the redirect element.</p>
      <p class="caption"><a name="example-79" id="example-79"></a>Example 79. Client instructs a call to redirect, with some headers</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;redirect xmlns='urn:xmpp:rayo:1'
            to='sip:other@there.com'&gt;
    &lt;header name="x-skill" value="agent" /&gt;
    &lt;header name="x-customer-id" value="8877" /&gt;
  &lt;/redirect&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">The server should send an appropriate redirection instruction to the underlying session.</p>

      <p class="" style="">If the server is able to successfully relay the redirection to the calling party, it should send an empty IQ result to confirm the command has completed execution:</p>
      <p class="caption"><a name="example-80" id="example-80"></a>Example 80. Server acknowledges successful redirect</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;
</pre></div>

      <p class="" style="">If the server is unable to perform the redirect because the call is in a state where a redirect is not possible, it should return an unexpected-request (wait) error indicating such:</p>
      <p class="caption"><a name="example-81" id="example-81"></a>Example 81. Server indicates that the call is in a state where a redirect is not possible.</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;redirect xmlns='urn:xmpp:rayo:1'
            to='sip:other@there.com'&gt;
    &lt;header name="x-skill" value="agent" /&gt;
    &lt;header name="x-customer-id" value="8877" /&gt;
  &lt;/redirect&gt;
  &lt;error type='wait'&gt;
    &lt;unexpected-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>
    </div>

    <div class="indent"><h3>6.6.2 <a name="session-termination-rejection" id="session-termination-rejection">Call Rejection</a></h3>
      <p class="" style="">If a client cannot handle an incoming call, it MAY reject it. The client MUST do this before accepting the call. The target URI must be specified in the 'to' attribute of the redirect element.</p>
      <p class="caption"><a name="example-82" id="example-82"></a>Example 82. Client instructs a call to reject, with some headers</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;reject xmlns='urn:xmpp:rayo:1'&gt;
    &lt;header name="x-reject-description" value="Sorry, she cannae take it!" /&gt;
  &lt;/reject&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">The server should reject the underlying session. If the server is able to do so successfully, it should send an empty IQ result to confirm the command has completed execution:</p>
      <p class="caption"><a name="example-83" id="example-83"></a>Example 83. Server acknowledges successful rejection</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;
</pre></div>

      <p class="" style="">If the server is unable to perform the rejection because the call has already been accepted, it should return a not-allowed (cancel) error indicating such:</p>
      <p class="caption"><a name="example-84" id="example-84"></a>Example 84. Server indicates that the call already has another DCP and that control of the call is no longer available.</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;reject xmlns='urn:xmpp:rayo:1'&gt;
    &lt;header name="x-reject-description" value="Sorry, she cannae take it!" /&gt;
  &lt;/reject&gt;
  &lt;error type='cancel'&gt;
    &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>
    </div>

    <div class="indent"><h3>6.6.3 <a name="session-termination-hangup" id="session-termination-hangup">Call Hangup</a></h3>
      <p class="" style="">If a client wishes to end a call it should send a hangup command to the call instructing it to do so:</p>
      <p class="caption"><a name="example-85" id="example-85"></a>Example 85. Client instructs a call to hangup, with some headers</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;hangup xmlns='urn:xmpp:rayo:1'&gt;
    &lt;header name="x-call-result" value="4" /&gt;
  &lt;/hangup&gt;
&lt;/iq&gt;
</pre></div>

      <p class="" style="">The server should queue the call for immediate hangup and return a response indicating success of the command:</p>
      <p class="caption"><a name="example-86" id="example-86"></a>Example 86. Server acknowledges hangup queueing</p><div class="indent"><pre class="prettyprint">
&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='result'
    id='h7ed2'/&gt;
</pre></div>

      <p class="" style="">The server MUST follow this sequence to hang up a call:</p>
      <ul class="" style="">
        <li class="" style="">Terminate all components of the call, and components MUST send a complete event indicating hangup as the cause.</li>
        <li class="" style="">Terminate all joins on the call, sending unjoined events.</li>
        <li class="" style="">Terminate the underlying session.</li>
      </ul>
    </div>

    <div class="indent"><h3>6.6.4 <a name="session-termination-end" id="session-termination-end">Call End Notification</a></h3>
      <p class="" style="">The server MUST monitor a call's underlying session and react appropriately in the case that it comes to an end:</p>
      <ul class="" style="">
        <li class="" style="">The server MUST determine the reason for the call ending to be one of <a href="#def-end-reason">the appropriate end reasons</a>.</li>
        <li class="" style="">If the call ending was not a result of a hangup command from a client, the server MUST terminate all components on the call, which MUST send a complete event indicating hangup as the cause. The server MUST additionally terminate all joins on the call, sending unjoined events.</li>
        <li class="" style="">The server MUST send an end event (of type unavailable) on behalf of the call, specifying the above determined reason as a child element, to all JIDs to which an offer was sent or from which a command was received.</li>
        <li class="" style="">The server MUST NOT send any more events from a call which has ended and declared itself unavailable.</li>
        <li class="" style="">The server MUST respond to any commands sent to an ended call (or one which never existed) with an item-not-found (cancel) error.</li>
      </ul>

      <p class="caption"><a name="example-87" id="example-87"></a>Example 87. Controlling party receives notification of the call being terminated due to a remote party hangup</p><div class="indent"><pre class="prettyprint">
&lt;presence from='9f00061@call.shakespeare.lit'
          to='juliet@capulet.lit/balcony'
          type='unavailable'&gt;
  &lt;end xmlns='urn:xmpp:rayo:1'&gt;
    &lt;hangup/&gt;
  &lt;/end&gt;
&lt;/presence&gt;
</pre></div>

      <p class="caption"><a name="example-88" id="example-88"></a>Example 88. Non-existant call receives a command</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;answer xmlns='urn:xmpp:rayo:1'/&gt;
&lt;/iq&gt;

&lt;iq from='9f00061@call.shakespeare.lit'
    to='juliet@capulet.lit/balcony'
    type='error'
    id='h7ed2'&gt;
  &lt;answer xmlns='urn:xmpp:rayo:1'/&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;
</pre></div>
    </div>
  </div>

  <div class="indent"><h3>6.7 <a name="session-headers" id="session-headers">Headers</a></h3>
    <p class="" style="">In elements which may carry child &lt;header/&gt; elements, a server or client MAY specify several header elements with the same name. In such cases, these MUST be considered to form a collection of ordered values for the key provided.</p>

    <p class="caption"><a name="example-89" id="example-89"></a>Example 89. Client requests establishment of a new outbound session with multiple values for the SIP Route header</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='shakespeare.lit'
    type='set'
    id='h7ed2'&gt;
  &lt;dial xmlns='urn:xmpp:rayo:1'
        to='tel:+13055195825'
        from='tel:+14152226789'&gt;
    &lt;header name="Route" value="foo" /&gt;
    &lt;header name="Route" value="bar" /&gt;
  &lt;/dial&gt;
&lt;/iq&gt;
</pre></div>
  </div>

  <div class="indent"><h3>6.8 <a name="session-im" id="session-im">Instant Messages</a></h3>
    <div class="indent"><h3>6.8.1 <a name="session-im-call-bound" id="session-im-call-bound">Call-bound Messages</a></h3>
      <p class="" style="">XMPP message stanzas directed to the call's JID with a type of 'normal' MAY be forwarded to the calling party by translating the message into the calling party's protocol. In the case of SIP, this SHOULD follow the conventions set out in <a href="http://tools.ietf.org/html/draft-ietf-stox-im-06">draft-ietf-stox-im-06</a> with the exception of the &lt;thread/&gt; to Call-ID mapping, as the Call-ID will always be that of the calling party.</p>

      <p class="" style="">If a message is directed to the call's JID with a type other than 'normal' then the server MUST return a &lt;feature-not-implemented/&gt; error with a type of 'modify'. If no translation is possible then the server SHOULD return the same error but with a type of 'cancel'.</p>

      <p class="caption"><a name="example-90" id="example-90"></a>Example 90. Translation of a XMPP message into a SIP MESSAGE</p><div class="indent"><pre class="prettyprint">
&lt;message
    from='juliet@capulet.lit/balcony'
    to='9f00061@call.shakespeare.lit'
    type='normal'&gt;
  &lt;body&gt;Art thou not Romeo, and a Montague?&lt;/body&gt;
&lt;/message&gt;

MESSAGE sip:romeo@montague.lit SIP/2.0
Via: SIP/2.0/UDP call.shakespeare.lit;branch=AmRHlGRD0WD7BHgM5fKc
Max-Forwards: 70
From: &lt;sip:call.shakespeare.lit&gt;;tag=78aBN3CgAB8MK
To: &lt;sip:romeo@montague.lit&gt;;tag=Z7nlVUbvTOmV6
Call-ID: 2819297471
CSeq: 55119460 MESSAGE
Content-Type: text/plain
Content-Length: 35

Art thou not Romeo, and a Montague?
</pre></div>
    </div>
  </div>
<h2>7.
       <a name="def" id="def">Formal Definition</a></h2>

  <div class="indent"><h3>7.1 <a name="def-header" id="def-header">Header Element</a></h3>
    <p class="" style="">The &lt;header/&gt; element MUST be empty.</p>
    <p class="" style="">The attributes of the &lt;header/&gt; element are as follows.</p>
    <div class="indent"><p class="caption"><a name="table-2" id="table-2"></a>Table 2: Attributes of Header Element</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Attribute</th>
        <th colspan="" rowspan="">Definition</th>
        <th colspan="" rowspan="">Inclusion</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">name</td>
        <td align="" colspan="" rowspan="">A token giving the name by which the header may be known.</td>
        <td align="" colspan="" rowspan="">REQUIRED</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">value</td>
        <td align="" colspan="" rowspan="">The string value of the named header.</td>
        <td align="" colspan="" rowspan="">REQUIRED</td>
      </tr>
    </table></div>
  </div>

  <div class="indent"><h3>7.2 <a name="def-offer" id="def-offer">Offer Element</a></h3>
    <p class="" style="">Informs the recipient that a new call is available for control and invites it to take control using progress commands below.</p>
    <p class="" style="">The &lt;offer/&gt; element MAY contain one or more <a href="#def-header">&lt;header/&gt; elements</a>.</p>
    <p class="" style="">The attributes of the &lt;offer/&gt; element are as follows.</p>
    <div class="indent"><p class="caption"><a name="table-3" id="table-3"></a>Table 3: Attributes of Offer Element</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Attribute</th>
        <th colspan="" rowspan="">Definition</th>
        <th colspan="" rowspan="">Inclusion</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">to</td>
        <td align="" colspan="" rowspan="">The target URI for the call. May me a tel URI, SIP URI, a JID (for Jingle) or some other platform-specific addressing mechanism.</td>
        <td align="" colspan="" rowspan="">REQUIRED</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">from</td>
        <td align="" colspan="" rowspan="">The caller ID URI for the call. May be a tel URI, SIP URI, a JID (for Jingle) or some other platform-specific addressing mechanism.</td>
        <td align="" colspan="" rowspan="">OPTIONAL</td>
      </tr>
    </table></div>
  </div>

  <div class="indent"><h3>7.3 <a name="def-ringing" id="def-ringing">Ringing Element</a></h3>
    <p class="" style="">Indication that an outbound call has begun ringing, or accepted by the remote party.</p>
    <p class="" style="">The &lt;ringing/&gt; element MAY contain one or more <a href="#def-header">&lt;header/&gt; elements</a>.</p>
    <p class="" style="">The &lt;ringing/&gt; element has no attributes.</p>
  </div>

  <div class="indent"><h3>7.4 <a name="def-answered" id="def-answered">Answered Element</a></h3>
    <p class="" style="">Indication that an outbound call has been answered and that the 3rd party negotiation has completed. At this point, the media stream should be open.</p>
    <p class="" style="">The &lt;answered/&gt; element MAY contain one or more <a href="#def-header">&lt;header/&gt; elements</a>.</p>
    <p class="" style="">The &lt;answered/&gt; element has no attributes.</p>
  </div>

  <div class="indent"><h3>7.5 <a name="def-end" id="def-end">End Element</a></h3>
    <p class="" style="">Indication that the call has come to an end, giving the reason.</p>
    <p class="" style="">The &lt;end/&gt; element MUST contain a single <a href="#def-end-reason">end reason element</a>. It MAY also contain one or more <a href="#def-header">&lt;header/&gt; elements</a>.</p>
    <p class="" style="">The &lt;end/&gt; element has no attributes.</p>

    <div class="indent"><h3>7.5.1 <a name="def-end-reason" id="def-end-reason">End Reason Element</a></h3>
      <p class="" style="">The following are valid end reason elements. Unless otherwise stated, they all MUST be empty.</p>

      <p class="" style="">The attributes of the end reason element are as follows.</p>
      <div class="indent"><p class="caption"><a name="table-4" id="table-4"></a>Table 4: Attributes of End Reason Element</p><table border="1" cellpadding="3" cellspacing="0">
        <tr class="body">
          <th colspan="" rowspan="">Attribute</th>
          <th colspan="" rowspan="">Definition</th>
          <th colspan="" rowspan="">Inclusion</th>
        </tr>
        <tr class="body">
          <td align="" colspan="" rowspan="">platform-code</td>
          <td align="" colspan="" rowspan="">A platform-specific end code. This could be a SIP code, ITU-T Q.850 or some other system. The code may be an arbitrary string.</td>
          <td align="" colspan="" rowspan="">OPTIONAL</td>
        </tr>
      </table></div>

      <div class="indent"><dl>
        <di>
          <dt><strong>&lt;hungup/&gt;</strong></dt>
          <dd>Indication that the call ended due to a normal hangup by the remote party.</dd>
        </di>
        <di>
          <dt><strong>&lt;hangup-command/&gt;</strong></dt>
          <dd>Indication that the call ended due to a normal hangup triggered by a hangup command.</dd>
        </di>
        <di>
          <dt><strong>&lt;timeout/&gt;</strong></dt>
          <dd>Indication that the call ended due to a timeout in contacting the remote party.</dd>
        </di>
        <di>
          <dt><strong>&lt;busy/&gt;</strong></dt>
          <dd>Indication that the call ended due to being rejected by the remote party subsequent to being accepted.</dd>
        </di>
        <di>
          <dt><strong>&lt;rejected/&gt;</strong></dt>
          <dd>Indication that the call ended due to being rejected by the remote party before being accepted.</dd>
        </di>
        <di>
          <dt><strong>&lt;error/&gt;</strong></dt>
          <dd>Indication that the call ended due to a system error.</dd>
        </di>
      </dl></div>
    </div>
  </div>

  <div class="indent"><h3>7.6 <a name="def-accept" id="def-accept">Accept Element</a></h3>
    <p class="" style="">Instructs the server to send notification to the calling party that the call will be dealt with and that ringing may begin.</p>
    <p class="" style="">The &lt;accept/&gt; element MAY contain one or more <a href="#def-header">&lt;header/&gt; elements</a>.</p>
    <p class="" style="">The &lt;accept/&gt; element has no attributes.</p>
  </div>

  <div class="indent"><h3>7.7 <a name="def-answer" id="def-answer">Answer Element</a></h3>
    <p class="" style="">Instructs the server to pick up an incoming call and connect the media stream.</p>
    <p class="" style="">The &lt;answer/&gt; element MAY contain one or more <a href="#def-header">&lt;header/&gt; elements</a>.</p>
    <p class="" style="">The &lt;answer/&gt; element has no attributes.</p>
  </div>

  <div class="indent"><h3>7.8 <a name="def-redirect" id="def-redirect">Redirect Element</a></h3>
    <p class="" style="">Instructs the calling party that the call will not be accepted and that instead it should try to call the URI indicated in the command.</p>
    <p class="" style="">The &lt;redirect/&gt; element MAY contain one or more <a href="#def-header">&lt;header/&gt; elements</a>.</p>
    <p class="" style="">The attributes of the &lt;redirect/&gt; element are as follows.</p>
    <div class="indent"><p class="caption"><a name="table-5" id="table-5"></a>Table 5: Attributes of Offer Element</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Attribute</th>
        <th colspan="" rowspan="">Definition</th>
        <th colspan="" rowspan="">Inclusion</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">to</td>
        <td align="" colspan="" rowspan="">The new target URI for the call to be redirected to.</td>
        <td align="" colspan="" rowspan="">REQUIRED</td>
      </tr>
    </table></div>
  </div>

  <div class="indent"><h3>7.9 <a name="def-reject" id="def-reject">Reject Element</a></h3>
    <p class="" style="">Instructs the server to reject the call with a given reason.</p>
    <p class="" style="">The &lt;reject/&gt; element MUST contain a single <a href="#def-reject-reason">reject reason element</a>. It MAY also contain one or more <a href="#def-header">&lt;header/&gt; elements</a>.</p>
    <p class="" style="">The &lt;reject/&gt; element has no attributes.</p>

    <div class="indent"><h3>7.9.1 <a name="def-reject-reason" id="def-reject-reason">Reject Reason Element</a></h3>
      <p class="" style="">The following are valid reject reason elements. Unless otherwise stated, they all MUST be empty, and they do not have any attributes.</p>

      <div class="indent"><dl>
        <di>
          <dt><strong>&lt;decline/&gt;</strong></dt>
          <dd>Indicates that the controlling party refused the call for an unspecified reason, such as access control.</dd>
        </di>
        <di>
          <dt><strong>&lt;busy/&gt;</strong></dt>
          <dd>Indicates that the controlling party refused the call due to excess load.</dd>
        </di>
        <di>
          <dt><strong>&lt;error/&gt;</strong></dt>
          <dd>Indicates that the controlling party refused the call because some error occurred.</dd>
        </di>
      </dl></div>
    </div>
  </div>

  <div class="indent"><h3>7.10 <a name="def-hangup" id="def-hangup">Hangup Element</a></h3>
    <p class="" style="">Instructs the server to bring the call to an end naturally.</p>
    <p class="" style="">The &lt;hangup/&gt; element MAY contain one or more <a href="#def-header">&lt;header/&gt; elements</a>.</p>
    <p class="" style="">The &lt;hangup/&gt; element has no attributes.</p>
  </div>

  <div class="indent"><h3>7.11 <a name="def-dial" id="def-dial">Dial Element</a></h3>
    <p class="" style="">Instructs the server to create a new call and surrender control of it to the requesting party.</p>
    <p class="" style="">The &lt;dial/&gt; element MAY contain one or more <a href="#def-header">&lt;header/&gt; elements</a>. It MAY contain one or more <a href="#def-join">&lt;join/&gt; elements</a>, instructing the server to join the new call in the indicated manner rather than the default (join to the local media server).</p>
    <p class="" style="">The attributes of the &lt;dial/&gt; element are as follows.</p>
    <div class="indent"><p class="caption"><a name="table-6" id="table-6"></a>Table 6: Attributes of Dial Element</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Attribute</th>
        <th colspan="" rowspan="">Definition</th>
        <th colspan="" rowspan="">Inclusion</th>
        <th colspan="" rowspan="">Default</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">to</td>
        <td align="" colspan="" rowspan="">Indicates the party to whom the call should be directed.</td>
        <td align="" colspan="" rowspan="">REQUIRED</td>
        <td align="" colspan="" rowspan=""></td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">from</td>
        <td align="" colspan="" rowspan="">Indicates the caller ID with which the call should appear to originate.</td>
        <td align="" colspan="" rowspan="">OPTIONAL</td>
        <td align="" colspan="" rowspan=""></td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">uri</td>
        <td align="" colspan="" rowspan="">Indicates the URI at which the client wishes the call to be presented.</td>
        <td align="" colspan="" rowspan="">OPTIONAL</td>
        <td align="" colspan="" rowspan=""></td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">timeout</td>
        <td align="" colspan="" rowspan="">Indicates the maximum time allowed for a response to be provided by the remote party before the call should be considered to have come to an end.</td>
        <td align="" colspan="" rowspan="">OPTIONAL</td>
        <td align="" colspan="" rowspan="">-1</td>
      </tr>
    </table></div>
  </div>

  <div class="indent"><h3>7.12 <a name="def-join" id="def-join">Join Element</a></h3>
    <p class="" style="">Instructs the server to join the media streams of the call and the specified party, given direction and media negotiation parameters.</p>
    <p class="" style="">The &lt;join/&gt; element MUST be empty.</p>
    <p class="" style="">The attributes of the &lt;join/&gt; element are as follows.</p>
    <div class="indent"><p class="caption"><a name="table-7" id="table-7"></a>Table 7: Attributes of Join Element</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Attribute</th>
        <th colspan="" rowspan="">Definition</th>
        <th colspan="" rowspan="">Inclusion</th>
        <th colspan="" rowspan="">Default</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">direction</td>
        <td align="" colspan="" rowspan="">
          <p class="" style="">Indicates the direction in which the media should flow between the call and the 3rd party. Must be one of the following values:</p>
          <ul class="" style="">
            <li class="" style=""><span class="strong">"duplex"</span> - Indicates that media should flow in both directions between the parties.</li>
            <li class="" style=""><span class="strong">"send"</span> - Indicates that media should only flow from the target call to the third party.</li>
            <li class="" style=""><span class="strong">"recv"</span> - Indicates that media should only flow from the third party to the target call.</li>
          </ul>
        </td>
        <td align="" colspan="" rowspan="">OPTIONAL</td>
        <td align="" colspan="" rowspan="">duplex</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">media</td>
        <td align="" colspan="" rowspan="">
          <p class="" style="">Indicates the manner in which the server should negotiate media between the two parties. Must be one of the following values:</p>
          <ul class="" style="">
            <li class="" style=""><span class="strong">"bridge"</span> - Instructs the server to bridge the parties media streams via its local media server.</li>
            <li class="" style=""><span class="strong">"direct"</span> - Instructs the server to have the parties negotiate media directly with one another.</li>
          </ul>
        </td>
        <td align="" colspan="" rowspan="">OPTIONAL</td>
        <td align="" colspan="" rowspan="">bridge</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">call-uri</td>
        <td align="" colspan="" rowspan="">Indicates the 3rd party call URI to which the target call should be joined.</td>
        <td align="" colspan="" rowspan="">REQUIRED unless mixer-name is set. MUST NOT be set if mixer-name is set.</td>
        <td align="" colspan="" rowspan=""></td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">mixer-name</td>
        <td align="" colspan="" rowspan="">Indicates the mixer name to which the target call should be joined.</td>
        <td align="" colspan="" rowspan="">REQUIRED unless call-uri is set. MUST NOT be set if call-uri is set.</td>
        <td align="" colspan="" rowspan=""></td>
      </tr>
    </table></div>
  </div>

  <div class="indent"><h3>7.13 <a name="def-unjoin" id="def-unjoin">Unjoin Element</a></h3>
    <p class="" style="">Instructs the server to unjoin the media streams of the call and the specified party.</p>
    <p class="" style="">The &lt;unjoin/&gt; element MUST be empty.</p>
    <p class="" style="">The attributes of the &lt;unjoin/&gt; element are as follows.</p>
    <div class="indent"><p class="caption"><a name="table-8" id="table-8"></a>Table 8: Attributes of Unjoin Element</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Attribute</th>
        <th colspan="" rowspan="">Definition</th>
        <th colspan="" rowspan="">Inclusion</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">call-uri</td>
        <td align="" colspan="" rowspan="">Indicates the 3rd party call URI from which the target call should be unjoined.</td>
        <td align="" colspan="" rowspan="">OPTIONAL. MUST NOT be set if mixer-name is set.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">mixer-name</td>
        <td align="" colspan="" rowspan="">Indicates the mixer name from which the target call should be unjoined.</td>
        <td align="" colspan="" rowspan="">OPTIONAL. MUST NOT be set if call-uri is set.</td>
      </tr>
    </table></div>
  </div>

  <div class="indent"><h3>7.14 <a name="def-joined" id="def-joined">Joined Element</a></h3>
    <p class="" style="">Indicates that the call was successfully joined to the specified party.</p>
    <p class="" style="">The &lt;joined/&gt; element MUST be empty.</p>
    <p class="" style="">The attributes of the &lt;joined/&gt; element are as follows.</p>
    <div class="indent"><p class="caption"><a name="table-9" id="table-9"></a>Table 9: Attributes of Joined Element</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Attribute</th>
        <th colspan="" rowspan="">Definition</th>
        <th colspan="" rowspan="">Inclusion</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">call-uri</td>
        <td align="" colspan="" rowspan="">Indicates the 3rd party call URI to which the target call was joined.</td>
        <td align="" colspan="" rowspan="">REQUIRED unless mixer-name is set. MUST NOT be set if mixer-name is set.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">mixer-name</td>
        <td align="" colspan="" rowspan="">Indicates the mixer name to which the target call was joined.</td>
        <td align="" colspan="" rowspan="">REQUIRED unless call-uri is set. MUST NOT be set if call-uri is set.</td>
      </tr>
    </table></div>
  </div>

  <div class="indent"><h3>7.15 <a name="def-unjoined" id="def-unjoined">Unjoined Element</a></h3>
    <p class="" style="">Indicates that the call ceased to be joined to the specified party.</p>
    <p class="" style="">The &lt;unjoined/&gt; element MUST be empty.</p>
    <p class="" style="">The attributes of the &lt;unjoined/&gt; element are as follows.</p>
    <div class="indent"><p class="caption"><a name="table-10" id="table-10"></a>Table 10: Attributes of Unjoined Element</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Attribute</th>
        <th colspan="" rowspan="">Definition</th>
        <th colspan="" rowspan="">Inclusion</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">call-uri</td>
        <td align="" colspan="" rowspan="">Indicates the 3rd party call URI from which the target call was unjoined.</td>
        <td align="" colspan="" rowspan="">REQUIRED unless mixer-name is set. MUST NOT be set if mixer-name is set.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">mixer-name</td>
        <td align="" colspan="" rowspan="">Indicates the mixer name from which the target call was unjoined.</td>
        <td align="" colspan="" rowspan="">REQUIRED unless call-uri is set. MUST NOT be set if call-uri is set.</td>
      </tr>
    </table></div>
  </div>

  <div class="indent"><h3>7.16 <a name="def-started-speaking" id="def-started-speaking">Started Speaking Element</a></h3>
    <p class="" style="">Indicates that a call joined to a mixer with which the controlling party has an events subscription has activated a speech detector, providing its URI.</p>
    <p class="" style="">The &lt;started-speaking/&gt; element MUST be empty.</p>
    <p class="" style="">The attributes of the &lt;started-speaking/&gt; element are as follows.</p>
    <div class="indent"><p class="caption"><a name="table-11" id="table-11"></a>Table 11: Attributes of Started Speaking Element</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Attribute</th>
        <th colspan="" rowspan="">Definition</th>
        <th colspan="" rowspan="">Inclusion</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">call-uri</td>
        <td align="" colspan="" rowspan="">Indicates the URI of the call which has triggered the speech detector.</td>
        <td align="" colspan="" rowspan="">REQUIRED</td>
      </tr>
    </table></div>
  </div>

  <div class="indent"><h3>7.17 <a name="def-stopped-speaking" id="def-stopped-speaking">Stopped Speaking Element</a></h3>
    <p class="" style="">Indicates that a call joined to a mixer with which the controlling party has an events subscription has ceased activation of a speech detector, providing its URI.</p>
    <p class="" style="">The &lt;stopped-speaking/&gt; element MUST be empty.</p>
    <p class="" style="">The attributes of the &lt;stopped-speaking/&gt; element are as follows.</p>
    <div class="indent"><p class="caption"><a name="table-12" id="table-12"></a>Table 12: Attributes of Stopped Speaking Element</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Attribute</th>
        <th colspan="" rowspan="">Definition</th>
        <th colspan="" rowspan="">Inclusion</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">call-uri</td>
        <td align="" colspan="" rowspan="">Indicates the URI of the call which has triggered the speech detector.</td>
        <td align="" colspan="" rowspan="">REQUIRED</td>
      </tr>
    </table></div>
  </div>

  <div class="indent"><h3>7.18 <a name="def-ref" id="def-ref">Ref Element</a></h3>
    <p class="" style="">Used to give the address of a newly created resource, either a call or a component.</p>
    <p class="" style="">The &lt;ref/&gt; element MUST be empty.</p>
    <p class="" style="">The attributes of the &lt;ref/&gt; element are as follows.</p>
    <div class="indent"><p class="caption"><a name="table-13" id="table-13"></a>Table 13: Attributes of Ref Element</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Attribute</th>
        <th colspan="" rowspan="">Definition</th>
        <th colspan="" rowspan="">Inclusion</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">uri</td>
        <td align="" colspan="" rowspan="">Gives the URI of the new resource.</td>
        <td align="" colspan="" rowspan="">REQUIRED</td>
      </tr>
    </table></div>
  </div>

  <div class="indent"><h3>7.19 <a name="def-components" id="def-components">Components</a></h3>

    <div class="indent"><h3>7.19.1 <a name="def-components-stop" id="def-components-stop">Stop Element</a></h3>
      <p class="" style="">Instructs a component to come to an end before it completes naturally.</p>
      <p class="" style="">The &lt;stop/&gt; element MUST be empty.</p>
      <p class="" style="">The &lt;stop/&gt; element has no attributes.</p>
    </div>

    <div class="indent"><h3>7.19.2 <a name="def-components-complete" id="def-components-complete">Complete Element</a></h3>
      <p class="" style="">Indicates that the component has come to an end and no further processing will occurr. Gives the reason for the termination.</p>
      <p class="" style="">The &lt;complete/&gt; element MUST contain exactly one child element, indicating the reason for the complete event being raised. The reason may be a <a href="#def-components-complete-reason">core complete reason</a> or a reason specific to a particular component.</p>
      <p class="" style="">The &lt;complete/&gt; element has no attributes.</p>

      <div class="indent"><h3>7.19.2.1 <a name="def-components-complete-reason" id="def-components-complete-reason">Complete Reason Element</a></h3>
        <p class="" style="">The following are valid complete reason elements. They all MAY contain further component-specific metadata elements, but they do not have any attributes.</p>

        <div class="indent"><dl>
          <di>
            <dt><strong>&lt;stop/&gt;</strong></dt>
            <dd>Indicates that the component came to an end because it was issued a stop command by the controlling party.</dd>
          </di>
          <di>
            <dt><strong>&lt;hangup/&gt;</strong></dt>
            <dd>Indicates that the component came to an end because the call ended.</dd>
          </di>
          <di>
            <dt><strong>&lt;error/&gt;</strong></dt>
            <dd>Indicates that the component came to an end because it encountered an error.</dd>
          </di>
        </dl></div>
      </div>
    </div>

    <div class="indent"><h3>7.19.3 <a name="def-component-output" id="def-component-output">Media Output</a></h3>
      <p class="" style="">An output component is used to instruct the server to generate audible output to a call or mixer.</p>

      <div class="indent"><h3>7.19.3.1 <a name="def-component-output-output" id="def-component-output-output">Output Element</a></h3>
        <p class="" style="">Instructs the server to begin an output component executing on the target call or mixer with the specified document and parameters.</p>
        <p class="" style="">The &lt;output/&gt; element MUST contain one or more <a href="#def-component-output-output-document">&lt;document/&gt; elements</a>. A server MUST support the application/ssml+xml content type, but MAY additionally support others.</p>
        <p class="" style="">The attributes of the &lt;output/&gt; element are as follows.</p>
        <div class="indent"><p class="caption"><a name="table-14" id="table-14"></a>Table 14: Attributes of Output Element</p><table border="1" cellpadding="3" cellspacing="0">
          <tr class="body">
            <th colspan="" rowspan="">Attribute</th>
            <th colspan="" rowspan="">Definition</th>
            <th colspan="" rowspan="">Possible Values</th>
            <th colspan="" rowspan="">Default</th>
            <th colspan="" rowspan="">Inclusion</th>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">start-offset</td>
            <td align="" colspan="" rowspan="">Indicates some offset through which the output should be skipped before rendering begins.</td>
            <td align="" colspan="" rowspan="">A positive integer in ms.</td>
            <td align="" colspan="" rowspan="">0</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">start-paused</td>
            <td align="" colspan="" rowspan="">Indicates wether or not the component should be started in a paused state to be resumed at a later time.</td>
            <td align="" colspan="" rowspan="">true|false</td>
            <td align="" colspan="" rowspan="">false</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">repeat-interval</td>
            <td align="" colspan="" rowspan="">Indicates the duration of silence that should space repeats of the rendered document.</td>
            <td align="" colspan="" rowspan="">A positive integer in ms.</td>
            <td align="" colspan="" rowspan="">0</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">repeat-times</td>
            <td align="" colspan="" rowspan="">Indicates the number of times the output should be played.</td>
            <td align="" colspan="" rowspan="">A positive integer or 0 to repeat forever.</td>
            <td align="" colspan="" rowspan="">1</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">max-time</td>
            <td align="" colspan="" rowspan="">Indicates the maximum amount of time for which the output should be allowed to run before being terminated. Includes repeats.</td>
            <td align="" colspan="" rowspan="">A positive integer in ms or -1 to disable.</td>
            <td align="" colspan="" rowspan="">-1</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">renderer</td>
            <td align="" colspan="" rowspan="">Indicates which media engine the server should use to render the Output. The server defines the possible values and falls back to the platform default if not specified.</td>
            <td align="" colspan="" rowspan="">An arbitrary string</td>
            <td align="" colspan="" rowspan=""></td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">voice</td>
            <td align="" colspan="" rowspan="">The voice with which to speak the requested document</td>
            <td align="" colspan="" rowspan="">Any voice supported by the TTS engine.</td>
            <td align="" colspan="" rowspan=""></td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
        </table></div>

        
          <p class="" style="">Presents a document for rendering by the output engine.</p>
          <p class="" style="">The &lt;document/&gt; element MUST have either a url attribute set OR a content type and a body, containing a document for output rendering enclosed within CDATA.</p>
          <p class="" style="">The attributes of the &lt;document/&gt; element are as follows.</p>
          <div class="indent"><p class="caption"><a name="table-15" id="table-15"></a>Table 15: Attributes of Document Element</p><table border="1" cellpadding="3" cellspacing="0">
            <tr class="body">
              <th colspan="" rowspan="">Attribute</th>
              <th colspan="" rowspan="">Definition</th>
              <th colspan="" rowspan="">Possible Values</th>
              <th colspan="" rowspan="">Default</th>
              <th colspan="" rowspan="">Inclusion</th>
            </tr>
            <tr class="body">
              <td align="" colspan="" rowspan="">url</td>
              <td align="" colspan="" rowspan="">Provides a URI at which the document is available.</td>
              <td align="" colspan="" rowspan="">Any valid URI scheme supported by the server (eg HTTP).</td>
              <td align="" colspan="" rowspan="">none</td>
              <td align="" colspan="" rowspan="">REQUIRED unless content-type and content are set</td>
            </tr>
            <tr class="body">
              <td align="" colspan="" rowspan="">content-type</td>
              <td align="" colspan="" rowspan="">Indicates the content type of the document provided as CDATA.</td>
              <td align="" colspan="" rowspan="">A document content type token</td>
              <td align="" colspan="" rowspan=""></td>
              <td align="" colspan="" rowspan="">REQUIRED unless url is set</td>
            </tr>
          </table></div>
        
      </div>

      <div class="indent"><h3>7.19.3.2 <a name="def-component-output-pause" id="def-component-output-pause">Pause Element</a></h3>
        <p class="" style="">Instructs the server to pause the media output, but not terminate the component.</p>
        <p class="" style="">The &lt;pause/&gt; element MUST be empty.</p>
        <p class="" style="">The &lt;pause/&gt; element has no attributes.</p>
      </div>

      <div class="indent"><h3>7.19.3.3 <a name="def-component-output-resume" id="def-component-output-resume">Resume Element</a></h3>
        <p class="" style="">Instructs the server to continue rendering the output from the last pause marker.</p>
        <p class="" style="">The &lt;resume/&gt; element MUST be empty.</p>
        <p class="" style="">The &lt;resume/&gt; element has no attributes.</p>
      </div>

      <div class="indent"><h3>7.19.3.4 <a name="def-component-output-speedup" id="def-component-output-speedup">SpeedUp Element</a></h3>
        <p class="" style="">Instructs the server to increase the rate of output by a unit amount.</p>
        <p class="" style="">The &lt;speed-up/&gt; element MUST be empty.</p>
        <p class="" style="">The &lt;speed-up/&gt; element has no attributes.</p>
      </div>

      <div class="indent"><h3>7.19.3.5 <a name="def-component-output-speeddown" id="def-component-output-speeddown">SpeedDown Element</a></h3>
        <p class="" style="">Instructs the server to decrease the rate of output by a unit amount.</p>
        <p class="" style="">The &lt;speed-down/&gt; element MUST be empty.</p>
        <p class="" style="">The &lt;speed-down/&gt; element has no attributes.</p>
      </div>

      <div class="indent"><h3>7.19.3.6 <a name="def-component-output-volumeup" id="def-component-output-volumeup">VolumeUp Element</a></h3>
        <p class="" style="">Instructs the server to increase the volume of output by a unit amount.</p>
        <p class="" style="">The &lt;volume-up/&gt; element MUST be empty.</p>
        <p class="" style="">The &lt;volume-up/&gt; element has no attributes.</p>
      </div>

      <div class="indent"><h3>7.19.3.7 <a name="def-component-output-volumedown" id="def-component-output-volumedown">VolumeDown Element</a></h3>
        <p class="" style="">Instructs the server to decrease the volume of output by a unit amount.</p>
        <p class="" style="">The &lt;volume-down/&gt; element MUST be empty.</p>
        <p class="" style="">The &lt;volume-down/&gt; element has no attributes.</p>
      </div>

      <div class="indent"><h3>7.19.3.8 <a name="def-component-output-seek" id="def-component-output-seek">Seek Element</a></h3>
        <p class="" style="">Instructs the server to move the play marker of the output forward or back in time before resuming output.</p>
        <p class="" style="">The &lt;seek/&gt; element MUST be empty.</p>
        <p class="" style="">The attributes of the &lt;seek/&gt; element are as follows.</p>
        <div class="indent"><p class="caption"><a name="table-16" id="table-16"></a>Table 16: Attributes of Seek Element</p><table border="1" cellpadding="3" cellspacing="0">
          <tr class="body">
            <th colspan="" rowspan="">Attribute</th>
            <th colspan="" rowspan="">Definition</th>
            <th colspan="" rowspan="">Possible Values</th>
            <th colspan="" rowspan="">Inclusion</th>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">direction</td>
            <td align="" colspan="" rowspan="">Indicates the direction in time in which to move the play marker.</td>
            <td align="" colspan="" rowspan="">forward|back</td>
            <td align="" colspan="" rowspan="">REQUIRED</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">amount</td>
            <td align="" colspan="" rowspan="">Indicates the duration by which to move the play marker.</td>
            <td align="" colspan="" rowspan="">A positive integer, in ms.</td>
            <td align="" colspan="" rowspan="">REQUIRED</td>
          </tr>
        </table></div>
      </div>

      <div class="indent"><h3>7.19.3.9 <a name="def-component-output-finish" id="def-component-output-finish">Finish Element</a></h3>
        <p class="" style="">Indicates that the output component came to an end as a result of reaching the end of the document to be rendered.</p>
        <p class="" style="">The &lt;finish/&gt; element MUST be empty.</p>
        <p class="" style="">The &lt;finish/&gt; element has no attributes.</p>
      </div>

      <div class="indent"><h3>7.19.3.10 <a name="def-component-output-maxtime" id="def-component-output-maxtime">MaxTime Element</a></h3>
        <p class="" style="">Indicates that the output component came to an end due to the maximum time limit being reached.</p>
        <p class="" style="">The &lt;max-time/&gt; element MUST be empty.</p>
        <p class="" style="">The &lt;max-time/&gt; element has no attributes.</p>
      </div>
    </div>

    <div class="indent"><h3>7.19.4 <a name="def-component-input" id="def-component-input">Media Input</a></h3>
      <p class="" style="">An input component is used to instruct the server to gather media input from a call or mixer, using either DTMF or ASR.</p>

      <div class="indent"><h3>7.19.4.1 <a name="def-component-input-input" id="def-component-input-input">Input Element</a></h3>
        <p class="" style="">Instructs the server to begin an input detector of the specified mode, with certain attributes, governed by the rules provided in one or more grammar documents.</p>
        <p class="" style="">The &lt;input/&gt; element MUST contain one or more <a href="#def-comoponent-input-input-grammar">&lt;grammar/&gt; elements</a>.</p>
        <p class="" style="">The attributes of the &lt;input/&gt; element are as follows.</p>
        <div class="indent"><p class="caption"><a name="table-17" id="table-17"></a>Table 17: Attributes of Input Element</p><table border="1" cellpadding="3" cellspacing="0">
          <tr class="body">
            <th colspan="" rowspan="">Attribute</th>
            <th colspan="" rowspan="">Definition</th>
            <th colspan="" rowspan="">Possible Values</th>
            <th colspan="" rowspan="">Default</th>
            <th colspan="" rowspan="">Inclusion</th>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">mode</td>
            <td align="" colspan="" rowspan="">The method by which to collect input.</td>
            <td align="" colspan="" rowspan="">any|dtmf|voice|cpa</td>
            <td align="" colspan="" rowspan="">any</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">terminator</td>
            <td align="" colspan="" rowspan="">Indicates a terminator token which, when encountered, should cause the input detection to cease.</td>
            <td align="" colspan="" rowspan="">A token string</td>
            <td align="" colspan="" rowspan="">none</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">recognizer</td>
            <td align="" colspan="" rowspan="">Indicates the name of the particular input processor to be engaged, used only for routing purposes (eg to choose which MRCP profile to invoke).</td>
            <td align="" colspan="" rowspan="">A token string</td>
            <td align="" colspan="" rowspan="">none</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">language</td>
            <td align="" colspan="" rowspan="">Specifies the recognition language to the recognizer.</td>
            <td align="" colspan="" rowspan="">Any valid ISO 639‑3 language code</td>
            <td align="" colspan="" rowspan="">en-US</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">initial-timeout</td>
            <td align="" colspan="" rowspan="">Indicates the amount of time preceding input which may expire before a timeout is triggered.</td>
            <td align="" colspan="" rowspan="">Any positive integer in miliseconds, or -1 to disable.</td>
            <td align="" colspan="" rowspan="">-1</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">inter-digit-timeout</td>
            <td align="" colspan="" rowspan="">Indicates (in the case of DTMF input) the amount of time between input digits which may expire before a timeout is triggered.</td>
            <td align="" colspan="" rowspan="">Any positive integer in miliseconds, or -1 to disable.</td>
            <td align="" colspan="" rowspan="">-1</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">recognition-timeout</td>
            <td align="" colspan="" rowspan="">Indicates the time (in milliseconds) for speech input, after speech has begun, to return a Match before triggering a Nomatch completion.</td>
            <td align="" colspan="" rowspan="">Integer value from 0 to MAXTIMEOUT, where MAXTIMEOUT is implementation specific, or -1 to disable.</td>
            <td align="" colspan="" rowspan="">-1</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">sensitivity</td>
            <td align="" colspan="" rowspan="">Indicates how sensitive the interpreter should be to loud versus quiet input. Higher values represent greater sensitivity.</td>
            <td align="" colspan="" rowspan="">A decimal value between 0 and 1.</td>
            <td align="" colspan="" rowspan="">0.5</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">min-confidence</td>
            <td align="" colspan="" rowspan="">Indicates the confidence threshold, below which a match is to be considered unreliable.</td>
            <td align="" colspan="" rowspan="">A decimal value between 0 and 1.</td>
            <td align="" colspan="" rowspan="">0</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">max-silence</td>
            <td align="" colspan="" rowspan="">Indicates the maximum period of silence which may be encountered during input gathering before a timeout is triggered.</td>
            <td align="" colspan="" rowspan="">Any positive integer in miliseconds, or -1 to disable.</td>
            <td align="" colspan="" rowspan="">-1</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">match-content-type</td>
            <td align="" colspan="" rowspan="">Indicates the required response document format.</td>
            <td align="" colspan="" rowspan="">Must support at least application/nlsml+xml, but may support others such as application/emma+xml.</td>
            <td align="" colspan="" rowspan="">application/nlsml+xml</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
        </table></div>

        
          <p class="" style="">Provides the grammar document by which the input detection should be governed.</p>
          <p class="" style="">The &lt;grammar/&gt; element MUST have either a url attribute set OR a content type and a body.</p>
          <p class="" style="">The attributes of the &lt;grammar/&gt; element are as follows.</p>
          <div class="indent"><p class="caption"><a name="table-18" id="table-18"></a>Table 18: Attributes of Grammar Element</p><table border="1" cellpadding="3" cellspacing="0">
            <tr class="body">
              <th colspan="" rowspan="">Attribute</th>
              <th colspan="" rowspan="">Definition</th>
              <th colspan="" rowspan="">Possible Values</th>
              <th colspan="" rowspan="">Default</th>
              <th colspan="" rowspan="">Inclusion</th>
            </tr>
            <tr class="body">
              <td align="" colspan="" rowspan="">url</td>
              <td align="" colspan="" rowspan="">Provides a URI at which the grammar document is available.</td>
              <td align="" colspan="" rowspan="">Any valid URI scheme supported by the server (eg HTTP).</td>
              <td align="" colspan="" rowspan="">none</td>
              <td align="" colspan="" rowspan="">REQUIRED unless content-type and content are set</td>
            </tr>
            <tr class="body">
              <td align="" colspan="" rowspan="">content-type</td>
              <td align="" colspan="" rowspan="">Indicates the content type of the grammar document provided as CDATA.</td>
              <td align="" colspan="" rowspan="">A grammar content type token</td>
              <td align="" colspan="" rowspan="">none</td>
              <td align="" colspan="" rowspan="">REQUIRED unless url is set</td>
            </tr>
          </table></div>
        
      </div>

      <div class="indent"><h3>7.19.4.2 <a name="def-component-input-match" id="def-component-input-match">Match</a></h3>
        <p class="" style="">Indicates that the component came to an end due to one of its grammars matching the received input.</p>
        <p class="" style="">The &lt;match/&gt; element MUST contain a valid response document within CDATA.</p>
        <p class="" style="">The attributes of the &lt;match/&gt; element are as follows.</p>
          <div class="indent"><p class="caption"><a name="table-19" id="table-19"></a>Table 19: Attributes of Match Element</p><table border="1" cellpadding="3" cellspacing="0">
            <tr class="body">
              <th colspan="" rowspan="">Attribute</th>
              <th colspan="" rowspan="">Definition</th>
              <th colspan="" rowspan="">Possible Values</th>
              <th colspan="" rowspan="">Default</th>
              <th colspan="" rowspan="">Inclusion</th>
            </tr>
            <tr class="body">
              <td align="" colspan="" rowspan="">content-type</td>
              <td align="" colspan="" rowspan="">Indicates the content type of the result document provided as CDATA.</td>
              <td align="" colspan="" rowspan="">A result document content type token</td>
              <td align="" colspan="" rowspan="">application/nlsml+xml</td>
              <td align="" colspan="" rowspan="">REQUIRED</td>
            </tr>
          </table></div>
      </div>

      <div class="indent"><h3>7.19.4.3 <a name="def-component-input-noinput" id="def-component-input-noinput">Noinput</a></h3>
        <p class="" style="">Indicates that the component came to an end because a timeout was triggered before input was received.</p>
        <p class="" style="">The &lt;noinput/&gt; element MUST be empty.</p>
        <p class="" style="">The &lt;noinput/&gt; element has no attributes.</p>
      </div>

      <div class="indent"><h3>7.19.4.4 <a name="def-component-input-nomatch" id="def-component-input-nomatch">Nomatch</a></h3>
        <p class="" style="">Indicates that the component came to an end because input was received which did not match any of the specified grammars.</p>
        <p class="" style="">The &lt;nomatch/&gt; element MUST be empty.</p>
        <p class="" style="">The &lt;nomatch/&gt; element has no attributes.</p>
      </div>
    </div>

    <div class="indent"><h3>7.19.5 <a name="def-component-prompt" id="def-component-prompt">Prompt</a></h3>
      <p class="" style="">An prompt component is a mixture of audio output and input, and is used to link the lifecycle of both such input may interrupt output via an arbitrary grammar.</p>

      <div class="indent"><h3>7.19.5.1 <a name="def-component-input-input" id="def-component-input-input">Prompt Element</a></h3>
        <p class="" style="">Instructs the server to begin an input detector of the specified mode, with certain attributes, governed by the rules provided in one or more grammar documents, while simultaneously rendering output.</p>
        <p class="" style="">The &lt;prompt/&gt; element MUST contain an <a href="#def-comoponent-input-input">&lt;input/&gt; element</a> and an <a href="#def-comoponent-output-output">&lt;output/&gt; element</a>.</p>
        <p class="" style="">The attributes of the &lt;prompt/&gt; element are as follows.</p>
        <div class="indent"><p class="caption"><a name="table-20" id="table-20"></a>Table 20: Attributes of Prompt Element</p><table border="1" cellpadding="3" cellspacing="0">
          <tr class="body">
            <th colspan="" rowspan="">Attribute</th>
            <th colspan="" rowspan="">Definition</th>
            <th colspan="" rowspan="">Possible Values</th>
            <th colspan="" rowspan="">Default</th>
            <th colspan="" rowspan="">Inclusion</th>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">barge-in</td>
            <td align="" colspan="" rowspan="">Whether or not the input detector is permitted to interrupt the output.</td>
            <td align="" colspan="" rowspan="">true|false</td>
            <td align="" colspan="" rowspan="">true</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
        </table></div>
      </div>

      <div class="indent"><h3>7.19.5.2 <a name="def-component-prompt-input-timers-started" id="def-component-prompt-input-timers-started">Input Timers Started Element</a></h3>
        <p class="" style="">Indicates that the component's input timers have started.</p>
        <p class="" style="">The &lt;input-timers-started/&gt; element MUST be empty.</p>
        <p class="" style="">The &lt;input-timers-started/&gt; element has no attributes.</p>
      </div>
    </div>

    <div class="indent"><h3>7.19.6 <a name="def-component-record" id="def-component-record">Media Recording</a></h3>
      <p class="" style="">A record component is used to instruct the server to record audible or visual media for temporary or permanent storage.</p>

      <div class="indent"><h3>7.19.6.1 <a name="def-component-record-record" id="def-component-record-record">Record Element</a></h3>
        <p class="" style="">Instructs the server to begin recording input to the call to a file.</p>
        <p class="" style="">The &lt;record/&gt; element MAY contain one or more <a href="#def-comoponent-record-record-hint">&lt;hint/&gt; elements</a>.</p>
        <p class="" style="">The attributes of the &lt;record/&gt; element are as follows.</p>
        <div class="indent"><p class="caption"><a name="table-21" id="table-21"></a>Table 21: Attributes of Record Element</p><table border="1" cellpadding="3" cellspacing="0">
          <tr class="body">
            <th colspan="" rowspan="">Attribute</th>
            <th colspan="" rowspan="">Definition</th>
            <th colspan="" rowspan="">Possible Values</th>
            <th colspan="" rowspan="">Default</th>
            <th colspan="" rowspan="">Inclusion</th>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">format</td>
            <td align="" colspan="" rowspan="">File format used during recording.</td>
            <td align="" colspan="" rowspan="">A valid format token, such as 'mp3', 'wav', 'h264'. Implementation specific.</td>
            <td align="" colspan="" rowspan="">wav</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">start-beep</td>
            <td align="" colspan="" rowspan="">Indicates whether subsequent record will be preceded with a beep.</td>
            <td align="" colspan="" rowspan="">true|false</td>
            <td align="" colspan="" rowspan="">false</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">stop-beep</td>
            <td align="" colspan="" rowspan="">Indicates whether subsequent record stop will be preceded with a beep.</td>
            <td align="" colspan="" rowspan="">true|false</td>
            <td align="" colspan="" rowspan="">false</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">start-paused</td>
            <td align="" colspan="" rowspan="">Whether subsequent record will start in PAUSE mode.</td>
            <td align="" colspan="" rowspan="">true|false</td>
            <td align="" colspan="" rowspan="">false</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">max-duration</td>
            <td align="" colspan="" rowspan="">Indicates the maximum duration for the recording.</td>
            <td align="" colspan="" rowspan="">Any positive integer in miliseconds, or -1 to disable.</td>
            <td align="" colspan="" rowspan="">-1</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">initial-timeout</td>
            <td align="" colspan="" rowspan="">Controls how long the recognizer should wait after the end of the prompt for the caller to speak before sending a Recorder event.</td>
            <td align="" colspan="" rowspan="">Any positive integer in miliseconds, or -1 to disable.</td>
            <td align="" colspan="" rowspan="">-1</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">final-timeout</td>
            <td align="" colspan="" rowspan="">Controls the length of a period of silence after callers have spoken to conclude they finished.</td>
            <td align="" colspan="" rowspan="">Any positive integer in miliseconds, or -1 to disable.</td>
            <td align="" colspan="" rowspan="">-1</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">direction</td>
            <td align="" colspan="" rowspan="">
              <p class="" style="">Indicates the direction of the call to record, meaning which call legs(s) are included in the resulting file, in case the call is joined to another or a mixer.</p>
            </td>
            <td align="" colspan="" rowspan="">
              <ul class="" style="">
                <li class="" style=""><span class="strong">"duplex"</span> - Records both sent and received audio.</li>
                <li class="" style=""><span class="strong">"send"</span> - Indicates that only the audio sent from the caller is to be recorded. Not supported when Record is executed against a mixer.</li>
                <li class="" style=""><span class="strong">"recv"</span> - Indicates that only and all audio received by the caller is recorded.</li>
              </ul>
            </td>
            <td align="" colspan="" rowspan="">duplex</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">mix</td>
            <td align="" colspan="" rowspan="">Whether all channels (call legs) should be mixed into a single recording channel.</td>
            <td align="" colspan="" rowspan="">true|false</td>
            <td align="" colspan="" rowspan="">false</td>
            <td align="" colspan="" rowspan="">OPTIONAL</td>
          </tr>
        </table></div>

        
          <p class="" style="">Optional format-specific encoding hint</p>
          <p class="" style="">The &lt;hint/&gt; element MUST be empty.</p>
          <p class="" style="">The attributes of the &lt;hint/&gt; element are as follows.</p>
          <div class="indent"><p class="caption"><a name="table-22" id="table-22"></a>Table 22: Attributes of Hint Element</p><table border="1" cellpadding="3" cellspacing="0">
            <tr class="body">
              <th colspan="" rowspan="">Attribute</th>
              <th colspan="" rowspan="">Definition</th>
              <th colspan="" rowspan="">Inclusion</th>
            </tr>
            <tr class="body">
              <td align="" colspan="" rowspan="">name</td>
              <td align="" colspan="" rowspan="">The name of the hint value as expected by the recorder.</td>
              <td align="" colspan="" rowspan="">REQUIRED</td>
            </tr>
            <tr class="body">
              <td align="" colspan="" rowspan="">value</td>
              <td align="" colspan="" rowspan="">The value of the hint provided.</td>
              <td align="" colspan="" rowspan="">REQUIRED</td>
            </tr>
          </table></div>
        
      </div>

      <div class="indent"><h3>7.19.6.2 <a name="def-component-record-pause" id="def-component-record-pause">Pause Element</a></h3>
        <p class="" style="">Instructs the server to cease recording input but to leave the destination open for appending to permit resumption from the same point.</p>
        <p class="" style="">The &lt;pause/&gt; element MUST be empty.</p>
        <p class="" style="">The &lt;pause/&gt; element has no attributes.</p>
      </div>

      <div class="indent"><h3>7.19.6.3 <a name="def-component-record-resume" id="def-component-record-resume">Resume Element</a></h3>
        <p class="" style="">Instructs the server to continue recording input, appending to the same destination.</p>
        <p class="" style="">The &lt;resume/&gt; element MUST be empty.</p>
        <p class="" style="">The &lt;resume/&gt; element has no attributes.</p>
      </div>

      <div class="indent"><h3>7.19.6.4 <a name="def-component-record-recording" id="def-component-record-recording">Recording Element</a></h3>
        <p class="" style="">Provides the result of a recording, as a reference to its location.</p>
        <p class="" style="">The &lt;recording/&gt; element MUST be empty.</p>
        <p class="" style="">The attributes of the &lt;recording/&gt; element are as follows.</p>
        <div class="indent"><p class="caption"><a name="table-23" id="table-23"></a>Table 23: Attributes of Recording Element</p><table border="1" cellpadding="3" cellspacing="0">
          <tr class="body">
            <th colspan="" rowspan="">Attribute</th>
            <th colspan="" rowspan="">Definition</th>
            <th colspan="" rowspan="">Possible Values</th>
            <th colspan="" rowspan="">Inclusion</th>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">uri</td>
            <td align="" colspan="" rowspan="">Indicates the URI at which the recording is made available.</td>
            <td align="" colspan="" rowspan="">A valid URI</td>
            <td align="" colspan="" rowspan="">REQUIRED</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">duration</td>
            <td align="" colspan="" rowspan="">Indicates the duration of the completed recording.</td>
            <td align="" colspan="" rowspan="">A positive integer in milliseconds.</td>
            <td align="" colspan="" rowspan="">REQUIRED</td>
          </tr>
          <tr class="body">
            <td align="" colspan="" rowspan="">size</td>
            <td align="" colspan="" rowspan="">Indicates the filesize of the completed recording.</td>
            <td align="" colspan="" rowspan="">A positive integer in bytes.</td>
            <td align="" colspan="" rowspan="">REQUIRED</td>
          </tr>
        </table></div>
      </div>

      <div class="indent"><h3>7.19.6.5 <a name="def-component-record-max-duration" id="def-component-record-max-duration">Max Duration Element</a></h3>
        <p class="" style="">Indicates that the component came to an end due to the max duration being reached.</p>
        <p class="" style="">The &lt;max-duration/&gt; element MUST be empty.</p>
        <p class="" style="">The &lt;max-duration/&gt; element has no attributes.</p>
      </div>

      <div class="indent"><h3>7.19.6.6 <a name="def-component-record-initial-timeout" id="def-component-record-initial-timeout">Initial Timeout Element</a></h3>
        <p class="" style="">Indicates that the component came to an end due to no input being detected before the initial-timeout.</p>
        <p class="" style="">The &lt;initial-timeout/&gt; element MUST be empty.</p>
        <p class="" style="">The &lt;initial-timeout/&gt; element has no attributes.</p>
      </div>

      <div class="indent"><h3>7.19.6.7 <a name="def-component-record-final-timeout" id="def-component-record-final-timeout">Final Timeout Element</a></h3>
        <p class="" style="">Indicates that the component came to an end because no input had been detected for the final timeout duration.</p>
        <p class="" style="">The &lt;final-timeout/&gt; element MUST be empty.</p>
        <p class="" style="">The &lt;final-timeout/&gt; element has no attributes.</p>
      </div>
    </div>
  </div>
<h2>8.
       <a name="support" id="support">Determining Support</a></h2>
  <p class="" style="">If an entity supports Rayo, it MUST advertise that fact by returning a feature of "urn:xmpp:rayo:1" (see <a href="#registrar-versioning">Namespace Versioning</a> regarding the possibility of incrementing the version number) in response to a <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0030.html">Service Discovery (XEP-0030)</a></span>  [<a href="#nt-idm1379">4</a>] information request. The response MUST also include features for the application formats and transport methods supported by the responding entity, as described in the relevant specifications.</p>
  <p class="caption"><a name="example-91" id="example-91"></a>Example 91. Service Discovery Information Request - Client to Server</p><div class="indent"><pre class="prettyprint">
&lt;iq from='kingclaudius@shakespeare.lit/castle'
    id='disco1'
    to='call.rayo.org'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
</pre></div>
  <p class="caption"><a name="example-92" id="example-92"></a>Example 92. Service Discovery Information Response - Client to Server</p><div class="indent"><pre class="prettyprint">
&lt;iq from='call.rayo.org'
    id='disco1'
    to='kingclaudius@shakespeare.lit/castle'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;feature var='urn:xmpp:rayo:1'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></div>
  <p class="caption"><a name="example-93" id="example-93"></a>Example 93. Service Discovery Information Request - Server to Client</p><div class="indent"><pre class="prettyprint">
&lt;iq from='call.rayo.org'
    id='disco1'
    to='laertes@shakespeare.lit/castle'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
</pre></div>
  <p class="caption"><a name="example-94" id="example-94"></a>Example 94. Service Discovery Information Response - Server to Client</p><div class="indent"><pre class="prettyprint">
&lt;iq from='laertes@shakespeare.lit/castle'
    id='disco1'
    to='call.rayo.org'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;feature var='urn:xmpp:rayo:client:1'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></div>
  <p class="" style="">In order for an application to determine whether an entity supports this protocol, where possible it SHOULD use the dynamic, presence-based profile of service discovery defined in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0115.html">Entity Capabilities (XEP-0115)</a></span>  [<a href="#nt-idm1388">5</a>]. However, if an application has not received entity capabilities information from an entity, it SHOULD use explicit service discovery instead.</p>
<h2>9.
       <a name="extensions" id="extensions">Extending Rayo</a></h2>
  <p class="" style="">Rayo is a protocol designed for extensibility. Rayo implementations and deployments have great flexibility in the way they map the Rayo protocol to their underlying transport and media layers, and the functionality they provide around the Rayo interface to the system.</p>

  <p class="" style="">Further commands and components may also be added to the Rayo protocol in order to extend its capabilities. Such extensions should be submitted to the XSF as ProtoXEPs and use namespaces aligning with the core component namespaces.</p>
<h2>10.
       <a name="impl" id="impl">Implementation Notes</a></h2>
  <p class="" style="">A server MUST document any cases where its behaviour differs from that in this specification (such as lack of support for particular options/components/etc) and return an error whenever a command is not understood. A server MUST NOT silently ignore any instructions.</p>
<h2>11.
       <a name="security" id="security">Security Considerations</a></h2>
  <div class="indent"><h3>11.1 <a name="security-dos" id="security-dos">Denial of Service</a></h3>
    <p class="" style="">Rayo sessions can be resource-intensive. Therefore, it is possible to launch a denial-of-service attack against an entity by burdening it with too many Rayo sessions. Care must be taken to accept sessions only from known entities and only if the entity's device is able to process such sessions.</p>
  </div>
  <div class="indent"><h3>11.2 <a name="security-gateways" id="security-gateways">Communication Through Gateways</a></h3>
    <p class="" style="">Rayo communications can be enabled through gateways to non-XMPP networks, whose security characteristics can be quite different from those of XMPP networks. For example, on some SIP networks authentication is optional and "from" addresses can be easily forged. Care must be taken in communicating through such gateways.</p>
  </div>
  <div class="indent"><h3>11.3 <a name="security-info" id="security-info">Information Exposure</a></h3>
    <p class="" style="">Mere negotiation of a Rayo session can expose sensitive information about the parties (e.g. IP addresses). Care must be taken in communicating such information, and end-to-end encryption should be used if the parties do not trust the intermediate servers or gateways.</p>
  </div>
<h2>12.
       <a name="iana" id="iana">IANA Considerations</a></h2>
  <p class="" style="">This document requires no interaction with the <span class="ref" style=""><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-idm1406">6</a>].</p>
<h2>13.
       <a name="registrar" id="registrar">XMPP Registrar Considerations</a></h2>
    <div class="indent"><h3>13.1 <a name="registrar-ns" id="registrar-ns">Protocol Namespaces</a></h3>
    <p class="" style="">This specification defines the following XML namespaces:</p>
    <ul class="" style="">
      <li class="" style="">urn:xmpp:rayo:1</li>
      <li class="" style="">urn:xmpp:rayo:client:1</li>
      <li class="" style="">urn:xmpp:rayo:call:1</li>
      <li class="" style="">urn:xmpp:rayo:mixer:1</li>
      <li class="" style="">urn:xmpp:rayo:ext:1</li>
      <li class="" style="">urn:xmpp:rayo:ext:complete:1</li>
      <li class="" style="">urn:xmpp:rayo:output:1</li>
      <li class="" style="">urn:xmpp:rayo:output:complete:1</li>
      <li class="" style="">urn:xmpp:rayo:input:1</li>
      <li class="" style="">urn:xmpp:rayo:input:complete:1</li>
      <li class="" style="">urn:xmpp:rayo:prompt:1</li>
      <li class="" style="">urn:xmpp:rayo:record:1</li>
      <li class="" style="">urn:xmpp:rayo:record:complete:1</li>
    </ul>
    <p class="" style="">The <span class="ref" style=""><a href="https://xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-idm1428">7</a>] includes the foregoing namespaces in its registry at &lt;<a href="https://xmpp.org/registrar/namespaces.html">https://xmpp.org/registrar/namespaces.html</a>&gt;, as governed by <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0053.html">XMPP Registrar Function (XEP-0053)</a></span>  [<a href="#nt-idm1433">8</a>].</p>
  </div>
  <div class="indent"><h3>13.2 <a name="registrar-versioning" id="registrar-versioning">Namespace Versioning</a></h3>
    <p class="" style="">If the protocol defined in this specification undergoes a major revision that is not fully backward-compatible with an older version, or that contains significant new features, the XMPP Registrar shall increment the protocol version number found at the end of the XML namespaces defined herein, as described in Section 4 of <span class="ref">XEP-0053</span>.</p>
  </div>
  <div class="indent"><h3>13.3 <a name="registrar-components" id="registrar-components">Rayo Components Registry</a></h3>
    <p class="" style="">The XMPP Registrar maintains a registry of Rayo components. All component registrations with the exception of those defined above shall be defined in separate specifications (not in this document). Components defined within the XEP series MUST be registered with the XMPP Registrar, resulting in protocol URNs of the form "urn:xmpp:rayo:component_name:X" (where "component_name" is the registered name of the component and "X" is a non-negative integer).</p>
    <p class="" style="">In order to submit new values to this registry, the registrant shall define an XML fragment of the following form and either include it in the relevant XMPP Extension Protocol or send it to the email address &lt;registrar@xmpp.org&gt;:</p>
    <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;component&gt;
  &lt;name&gt;The name of the component.&lt;/name&gt;
  &lt;desc&gt;A natural-language summary of the component.&lt;/desc&gt;
  &lt;doc&gt;The document in which the component is specified.&lt;/doc&gt;
&lt;/component&gt;
</pre></div>
  </div>
<h2>14.
       <a name="schema" id="schema">XML Schema</a></h2>
  <div class="indent"><h3>14.1 <a name="schema-rayo" id="schema-rayo">Rayo</a></h3>
  <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;schema xmlns="http://www.w3.org/2001/XMLSchema"
  targetNamespace="urn:xmpp:rayo:1"
  xmlns:tns="urn:xmpp:rayo:1"
  elementFormDefault="qualified"&gt;

  &lt;annotation&gt;
    &lt;documentation&gt;
      The protocol documented by this schema is defined at http://rayo.org/xep
    &lt;/documentation&gt;
  &lt;/annotation&gt;

  &lt;!-- Header elements --&gt;
  &lt;complexType name="headerType"&gt;
    &lt;attribute name="name" type="token" use="required"&gt;
      &lt;annotation&gt;
        &lt;documentation&gt;
          A token giving the name by which the header may be known.
        &lt;/documentation&gt;
      &lt;/annotation&gt;
    &lt;/attribute&gt;
    &lt;attribute name="value" type="string" use="required"&gt;
      &lt;annotation&gt;
        &lt;documentation&gt;
          The string value of the named header.
        &lt;/documentation&gt;
      &lt;/annotation&gt;
    &lt;/attribute&gt;
  &lt;/complexType&gt;

  &lt;!-- Offer Event --&gt;
  &lt;element name="offer"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Informs the recipient that a new call is available for control and invites it to take control using progress commands below.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
    &lt;complexType&gt;
      &lt;attribute name="to" type="anyURI" use="required"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            The target URI for the call. May be a tel URI, SIP URI, a JID (for Jingle) or some other platform-specific addressing mechanism.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="from" type="anyURI" use="optional"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            The caller ID URI for the call. May be a tel URI, SIP URI, a JID (for Jingle) or some other platform-specific addressing mechanism.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;sequence&gt;
        &lt;element name="header" type="tns:headerType" minOccurs="0" maxOccurs="unbounded"&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              Set of header variables sent by the originating party (eg SIP INVITE headers).
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/element&gt;
      &lt;/sequence&gt;
    &lt;/complexType&gt;
  &lt;/element&gt;

  &lt;complexType name="callProgressType"&gt;
    &lt;sequence&gt;
      &lt;element name="header" type="tns:headerType" minOccurs="0" maxOccurs="unbounded" /&gt;
    &lt;/sequence&gt;
  &lt;/complexType&gt;

  &lt;!-- Ringing Event --&gt;
  &lt;element name="ringing" type="tns:callProgressType"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indication that an outbound call has begun ringing, or accepted by the remote party.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- Answered Event --&gt;
  &lt;element name="answered" type="tns:callProgressType"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indication that an outbound call has been answered and that the 3rd party negotiation has completed. At this point, the media stream should be open.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;complexType name="endReasonType"&gt;
    &lt;attribute name="platform-code" type="string" use="optional"&gt;
      &lt;annotation&gt;
        &lt;documentation&gt;
          A platform-specific end code. This could be a SIP code, ITU-T Q.850 or some other system. The code may be an arbitrary string.
        &lt;/documentation&gt;
      &lt;/annotation&gt;
    &lt;/attribute&gt;
  &lt;/complexType&gt;

  &lt;!-- End Event --&gt;
  &lt;element name="end"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indication that the call has come to an end, giving the reason.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
    &lt;complexType&gt;
      &lt;sequence&gt;
        &lt;choice&gt;
          &lt;element name="hungup" type="tns:endReasonType"&gt;
            &lt;annotation&gt;
              &lt;documentation&gt;
                Indication that the call ended due to a normal hangup by the remote party.
              &lt;/documentation&gt;
            &lt;/annotation&gt;
          &lt;/element&gt;
          &lt;element name="hangup-command" type="tns:endReasonType"&gt;
            &lt;annotation&gt;
              &lt;documentation&gt;
                Indication that the call ended due to a normal hangup triggered by a hangup command.
              &lt;/documentation&gt;
            &lt;/annotation&gt;
          &lt;/element&gt;
          &lt;element name="timeout" type="tns:endReasonType"&gt;
            &lt;annotation&gt;
              &lt;documentation&gt;
                Indication that the call ended due to a timeout in contacting the remote party.
              &lt;/documentation&gt;
            &lt;/annotation&gt;
          &lt;/element&gt;
          &lt;element name="busy" type="tns:endReasonType"&gt;
            &lt;annotation&gt;
              &lt;documentation&gt;
                Indication that the call ended due to being rejected by the remote party subsequent to being accepted.
              &lt;/documentation&gt;
            &lt;/annotation&gt;
          &lt;/element&gt;
          &lt;element name="rejected" type="tns:endReasonType"&gt;
            &lt;annotation&gt;
              &lt;documentation&gt;
                Indication that the call ended due to being rejected by the remote party before being accepted.
              &lt;/documentation&gt;
            &lt;/annotation&gt;
          &lt;/element&gt;
          &lt;element name="error" type="tns:endReasonType"&gt;
            &lt;annotation&gt;
              &lt;documentation&gt;
                Indication that the call ended due to a system error.
              &lt;/documentation&gt;
            &lt;/annotation&gt;
          &lt;/element&gt;
        &lt;/choice&gt;
        &lt;element name="header" type="tns:headerType" minOccurs="0" maxOccurs="unbounded"&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
             Set of header variables sent by the remote party along with the indication of the call ending.
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/element&gt;
      &lt;/sequence&gt;
    &lt;/complexType&gt;
  &lt;/element&gt;

  &lt;!-- Accept Command --&gt;
  &lt;element name="accept"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to send notification to the calling party that the call will be dealt with and that ringing may begin.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
    &lt;complexType&gt;
      &lt;sequence&gt;
        &lt;element name="header" type="tns:headerType" minOccurs="0" maxOccurs="unbounded" /&gt;
      &lt;/sequence&gt;
    &lt;/complexType&gt;
  &lt;/element&gt;

  &lt;!-- Answer Command --&gt;
  &lt;element name="answer"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to pick up an incoming call and connect the media stream.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
    &lt;complexType&gt;
      &lt;sequence&gt;
        &lt;element name="header" type="tns:headerType" minOccurs="0" maxOccurs="unbounded" /&gt;
      &lt;/sequence&gt;
    &lt;/complexType&gt;
  &lt;/element&gt;

  &lt;!-- Redirect Command --&gt;
  &lt;element name="redirect"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the calling party that the call will not be accepted and that instead it should try to call the URI indicated in the command.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
    &lt;complexType&gt;
      &lt;attribute name="to" type="anyURI" use="required"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            The new target URI for the call to be redirected to.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;sequence&gt;
        &lt;element name="header" type="tns:headerType" minOccurs="0" maxOccurs="unbounded" /&gt;
      &lt;/sequence&gt;
    &lt;/complexType&gt;
  &lt;/element&gt;

  &lt;!-- Reject Command --&gt;
  &lt;element name="reject"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to reject the call with a given reason.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
    &lt;complexType mixed="true"&gt;
      &lt;sequence&gt;
        &lt;choice&gt;
          &lt;element name="decline" type="tns:empty"&gt;
            &lt;annotation&gt;
              &lt;documentation&gt;
                Indicates that the controlling party refused the call for an unspecified reason, such as access control.
              &lt;/documentation&gt;
            &lt;/annotation&gt;
          &lt;/element&gt;
          &lt;element name="busy" type="tns:empty"&gt;
            &lt;annotation&gt;
              &lt;documentation&gt;
                Indicates that the controlling party refused the call due to excess load.
              &lt;/documentation&gt;
            &lt;/annotation&gt;
          &lt;/element&gt;
          &lt;element name="error" type="tns:empty"&gt;
            &lt;annotation&gt;
              &lt;documentation&gt;
                Indicates that the controlling party refused the call because some error occurred.
              &lt;/documentation&gt;
            &lt;/annotation&gt;
          &lt;/element&gt;
        &lt;/choice&gt;
        &lt;element name="header" type="tns:headerType" minOccurs="0" maxOccurs="unbounded" /&gt;
      &lt;/sequence&gt;
    &lt;/complexType&gt;
  &lt;/element&gt;

  &lt;!-- Hangup Command --&gt;
  &lt;element name="hangup"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to bring the call to an end naturally.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
    &lt;complexType&gt;
      &lt;sequence&gt;
        &lt;element name="header" type="tns:headerType" minOccurs="0" maxOccurs="unbounded" /&gt;
      &lt;/sequence&gt;
    &lt;/complexType&gt;
  &lt;/element&gt;

  &lt;!-- Dial Command --&gt;
  &lt;element name="dial"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to create a new call and surrender control of it to the requesting party.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
    &lt;complexType&gt;
      &lt;attribute name="to" type="anyURI" use="required"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates the party to whom the call should be directed.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="from" type="anyURI" use="optional"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates the caller ID with which the call should appear to originate.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="uri" type="anyURI" use="optional"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates the URI at which the client wishes the call to be presented.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="timeout" type="tns:timeoutType" use="optional" default="-1"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates the maximum time allowed for a response to be provided by the remote party before the call should be considered to have come to an end.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;sequence&gt;
        &lt;element name="header" type="tns:headerType" minOccurs="0" maxOccurs="unbounded" /&gt;
        &lt;element name="join" type="tns:joinCommandType" minOccurs="0" maxOccurs="unbounded"&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              Instructs the server to join the new call in the indicated manner rather than the default (join to the local media server).
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/element&gt;
      &lt;/sequence&gt;
    &lt;/complexType&gt;
  &lt;/element&gt;

  &lt;!-- Join Command --&gt;
  &lt;element name="join"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to join the media streams of the call and the specified party, given direction and media negotiation parameters.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
    &lt;complexType&gt;
      &lt;complexContent&gt;
        &lt;extension base="tns:joinType"&gt;
          &lt;attribute name="direction" use="optional" default="duplex"&gt;
            &lt;annotation&gt;
              &lt;documentation&gt;
                Indicates the direction in which the media should flow between the call and the 3rd party.
              &lt;/documentation&gt;
            &lt;/annotation&gt;
            &lt;simpleType&gt;
              &lt;restriction base="token"&gt;
                &lt;enumeration value="duplex"&gt;
                  &lt;annotation&gt;
                    &lt;documentation&gt;
                      Indicates that media should flow in both directions between the parties.
                    &lt;/documentation&gt;
                  &lt;/annotation&gt;
                &lt;/enumeration&gt;
                &lt;enumeration value="send"&gt;
                  &lt;annotation&gt;
                    &lt;documentation&gt;
                      Indicates that media should only flow from the target call to the third party.
                    &lt;/documentation&gt;
                  &lt;/annotation&gt;
                &lt;/enumeration&gt;
                &lt;enumeration value="recv"&gt;
                  &lt;annotation&gt;
                    &lt;documentation&gt;
                      Indicates that media should only flow from the third party to the target call.
                    &lt;/documentation&gt;
                  &lt;/annotation&gt;
                &lt;/enumeration&gt;
              &lt;/restriction&gt;
            &lt;/simpleType&gt;
          &lt;/attribute&gt;
          &lt;attribute name="media" use="optional" default="bridge"&gt;
            &lt;annotation&gt;
              &lt;documentation&gt;
                Indicates the manner in which the server should negotiate media between the two parties.
              &lt;/documentation&gt;
            &lt;/annotation&gt;
            &lt;simpleType&gt;
              &lt;restriction base="token"&gt;
                &lt;enumeration value="bridge"&gt;
                  &lt;annotation&gt;
                    &lt;documentation&gt;
                      Instructs the server to bridge the parties media streams via its local media server.
                    &lt;/documentation&gt;
                  &lt;/annotation&gt;
                &lt;/enumeration&gt;
                &lt;enumeration value="direct"&gt;
                  &lt;annotation&gt;
                    &lt;documentation&gt;
                      Instructs the server to have the parties negotiate media directly with one another.
                    &lt;/documentation&gt;
                  &lt;/annotation&gt;
                &lt;/enumeration&gt;
              &lt;/restriction&gt;
            &lt;/simpleType&gt;
          &lt;/attribute&gt;
        &lt;/extension&gt;
      &lt;/complexContent&gt;
    &lt;/complexType&gt;
  &lt;/element&gt;

  &lt;!-- Unjoin Command --&gt;
  &lt;element name="unjoin" type="tns:joinType"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to unjoin the media streams of the call and the specified party.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- Joined Event --&gt;
  &lt;element name="joined" type="tns:joinType"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indicates that the call was successfully joined to the specified party.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- Unjoined Event --&gt;
  &lt;element name="unjoined" type="tns:joinType"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indicates that the call ceased to be joined to the specified party.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;complexType name="joinType"&gt;
    &lt;attribute name="call-uri" type="anyURI" use="optional"&gt;
      &lt;annotation&gt;
        &lt;documentation&gt;
          Indicates the 3rd party call URI to which the target call should be joined. May not be set if the mixer-name attribute is set.
        &lt;/documentation&gt;
      &lt;/annotation&gt;
    &lt;/attribute&gt;
    &lt;attribute name="mixer-name" type="token" use="optional"&gt;
      &lt;annotation&gt;
        &lt;documentation&gt;
          Indicates the mixer name to which the target call should be joined. May not be set if the call-id attribute is set.
        &lt;/documentation&gt;
      &lt;/annotation&gt;
    &lt;/attribute&gt;
  &lt;/complexType&gt;

  &lt;!-- Started Speaking Event --&gt;
  &lt;element name="started-speaking" type="tns:activeSpeakerType"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indicates that a call joined to a mixer with which the controlling party has an events subscription has activated a speech detector, providing its ID.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- Stopped Speaking Event --&gt;
  &lt;element name="stopped-speaking" type="tns:activeSpeakerType"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indicates that a call joined to a mixer with which the controlling party has an events subscription has ceased activation of a speech detector, providing its ID.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;complexType name="activeSpeakerType"&gt;
    &lt;attribute name="call-uri" type="anyURI" use="required"&gt;
      &lt;annotation&gt;
        &lt;documentation&gt;
          Indicates the URI of the call which has triggered the speech detector.
        &lt;/documentation&gt;
      &lt;/annotation&gt;
    &lt;/attribute&gt;
  &lt;/complexType&gt;

  &lt;!-- Resource Reference --&gt;
  &lt;element name="ref"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Used to give an indication of the identity of a newly created resource, either a call or a component.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
    &lt;complexType&gt;
      &lt;attribute name="uri" type="anyURI" use="required"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Gives the URI of the new resource.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
    &lt;/complexType&gt;
  &lt;/element&gt;

  &lt;!-- Utility: Empty Type --&gt;
  &lt;simpleType name="empty"&gt;
    &lt;restriction base="string"&gt;
      &lt;enumeration value='' /&gt;
    &lt;/restriction&gt;
  &lt;/simpleType&gt;

  &lt;!-- Utility: Duration Type --&gt;
  &lt;simpleType name="durationType"&gt;
    &lt;restriction base="long"&gt;
      &lt;annotation&gt;
        &lt;documentation&gt;
          Value is a duration in milleseconds
        &lt;/documentation&gt;
      &lt;/annotation&gt;
    &lt;/restriction&gt;
  &lt;/simpleType&gt;

  &lt;!-- Utility: Timeout Type --&gt;
  &lt;simpleType name="timeoutType"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        A value of -1 indicates no timeout
      &lt;/documentation&gt;
    &lt;/annotation&gt;

    &lt;restriction base="tns:durationType"&gt;
      &lt;minInclusive value="-1"/&gt;
    &lt;/restriction&gt;
  &lt;/simpleType&gt;

  &lt;!-- Utility: Fraction Decimal Type --&gt;
  &lt;simpleType name="fractionDecimalType"&gt;
    &lt;restriction base="decimal"&gt;
      &lt;minInclusive value="0"/&gt;
      &lt;maxInclusive value="1"/&gt;
    &lt;/restriction&gt;
  &lt;/simpleType&gt;

&lt;/schema&gt;
</pre></div>
  </div>
  <div class="indent"><h3>14.2 <a name="schema-rayo-ext" id="schema-rayo-ext">Rayo Ext</a></h3>
  <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;schema xmlns="http://www.w3.org/2001/XMLSchema"
  targetNamespace="urn:xmpp:rayo:ext:1"
  xmlns:tns="urn:xmpp:rayo:ext:1"
  elementFormDefault="qualified"
  xmlns:core="urn:xmpp:rayo:1"&gt;

  &lt;annotation&gt;
    &lt;documentation&gt;
      The protocol documented by this schema is defined at http://rayo.org/xep
    &lt;/documentation&gt;
  &lt;/annotation&gt;

  &lt;!-- Stop Command --&gt;
  &lt;element name="stop" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs a component to come to an end before it completes naturally.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- Complete Event --&gt;
  &lt;element name="complete"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indicates that the component has come to an end and no further processing will occurr. Gives the reason for the termination.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
    &lt;complexType mixed="true"&gt;
      &lt;choice minOccurs="1" maxOccurs="1"&gt;
        &lt;any&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              The reason for component termination. May be either one of the core termination reasons (stop, hangup, error) or a component specific reason.
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/any&gt;
      &lt;/choice&gt;
      &lt;sequence&gt;
        &lt;any minOccurs="0" maxOccurs="unbounded"&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              May be any component specific metadata elements, such as &lt;recording&gt;.
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/any&gt;
      &lt;/sequence&gt;
    &lt;/complexType&gt;
  &lt;/element&gt;

&lt;/schema&gt;
</pre></div>
  </div>
  <div class="indent"><h3>14.3 <a name="schema-rayo-ext-complete" id="schema-rayo-ext-complete">Rayo Ext Complete</a></h3>
  <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;schema xmlns="http://www.w3.org/2001/XMLSchema"
  targetNamespace="urn:xmpp:rayo:ext:complete:1"
  xmlns:tns="urn:xmpp:rayo:ext:complete:1"
  elementFormDefault="qualified"
  xmlns:core="urn:xmpp:rayo:1"&gt;

  &lt;annotation&gt;
    &lt;documentation&gt;
      The protocol documented by this schema is defined at http://rayo.org/xep
    &lt;/documentation&gt;
  &lt;/annotation&gt;

  &lt;!-- Complete due to a &lt;stop/&gt; command --&gt;
  &lt;element name="stop" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indicates that the component came to an end because it was issued a stop command by the controlling party.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- Complete due to a hangup --&gt;
  &lt;element name="hangup" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indicates that the component came to an end because the call ended.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- Complete due to a system error --&gt;
  &lt;element name="error" type="string"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indicates that the component came to an end because it encountered an error.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

&lt;/schema&gt;
</pre></div>
  </div>
  <div class="indent"><h3>14.4 <a name="schema-rayo-output" id="schema-rayo-output">Rayo Output</a></h3>
  <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;schema xmlns="http://www.w3.org/2001/XMLSchema"
  targetNamespace="urn:xmpp:rayo:output:1"
  xmlns:tns="urn:xmpp:rayo:output:1"
  elementFormDefault="qualified"
  xmlns:core="urn:xmpp:rayo:1"&gt;

  &lt;annotation&gt;
    &lt;documentation&gt;
      The protocol documented by this schema is defined at http://rayo.org/xep
    &lt;/documentation&gt;
  &lt;/annotation&gt;

  &lt;complexType name="documentType"&gt;
    &lt;simpleContent&gt;
      &lt;attribute name="url" type="anyURI" use="optional"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Provides a URI at which the document is available. Must not be provided if the content-type attribute is set or the element contains a document as CDATA.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="content-type" type="string" use="optional"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates the content type of the document provided as CDATA. Must not be set if the url attribute is set.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;

      &lt;restriction base="CDATA" /&gt;
    &lt;/simpleContent&gt;
  &lt;/complexType&gt;

  &lt;!-- Main output command --&gt;
  &lt;element name="output"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to begin an output component executing on the target call or mixer with the specified document and parameters.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
    &lt;complexType&gt;
      &lt;attribute name="start-offset" type="core:durationType" use="optional" default="0"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates some offset through which the output should be skipped before rendering begins.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="start-paused" type="boolean" use="optional" default="false"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates wether or not the component should be started in a paused state to be resumed at a later time.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="repeat-interval" type="core:durationType" use="optional" default="0"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates the duration of silence that should space repeats of the rendered document.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="repeat-times" type="nonNegativeInteger" use="optional" default="1"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates the number of times the output should be played.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="max-time" type="core:timeoutType" use="optional" default="-1"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates the maximum amount of time for which the output should be allowed to run before being terminated. Includes repeats.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="renderer" type="string" use="optional"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates which media engine the server should use to render the Output.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="voice" type="string" use="optional"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            The voice with which to speak the requested document.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;

      &lt;sequence&gt;
        &lt;element name="document" type="tns:documentType" minOccurs="1" maxOccurs="unbounded"&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              Provides the document for rendering.
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/element&gt;
      &lt;/sequence&gt;
    &lt;/complexType&gt;
  &lt;/element&gt;

  &lt;!-- Pause command --&gt;
  &lt;element name="pause" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to cease rendering output at the current marker and permit resumption from the same point.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- Resume command --&gt;
  &lt;element name="resume" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to continue rendering the output from the last pause marker.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- Speed up command --&gt;
  &lt;element name="speed-up" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to increase the rate of output by a unit amount.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- Speed down command --&gt;
  &lt;element name="speed-down" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to decrease the rate of output by a unit amount.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- Volume up command --&gt;
  &lt;element name="volume-up" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to increase the volume of output by a unit amount.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- Volume down command --&gt;
  &lt;element name="volume-down" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to decrease the volume of output by a unit amount.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- Seek command --&gt;
  &lt;element name="seek"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to move the play marker of the output forward or back in time before resuming output.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
    &lt;complexType&gt;
      &lt;attribute name="direction" type="token" use="required"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates the direction in time in which to move the play marker.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
        &lt;simpleType&gt;
          &lt;restriction base="token"&gt;
            &lt;enumeration value="forward"/&gt;
            &lt;enumeration value="back"/&gt;
          &lt;/restriction&gt;
        &lt;/simpleType&gt;
      &lt;/attribute&gt;
      &lt;attribute name="amount" use="required"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates the duration by which to move the play marker.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
        &lt;simpleType&gt;
          &lt;restriction base="core:durationType"&gt;
            &lt;minInclusive value="0"/&gt;
          &lt;/restriction&gt;
        &lt;/simpleType&gt;
      &lt;/attribute&gt;
    &lt;/complexType&gt;
  &lt;/element&gt;

&lt;/schema&gt;
</pre></div>
  </div>
  <div class="indent"><h3>14.5 <a name="schema-rayo-output-complete" id="schema-rayo-output-complete">Rayo Output Complete</a></h3>
  <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;schema xmlns="http://www.w3.org/2001/XMLSchema"
  targetNamespace="urn:xmpp:rayo:output:complete:1"
  xmlns:tns="urn:xmpp:rayo:output:complete:1"
  elementFormDefault="qualified"
  xmlns:core="urn:xmpp:rayo:1"&gt;

  &lt;annotation&gt;
    &lt;documentation&gt;
      The protocol documented by this schema is defined at http://rayo.org/xep
    &lt;/documentation&gt;
  &lt;/annotation&gt;

  &lt;!-- Finish reason --&gt;
  &lt;element name="finish" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indicates that the output component came to an end as a result of reaching the end of the document to be rendered.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- MaxTime reason --&gt;
  &lt;element name="max-time" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indicates that the output component came to an end due to the maximum time limit being reached.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

&lt;/schema&gt;
</pre></div>
  </div>
  <div class="indent"><h3>14.6 <a name="schema-rayo-input" id="schema-rayo-input">Rayo Input</a></h3>
  <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;schema xmlns="http://www.w3.org/2001/XMLSchema"
  targetNamespace="urn:xmpp:rayo:input:1"
  xmlns:tns="urn:xmpp:rayo:input:1"
  elementFormDefault="qualified"
  xmlns:core="urn:xmpp:rayo:1"&gt;

  &lt;annotation&gt;
    &lt;documentation&gt;
      The protocol documented by this schema is defined at http://rayo.org/xep
    &lt;/documentation&gt;
  &lt;/annotation&gt;

  &lt;complexType name="grammarType"&gt;
    &lt;simpleContent&gt;
      &lt;attribute name="url" type="anyURI" use="optional"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Provides a URI at which the grammar document is available. Must not be provided if the content-type attribute is set or the element contains a grammar document as CDATA.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="content-type" type="string" use="optional"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates the content type of the grammar document provided as CDATA. Must not be set if the url attribute is set.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;

      &lt;restriction base="CDATA" /&gt;
    &lt;/simpleContent&gt;
  &lt;/complexType&gt;

  &lt;!-- Main Input command --&gt;
  &lt;element name="input"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to begin an input detector of the specified mode, with certain attributes, governed by the rules provided in one or more grammar documents.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
    &lt;complexType&gt;
      &lt;simpleContent&gt;
        &lt;attribute name="mode" use="optional" default="dtmf"&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              The method by which to collect input.
            &lt;/documentation&gt;
          &lt;/annotation&gt;
          &lt;simpleType&gt;
            &lt;restriction base="token"&gt;
              &lt;enumeration value="any" /&gt;
              &lt;enumeration value="voice" /&gt;
              &lt;enumeration value="dtmf" /&gt;
              &lt;enumeration value="cpa" /&gt;
            &lt;/restriction&gt;
          &lt;/simpleType&gt;
        &lt;/attribute&gt;
        &lt;attribute name="terminator" type="token" use="optional" default=""&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              Indicates a terminator token which, when encountered, should cause the input detection to cease.
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/attribute&gt;
        &lt;attribute name="recognizer" type="token" use="optional" default=""&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              Indicates the name of the particular input processor to be engaged, used only for routing purposes (eg to choose which MRCP profile to invoke).
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/attribute&gt;
        &lt;attribute name="language" type="token" use="optional" default="en-US"&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              Specifies the recognition language to the recognizer.
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/attribute&gt;
        &lt;attribute name="initial-timeout" type="core:timeoutType" use="optional" default="-1"&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              Indicates the amount of time preceding input which may expire before a timeout is triggered.
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/attribute&gt;
        &lt;attribute name="inter-digit-timeout" type="core:timeoutType" use="optional" default="-1"&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              Indicates (in the case of DTMF input) the amount of time between input digits which may expire before a timeout is triggered.
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/attribute&gt;
        &lt;attribute name="recognition-timeout" type="core:timeoutType" use="optional" default="-1"&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              Indicates the time (in milliseconds) for speech input, after speech has begun, to return a Match before triggering a Nomatch completion.
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/attribute&gt;
        &lt;attribute name="sensitivity" type="core:fractionDecimalType" use="optional" default="0.5"&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              Indicates how sensitive the interpreter should be to loud versus quiet input. Higher values represent greater sensitivity.
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/attribute&gt;
        &lt;attribute name="min-confidence" type="core:fractionDecimalType" use="optional" default="0"&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              Indicates the confidence threshold, below which a match is to be considered unreliable.
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/attribute&gt;
        &lt;attribute name="max-silence" type="core:timeoutType" use="optional" default="-1"&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              Indicates the maximum period of silence which may be encountered during input gathering before a timeout is triggered.
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/attribute&gt;
        &lt;attribute name="match-content-type" type="token" use="optional" default="application/nlsml+xml"&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              Indicates the required response document format.
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/attribute&gt;

        &lt;sequence&gt;
          &lt;element name="grammar" type="tns:grammarType" minOccurs="1" maxOccurs="unbounded"&gt;
            &lt;annotation&gt;
              &lt;documentation&gt;
                Provides the grammar document by which the input detection should be governed.
              &lt;/documentation&gt;
            &lt;/annotation&gt;
          &lt;/element&gt;
        &lt;/sequence&gt;
      &lt;/simpleContent&gt;
    &lt;/complexType&gt;
  &lt;/element&gt;

&lt;/schema&gt;
</pre></div>
  </div>
  <div class="indent"><h3>14.7 <a name="schema-rayo-input-complete" id="schema-rayo-input-complete">Rayo Input Complete</a></h3>
  <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;schema xmlns="http://www.w3.org/2001/XMLSchema"
  targetNamespace="urn:xmpp:rayo:input:complete:1"
  xmlns:tns="urn:xmpp:rayo:input:complete:1"
  elementFormDefault="qualified"
  xmlns:core="urn:xmpp:rayo:1"&gt;

  &lt;annotation&gt;
    &lt;documentation&gt;
      The protocol documented by this schema is defined at http://rayo.org/xep
    &lt;/documentation&gt;
  &lt;/annotation&gt;

  &lt;!-- Finish reason --&gt;
  &lt;element name="match"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indicates that the component came to an end due to one of its grammars matching the received input. Provides the NLSML result of the grammar match after any symantic processing which may have been performed. See the NLSML spec for details.
      &lt;/documentation&gt;
    &lt;/annotation&gt;

    &lt;complexType&gt;
      &lt;simpleContent&gt;
        &lt;attribute name="content-type" type="token" use="required" default="application/nlsml+xml"&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              Indicates the content type of the result document provided as CDATA.
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/attribute&gt;
      &lt;/simpleContent&gt;
    &lt;/complexType&gt;
  &lt;/element&gt;

  &lt;!-- Initial timeout reason --&gt;
  &lt;element name="noinput" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indicates that the component came to an end because a timeout was triggered before input was received.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- NoMatch reason --&gt;
  &lt;element name="nomatch" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indicates that the component came to an end because input was received which did not match any of the specified grammars.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

&lt;/schema&gt;
</pre></div>
  </div>
  <div class="indent"><h3>14.8 <a name="schema-rayo-prompt" id="schema-rayo-prompt">Rayo Prompt</a></h3>
  <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;schema xmlns="http://www.w3.org/2001/XMLSchema"
  targetNamespace="urn:xmpp:rayo:prompt:1"
  xmlns:tns="urn:xmpp:rayo:prompt:1"
  elementFormDefault="qualified"
  xmlns:core="urn:xmpp:rayo:1"
  xmlns:output="urn:xmpp:rayo:output:1"
  xmlns:input="urn:xmpp:rayo:input:1"&gt;

  &lt;annotation&gt;
    &lt;documentation&gt;
      The protocol documented by this schema is defined at http://rayo.org/xep
    &lt;/documentation&gt;
  &lt;/annotation&gt;

  &lt;!-- Main Prompt command --&gt;
  &lt;element name="prompt"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to begin an input detector of the specified mode, with certain attributes, governed by the rules provided in one or more grammar documents, while simultaneously rendering output.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
    &lt;complexType&gt;
      &lt;simpleContent&gt;
        &lt;attribute name="barge-in" type="boolean" use="optional" default="true"&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              Whether or not the input detector is permitted to interrupt the output.
            &lt;/documentation&gt;
          &lt;/annotation&gt;
        &lt;/attribute&gt;

        &lt;sequence&gt;
          &lt;element name="output" type="output:outputType" minOccurs="1" maxOccurs="1"&gt;
            &lt;annotation&gt;
              &lt;documentation&gt;
                Provides the output component to be executed
              &lt;/documentation&gt;
            &lt;/annotation&gt;
          &lt;/element&gt;
          &lt;element name="input" type="input:inputType" minOccurs="1" maxOccurs="1"&gt;
            &lt;annotation&gt;
              &lt;documentation&gt;
                Provides the input component to be executed
              &lt;/documentation&gt;
            &lt;/annotation&gt;
          &lt;/element&gt;
        &lt;/sequence&gt;
      &lt;/simpleContent&gt;
    &lt;/complexType&gt;
  &lt;/element&gt;

  &lt;!-- Input Timers Started Event --&gt;
  &lt;element name="input-timers-started"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indicates that the component's input timers have started.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

&lt;/schema&gt;
</pre></div>
  </div>
  <div class="indent"><h3>14.9 <a name="schema-rayo-record" id="schema-rayo-record">Rayo Record</a></h3>
  <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;schema xmlns="http://www.w3.org/2001/XMLSchema"
  targetNamespace="urn:xmpp:rayo:record:1"
  xmlns:tns="urn:xmpp:rayo:record:1"
  elementFormDefault="qualified"
  xmlns:core="urn:xmpp:rayo:1"&gt;

  &lt;annotation&gt;
    &lt;documentation&gt;
      The protocol documented by this schema is defined at http://rayo.org/xep
    &lt;/documentation&gt;
  &lt;/annotation&gt;

  &lt;!-- Main Record command --&gt;
  &lt;element name="record"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to begin recording input to the call to a file.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
    &lt;complexType&gt;
      &lt;attribute name="format" type="token" use="optional" default="wav"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            File format used during recording.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="start-beep" type="boolean" use="optional" default="false"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates whether subsequent record will be preceded with a beep.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="stop-beep" type="boolean" use="optional" default="false"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates whether subsequent record stop will be preceded with a beep.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="start-paused" type="boolean" use="optional" default="false"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Whether subsequent record will start in PAUSE mode.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="max-duration" type="core:timeoutType" use="optional" default="-1"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates the maximum duration for the recording.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="initial-timeout" type="core:timeoutType" use="optional" default="-1"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Controls how long the recognizer should wait after the end of the prompt for the caller to speak before sending a Recorder event.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="final-timeout" type="core:timeoutType" use="optional" default="-1"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Controls the length of a period of silence after callers have spoken to conclude they finished.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;
      &lt;attribute name="direction" use="optional" default="duplex"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Indicates the direction of the call to record, as in media produced or received by the calling party.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
        &lt;simpleType&gt;
          &lt;restriction base="token"&gt;
            &lt;enumeration value="duplex"&gt;
              &lt;annotation&gt;
                &lt;documentation&gt;
                  Records both sent and received audio.
                &lt;/documentation&gt;
              &lt;/annotation&gt;
            &lt;/enumeration&gt;
            &lt;enumeration value="send"&gt;
              &lt;annotation&gt;
                &lt;documentation&gt;
                  Indicates that only the audio sent from the caller is to be recorded. Not supported when Record is executed against a mixer.
                &lt;/documentation&gt;
              &lt;/annotation&gt;
            &lt;/enumeration&gt;
            &lt;enumeration value="recv"&gt;
              &lt;annotation&gt;
                &lt;documentation&gt;
                  Indicates that only and all audio received by the caller is recorded.
                &lt;/documentation&gt;
              &lt;/annotation&gt;
            &lt;/enumeration&gt;
          &lt;/restriction&gt;
        &lt;/simpleType&gt;
      &lt;/attribute&gt;
      &lt;attribute name="mix" type="boolean" use="optional" default="false"&gt;
        &lt;annotation&gt;
          &lt;documentation&gt;
            Whether all channels (call legs) should be mixed into a single recording channel.
          &lt;/documentation&gt;
        &lt;/annotation&gt;
      &lt;/attribute&gt;

      &lt;sequence&gt;
        &lt;element name="hint" minOccurs="0" maxOccurs="unbounded"&gt;
          &lt;annotation&gt;
            &lt;documentation&gt;
              Optional format-specific encoding hints
            &lt;/documentation&gt;
          &lt;/annotation&gt;
          &lt;complexType&gt;
            &lt;attribute name="name" type="string" use="required"&gt;
              &lt;annotation&gt;
                &lt;documentation&gt;
                  The name of the hint value as expected by the recorder.
                &lt;/documentation&gt;
              &lt;/annotation&gt;
            &lt;/attribute&gt;
            &lt;attribute name="value" type="string" use="required"&gt;
              &lt;annotation&gt;
                &lt;documentation&gt;
                  The value of the hint provided.
                &lt;/documentation&gt;
              &lt;/annotation&gt;
            &lt;/attribute&gt;
          &lt;/complexType&gt;
        &lt;/element&gt;
      &lt;/sequence&gt;
    &lt;/complexType&gt;
  &lt;/element&gt;

  &lt;!-- Pause command --&gt;
  &lt;element name="pause" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to cease recording input but to leave the destination open for appending to permit resumption from the same point.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- Resume command --&gt;
  &lt;element name="resume" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Instructs the server to continue recording input, appending to the same destination.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

&lt;/schema&gt;
</pre></div>
  </div>
  <div class="indent"><h3>14.10 <a name="schema-rayo-record-complete" id="schema-rayo-record-complete">Rayo Record Complete</a></h3>
  <p class="caption"></p><div class="indent"><pre class="prettyprint">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;schema xmlns="http://www.w3.org/2001/XMLSchema"
  targetNamespace="urn:xmpp:rayo:record:complete:1"
  xmlns:tns="urn:xmpp:rayo:record:complete:1"
  elementFormDefault="qualified"
  xmlns:core="urn:xmpp:rayo:1"&gt;

  &lt;annotation&gt;
    &lt;documentation&gt;
      The protocol documented by this schema is defined at http://rayo.org/xep
    &lt;/documentation&gt;
  &lt;/annotation&gt;

  &lt;!-- Recording data --&gt;
  &lt;element name="recording" type="core:empty"&gt;
    &lt;attribute name="uri" type="anyURI" use="required"&gt;
      &lt;annotation&gt;
        &lt;documentation&gt;
          Indicates the URI at which the recording is made available.
        &lt;/documentation&gt;
      &lt;/annotation&gt;
    &lt;/attribute&gt;
    &lt;attribute name="duration" type="core:durationType" use="required"&gt;
      &lt;annotation&gt;
        &lt;documentation&gt;
          Indicates the duration of the completed recording.
        &lt;/documentation&gt;
      &lt;/annotation&gt;
    &lt;/attribute&gt;
    &lt;attribute name="size" type="long" use="required"&gt;
      &lt;annotation&gt;
        &lt;documentation&gt;
          Indicates the filesize (in bytes) of the completed recording.
        &lt;/documentation&gt;
      &lt;/annotation&gt;
    &lt;/attribute&gt;
  &lt;/complexType&gt;

  &lt;!-- Max Duration reason --&gt;
  &lt;element name="max-duration" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indicates that the component came to an end due to the max duration being reached.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- Initial Timeout reason --&gt;
  &lt;element name="initial-timeout" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indicates that the component came to an end due to no input being detected before the initial-timeout.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

  &lt;!-- Final Timeout reason --&gt;
  &lt;element name="final-timeout" type="core:empty"&gt;
    &lt;annotation&gt;
      &lt;documentation&gt;
        Indicates that the component came to an end because no input had been detected for the final timeout duration.
      &lt;/documentation&gt;
    &lt;/annotation&gt;
  &lt;/element&gt;

&lt;/schema&gt;
</pre></div>
  </div>
<h2>15.
       <a name="history" id="history">History</a></h2>
  <p class="" style="">Prior to the development of the Rayo protocol, the most widely-used 3PCC protocols were Asterisk's AGI and AMI. Unfortunately, these protocols have many drawbacks, not least in their inconsistency and relatively poor documentation, but also in that they are poorly secured and lacking in attributes required for significant scalability. Much 3PCC activity is also done using process-internal APIs rather than a wire protocol like XMPP.</p>

  <p class="" style="">Rayo was developed to satisfy three main desires:</p>
  <ul class="" style="">
    <li class="" style="">To separate the application logic from the back-end call processing infrastructure for large-scale scripting-based hosted voice application platforms. This helps to ensure that the performance of the back-end infrastructure cannot be impacted by the applications controling it, and specifically to allow sandboxing the applications.</li>
    <li class="" style="">To create a platform-agnostic protocol for the control of live media sessions that has been designed from the start for such use.</li>
    <li class="" style="">To enable authenticated, federated, web-scale 3PCC on platforms with APIs only suitable for trusted internal use (Asterisk, FreeSWITCH, etc).</li>
  </ul>

  <p class="" style="">Initial development of the Rayo specification and its reference implementation was sponsored by Tropo (formerly Voxeo Labs) and Telefónica, with Punchblock being the first client library implementation, as part of the Adhearsion project. Since the beginning of the development process, further implementation efforts have begun on top of Asterisk's AGI/AMI protocols and FreeSWITCH EventSocket, native to FreeSWITCH (mod_rayo), as well as client library implementations in Node/CoffeeScript and Python.</p>
<h2>16.
       <a name="acknowledgements" id="acknowledgements">Acknowledgements</a></h2>
  <p class="" style="">The authors would like to acknowledge the input of teams at Tropo (formerly Voxeo Labs), Mojo Lingo and Telefónica in the development of the initial specification, and Grasshopper in expanding the implementation landscape.</p>

  <p class="" style="">Specific individuals who have contributed to the specification or to software significant to its completion include:</p>
  <ul class="" style="">
    <li class="" style="">Ben Langfeld</li>
    <li class="" style="">Ben Klang</li>
    <li class="" style="">Chris Rienzo</li>
    <li class="" style="">Jason Goecke</li>
    <li class="" style="">John Dyer</li>
    <li class="" style="">Jose de Castro</li>
    <li class="" style="">Juan de Bravo</li>
    <li class="" style="">Luca Pradovera</li>
    <li class="" style="">Martín Pérez</li>
  </ul>
<hr /><a name="appendices" id="appendices"></a><h2>Appendices</h2><hr /><a name="appendix-docinfo" id="appendix-docinfo"></a><h3>Appendix A: Document Information</h3><p class="indent">
            Series: <a href="http://xmpp.org/extensions/">XEP</a><br />
            Number: 0327<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status:
            <a href="http://xmpp.org/extensions/xep-0001.html#states-Deferred">Deferred</a><br />
            Type:
            <a href="http://xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br />
            Version: 0.8.1<br />
            Last Updated: 2018-11-03<br />
                Approving Body: <a href="http://xmpp.org/council/">XMPP Council</a><br />Dependencies: XMPP Core<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: NOT_YET_ASSIGNED<br />
              Source Control:
                <a class="standardsButton" href="https://github.com/xsf/xeps/blob/master/xep-0327.xml">HTML</a><br />
            This document in other formats:
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-0327.xml">XML</a> 
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-0327.pdf">PDF</a></p><hr /><a name="appendix-authorinfo" id="appendix-authorinfo"></a><h3>Appendix B: Author Information</h3><div class="indent"><h3>Ben Langfeld</h3><p class="indent">
        Email:
        <a href="mailto:ben@langfeld.me">ben@langfeld.me</a><br />
        JabberID:
        <a href="xmpp:ben@langfeld.me">ben@langfeld.me</a><br />
        URI:
        <a href="http://langfeld.me">http://langfeld.me</a><br /></p><h3>Jose de Castro</h3><p class="indent">
        Email:
        <a href="mailto:jdecastro@tropo.com">jdecastro@tropo.com</a><br />
        JabberID:
        <a href="xmpp:jdecastro@tropo.com">jdecastro@tropo.com</a><br />
        URI:
        <a href="http://tropo.com">http://tropo.com</a><br /></p></div><hr /><a name="appendix-legal" id="appendix-legal"></a><h3>Appendix C: Legal Notices</h3><div class="indent"><h4>Copyright</h4>This XMPP Extension Protocol is copyright © 1999 – 2018 by the <a href="https://xmpp.org/">XMPP Standards Foundation</a> (XSF).<h4>Permissions</h4>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h4>Disclaimer of Warranty</h4><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. ##</span><h4>Limitation of Liability</h4>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h4>IPR Conformance</h4>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which can be found at &lt;<a href="https://xmpp.org/about/xsf/ipr-policy">https://xmpp.org/about/xsf/ipr-policy</a>&gt; or obtained by writing to XMPP Standards Foundation, P.O. Box 787, Parker, CO 80134 USA).</div><hr /><a name="appendix-xmpp" id="appendix-xmpp"></a><h3>Appendix D: Relation to XMPP</h3><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 6120) and XMPP IM (RFC 6121) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><hr /><a name="appendix-discuss" id="appendix-discuss"></a><h3>Appendix E: Discussion Venue</h3><p class="indent">The primary venue for discussion of XMPP Extension Protocols is the &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">standards@xmpp.org</a>&gt; discussion list.</p><p class="indent">Discussion on other xmpp.org discussion lists might also be appropriate; see &lt;<a href="http://xmpp.org/about/discuss.shtml">http://xmpp.org/about/discuss.shtml</a>&gt; for a complete list.</p><p class="indent">Errata can be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><hr /><a name="appendix-conformance" id="appendix-conformance"></a><h3>Appendix F: Requirements Conformance</h3><p class="indent">The following requirements keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><a name="appendix-notes" id="appendix-notes"></a><h3>Appendix G: Notes</h3><div class="indent"><p><a name="nt-idm97" id="nt-idm97">1</a>. XEP-0166: Jingle &lt;<a href="https://xmpp.org/extensions/xep-0166.html">https://xmpp.org/extensions/xep-0166.html</a>&gt;.</p><p><a name="nt-idm101" id="nt-idm101">2</a>. RFC 3261: Session Initiation Protocol (SIP) &lt;<a href="http://tools.ietf.org/html/rfc3261">http://tools.ietf.org/html/rfc3261</a>&gt;.</p><p><a name="nt-idm279" id="nt-idm279">3</a>. XEP-0203: Delayed Delivery &lt;<a href="https://xmpp.org/extensions/xep-0203.html">https://xmpp.org/extensions/xep-0203.html</a>&gt;.</p><p><a name="nt-idm1379" id="nt-idm1379">4</a>. XEP-0030: Service Discovery &lt;<a href="https://xmpp.org/extensions/xep-0030.html">https://xmpp.org/extensions/xep-0030.html</a>&gt;.</p><p><a name="nt-idm1388" id="nt-idm1388">5</a>. XEP-0115: Entity Capabilities &lt;<a href="https://xmpp.org/extensions/xep-0115.html">https://xmpp.org/extensions/xep-0115.html</a>&gt;.</p><p><a name="nt-idm1406" id="nt-idm1406">6</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p><p><a name="nt-idm1428" id="nt-idm1428">7</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="https://xmpp.org/registrar/">https://xmpp.org/registrar/</a>&gt;.</p><p><a name="nt-idm1433" id="nt-idm1433">8</a>. XEP-0053: XMPP Registrar Function &lt;<a href="https://xmpp.org/extensions/xep-0053.html">https://xmpp.org/extensions/xep-0053.html</a>&gt;.</p></div><hr /><a name="appendix-revs" id="appendix-revs"></a><h3>Appendix H: Revision History</h3><p>Note: Older versions of this specification might be available at <a href="http://xmpp.org/extensions/attic/">http://xmpp.org/extensions/attic/</a></p><div class="indent"><h4>Version 0.8.1 (2018-11-03)</h4><div class="indent">Fix a bunch of typos, batch-style. (pep)
    </div><h4>Version 0.8 (2017-09-11)</h4><div class="indent">Defer due to lack of activity. (XEP Editor (jwi))
    </div><h4>Version 0.7 (2015-07-15)</h4><div class="indent"><p class="" style="">Updates based on XMPP Council feedback.</p> (bl)
    </div><h4>Version 0.6 (2015-04-29)</h4><div class="indent"><p class="" style="">Changes to address Last Call feedback.</p> (bl)
    </div><h4>Version 0.5 (2014-09-23)</h4><div class="indent"><p class="" style="">Add an extra recognition timeout to the Input component.</p> (bl)
    </div><h4>Version 0.4 (2014-03-13)</h4><div class="indent"><p class="" style="">Suggest timestamping Rayo events; allow specifying a call URI when dialing.</p> (bl)
    </div><h4>Version 0.3 (2014-01-30)</h4><div class="indent"><p class="" style="">Further updates.</p> (bl)
    </div><h4>Version 0.2 (2013-06-10)</h4><div class="indent"><p class="" style="">Updates to address open issues.</p> (bl)
    </div><h4>Version 0.1 (2013-05-06)</h4><div class="indent"><p class="" style="">Initial published version approved by the XMPP Council.</p> (psa)
    </div><h4>Version 0.0.1 (2013-04-05)</h4><div class="indent"><p class="" style="">First draft.</p> (bl)
    </div></div><hr /><p>END</p></body></html>
