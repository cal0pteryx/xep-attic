<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0385: Stateless Inline Media Sharing (SIMS)</title><link rel="stylesheet" type="text/css" href="xmpp.css" /><link href="prettify.css" type="text/css" rel="stylesheet" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><script type="text/javascript" src="prettify.js"></script><meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0" /><meta name="DC.Title" content="Stateless Inline Media Sharing (SIMS)" /><meta name="DC.Creator" content="Tobias Markmann" /><meta name="DC.Description" content="This specification describes a protocol for stateless asynchronous media sharing with integrity and transport flexibility. It allows clients to provide a good interoperable user experience in combination with Carbons and MAM." /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2018-01-25" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0385" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright &#xA9; 1999 &#x2013; 2018 by the XMPP Standards Foundation (XSF)." /></head><body onload="prettyPrint()"><h1>XEP-0385: Stateless Inline Media Sharing (SIMS)</h1><table><tr valign="top"><td><strong>Abstract:</strong></td><td>This specification describes a protocol for stateless asynchronous media sharing with integrity and transport flexibility. It allows clients to provide a good interoperable user experience in combination with Carbons and MAM.</td></tr><tr valign="top"><td><strong>Author:</strong></td><td>Tobias Markmann</td></tr><tr valign="top"><td><strong>Copyright:</strong></td><td>© 1999 – 2017 XMPP Standards Foundation. <a href="#appendix-legal">SEE LEGAL NOTICES</a>.</td></tr><tr valign="top"><td><strong>Status:</strong></td><td>Experimental</td></tr><tr valign="top"><td><strong>Type:</strong></td><td>Standards Track</td></tr><tr valign="top"><td><strong>Version:</strong></td><td>0.2.1</td></tr><tr valign="top"><td><strong>Last Updated:</strong></td><td>2018-01-25</td></tr></table><hr /><p style="color:red">WARNING: This Standards-Track document is Experimental. Publication as an XMPP Extension Protocol does not imply approval of this proposal by the XMPP Standards Foundation. Implementation of the protocol described herein is encouraged in exploratory implementations, but production systems are advised to carefully consider whether it is appropriate to deploy implementations of this protocol before it advances to a status of Draft.</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#intro">Introduction</a><br />2.  <a href="#related">Related XEPs</a><br />   
      2.1.  <a href="#sect-idm78">Bits of Binary</a><br />   
      2.2.  <a href="#sect-idm92">Jingle File Transfer</a><br />   
      2.3.  <a href="#sect-idm106">HTTP File Upload</a><br />   
      2.4.  <a href="#sect-idm116">Comparison of File Transfer Protocols</a><br />3.  <a href="#reqs">Requirements</a><br />4.  <a href="#usecases">Use Cases</a><br />   
      4.1.  <a href="#usecases-sending-photo">Sharing a photo</a><br />   
      4.2.  <a href="#sect-idm227">Receiving a shared photo</a><br />5.  <a href="#rules">Business Rules</a><br />   
      5.1.  <a href="#sect-idm251">Transport Method Preference</a><br />   
      5.2.  <a href="#sect-idm279">Media Support</a><br />   
      5.3.  <a href="#sect-idm329">Atomatic retrieval of shared media</a><br />   
      5.4.  <a href="#sect-idm332">MUC and MIX related rules</a><br />   
      5.5.  <a href="#sect-idm343">MAM and Carbons related rules</a><br />   
      5.6.  <a href="#sect-idm350">XHTML-IM related rules</a><br />6.  <a href="#impl">Implementation Notes</a><br />7.  <a href="#access">Accessibility Considerations</a><br />8.  <a href="#i18n">Internationalization Considerations</a><br />9.  <a href="#security">Security Considerations</a><br />   
      9.1.  <a href="#sect-idm367">Clearing of privacy sensitive metadata</a><br />   
      9.2.  <a href="#sect-idm369">The value and cost of end-to-end media integrity</a><br />10.  <a href="#ack">Acknowledgements</a><br />11.  <a href="#iana">IANA Considerations</a><br />12.  <a href="#registrar">XMPP Registrar Considerations</a><br />   
      12.1.  <a href="#registrar-protocol">Protocol Namespaces</a><br />13.  <a href="#schema">XML Schema</a></p><p><a href="#appendices">Appendices</a><br />    <a href="#appendix-docinfo">A: Document Information</a><br />    <a href="#appendix-authorinfo">B: Author Information</a><br />    <a href="#appendix-legal">C: Legal Notices</a><br />    <a href="#appendix-xmpp">D: Relation to XMPP</a><br />    <a href="#appendix-discuss">E: Discussion Venue</a><br />    <a href="#appendix-conformance">F: Requirements Conformance</a><br />    <a href="#appendix-notes">G: Notes</a><br />    <a href="#appendix-revs">H: Revision History</a></p></div><hr /><h2>1.
       <a name="intro" id="intro">Introduction</a></h2>
  <p class="" style="">File sharing in XMPP has mainly been addressed by synchronous solutions like <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0096.html">SI File Transfer (XEP-0096)</a></span>  [<a href="#nt-idm60">1</a>] and <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0234.html">Jingle File Transfer (XEP-0234)</a></span>  [<a href="#nt-idm64">2</a>].
    However, these extensions only address the transfer of files and there is more to file sharing than the simple transfer of the data.</p>
  <p class="" style="">Extentions that go beyond the simple transfer of data are <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0329.html">File Information Sharing (XEP-0329)</a></span>  [<a href="#nt-idm69">3</a>] and <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0363.html">HTTP File Upload (XEP-0363)</a></span>  [<a href="#nt-idm73">4</a>]. XEP-0329 allows sharing folder structures to other users, allowing them to browse the remote folder and fetch interesting files using existing file-transfer protocols. XEP-0363 describes a protocol to ask a server component for a HTTP storage URL where a client can use HTTP PUT to save a file to and afterwards share the public URL with other users to share the file. While this provides some form of asynchronus file sharing it does not provide integrity protection and requires a server component.</p>
  <p class="" style="">This proposal aims to provide a protocol that will enable XMPP clients to implement a great user experience (UX) around the process of sharing media in conversations. Shared media can take any form of static media like photos, videos, documents, compresses archives, etc.
  This is directly refelected in the requirents of this extension lined out in the following sections.</p>
<h2>2.
       <a name="related" id="related">Related XEPs</a></h2>
  <p class="" style="">The state of sharing media with chat partners in the XMPP community is a protocol zoo in 2016. There are three major protocols for sharing media in XMPP.</p>
  <div class="indent"><h3>2.1 <a name="sect-idm78" id="sect-idm78">Bits of Binary</a></h3>
    <p class="" style=""><span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0231.html">Bits of Binary (XEP-0231)</a></span>  [<a href="#nt-idm82">5</a>] is designed for small media, i.e. less than 8 KB in size, that is hosted server-side and transferred Base64 encoded in-band of an existing XMPP stream. Example use-cases are custom emoticons that are referenced in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0071.html">XHTML-IM (XEP-0071)</a></span>  [<a href="#nt-idm86">6</a>] img-tags, or thumbnails for <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0234.html">Jingle File Transfer (XEP-0234)</a></span>  [<a href="#nt-idm64">2</a>].</p>
  </div>
  <div class="indent"><h3>2.2 <a name="sect-idm92" id="sect-idm92">Jingle File Transfer</a></h3>
    <p class="" style=""><span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0234.html">Jingle File Transfer (XEP-0234)</a></span>  [<a href="#nt-idm64">2</a>] describes a peer-to-peer protocol for synchronous file-transfer between two XMPP entities. It attempts a direct transmission, followed by a proxied transmission, via <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0260.html">Jingle SOCKS5 Bytestreams Transport Method (XEP-0260)</a></span>  [<a href="#nt-idm100">7</a>]. If neither works it will fallback to <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0261.html">Jingle In-Band Bytestreams Transport Method (XEP-0261)</a></span>  [<a href="#nt-idm104">8</a>] which will transfer the data inband of the exsiting XMPP stream.</p>
  </div>
  <div class="indent"><h3>2.3 <a name="sect-idm106" id="sect-idm106">HTTP File Upload</a></h3>
    <p class="" style=""><span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0363.html">HTTP File Upload (XEP-0363)</a></span>  [<a href="#nt-idm73">4</a>] was designed as a simpler to implement alternative to <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0231.html">Bits of Binary (XEP-0231)</a></span>  [<a href="#nt-idm82">5</a>]. This is achieved by reusing the HTTP APIs in todays mobile and language SDKs. It requires a server component where clients can request HTTP URLs to upload data to and share the corresponding download URL as part of plain text in a conversation.</p>
  </div>
  <div class="indent"><h3>2.4 <a name="sect-idm116" id="sect-idm116">Comparison of File Transfer Protocols</a></h3>
    <div class="indent"><p class="caption"><a name="table-1" id="table-1"></a>Table 1: Comparison of File Transfer Protocols in 2016</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Protocol</th>
        <th colspan="" rowspan="">File Size Limit</th>
        <th colspan="" rowspan="">Integrity Verification</th>
        <th colspan="" rowspan="">Transport</th>
        <th colspan="" rowspan="">Multi Receiver Support</th>
        <th colspan="" rowspan="">Server Support</th>
        <th colspan="" rowspan="">Resumption</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan=""><span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0231.html">Bits of Binary (XEP-0231)</a></span>  [<a href="#nt-idm82">5</a>]</td>
        <td align="" colspan="" rowspan="">8 KB</td>
        <td align="" colspan="" rowspan="">Yes</td>
        <td align="" colspan="" rowspan="">Inband</td>
        <td align="" colspan="" rowspan="">Yes</td>
        <td align="" colspan="" rowspan="">Required</td>
        <td align="" colspan="" rowspan="">No</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan=""><span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0234.html">Jingle File Transfer (XEP-0234)</a></span>  [<a href="#nt-idm64">2</a>]</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">Yes</td>
        <td align="" colspan="" rowspan="">Inband/Direct/Proxy</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">Optional</td>
        <td align="" colspan="" rowspan="">Yes</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan=""><span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0363.html">HTTP File Upload (XEP-0363)</a></span>  [<a href="#nt-idm73">4</a>]</td>
        <td align="" colspan="" rowspan="">Service Dependent</td>
        <td align="" colspan="" rowspan="">No</td>
        <td align="" colspan="" rowspan="">Outband (HTTP)</td>
        <td align="" colspan="" rowspan="">Yes</td>
        <td align="" colspan="" rowspan="">Required</td>
        <td align="" colspan="" rowspan="">Download only</td>
      </tr>
    </table></div>
  </div>
<h2>3.
       <a name="reqs" id="reqs">Requirements</a></h2>
  <ul class="" style="">
    <li class="" style="">Not require server components to work to ease deployment</li>
    <li class="" style="">Can be improved by server components for taking load of clients</li>
    <li class="" style="">Media sharing should work and enable a good UX in multi-user chats like <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idm169">9</a>] and <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0369.html">Mediated Information eXchange (MIX) (XEP-0369)</a></span>  [<a href="#nt-idm173">10</a>]</li>
    <li class="" style="">Media sharing should work great together with conversation synchronization protocols like <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0280.html">Message Carbons (XEP-0280)</a></span>  [<a href="#nt-idm178">11</a>] and <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0313.html">Message Archive Management (XEP-0313)</a></span>  [<a href="#nt-idm182">12</a>]</li>
    <li class="" style="">Reuse exiting protocols for the actual transport of the data, i.e. <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0096.html">SI File Transfer (XEP-0096)</a></span>  [<a href="#nt-idm60">1</a>], <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0234.html">Jingle File Transfer (XEP-0234)</a></span>  [<a href="#nt-idm64">2</a>] or <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0363.html">HTTP File Upload (XEP-0363)</a></span>  [<a href="#nt-idm73">4</a>]</li>
    <li class="" style="">Guarantee file integrity</li>
    <li class="" style="">Enable aggresive caching</li>
    <li class="" style="">Provide users with metadata, e.g. file size, file type or thumbnail, to help them decide whether or not they want to load the media file</li>
    <li class="" style="">Support referring to third party hosting services</li>
  </ul>
<h2>4.
       <a name="usecases" id="usecases">Use Cases</a></h2>
  <div class="indent"><h3>4.1 <a name="usecases-sending-photo" id="usecases-sending-photo">Sharing a photo</a></h3>
  <p class="" style="">To share a photo, or any kind of media, a user sends a message stanza to the contact. If the message has an empty body, it is recommended
  to add a message processing hint, see <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0334.html">Message Processing Hints (XEP-0334)</a></span>  [<a href="#nt-idm206">13</a>], to indicate the message to be stored in message stores like <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0313.html">Message Archive Management (XEP-0313)</a></span>  [<a href="#nt-idm182">12</a>].</p>
  <p class="" style="">Clients supporting <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0363.html">HTTP File Upload (XEP-0363)</a></span>  [<a href="#nt-idm73">4</a>] can upload the media file to a HTTP service and add the corresponding HTTP URL to the sources.</p>
  <p class="caption"><a name="example-1" id="example-1"></a>Example 1. Sharing an image with a contact</p><div class="indent"><pre class="prettyprint">&lt;message to='julient@shakespeare.lit' from='romeo@montague.lit'&gt;
  &lt;body&gt;Look at the nice view from the summit.&lt;/body&gt;
  &lt;reference xmlns='urn:xmpp:reference:0' begin='17' end='20' type='data'&gt;
    &lt;media-sharing xmlns='urn:xmpp:sims:1'&gt;
      &lt;file xmlns='urn:xmpp:jingle:apps:file-transfer:5'&gt;
        &lt;media-type&gt;image/jpeg&lt;/media-type&gt;
        &lt;name&gt;summit.jpg&lt;/name&gt;
        &lt;size&gt;3032449&lt;/size&gt;
        &lt;hash xmlns='urn:xmpp:hashes:2' algo='sha3-256'&gt;2XarmwTlNxDAMkvymloX3S5+VbylNrJt/l5QyPa+YoU=&lt;/hash&gt;
        &lt;hash xmlns='urn:xmpp:hashes:2' algo='id-blake2b256'&gt;2AfMGH8O7UNPTvUVAM9aK13mpCY=&lt;/hash&gt;
        &lt;desc&gt;Photo from the summit.&lt;/desc&gt;
        &lt;thumbnail xmlns='urn:xmpp:thumbs:1'uri='cid:sha1+ffd7c8d28e9c5e82afea41f97108c6b4@bob.xmpp.org' media-type='image/png' width='128' height='96'/&gt;
      &lt;/file&gt;
      &lt;sources&gt;
        &lt;reference xmlns='urn:xmpp:reference:0' type='data' uri='https://download.montague.lit/4a771ac1-f0b2-4a4a-9700-f2a26fa2bb67/summit.jpg' /&gt;
        &lt;reference xmlns='urn:xmpp:reference:0' type='data' uri='xmpp:romeo@montague.lit/resource?jingle;id=9559976B-3FBF-4E7E-B457-2DAA225972BB' /&gt;
      &lt;/sources&gt;
    &lt;/media-sharing&gt;
  &lt;/reference&gt;
&lt;/message&gt;</pre></div>
  <p class="" style="">The file element is the same as from <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0234.html">Jingle File Transfer (XEP-0234)</a></span>  [<a href="#nt-idm64">2</a>]. It MUST specify media-type, size, description, and one or multiple hash elements as described in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0300.html">Use of Cryptographic Hash Functions in XMPP (XEP-0300)</a></span>  [<a href="#nt-idm225">14</a>].
  The hash elements are essential as they provide end-to-end file integrity and allow efficient caching and flexible retrieval methods.</p>
  </div>
  <div class="indent"><h3>4.2 <a name="sect-idm227" id="sect-idm227">Receiving a shared photo</a></h3>
    <p class="" style="">On receive of a reference to a &lt;media-sharing&gt; element inside a message, a client SHOULD lookup in a local storage, whether the media with any of the proivded hashes has already
      been retrieved and is available. In that case no transfer needs to be initated and the image can be displayed in-line of the chat.</p>
    <p class="" style="">If the media file is not available locally, the media file can be obtained by one of the references in the &lt;sources&gt; element. If a client support HTTP downloads, it can simply download HTTP references.</p>
    <p class="" style="">If not, it can fetch the media file via a <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0358.html">Publishing Available Jingle Sessions (XEP-0358)</a></span>  [<a href="#nt-idm233">15</a>] URI reference in the sources and initiate a Jingle File-Transfer. If the client does not support <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0358.html">Publishing Available Jingle Sessions (XEP-0358)</a></span>  [<a href="#nt-idm233">15</a>], it can attempt fetching the media file via <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0234.html">Jingle File Transfer (XEP-0234)</a></span>  [<a href="#nt-idm64">2</a>] by using the hash elements in the file element as described in <a href="http://xmpp.org/extensions/xep-0234.html#requesting">Jingle File-Transfer</a>.</p>
    <p class="" style="">A client MAY retrieve the file from other sources than these mentioned in the sources element. This may be via <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0234.html">Jingle File Transfer (XEP-0234)</a></span>  [<a href="#nt-idm64">2</a>] from the senders' other resources or from a
      media caching service located at the local service. The standardization of such cache is out of scope for this document.</p>
    <p class="" style="">Regardless of the transport method used to obtain the file, the received content MUST be verified against one of the hashes.
      If the verification fails, the retrieved contant MUST be discarded and retrieval using a different source can be attempted.</p>
  </div>
<h2>5.
       <a name="rules" id="rules">Business Rules</a></h2>
  <div class="indent"><h3>5.1 <a name="sect-idm251" id="sect-idm251">Transport Method Preference</a></h3>
    <p class="" style="">This XEP delegates actual transport of the media data to one of the existing file-transfer XEPs. Thus a client supporting this XEP MUST implement <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0234.html">Jingle File Transfer (XEP-0234)</a></span>  [<a href="#nt-idm64">2</a>] and <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0363.html">HTTP File Upload (XEP-0363)</a></span>  [<a href="#nt-idm73">4</a>].</p>
    <p class="" style="">If a users server supports <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0363.html">HTTP File Upload (XEP-0363)</a></span>  [<a href="#nt-idm73">4</a>], it SHOULD upload the file to the service and add the retrieval URL to the &lt;sources&gt; tag, unless the user specifically asked to not store media in the cloud.</p>
    <p class="" style="">Using <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0363.html">HTTP File Upload (XEP-0363)</a></span>  [<a href="#nt-idm73">4</a>] for media file transfer highly increases the UX, since the HTTP server has a higher availability than XMPP end-user clients and can easily handle the load of lots of requests that result from sharing media in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idm169">9</a>] and <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0369.html">Mediated Information eXchange (MIX) (XEP-0369)</a></span>  [<a href="#nt-idm173">10</a>] rooms.</p>
  </div>
  <div class="indent"><h3>5.2 <a name="sect-idm279" id="sect-idm279">Media Support</a></h3>
    <p class="" style="">Sharing the raw data of media does not provide a complete user experience. Clients ideally need to be able to display the media inline of the chat. For this we set baseline requirements for audio, video and picture formats, that a client supports to display. These requrirements are shown in the following table.</p>
    <p class="" style="">A client usually will always send in one format per media type, if it creates that media itself.</p>
    <div class="indent"><p class="caption"><a name="table-2" id="table-2"></a>Table 2: Mandated encoding and in-line display support.</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Media Type</th>
        <th colspan="" rowspan="">Mime Type</th>
        <th colspan="" rowspan="">Format/Container</th>
        <th colspan="" rowspan="">Codec</th>
        <th colspan="" rowspan="">Requirement</th>
        <th colspan="" rowspan="">Comment</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Audio</td>
        <td align="" colspan="" rowspan="">audio/m4a</td>
        <td align="" colspan="" rowspan="">MPEG4</td>
        <td align="" colspan="" rowspan="">AAC</td>
        <td align="" colspan="" rowspan="">SHOULD</td>
        <td align="" colspan="" rowspan="">Can be encoded/decoded by stock <a href="https://developer.android.com/guide/appendix/media-formats.html">Android</a> and <a href="https://developer.apple.com/library/content/documentation/Miscellaneous/Conceptual/iPhoneOSTechOverview/MediaLayer/MediaLayer.html">iOS</a> systems.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Image</td>
        <td align="" colspan="" rowspan="">image/jpeg</td>
        <td align="" colspan="" rowspan="">-</td>
        <td align="" colspan="" rowspan="">JPEG</td>
        <td align="" colspan="" rowspan="">SHOULD</td>
        <td align="" colspan="" rowspan="">Supported on common desktop and mobile systems. Use for photos.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Image</td>
        <td align="" colspan="" rowspan="">image/png</td>
        <td align="" colspan="" rowspan="">-</td>
        <td align="" colspan="" rowspan="">PNG</td>
        <td align="" colspan="" rowspan="">SHOULD</td>
        <td align="" colspan="" rowspan="">Supported on common desktop and mobile systems. Use for non-photos.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Video</td>
        <td align="" colspan="" rowspan="">image/gif</td>
        <td align="" colspan="" rowspan="">-</td>
        <td align="" colspan="" rowspan="">GIF</td>
        <td align="" colspan="" rowspan="">SHOULD</td>
        <td align="" colspan="" rowspan="">Widespread history animation format supported everywhere.</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">Video</td>
        <td align="" colspan="" rowspan="">video/mp4</td>
        <td align="" colspan="" rowspan="">MPEG4</td>
        <td align="" colspan="" rowspan="">H.264 AVC</td>
        <td align="" colspan="" rowspan="">SHOULD</td>
        <td align="" colspan="" rowspan="">Can be encoded/decoded by stock <a href="https://developer.android.com/guide/appendix/media-formats.html">Android</a> and <a href="https://developer.apple.com/library/content/documentation/Miscellaneous/Conceptual/iPhoneOSTechOverview/MediaLayer/MediaLayer.html">iOS</a> systems.</td>
      </tr>
    </table></div>
  </div>
  <div class="indent"><h3>5.3 <a name="sect-idm329" id="sect-idm329">Atomatic retrieval of shared media</a></h3>
    <p class="" style="">Depending on the size of the shared media, a client MAY want to automatically download and display the media instead of fetching and displaying the thumbnail. The size threshold depends on the network environment the client currently runs in.</p>
    <p class="" style="">If a client supports automatic retrieval it MUST disclose this feature to the end user and provide a way to disable it, as it may result in high network traffic.</p>
  </div>
  <div class="indent"><h3>5.4 <a name="sect-idm332" id="sect-idm332">MUC and MIX related rules</a></h3>
    <p class="" style="">In cases where media is shared in a <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idm169">9</a>] or <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0369.html">Mediated Information eXchange (MIX) (XEP-0369)</a></span>  [<a href="#nt-idm173">10</a>] room the sender has to expect that a large number of clients may retrieve the shared media automatically. Ideally multiple sources, including HTTP or other high availability sources, are provided in the &lt;sources&gt; tag of the &lt;media-sharing&gt; tag in case the media is shared in a MUC/MIX room.</p>
    <p class="box" style="">TODO: Describe protocol for MIX members to advertise media availablilty to peers in a dedicated MIX channel PubSub node. Maybe as a dedicated XEP.</p>
  </div>
  <div class="indent"><h3>5.5 <a name="sect-idm343" id="sect-idm343">MAM and Carbons related rules</a></h3>
    <p class="" style="">For the media sharing described in this XEP to work, it is REQUIRED for MAM to store the whole stanza instead of only the body content. If the MAM component of the user's server strips away the &lt;media-sharing&gt; tag, any shared media will be missing in archived messages.</p>
    <p class="" style="">If sensitve media is shared a client MAY add relevant hints for the server via <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0334.html">Message Processing Hints (XEP-0334)</a></span>  [<a href="#nt-idm206">13</a>].</p>
  </div>
  <div class="indent"><h3>5.6 <a name="sect-idm350" id="sect-idm350">XHTML-IM related rules</a></h3>
    <p class="" style="">To refer to shared media in a XHTML-IM message, this XEP takes advantage of the requirement for hash elements in the file metadata and <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc6920">RFC 6920</a></span>  [<a href="#nt-idm354">16</a>] and its ni URI format. Using the URI format, XHTML-IM can easily refer to media that is attached to a message via a &lt;media-sharing&gt; element, as shown in the following example.</p>
    <p class="caption"><a name="example-2" id="example-2"></a>Example 2. Sharing an image with a contact</p><div class="indent"><pre class="prettyprint">&lt;message to='julient@shakespeare.lit' from='romeo@montague.lit'&gt;
    &lt;body&gt;Look at the nice view from the summit.&lt;/body&gt;
    &lt;html xmlns='http://jabber.org/protocol/xhtml-im'&gt;
      &lt;body xmlns='http://www.w3.org/1999/xhtml'&gt;
        &lt;p&gt;Look at the nice &lt;p style='font-weight:bold; display:inline"&gt;view&lt;/p&gt; from the summit.&lt;/p&gt;
        &lt;img src="ni:///sha3-256;wqfDv8OGw7jCvx7Dl2ZRw4FHVsKgYcOWYsO14oKsw79Nw6Q7ScO64oCaw5gKS-KCrMO4Q0o" /&gt;
      &lt;/body&gt;
    &lt;/html&gt;
    &lt;reference xmlns='urn:xmpp:reference:0' begin='17' end='20' type='data'&gt;
      &lt;media-sharing xmlns='urn:xmpp:sims:1'&gt;
        &lt;file xmlns='urn:xmpp:jingle:apps:file-transfer:5'&gt;
          &lt;media-type&gt;image/jpeg&lt;/media-type&gt;
          &lt;name&gt;summit.jpg&lt;/name&gt;
          &lt;size&gt;3032449&lt;/size&gt;
          &lt;hash xmlns='urn:xmpp:hashes:2' algo='sha3-256'&gt;2XarmwTlNxDAMkvymloX3S5+VbylNrJt/l5QyPa+YoU=&lt;/hash&gt;
          &lt;hash xmlns='urn:xmpp:hashes:2' algo='id-blake2b256'&gt;2AfMGH8O7UNPTvUVAM9aK13mpCY=&lt;/hash&gt;
          &lt;desc&gt;Photo from the summit.&lt;/desc&gt;
          &lt;thumbnail xmlns='urn:xmpp:thumbs:1'uri='cid:sha1+ffd7c8d28e9c5e82afea41f97108c6b4@bob.xmpp.org' media-type='image/png' width='128' height='96'/&gt;
        &lt;/file&gt;
        &lt;sources&gt;
          &lt;reference xmlns='urn:xmpp:reference:0' type='data' uri='https://download.montague.lit/4a771ac1-f0b2-4a4a-9700-f2a26fa2bb67/summit.jpg' /&gt;
          &lt;reference xmlns='urn:xmpp:reference:0' type='data' uri='xmpp:romeo@montague.lit/resource?jingle-ft' /&gt;
        &lt;/sources&gt;
      &lt;/media-sharing&gt;
    &lt;/reference&gt;
  &lt;/message&gt;</pre></div>
    <p class="" style="">This way the client can aquire the content addressable resource mentioned in the img-tag in the XHTML-IM message, and when finished show in in the rendered XHTML-IM message.</p>
  </div>
<h2>6.
       <a name="impl" id="impl">Implementation Notes</a></h2>
  <p class="" style=""></p>
<h2>7.
       <a name="access" id="access">Accessibility Considerations</a></h2>
  <p class="" style="">The size element in the file element provides clients to automatically load small files and if not provide the users with a hint on how long a transfer might take.</p>
  <p class="" style="">The OPTIONAL thumbnail element in the file element improves the user experience as it provides further hints for users on whether the file could be of interest to them.</p>
  <p class="" style="">The desc element in the file element is criticial for clients to enable them to provide accessibility to users who use screen readers.</p>
<h2>8.
       <a name="i18n" id="i18n">Internationalization Considerations</a></h2>
  <p class="" style="">OPTIONAL.</p>
<h2>9.
       <a name="security" id="security">Security Considerations</a></h2>
  <div class="indent"><h3>9.1 <a name="sect-idm367" id="sect-idm367">Clearing of privacy sensitive metadata</a></h3>
    <p class="" style="">Mobile devices are able to attach the geographic location of where a photo was taken to the photo. It is RECOMMENDED that a client implementing this XEP attempts to detect privacy exposing metadata in media shared and if found provides the user with an option to clear the media of such metadata.</p>
  </div>
  <div class="indent"><h3>9.2 <a name="sect-idm369" id="sect-idm369">The value and cost of end-to-end media integrity</a></h3>
    <p class="" style="">Requiring end-to-end media integrity prevents trival server side optimizations or other processing on shared media as it will change the cryptographic hash of the media file. On the other hand, requring a matching cryptographic hash guarantees that everybody sees the exact same media a user has shared in a group conversation.</p>
  </div>
<h2>10.
       <a name="ack" id="ack">Acknowledgements</a></h2>
  <p class="" style="">Thanks to Kim Alvefur, Emmanuel Gil Peyrot, Kevin Smith, Nicolas Vérité, and Florian Schmaus for their helpful comments.</p>
<h2>11.
       <a name="iana" id="iana">IANA Considerations</a></h2>
  <p class="" style="">REQUIRED.</p>
<h2>12.
       <a name="registrar" id="registrar">XMPP Registrar Considerations</a></h2>
  <p class="" style="">The <span class="ref" style=""><a href="https://xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-idm379">17</a>] includes the following information in its registries.</p>
  <div class="indent"><h3>12.1 <a name="registrar-protocol" id="registrar-protocol">Protocol Namespaces</a></h3>
    <p class="" style="">The XMPP Registrar will include the following namespace in its registry of protocol namespaces at &lt;<a href="https://xmpp.org/registrar/namespaces.html">https://xmpp.org/registrar/namespaces.html</a>&gt;:</p>
    <ul class="" style="">
      <li class="" style="">urn:xmpp:sims:1</li>
    </ul>
  </div>
<h2>13.
       <a name="schema" id="schema">XML Schema</a></h2>
  <p class="" style="">REQUIRED for protocol specifications.</p>
<hr /><a name="appendices" id="appendices"></a><h2>Appendices</h2><hr /><a name="appendix-docinfo" id="appendix-docinfo"></a><h3>Appendix A: Document Information</h3><p class="indent">
            Series: <a href="http://xmpp.org/extensions/">XEP</a><br />
            Number: 0385<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status:
            <a href="http://xmpp.org/extensions/xep-0001.html#states-Experimental">Experimental</a><br />
            Type:
            <a href="http://xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br />
            Version: 0.2.1<br />
            Last Updated: 2018-01-25<br />
                Approving Body: <a href="http://xmpp.org/council/">XMPP Council</a><br />Dependencies: XMPP Core, XEP-0001, XEP-0234, XEP-0300, XEP-0363<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: sims<br />
              Source Control:
                <a class="standardsButton" href="https://github.com/xsf/xeps/blob/master/xep-0385.xml">HTML</a><br />
            This document in other formats:
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-0385.xml">XML</a> 
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-0385.pdf">PDF</a></p><hr /><a name="appendix-authorinfo" id="appendix-authorinfo"></a><h3>Appendix B: Author Information</h3><div class="indent"><h3>Tobias Markmann</h3><p class="indent">
        Email:
        <a href="mailto:tobias.markmann@isode.com">tobias.markmann@isode.com</a><br />
        JabberID:
        <a href="xmpp:tm@ayena.de">tm@ayena.de</a><br /></p></div><hr /><a name="appendix-legal" id="appendix-legal"></a><h3>Appendix C: Legal Notices</h3><div class="indent"><h4>Copyright</h4>This XMPP Extension Protocol is copyright © 1999 – 2018 by the <a href="https://xmpp.org/">XMPP Standards Foundation</a> (XSF).<h4>Permissions</h4>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h4>Disclaimer of Warranty</h4><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. ##</span><h4>Limitation of Liability</h4>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h4>IPR Conformance</h4>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which can be found at &lt;<a href="https://xmpp.org/about/xsf/ipr-policy">https://xmpp.org/about/xsf/ipr-policy</a>&gt; or obtained by writing to XMPP Standards Foundation, P.O. Box 787, Parker, CO 80134 USA).</div><hr /><a name="appendix-xmpp" id="appendix-xmpp"></a><h3>Appendix D: Relation to XMPP</h3><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 6120) and XMPP IM (RFC 6121) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><hr /><a name="appendix-discuss" id="appendix-discuss"></a><h3>Appendix E: Discussion Venue</h3><p class="indent">The primary venue for discussion of XMPP Extension Protocols is the &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">standards@xmpp.org</a>&gt; discussion list.</p><p class="indent">Discussion on other xmpp.org discussion lists might also be appropriate; see &lt;<a href="http://xmpp.org/about/discuss.shtml">http://xmpp.org/about/discuss.shtml</a>&gt; for a complete list.</p><p class="indent">Errata can be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><hr /><a name="appendix-conformance" id="appendix-conformance"></a><h3>Appendix F: Requirements Conformance</h3><p class="indent">The following requirements keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><a name="appendix-notes" id="appendix-notes"></a><h3>Appendix G: Notes</h3><div class="indent"><p><a name="nt-idm60" id="nt-idm60">1</a>. XEP-0096: SI File Transfer &lt;<a href="https://xmpp.org/extensions/xep-0096.html">https://xmpp.org/extensions/xep-0096.html</a>&gt;.</p><p><a name="nt-idm64" id="nt-idm64">2</a>. XEP-0234: Jingle File Transfer &lt;<a href="https://xmpp.org/extensions/xep-0234.html">https://xmpp.org/extensions/xep-0234.html</a>&gt;.</p><p><a name="nt-idm69" id="nt-idm69">3</a>. XEP-0329: File Information Sharing &lt;<a href="https://xmpp.org/extensions/xep-0329.html">https://xmpp.org/extensions/xep-0329.html</a>&gt;.</p><p><a name="nt-idm73" id="nt-idm73">4</a>. XEP-0363: HTTP File Upload &lt;<a href="https://xmpp.org/extensions/xep-0363.html">https://xmpp.org/extensions/xep-0363.html</a>&gt;.</p><p><a name="nt-idm82" id="nt-idm82">5</a>. XEP-0231: Bits of Binary &lt;<a href="https://xmpp.org/extensions/xep-0231.html">https://xmpp.org/extensions/xep-0231.html</a>&gt;.</p><p><a name="nt-idm86" id="nt-idm86">6</a>. XEP-0071: XHTML-IM &lt;<a href="https://xmpp.org/extensions/xep-0071.html">https://xmpp.org/extensions/xep-0071.html</a>&gt;.</p><p><a name="nt-idm100" id="nt-idm100">7</a>. XEP-0260: Jingle SOCKS5 Bytestreams Transport Method &lt;<a href="https://xmpp.org/extensions/xep-0260.html">https://xmpp.org/extensions/xep-0260.html</a>&gt;.</p><p><a name="nt-idm104" id="nt-idm104">8</a>. XEP-0261: Jingle In-Band Bytestreams Transport Method &lt;<a href="https://xmpp.org/extensions/xep-0261.html">https://xmpp.org/extensions/xep-0261.html</a>&gt;.</p><p><a name="nt-idm169" id="nt-idm169">9</a>. XEP-0045: Multi-User Chat &lt;<a href="https://xmpp.org/extensions/xep-0045.html">https://xmpp.org/extensions/xep-0045.html</a>&gt;.</p><p><a name="nt-idm173" id="nt-idm173">10</a>. XEP-0369: Mediated Information eXchange (MIX) &lt;<a href="https://xmpp.org/extensions/xep-0369.html">https://xmpp.org/extensions/xep-0369.html</a>&gt;.</p><p><a name="nt-idm178" id="nt-idm178">11</a>. XEP-0280: Message Carbons &lt;<a href="https://xmpp.org/extensions/xep-0280.html">https://xmpp.org/extensions/xep-0280.html</a>&gt;.</p><p><a name="nt-idm182" id="nt-idm182">12</a>. XEP-0313: Message Archive Management &lt;<a href="https://xmpp.org/extensions/xep-0313.html">https://xmpp.org/extensions/xep-0313.html</a>&gt;.</p><p><a name="nt-idm206" id="nt-idm206">13</a>. XEP-0334: Message Processing Hints &lt;<a href="https://xmpp.org/extensions/xep-0334.html">https://xmpp.org/extensions/xep-0334.html</a>&gt;.</p><p><a name="nt-idm225" id="nt-idm225">14</a>. XEP-0300: Use of Cryptographic Hash Functions in XMPP &lt;<a href="https://xmpp.org/extensions/xep-0300.html">https://xmpp.org/extensions/xep-0300.html</a>&gt;.</p><p><a name="nt-idm233" id="nt-idm233">15</a>. XEP-0358: Publishing Available Jingle Sessions &lt;<a href="https://xmpp.org/extensions/xep-0358.html">https://xmpp.org/extensions/xep-0358.html</a>&gt;.</p><p><a name="nt-idm354" id="nt-idm354">16</a>. RFC 6920: Naming Things with Hashes &lt;<a href="http://tools.ietf.org/html/rfc6920">http://tools.ietf.org/html/rfc6920</a>&gt;.</p><p><a name="nt-idm379" id="nt-idm379">17</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="https://xmpp.org/registrar/">https://xmpp.org/registrar/</a>&gt;.</p></div><hr /><a name="appendix-revs" id="appendix-revs"></a><h3>Appendix H: Revision History</h3><p>Note: Older versions of this specification might be available at <a href="http://xmpp.org/extensions/attic/">http://xmpp.org/extensions/attic/</a></p><div class="indent"><h4>Version 0.2.1 (2018-01-25)</h4><div class="indent"><p class="" style="">Fix reference to XEP-0234.</p> (vv)
    </div><h4>Version 0.2.0 (2017-09-21)</h4><div class="indent"><p class="" style="">Use 'urn:xmpp:hashes:2' and 'urn:xmpp:jingle:apps:file-transfer:5'.</p> (fs)
    </div><h4>Version 0.1.0 (2017-01-04)</h4><div class="indent"><p class="" style="">Initial version approved by the council.</p> (XEP Editor: ssw)
    </div><h4>Version 0.0.1 (2016-12-21)</h4><div class="indent"><p class="" style="">First draft processed by editor.</p> (tm (XEP Editor: ssw))
    </div></div><hr /><p>END</p></body></html>
