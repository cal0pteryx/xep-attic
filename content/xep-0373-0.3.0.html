<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>XEP-0373: OpenPGP for XMPP</title><link rel="stylesheet" type="text/css" href="xmpp.css" /><link href="prettify.css" type="text/css" rel="stylesheet" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" /><script type="text/javascript" src="prettify.js"></script><meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=2.0" /><meta name="DC.Title" content="OpenPGP for XMPP" /><meta name="DC.Creator" content="Florian Schmaus" /><meta name="DC.Creator" content="Dominik Sch&#xFC;rmann" /><meta name="DC.Creator" content="Vincent Breitmoser" /><meta name="DC.Description" content="Specifies end-to-end encryption and authentication of data with the help of&#10;  OpenPGP, announcement, discovery and retrieval of public keys and a&#10;  mechanism to synchronize secret keys over multiple&#10;  devices." /><meta name="DC.Publisher" content="XMPP Standards Foundation" /><meta name="DC.Contributor" content="XMPP Extensions Editor" /><meta name="DC.Date" content="2018-04-16" /><meta name="DC.Type" content="XMPP Extension Protocol" /><meta name="DC.Format" content="XHTML" /><meta name="DC.Identifier" content="XEP-0373" /><meta name="DC.Language" content="en" /><meta name="DC.Rights" content="This XMPP Extension Protocol is copyright &#xA9; 1999 &#x2013; 2018 by the XMPP Standards Foundation (XSF)." /></head><body onload="prettyPrint()"><h1>XEP-0373: OpenPGP for XMPP</h1><table><tr valign="top"><td><strong>Abstract:</strong></td><td>Specifies end-to-end encryption and authentication of data with the help of
  OpenPGP, announcement, discovery and retrieval of public keys and a
  mechanism to synchronize secret keys over multiple
  devices.</td></tr><tr valign="top"><td><strong>Authors:</strong></td><td>Florian Schmaus, Dominik Schürmann, Vincent Breitmoser</td></tr><tr valign="top"><td><strong>Copyright:</strong></td><td>© 1999 – 2017 XMPP Standards Foundation. <a href="#appendix-legal">SEE LEGAL NOTICES</a>.</td></tr><tr valign="top"><td><strong>Status:</strong></td><td>Experimental</td></tr><tr valign="top"><td><strong>Type:</strong></td><td>Standards Track</td></tr><tr valign="top"><td><strong>Version:</strong></td><td>0.3.0</td></tr><tr valign="top"><td><strong>Last Updated:</strong></td><td>2018-04-16</td></tr></table><hr /><p style="color:red">WARNING: This Standards-Track document is Experimental. Publication as an XMPP Extension Protocol does not imply approval of this proposal by the XMPP Standards Foundation. Implementation of the protocol described herein is encouraged in exploratory implementations, but production systems are advised to carefully consider whether it is appropriate to deploy implementations of this protocol before it advances to a status of Draft.</p><hr /><h2>Table of Contents</h2><div class="indent"><p><br />1.  <a href="#intro">Introduction</a><br />2.  <a href="#glossary">Glossary</a><br />3.  <a href="#signcrypt">OpenPGP Encrypted and Signed Data</a><br />   
      3.1.  <a href="#exchange">Exchanging OpenPGP Encrypted and Signed Data</a><br />   
      3.2.  <a href="#openpgp-verification">Verification of &lt;openpgp/&gt; Content</a><br />4.  <a href="#announcing-discover-pubkey">Announcing and Discovering Public Keys via PEP</a><br />   
      4.1.  <a href="#annoucning-pubkey">The OpenPGP Public-Key Data Node</a><br />   
      4.2.  <a href="#announcing-pubkey-list">The OpenPGP Public Key Metadata Node</a><br />   
      4.3.  <a href="#discover-pubkey">Discovering Public Keys</a><br />   
      4.4.  <a href="#pubsub-notifications">Receiving notifications about key changes</a><br />5.  <a href="#synchro-pep">Synchronizing the Secret Key with a Private PEP Node</a><br />   
      5.1.  <a href="#sect-idm236">Required PEP features</a><br />      
      5.1.1.  <a href="#sect-idm238">Discovering support</a><br />   
      5.2.  <a href="#req-info-secret-pep-node">Requesting Information About the Secret Key PEP Node</a><br />      
      5.2.1.  <a href="#sect-idm244">Client Sends Request</a><br />      
      5.2.2.  <a href="#sect-idm246">PEP Service Success Response</a><br />      
      5.2.3.  <a href="#sect-idm248">PEP Node Does Not Exist Response</a><br />      
      5.2.4.  <a href="#sect-idm251">PEP Not Supported</a><br />   
      5.3.  <a href="#sect-idm254">Creating the Secret Key PEP Node</a><br />6.  <a href="#rules">Business Rules</a><br />   
      6.1.  <a href="#openpgp-packet-format-version">OpenPGP Packet Format Version Restriction</a><br />   
      6.2.  <a href="#pubsub-node-configuration">PubSub Node Configuration</a><br />   
      6.3.  <a href="#key-enforcement">Key Enforcement</a><br />7.  <a href="#implementors-advice">Implementors Advice</a><br />   
      7.1.  <a href="#design-and-techniques">Design Principles and Techniques</a><br />   
      7.2.  <a href="#stanza-size">Stanza Size</a><br />   
      7.3.  <a href="#xmpp-address-normalization">XMPP Address Normalization</a><br />8.  <a href="#rationale">Rationale</a><br />   
      8.1.  <a href="#key-handling">Key Handling</a><br />   
      8.2.  <a href="#openpgp-element-design">OpenPGP Element and Content Element Design</a><br />   
      8.3.  <a href="#solving-xep0027-issues">Addressing the Issues and Problems of XEP-0027</a><br />   
      8.4.  <a href="#openpgp-ascii-armor">Not using OpenPGP ASCII Armor</a><br />   
      8.5.  <a href="#openpgp-user-ids">OpenPGP User IDs</a><br />9.  <a href="#security">Security Considerations</a><br />10.  <a href="#iana">IANA Considerations</a><br />11.  <a href="#registrar">XMPP Registrar Considerations</a><br />   
      11.1.  <a href="#registrar-ns">Protocol Namespaces</a><br />12.  <a href="#schema">XML Schema</a><br />13.  <a href="#acknowledgements">Acknowledgements</a></p><p><a href="#appendices">Appendices</a><br />    <a href="#appendix-docinfo">A: Document Information</a><br />    <a href="#appendix-authorinfo">B: Author Information</a><br />    <a href="#appendix-legal">C: Legal Notices</a><br />    <a href="#appendix-xmpp">D: Relation to XMPP</a><br />    <a href="#appendix-discuss">E: Discussion Venue</a><br />    <a href="#appendix-conformance">F: Requirements Conformance</a><br />    <a href="#appendix-notes">G: Notes</a><br />    <a href="#appendix-revs">H: Revision History</a></p></div><hr /><h2>1.
       <a name="intro" id="intro">Introduction</a></h2>

  <p class="" style="">This XMPP extension protocol specifies the foundations of
  end-to-end encryption and authentication, based on digital
  signatures, of data with the help of OpenPGP. Additional XEPs will
  use this extension protocol as building block when specifying their
  own OpenPGP profile suiting their use case. One such profile is the
  Instant Messaging Profile specified in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0374.html">OpenPGP for XMPP Instant Messaging (XEP-0374)</a></span>  [<a href="#nt-idm95">1</a>].</p>

  <p class="" style="">XMPP provides the mechanisms to solve a lot of issues that come
  with modern day OpenPGP usage. For example, based on <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0163.html">Personal Eventing Protocol (XEP-0163)</a></span>  [<a href="#nt-idm100">2</a>] this
  specification describes a standardized way to discover OpenPGP
  public keys of other entities. But unlike the OpenPGP keyservers,
  this process establishes a strong relation between the key and the
  key's owning entity (usually a human user). A similar mechanism
  described herein allows to synchronize the secret key(s) across
  multiple devices.</p>

  <p class="" style="">OpenPGP in return allows for end-to-end encrypted data to be
  exchanged between one, two or even multiple entities
  (multi-end-to-multi-end encryption). Therefore this XEP can be used
  for example to implement end-to-end encrypted <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0045.html">Multi-User Chat (XEP-0045)</a></span>  [<a href="#nt-idm105">3</a>].</p>

<h2>2.
       <a name="glossary" id="glossary">Glossary</a></h2>

  <div class="indent"><dl>
    <di><dt><strong>OpenPGP element</strong></dt><dd>An XMPP extension element: &lt;openpgp/&gt; qualified by the 'urn:xmpp:openpgp:0' namespace</dd></di>
    <di><dt><strong>OpenPGP content element</strong></dt><dd>An element embedded via OpenPGP in a &lt;openpgp/&gt; element. Either one of &lt;signcrypt/&gt;, &lt;sign/&gt; or &lt;crypt/&gt;, qualified by the 'urn:xmpp:openpgp:0' namespace.</dd></di>
    <di><dt><strong>PEP</strong></dt><dd><span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0163.html">Personal Eventing Protocol (XEP-0163)</a></span>  [<a href="#nt-idm100">2</a>]</dd></di>
    <di><dt><strong>Public-Key metadata node ("metadata node")</strong></dt><dd>A PEP node containing metadata of the entity's public OpenPGP key.</dd></di>
    <di><dt><strong>Public-Key data node ("data node")</strong></dt><dd>A PEP node containing an entity's public OpenPGP key.</dd></di>
    <di><dt><strong>Secret-Key node</strong></dt><dd>A PEP node containing an entity's encrypted secret OpenPGP key.</dd></di>
    <di><dt><strong>OpenPGP v4 Fingerprint String</strong></dt><dd>A String representing the OpenPGP v4 fingerprint of a key.</dd></di>
  </dl></div>

<h2>3.
       <a name="signcrypt" id="signcrypt">OpenPGP Encrypted and Signed Data</a></h2>

  <div class="indent"><h3>3.1 <a name="exchange" id="exchange">Exchanging OpenPGP Encrypted and Signed Data</a></h3>

    <p class="" style="">The &lt;openpgp/&gt; extension element qualified by the
    'urn:xmpp:openpgp:0' namespace is used in order to exchange
    encrypted and signed data.</p>

    <p class="caption"><a name="example-1" id="example-1"></a>Example 1. The &lt;openpgp/&gt; extension within a message.</p><div class="indent"><pre class="prettyprint">
&lt;message to='juliet@example.org'&gt;
  &lt;openpgp xmlns='urn:xmpp:openpgp:0'&gt;
    BASE64_OPENPGP_MESSAGE
  &lt;/openpgp&gt;
&lt;/message&gt;</pre></div>

    <p class="" style="">The text content of &lt;openpgp/&gt; ("BASE64_OPENPGP_MESSAGE") is a
    Base64 encoded (<span class="ref" style=""><a href="http://tools.ietf.org/html/rfc4648">RFC 4648</a></span>  [<a href="#nt-idm141">4</a>] <a href="https://tools.ietf.org/html/rfc4648#section-4">§ 4</a>)
    OpenPGP message as specified in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc4880">RFC 4880</a></span>  [<a href="#nt-idm146">5</a>] which contains an
    encrypted and/or signed UTF-8 (<span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3629">RFC 3629</a></span>  [<a href="#nt-idm150">6</a>]) encoded string. This
    string MUST correspond to exactly one OpenPGP content element,
    that is, it represents either a &lt;signcrypt/&gt;, a &lt;sign/&gt; or a &lt;crypt/&gt;
    extension element qualified by the 'urn:xmpp:openpgp:0'
    namespace. Note that OpenPGP's ASCII Armor is not used, instead
    the XMPP client MUST encode the raw bytes of the OpenPGP message using
    Base64.</p>

    <p class="" style="">In case of a &lt;signcrypt/&gt; element, the OpenPGP message embedded
    in the &lt;openpgp/&gt; element MUST be encrypted and signed, and SHOULD
    also be encrypted to self. In case of a &lt;sign/&gt; element, the
    OpenPGP message MUST be signed and MUST NOT be encrypted. In case
    of &lt;crypt/&gt; the OpenPGP message MUST NOT be signed, but MUST be
    encrypted.</p>

    <p class="caption"><a name="example-2" id="example-2"></a>Example 2. The &lt;signcrypt/&gt; extension element.</p><div class="indent"><pre class="prettyprint">
&lt;signcrypt xmlns='urn:xmpp:openpgp:0'&gt;
  &lt;to jid='juliet@example.org'/&gt;
  &lt;time stamp='2014-07-10T17:06:00+02:00'/&gt;
  &lt;rpad&gt;
    f0rm1l4n4-mT8y33j!Y%fRSrcd^ZE4Q7VDt1L%WEgR!kv
  &lt;/rpad&gt;
  &lt;payload&gt;
    &lt;body xmlns='jabber:client'&gt;
      This is a secret message.
    &lt;/body&gt;
  &lt;/payload&gt;
&lt;/signcrypt&gt;</pre></div>

    <p class="" style="">OpenPGP content elements MUST possess exactly one 'time'
    element as direct child elements. The &lt;signcrypt/&gt; and &lt;crypt/&gt;
    content elements MUST contain at least one 'to' element(s), which
    MUST have a 'jid' attribute containing the intended recipient's
    XMPP address of the signed and/or encrypted data to prevent
    Surreptitious Forward Attacks [<a href="#nt-idm155">7</a>].
    The XMPP address found in the 'to' element's 'jid' attribute
    SHOULD be without Resourcepart (i.e., a bare JID). A &lt;sign/&gt; content
    element may not carry a 'to' attribute. The 'time' element MUST
    have a 'stamp' attribute which contains the timestamp when the
    OpenPGP content element was signed and/or encrypted in the
    DateTime format as specified in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0082.html">XMPP Date and Time Profiles (XEP-0082)</a></span>  [<a href="#nt-idm159">8</a>] § 3.2. The &lt;signcrypt/&gt;
    and &lt;crypt/&gt; elements SHOULD furthermore contain a 'rpad' element
    which text content is a random-length random-content padding.</p>

    <div class="indent"><p class="caption"><a name="table-1" id="table-1"></a>Table 1: OpenPGP Content Element Properties</p><table border="1" cellpadding="3" cellspacing="0">
      <tr class="body">
        <th colspan="" rowspan="">Content Element</th>
        <th colspan="" rowspan="">'to' Element</th>
        <th colspan="" rowspan="">'time' Element</th>
        <th colspan="" rowspan="">&lt;rpad/&gt; Element</th>
        <th colspan="" rowspan="">&lt;payload/&gt; Element</th>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">&lt;signcrypt/&gt;</td>
        <td align="" colspan="" rowspan="">MUST have at least one</td>
        <td align="" colspan="" rowspan="">MUST have exactly one</td>
        <td align="" colspan="" rowspan="">SHOULD have exactly one</td>
        <td align="" colspan="" rowspan="">MUST have exactly one</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">&lt;sign/&gt;</td>
        <td align="" colspan="" rowspan="">MAY NOT contain one</td>
        <td align="" colspan="" rowspan="">MUST have exactly one</td>
        <td align="" colspan="" rowspan="">NOT REQUIRED</td>
        <td align="" colspan="" rowspan="">MUST have exactly one</td>
      </tr>
      <tr class="body">
        <td align="" colspan="" rowspan="">&lt;crypt/&gt;</td>
        <td align="" colspan="" rowspan="">MUST have at least one</td>
        <td align="" colspan="" rowspan="">MUST have exactly one</td>
        <td align="" colspan="" rowspan="">SHOULD have exactly one</td>
        <td align="" colspan="" rowspan="">MUST have exactly one</td>
      </tr>
    </table></div>

    <p class="" style="">OpenPGP content elements MUST possess exactly one &lt;payload/&gt;
    element. The child elements of &lt;payload/&gt; can be seen as OpenPGP
    secured Stanza extension elements which are encrypted and/or
    signed. After the &lt;openpgp/&gt; element and the including &lt;signcrypt/&gt;,
    &lt;sign/&gt; or &lt;crypt/&gt; element was verified, they are processed
    according to the specification of the relevant OpenPGP for XMPP
    profile (see for example <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0374.html">OpenPGP for XMPP Instant Messaging (XEP-0374)</a></span>  [<a href="#nt-idm95">1</a>]).</p>

  </div>

  <div class="indent"><h3>3.2 <a name="openpgp-verification" id="openpgp-verification">Verification of &lt;openpgp/&gt; Content</a></h3>

    <p class="" style="">Recipients MUST verify that the signature is valid, that the
    signature's key corresponds to the sender's key, and that the
    sender's key has a User ID containing the sender's XMPP
    address in the form "xmpp:juliet@example.org" (for details see
    <a href="#openpgp-user-ids">"OpenPGP User IDs"</a>). Thus,
    the recipient may
    need to retrieve the key from the Personal Eventing Protocol node
    as described above. At least one of the XMPP addresses found in
    the 'to' elements contained in OpenPGP content element MUST
    correspond to the outer 'to' of the XMPP &lt;message/&gt;. Furthermore,
    recipients are RECOMMENDED to verify the 'time' element for
    plausibility or to display it to a user for verification.</p>

  </div>

<h2>4.
       <a name="announcing-discover-pubkey" id="announcing-discover-pubkey">Announcing and Discovering Public Keys via PEP</a></h2>

  <p class="" style="">Parties interested in exchanging encrypted data between each
  other via OpenPGP need to know the public key(s) of the
  recipients. The following section specifies a mechanism to announce
  and discover public keys.</p>

  <p class="" style="">Two PEP node types are invovled: A "medatata node" is used to store meta information about
  OpenPGP keys used by an entity while the actual public keys are stored in "data nodes".</p>

  <div class="indent"><h3>4.1 <a name="annoucning-pubkey" id="annoucning-pubkey">The OpenPGP Public-Key Data Node</a></h3>

    <p class="" style="">The public key data, as specified in <span class="ref">RFC 4880</span>, is stored in a PEP data
    node. Note that OpenPGP's ASCII Armor is not used, instead the XMPP client MUST encode the
    public key using Base64. The id of the node MUST be "urn:xmpp:openpgp:0:public-keys:" followed
    by the fingerprint string of the OpenPGP public-key contained in the data node.</p>

    <p class="" style="">The <span class="em">OpenPGP v4 fingerprint string</span> is obtained as follows: First the raw bytes of the
    fingerprint are computed as specified in <span class="ref">RFC 4880 § 12.2.</span>. Then the bytes are
    encoded as a hexadecimal string using upper case characters [<a href="#nt-idm203">9</a>].</p>

    <p class="" style="">The data node MUST contain an &lt;pubkey/&gt; element qualified by the 'urn:xmpp:openpgp:0'
    namespace. An optional 'date' attribute holds the information about the last modification of the
    key as DateTime format of <span class="ref">XEP-0082</span>. The element MUST include a &lt;data/&gt;
    element which contains the data of the key Base64 encoded.</p>

    <p class="caption"><a name="example-3" id="example-3"></a>Example 3. Saving the public key in the data node.</p><div class="indent"><pre class="prettyprint">
&lt;iq type='set' from='juliet@example.org/balcony' id='publish1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='urn:xmpp:openpgp:0:public-keys:1357B01865B2503C18453D208CAC2A9678548E35'&gt;
      &lt;item&gt;
        &lt;pubkey xmlns='urn:xmpp:openpgp:0' date='2018-01-21T10:46:21Z'&gt;
           &lt;data&gt;
             BASE64_OPENPGP_PUBLIC_KEY
           &lt;/data&gt;
        &lt;/pubkey&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

  </div>

  <div class="indent"><h3>4.2 <a name="announcing-pubkey-list" id="announcing-pubkey-list">The OpenPGP Public Key Metadata Node</a></h3>

    <p class="" style="">To update the public keys used by an entity, the metadata node is updated. Before adding a
    OpenPGP key ID to the metadata node, the publisher MUST ensure that the public key is available
    at the corresponding data node.</p>

    <p class="" style=""> The ID of the metadata node is 'urn:xmpp:openpgp:0:public-keys'. It contains a
    &lt;public-keys-list/&gt; element qualified by the 'urn:xmpp:openpgp:0' namespace containing one
    or more &lt;pubkey-metadata/&gt; elements. Every pubkey-metadata element MUST have a
    'v4-fingerprint' attribute, containing the OpenPGP v4 fingerprint string, and a 'date'
    attribute, containing the time the key was published or updated in DateTime format of
    <span class="ref">XEP-0082</span>. An OpenPGP V4 fingerprint MUST NOT occur in the list more than once.</p>

    <p class="caption"><a name="example-4" id="example-4"></a>Example 4. Publishing a public key to the metadata node.</p><div class="indent"><pre class="prettyprint">
&lt;iq type='set' from='juliet@example.org/balcony' id='publish1'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;publish node='urn:xmpp:openpgp:0:public-keys'&gt;
      &lt;item&gt;
        &lt;public-keys-list xmlns='urn:xmpp:openpgp:0'&gt;
          &lt;pubkey-metadata
            v4-fingerprint='1357B01865B2503C18453D208CAC2A9678548E35'
            date='2018-03-01T15:26:12Z'
            /&gt;
          &lt;pubkey-metadata
            v4-fingerprint='67819B343B2AB70DED9320872C6464AF2A8E4C02'
            date='1953-05-16T12:00:00Z'
            /&gt;
        &lt;/public-keys-list&gt;
      &lt;/item&gt;
    &lt;/publish&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

  </div>

  <div class="indent"><h3>4.3 <a name="discover-pubkey" id="discover-pubkey">Discovering Public Keys</a></h3>

    <p class="" style="">In order to discover the OpenPGP public keys, the interested entity first queries a remote
    entities metadata note to learn about its currently annouced OpenPGP keys. Then the public
    OpenPGP key(s) can be retrieved by querying the data node for a specific fingerprint.</p>

    <p class="caption"><a name="example-5" id="example-5"></a>Example 5. Requesting an OpenPGP public key from an XMPP entity.</p><div class="indent"><pre class="prettyprint">
&lt;iq from='romeo@example.org/orchard'
    to='juliet@example.org'
    type='get'
    id='getpub'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='urn:xmpp:openpgp:0:public-keys:1357B01865B2503C18453D208CAC2A9678548E35'
           max_items='1'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

    <p class="caption"><a name="example-6" id="example-6"></a>Example 6. Personal Eventing Protocol result containing the requested public key.</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@example.org'
    to='romeo@example.org/orchard'
    type='result'
    id='getpub'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='urn:xmpp:openpgp:0:public-keys:1357B01865B2503C18453D208CAC2A9678548E35'&gt;
      &lt;item&gt;
        &lt;pubkey xmlns='urn:xmpp:openpgp:0'&gt;
          &lt;data&gt;
            BASE64_OPENPGP_PUBLIC_KEY
          &lt;/data&gt;
        &lt;/pubkey&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

    <p class="" style="">Note that the result may contain multiple pubkey elements. Only
    the public keys found in the most recent item MUST be used. Requesters
    may want to limit the results to the most recent item using the
    'max_items' attribute set to '1'. Clients could alternatively use
    <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0059.html">Result Set Management (XEP-0059)</a></span>  [<a href="#nt-idm219">10</a>] as an alternative to 'max_items' but accoding to
    <span class="ref">XEP-0060</span> RSM is not (yet) mandatory for PubSub
    services.</p>

    <p class="" style="">Some XMPP services may not provide the Personal Eventing
    Protocol feature required to provide the mechanism described
    here. If so, they will return an &lt;iq/&gt; error of type
    service-unavailable.</p>

  </div>

  <div class="indent"><h3>4.4 <a name="pubsub-notifications" id="pubsub-notifications">Receiving notifications about key changes</a></h3>

    <p class="" style="">Entities which are subscribed to the metadata node or advertise the
    "urn:xmpp:openpgp:0:public-keys+notify" feature via <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0115.html">Entity Capabilities (XEP-0115)</a></span>  [<a href="#nt-idm227">11</a>] (see <span class="ref">XEP-0060 § 9.2</span>)
    receive a notification upon a node update.</p>

  </div>

<h2>5.
       <a name="synchro-pep" id="synchro-pep">Synchronizing the Secret Key with a Private PEP Node</a></h2>

  

    <p class="" style="">A private PEP node is used to allow XMPP clients to synchronize
    the user's secret OpenPGP key. Where private PEP node is defined: A
    PEP node in whitelist mode where only the bare JID of the key
    owner is whitelisted as described in <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0223.html">Best Practices for Persistent Storage of Private Data via Publish-Subscribe (XEP-0223)</a></span>  [<a href="#nt-idm234">12</a>]. The secret key is
    additionally encrypted.</p>

    <div class="indent"><h3>5.1 <a name="sect-idm236" id="sect-idm236">Required PEP features</a></h3>

      <p class="" style="">The used PEP server MUST support PEP and the whitelist access
      model. It SHOULD also support persistent items.</p>

        <div class="indent"><h3>5.1.1 <a name="sect-idm238" id="sect-idm238">Discovering support</a></h3>

          <p class="caption"><a name="example-7" id="example-7"></a>Example 7. Account owner queries server regarding protocol support</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit/balcony'
    to='juliet@capulet.lit'
    id='disco1'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
</pre></div>

        <p class="" style="">The service discovery result must contain a PEP identity
        '&lt;identity category='pubsub' type='pep'/&gt;, and the
        'http://jabber.org/protocol/pubsub#access-whitelist'
        feature. Ideally it also contains the
        'http://jabber.org/protocol/pubsub#persistent-items'
        feature</p>

        <p class="caption"><a name="example-8" id="example-8"></a>Example 8. Server communicates protocol support</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@capulet.lit'
    to='juliet@capulet.lit/balcony'
    id='disco1'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;identity category='account' type='registered'/&gt;
    &lt;identity category='pubsub' type='pep'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#access-presence'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#auto-create'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#auto-subscribe'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#config-node'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#create-and-configure'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#create-nodes'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#filtered-notifications'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#persistent-items'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#publish'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#retrieve-items'/&gt;
    &lt;feature var='http://jabber.org/protocol/pubsub#subscribe'/&gt;
    ...
  &lt;/query&gt;
&lt;/iq&gt;</pre></div>

       </div>

    </div>

    <div class="indent"><h3>5.2 <a name="req-info-secret-pep-node" id="req-info-secret-pep-node">Requesting Information About the Secret Key PEP Node</a></h3>

      <p class="" style="">In order to synchronize the secret key over a private PEP node,
      clients first need to discover and verify the node for the correct
      settings.</p>

      <div class="indent"><h3>5.2.1 <a name="sect-idm244" id="sect-idm244">Client Sends Request</a></h3>

  <p class="caption"><a name="example-9" id="example-9"></a>Example 9. Requesting the user's secret key.</p><div class="indent"><pre class="prettyprint">
&lt;iq from='romeo@example.org/orchard'
    to='juliet@example.org'
    type='get'
    id='getsecret'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='urn:xmpp:openpgp:secret-key:0'
           max_items='1'/&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

      </div>
      <div class="indent"><h3>5.2.2 <a name="sect-idm246" id="sect-idm246">PEP Service Success Response</a></h3>

  <p class="caption"><a name="example-10" id="example-10"></a>Example 10. Personal Eventing Protocol result containing the requested secret key.</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@example.org'
    to='romeo@example.org/orchard'
    type='result'
    id='getsecret'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;items node='urn:xmpp:openpgp:secret-key:0'&gt;
      &lt;item&gt;
        &lt;secretkey xmlns='urn:xmpp:openpgp:0'&gt;
            BASE64_OPENPGP_ENCRYPTED_SECRET_KEY
        &lt;/secretkey&gt;
      &lt;/item&gt;
    &lt;/items&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>

      </div>
      <div class="indent"><h3>5.2.3 <a name="sect-idm248" id="sect-idm248">PEP Node Does Not Exist Response</a></h3>

        <p class="" style="">If the node does not exist the service will return an &lt;iq/&gt;
        error indicating the item-not-found error condition. The
        client MUST then create it with an whitelist access model.</p>

        <p class="caption"><a name="example-11" id="example-11"></a>Example 11. Node does not exist</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@example.org'
    to='romeo@example.org/orchard'
    type='error'
    id='getsecret'&gt;
  &lt;error type='cancel'&gt;
    &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

      </div>

      <div class="indent"><h3>5.2.4 <a name="sect-idm251" id="sect-idm251">PEP Not Supported</a></h3>

        <p class="" style="">The service will return a service-unavailable error &lt;iq/&gt; if
        it does not support PEP.</p>

        <p class="caption"><a name="example-12" id="example-12"></a>Example 12. Node does not exist</p><div class="indent"><pre class="prettyprint">
&lt;iq from='juliet@example.org'
    to='romeo@example.org/orchard'
    type='error'
    id='getsecret'&gt;
  &lt;error type='cancel'&gt;
    &lt;service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
  &lt;/error&gt;
&lt;/iq&gt;</pre></div>

      </div>

    </div>
    <div class="indent"><h3>5.3 <a name="sect-idm254" id="sect-idm254">Creating the Secret Key PEP Node</a></h3>

      <p class="caption"><a name="example-13" id="example-13"></a>Example 13. Client creates secret key PEP node</p><div class="indent"><pre class="prettyprint">
&lt;iq type='set'
    from='juliet@example.org/balcony'
    id='create-node'&gt;
  &lt;pubsub xmlns='http://jabber.org/protocol/pubsub'&gt;
    &lt;create node='urn:xmpp:openpgp:secret-key:0'/&gt;
    &lt;configure&gt;
      &lt;x xmlns='jabber:x:data' type='submit'&gt;
        &lt;field var='FORM_TYPE' type='hidden'&gt;
          &lt;value&gt;http://jabber.org/protocol/pubsub#node_config&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#access_model'&gt;
          &lt;value&gt;whitelist&lt;/value&gt;
        &lt;/field&gt;
        &lt;field var='pubsub#send_last_published_item'&gt;
          &lt;value&gt;on_sub&lt;/value&gt;
        &lt;/field&gt;
      &lt;/x&gt;
    &lt;/configure&gt;
  &lt;/pubsub&gt;
&lt;/iq&gt;</pre></div>
      <p class="caption"><a name="example-14" id="example-14"></a>Example 14. Service informs requesting entity of success</p><div class="indent"><pre class="prettyprint">
&lt;iq type='result'
    to='juliet@example.org/balcony'
    id='create-node'/&gt;</pre></div>

      <p class="" style="">The node is now created and the only affiliated entity is the
      bare JID of the user, who created the node, with an affiliation as
      'owner'.</p>

      <p class="" style="">In order to set a new secret key, clients store the encrypted
      secret key as Base64 encoded raw OpenPGP message within an
      &lt;secretkey/&gt; element qualified by the 'urn:xmpp:openpgp:0'
      namespace. These secret key backups are created as follows:</p>

      <ol start="" class="" style="">
        <li class="" style="">All secret keys that should be included in the backup MUST
        be concatenated in their transferable key format (<span class="ref">RFC
        4880</span> <a href="http://tools.ietf.org/html/rfc4880#section-11.1">§
        11.1</a>).
        </li>
        <li class="" style="">A backup code is generated from secure random: The backup
        code consists of 24 upper case characters from the Latin
        alphabet and numbers without 'O' ("LATIN CAPITAL LETTER O")
        and '0' ("DIGIT ZERO") (alphabet:
        <tt>123456789ABCDEFGHIJKLMNPQRSTUVWXYZ</tt>) grouped into
        4-character chunks, e.g.,
        <tt>TWNK-KD5Y-MT3T-E1GS-DRDB-KVTW</tt>. The characters MUST be
        generated from cryptographically secure random. For example
        <tt><a href="https://lwn.net/Articles/606141/">getrandom(2)</a></tt>,
        <tt><a href="https://docs.oracle.com/javase/8/docs/api/java/security/SecureRandom.html">SecureRandom</a></tt>
        or <tt>/dev/urandom</tt>. More information about the
        randomness requirements for security can be found in <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc4086">RFC 4086</a></span>  [<a href="#nt-idm273">13</a>]
        </li>
        <li class="" style="">The whole backup code including the dashes is directly
        used as a string to encrypt the concatenated transferable keys
        as an OpenPGP message. More precisely: It is used as the
        symmetric-key for a Symmetric-Key Encrypted Session Key Packet
        according to <span class="ref">RFC 4880</span> <a href="http://tools.ietf.org/html/rfc4880#section-5.3">§
        5.3</a>; the symmetric-key is thus 29 characters long
        including the dashes.  The encryption algorithm MUST be one of
        the standardized OpenPGP symmetric algorithms, e.g, AES-128.
        </li>
      </ol>

    </div>

<h2>6.
       <a name="rules" id="rules">Business Rules</a></h2>

  <div class="indent"><h3>6.1 <a name="openpgp-packet-format-version" id="openpgp-packet-format-version">OpenPGP Packet Format Version Restriction</a></h3>

    <p class="" style="">Implementations of this XEP MUST generate and accept only
    version 4 (or higher) OpenPGP packets. Lower version OpenPGP
    packets are insecure in many aspects (see for example <span class="ref">RFC
    4880</span> <a href="http://tools.ietf.org/html/rfc4880#section-5.5.2">§
    5.5.2</a>.).</p>

  </div>

  <div class="indent"><h3>6.2 <a name="pubsub-node-configuration" id="pubsub-node-configuration">PubSub Node Configuration</a></h3>

    <p class="" style="">The Public-Key <span class="em">metadata</span> node and the Secret-Key node SHOULD be configured to either
    never send the latest item, or to send the latest item only when a new entity subscribed. Thus
    the nodes 'send_last_published_item' configuration option SHOULD be set to either 'never' or
    'on_sub' (see <span class="ref">XEP-0060</span> <a href="https://xmpp.org/extensions/xep-0060.html#registrar-formtypes-config">§ 16.4.4</a>).</p>

  </div>

  <div class="indent"><h3>6.3 <a name="key-enforcement" id="key-enforcement">Key Enforcement</a></h3>

    <p class="" style="">Whenever an entity becomes aware that the metadata node has changed (e.g., by receiving a PEP
    update from their own account), it SHOULD check that the list contains the key they use. If the
    key has been removed, the entity SHOULD reannounce it.</p>

  </div>

<h2>7.
       <a name="implementors-advice" id="implementors-advice">Implementors Advice</a></h2>

  <div class="indent"><h3>7.1 <a name="design-and-techniques" id="design-and-techniques">Design Principles and Techniques</a></h3>

    <p class="" style="">OpenPGP implementations have a sad history of being not very
    user-friendly which results in users either not using OpenPGP or in
    users wrongly using OpenPGP. Implementors of this XEP, and
    additional future XEPs based on this XEP, therefore should read
    <span class="ref" style=""><a href="http://g10code.com/steed.html">STEED</a></span> [<a href="#nt-idm295">14</a>]
    and <span class="ref" style=""><a href="https://www.cs.berkeley.edu/~tygar/papers/Why_Johnny_Cant_Encrypt/OReilly.pdf">"Why
    Johnny can't encrypt"</a></span> [<a href="#nt-idm299">15</a>]. Implementors
    of this XEP are encouraged to provide the concepts described in
    STEED:</p>

    <ul class="" style="">
      <li class="" style="">Automatic key generation</li>
      <li class="" style="">Automatic key distribution</li>
      <li class="" style="">Opportunistic encryption</li>
      <li class="" style="">Trust upon first contact</li>
    </ul>

    <p class="" style="">Furthermore implementors should design the user interface for
    effective security by following the design principles and
    techniques for security mentioned in "Why Johnny Can't
    Encrypt".</p>

  </div>

  <div class="indent"><h3>7.2 <a name="stanza-size" id="stanza-size">Stanza Size</a></h3>

    <p class="" style="">Implementors should be aware that the size OpenPGP public and
    secret keys is somewhere in the range of tens of
    kilobytes. Applying Base64 encoding on keys, as it is described
    herein, further increases the size. The formula to determine the
    Base64 encoded size is: ceil(bytes / 3) * 4. Thus the lower bound
    for the maximum stanza size of 10000 bytes, as specified in <span class="ref">RFC
    6120</span> § 13.12. 4., is usually exceeded. However all XMPP server
    implementations, the authors are aware of, follow the
    recommendation of the RFC and do not blindly set the maximum
    stanza size to such a low value, but use a much higher
    threshold. Therefore, this should hardly be an issue for
    implementations. Nevertheless, it is advised to keep the size of
    OpenPGP keys small by removing all signatures except the most
    recent self-signature on each User ID before exporting the key
    (cf. GnuPG's <tt>--export-options export-minimal</tt>).
    In addition, implementors are advised to handle
    &lt;policy-violation/&gt; error responses when trying to
    transmit Base64 encoded keys.</p>

  </div>

  <div class="indent"><h3>7.3 <a name="xmpp-address-normalization" id="xmpp-address-normalization">XMPP Address Normalization</a></h3>

    <p class="" style="">The format of XMPP addresses, sometimes called JIDs, is well
    defined. Thus they need to be normalized, as defined in
    <span class="ref" style=""><a href="http://tools.ietf.org/html/rfc7622">RFC 7622</a></span>  [<a href="#nt-idm315">16</a>]. When implementations are required to compare XMPP
    addresses for equality, as it is the case in <a href="#openpgp-verification">"Verification of &lt;openpgp/&gt;
    Content"</a>, then they also have to compare the normalized
    versions of the addresses.</p>

  </div>

<h2>8.
       <a name="rationale" id="rationale">Rationale</a></h2>

  <div class="indent"><h3>8.1 <a name="key-handling" id="key-handling">Key Handling</a></h3>

    <p class="" style="">This specification intentionally does not specify if the used
    OpenPGP key should be a primary key or a subkey. It is even
    possible to announce multiple public keys in the Personal Eventing
    Protocol node. Implementations MUST be prepared to find multiple
    public keys. The authors however believe that for ease of use only
    one OpenPGP key specially crafted for the XMPP use case should be
    created, announced and used.</p>

  </div>

  <div class="indent"><h3>8.2 <a name="openpgp-element-design" id="openpgp-element-design">OpenPGP Element and Content Element Design</a></h3>

    <p class="" style="">The &lt;openpgp/&gt; and OpenPGP content elements are container
    elements for arbitrary signed and encrypted data and can thus act
    as building blocks for encrypted data included in Message, IQ and
    Presence stanzas. For example, future specifications may use them
    to implement encrypted versions of <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0047.html">In-Band Bytestreams (XEP-0047)</a></span>  [<a href="#nt-idm325">17</a>] or <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0261.html">Jingle In-Band Bytestreams Transport Method (XEP-0261)</a></span>  [<a href="#nt-idm329">18</a>].</p>

    <p class="" style="">Note that signed OpenPGP messages already contain a timestamp
    as per the OpenPGP specification. OpenPGP content elements
    nevertheless require the 'time' element because not every OpenPGP
    API may provide access to the embedded OpenPGP timestamp.</p>

    <p class="" style="">The 'rpad' element of the OpenPGP content elements exists to
    prevent length-based side channel attacks.</p>

  </div>

  <div class="indent"><h3>8.3 <a name="solving-xep0027-issues" id="solving-xep0027-issues">Addressing the Issues and Problems of XEP-0027</a></h3>

    <p class="" style="">This specification addresses all relevant issues of <span class="ref" style=""><a href="https://xmpp.org/extensions/xep-0027.html">Current Jabber OpenPGP Usage (XEP-0027)</a></span>  [<a href="#nt-idm337">19</a>]
    (<a href="https://xmpp.org/extensions/xep-0027.html#security">§
    4</a>, <a href="https://xmpp.org/extensions/xep-0027.html#issues">§
    5</a>). It mitigates replay attacks by including the
    recipient's address and a timestamp in the OpenPGP content
    element [<a href="#nt-idm341">20</a>]. It allows for both, signing and
    encrypting of the element. The scope of the specification was
    deliberately limited to OpenPGP.</p>

    <p class="" style="">Features like signed presences, which is provided by <span class="ref">XEP-0027</span>,
    may be added later on as add-on XEP to this.</p>

  </div>

  <div class="indent"><h3>8.4 <a name="openpgp-ascii-armor" id="openpgp-ascii-armor">Not using OpenPGP ASCII Armor</a></h3>

    <p class="" style="">We decided against OpenPGP ASCII Armor (which contains an
    additional checksum) and in favor for Base64, because
    encoding should be part of the network application rather than the
    crypto layer. Also XMPP, needs no additional error correction of payload.
    In "MIME Security with OpenPGP" (<span class="ref" style=""><a href="http://tools.ietf.org/html/rfc3156">RFC 3156</a></span>  [<a href="#nt-idm348">21</a>]), ASCII Armor
    has only been chosen to be backwards compatible with legacy applications
    supporting non-MIME OpenPGP emails only.</p>

  </div>

  <div class="indent"><h3>8.5 <a name="openpgp-user-ids" id="openpgp-user-ids">OpenPGP User IDs</a></h3>

    <p class="" style="">OpenPGP User IDs normally consist of a name - email address pair, e.g.,
      "Juliet &lt;juliet@example.org&gt;" (<span class="ref">RFC 4880</span> <a href="http://tools.ietf.org/html/rfc4880#section-5.11">§ 5.11</a>).
    For this XEP, we require User IDs of the format "xmpp:juliet@example.org".
    First, it is required to have at least one User ID indicating the use
    of this OpenPGP key. When doing certification of keys (key signing),
    the partner must know what User ID she actually certifies.
    Second, this format uses the standardized URI from <span class="ref">XEP-0147</span> to indicate
    that this User ID corresponds to a key that is used for XMPP.
    Third, having the Real Name inside provides no additional security
    or guideline if this key should be certified. The XMPP address
    is the only trust anchor here.</p>

    </div>

<h2>9.
       <a name="security" id="security">Security Considerations</a></h2>

  <p class="" style="">The scope of this XEP is intentionally limited, so that the
  specification just defines way for XMPP entities to discover,
  announce and synchronize OpenPGP keys, and how to exchange signed
  and encrypted data between two or more parties. Everything else is
  outside its scope. For example, how 'secure' the key material is
  protected on the endpoints is up to the implementation.</p>

  <p class="" style="">And while this XEP specifies a mechanism how to discover and
  retrieve a public key, it does not define how the trust relation to
  this key should be established. Even if key discovery and retrieval
  over XMPP provides a stronger coupling between the possessing entity
  (the XMPP address) and the key, as compared to the OpenPGP keyservers,
  how a XMPP server authenticates a remote server is a server policy,
  which does vary from server to server. Implementation MUST provide a
  way for the user to establish and assign trust to a public key. For
  example by using a QR code shown on the recipient's device screen.</p>

  <p class="" style="">Besides the protocol defined herein, OpenPGP implementations are
  another big attack surface. Needless to say that the security of
  encrypted data exchanged using this protocol depends on the security
  of the used OpenPGP implementation. It is strongly RECOMMENED to use
  existing implementations instead of writing your own. OpenPGP
  implementations have suffered from various vulnerabilities in the past
  which opened up DoS attack vectors. For example <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-4402">CVE-2013-4402</a>
  and <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-4617">CVE-2014-4717</a>.</p>

<h2>10.
       <a name="iana" id="iana">IANA Considerations</a></h2>

  <p class="" style="">This document requires no interaction with the <span class="ref" style=""><a href="http://www.iana.org/">Internet Assigned Numbers Authority (IANA)</a></span>  [<a href="#nt-idm365">22</a>].</p>

<h2>11.
       <a name="registrar" id="registrar">XMPP Registrar Considerations</a></h2>

  <div class="indent"><h3>11.1 <a name="registrar-ns" id="registrar-ns">Protocol Namespaces</a></h3>

    <p class="" style="">The <span class="ref" style=""><a href="https://xmpp.org/registrar/">XMPP Registrar</a></span>  [<a href="#nt-idm372">23</a>] includes 'urn:xmpp:openpgp:0' in its registry of protocol namespaces (see &lt;<a href="https://xmpp.org/registrar/namespaces.html">https://xmpp.org/registrar/namespaces.html</a>&gt;).</p>

  </div>

<h2>12.
       <a name="schema" id="schema">XML Schema</a></h2>

  <p class="" style="">TODO: Add after the XEP leaves the 'experimental' state.</p>

<h2>13.
       <a name="acknowledgements" id="acknowledgements">Acknowledgements</a></h2>

  <p class="" style="">Thanks to Emmanuel Gil Peyrot, Sergei Golovan, Marc Laporte, Georg
  Lukas, Adithya Abraham Philip, Brian Cully and fiaxh for their feedback.</p>

  <p class="" style="">The first draft of this specification was worked out and written
  on the wall of the 'Kymera' room in one of Google's buildings by the
  authors, consisting of members of the XMPP Standards Foundation and
  the OpenKeychain project, at the GSOC Mentors Summit 2015. The
  authors would like to thank Google for making it possible by
  bringing the right people together.</p>

<hr /><a name="appendices" id="appendices"></a><h2>Appendices</h2><hr /><a name="appendix-docinfo" id="appendix-docinfo"></a><h3>Appendix A: Document Information</h3><p class="indent">
            Series: <a href="http://xmpp.org/extensions/">XEP</a><br />
            Number: 0373<br />
            Publisher: <a href="/xsf/">XMPP Standards Foundation</a><br />
            Status:
            <a href="http://xmpp.org/extensions/xep-0001.html#states-Experimental">Experimental</a><br />
            Type:
            <a href="http://xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards Track</a><br />
            Version: 0.3.0<br />
            Last Updated: 2018-04-16<br />
                Approving Body: <a href="http://xmpp.org/council/">XMPP Council</a><br />Dependencies: XMPP Core, XEP-0030, XEP-0082, XEP-0163, XEP-0223, XEP-0334<br />
                Supersedes: None<br />
                Superseded By: None<br />
            Short Name: ox<br />
              Source Control:
                <a class="standardsButton" href="https://github.com/xsf/xeps/blob/master/xep-0373.xml">HTML</a><br />
            This document in other formats:
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-0373.xml">XML</a> 
                <a class="standardsButton" href="http://xmpp.org/extensions/xep-0373.pdf">PDF</a></p><hr /><a name="appendix-authorinfo" id="appendix-authorinfo"></a><h3>Appendix B: Author Information</h3><div class="indent"><h3>Florian Schmaus</h3><p class="indent">
        Email:
        <a href="mailto:flo@geekplace.eu">flo@geekplace.eu</a><br />
        JabberID:
        <a href="xmpp:flo@geekplace.eu">flo@geekplace.eu</a><br /></p><h3>Dominik Schürmann</h3><p class="indent">
        Email:
        <a href="mailto:dominik@dominikschuermann.de">dominik@dominikschuermann.de</a><br />
        JabberID:
        <a href="xmpp:dominik@dominikschuermann.de">dominik@dominikschuermann.de</a><br /></p><h3>Vincent Breitmoser</h3><p class="indent">
        Email:
        <a href="mailto:look@my.amazin.horse">look@my.amazin.horse</a><br />
        JabberID:
        <a href="xmpp:valodim@stratum0.org">valodim@stratum0.org</a><br /></p></div><hr /><a name="appendix-legal" id="appendix-legal"></a><h3>Appendix C: Legal Notices</h3><div class="indent"><h4>Copyright</h4>This XMPP Extension Protocol is copyright © 1999 – 2018 by the <a href="https://xmpp.org/">XMPP Standards Foundation</a> (XSF).<h4>Permissions</h4>Permission is hereby granted, free of charge, to any person obtaining a copy of this specification (the "Specification"), to make use of the Specification without restriction, including without limitation the rights to implement the Specification in a software program, deploy the Specification in a network service, and copy, modify, merge, publish, translate, distribute, sublicense, or sell copies of the Specification, and to permit persons to whom the Specification is furnished to do so, subject to the condition that the foregoing copyright notice and this permission notice shall be included in all copies or substantial portions of the Specification. Unless separate permission is granted, modified works that are redistributed shall not contain misleading information regarding the authors, title, number, or publisher of the Specification, and shall not claim endorsement of the modified works by the authors, any organization or project to which the authors belong, or the XMPP Standards Foundation.<h4>Disclaimer of Warranty</h4><span style="font-weight: bold">## NOTE WELL: This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE. ##</span><h4>Limitation of Liability</h4>In no event and under no legal theory, whether in tort (including negligence), contract, or otherwise, unless required by applicable law (such as deliberate and grossly negligent acts) or agreed to in writing, shall the XMPP Standards Foundation or any author of this Specification be liable for damages, including any direct, indirect, special, incidental, or consequential damages of any character arising from, out of, or in connection with the Specification or the implementation, deployment, or other use of the Specification (including but not limited to damages for loss of goodwill, work stoppage, computer failure or malfunction, or any and all other commercial damages or losses), even if the XMPP Standards Foundation or such author has been advised of the possibility of such damages.<h4>IPR Conformance</h4>This XMPP Extension Protocol has been contributed in full conformance with the XSF's Intellectual Property Rights Policy (a copy of which can be found at &lt;<a href="https://xmpp.org/about/xsf/ipr-policy">https://xmpp.org/about/xsf/ipr-policy</a>&gt; or obtained by writing to XMPP Standards Foundation, P.O. Box 787, Parker, CO 80134 USA).</div><hr /><a name="appendix-xmpp" id="appendix-xmpp"></a><h3>Appendix D: Relation to XMPP</h3><p class="indent">The Extensible Messaging and Presence Protocol (XMPP) is defined in the XMPP Core (RFC 6120) and XMPP IM (RFC 6121) specifications contributed by the XMPP Standards Foundation to the Internet Standards Process, which is managed by the Internet Engineering Task Force in accordance with RFC 2026. Any protocol defined in this document has been developed outside the Internet Standards Process and is to be understood as an extension to XMPP rather than as an evolution, development, or modification of XMPP itself.</p><hr /><a name="appendix-discuss" id="appendix-discuss"></a><h3>Appendix E: Discussion Venue</h3><p class="indent">The primary venue for discussion of XMPP Extension Protocols is the &lt;<a href="http://mail.jabber.org/mailman/listinfo/standards">standards@xmpp.org</a>&gt; discussion list.</p><p class="indent">Discussion on other xmpp.org discussion lists might also be appropriate; see &lt;<a href="http://xmpp.org/about/discuss.shtml">http://xmpp.org/about/discuss.shtml</a>&gt; for a complete list.</p><p class="indent">Errata can be sent to &lt;<a href="mailto:editor@xmpp.org">editor@xmpp.org</a>&gt;.</p><hr /><a name="appendix-conformance" id="appendix-conformance"></a><h3>Appendix F: Requirements Conformance</h3><p class="indent">The following requirements keywords as used in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".</p><hr /><a name="appendix-notes" id="appendix-notes"></a><h3>Appendix G: Notes</h3><div class="indent"><p><a name="nt-idm95" id="nt-idm95">1</a>. XEP-0374: OpenPGP for XMPP Instant Messaging &lt;<a href="https://xmpp.org/extensions/xep-0374.html">https://xmpp.org/extensions/xep-0374.html</a>&gt;.</p><p><a name="nt-idm100" id="nt-idm100">2</a>. XEP-0163: Personal Eventing Protocol &lt;<a href="https://xmpp.org/extensions/xep-0163.html">https://xmpp.org/extensions/xep-0163.html</a>&gt;.</p><p><a name="nt-idm105" id="nt-idm105">3</a>. XEP-0045: Multi-User Chat &lt;<a href="https://xmpp.org/extensions/xep-0045.html">https://xmpp.org/extensions/xep-0045.html</a>&gt;.</p><p><a name="nt-idm141" id="nt-idm141">4</a>. RFC 4648: The Base16, Base32, and Base64 Data Encodings &lt;<a href="http://tools.ietf.org/html/rfc4648">http://tools.ietf.org/html/rfc4648</a>&gt;.</p><p><a name="nt-idm146" id="nt-idm146">5</a>. RFC 4880: OpenPGP Message Format &lt;<a href="http://tools.ietf.org/html/rfc4880">http://tools.ietf.org/html/rfc4880</a>&gt;.</p><p><a name="nt-idm150" id="nt-idm150">6</a>. RFC 3629: UTF-8, a transformation format of ISO 10646 &lt;<a href="http://tools.ietf.org/html/rfc3629">http://tools.ietf.org/html/rfc3629</a>&gt;.</p><p><a name="nt-idm155" id="nt-idm155">7</a>. Jee Hea An, Yevgeniy Dodis, and
    Tal Rabin. 2002. On the Security of Joint Signature and
    Encryption. In Proceedings of the International Conference on the
    Theory and Applications of Cryptographic Techniques: Advances in
    Cryptology (EUROCRYPT '02), Lars R. Knudsen
    (Ed.). Springer-Verlag, London, UK, UK, 83-107. &lt;<a href="https://www.iacr.org/archive/eurocrypt2002/23320080/adr.pdf">https://www.iacr.org/archive/eurocrypt2002/23320080/adr.pdf</a>&gt;</p><p><a name="nt-idm159" id="nt-idm159">8</a>. XEP-0082: XMPP Date and Time Profiles &lt;<a href="https://xmpp.org/extensions/xep-0082.html">https://xmpp.org/extensions/xep-0082.html</a>&gt;.</p><p><a name="nt-idm203" id="nt-idm203">9</a>. This matches the representation
    used by GnuPG minus the SPACE separation.</p><p><a name="nt-idm219" id="nt-idm219">10</a>. XEP-0059: Result Set Management &lt;<a href="https://xmpp.org/extensions/xep-0059.html">https://xmpp.org/extensions/xep-0059.html</a>&gt;.</p><p><a name="nt-idm227" id="nt-idm227">11</a>. XEP-0115: Entity Capabilities &lt;<a href="https://xmpp.org/extensions/xep-0115.html">https://xmpp.org/extensions/xep-0115.html</a>&gt;.</p><p><a name="nt-idm234" id="nt-idm234">12</a>. XEP-0223: Best Practices for Persistent Storage of Private Data via Publish-Subscribe &lt;<a href="https://xmpp.org/extensions/xep-0223.html">https://xmpp.org/extensions/xep-0223.html</a>&gt;.</p><p><a name="nt-idm273" id="nt-idm273">13</a>. RFC 4086: Randomness Requirements for Security &lt;<a href="http://tools.ietf.org/html/rfc4086">http://tools.ietf.org/html/rfc4086</a>&gt;.</p><p><a name="nt-idm295" id="nt-idm295">14</a>. Koch,
    Werner, and Marcus Brinkman "STEED — Usable End-to-End
    Encryption", White Paper, g10 GmbH, 2011-10-17. &lt;<a href="http://g10code.com/steed.html">http://g10code.com/steed.html</a>&gt;</p><p><a name="nt-idm299" id="nt-idm299">15</a>. Whitten, Alma, and
    J. Doug Tygar. "Why Johnny Can't Encrypt: A Usability Evaluation
    of PGP 5.0." Usenix Security. Vol. 1999. 1999. &lt;<a href="https://www.cs.berkeley.edu/~tygar/papers/Why_Johnny_Cant_Encrypt/OReilly.pdf">https://www.cs.berkeley.edu/~tygar/papers/Why_Johnny_Cant_Encrypt/OReilly.pdf</a>&gt;</p><p><a name="nt-idm315" id="nt-idm315">16</a>. RFC 7622: Extensible Messaging and Presence Protocol (XMPP): Address Format &lt;<a href="http://tools.ietf.org/html/rfc7622">http://tools.ietf.org/html/rfc7622</a>&gt;.</p><p><a name="nt-idm325" id="nt-idm325">17</a>. XEP-0047: In-Band Bytestreams &lt;<a href="https://xmpp.org/extensions/xep-0047.html">https://xmpp.org/extensions/xep-0047.html</a>&gt;.</p><p><a name="nt-idm329" id="nt-idm329">18</a>. XEP-0261: Jingle In-Band Bytestreams Transport Method &lt;<a href="https://xmpp.org/extensions/xep-0261.html">https://xmpp.org/extensions/xep-0261.html</a>&gt;.</p><p><a name="nt-idm337" id="nt-idm337">19</a>. XEP-0027: Current Jabber OpenPGP Usage &lt;<a href="https://xmpp.org/extensions/xep-0027.html">https://xmpp.org/extensions/xep-0027.html</a>&gt;.</p><p><a name="nt-idm341" id="nt-idm341">20</a>. Full Replay attack prevention would require a
    counter based approach.</p><p><a name="nt-idm348" id="nt-idm348">21</a>. RFC 3156: MIME Security with OpenPGP &lt;<a href="http://tools.ietf.org/html/rfc3156">http://tools.ietf.org/html/rfc3156</a>&gt;.</p><p><a name="nt-idm365" id="nt-idm365">22</a>. The Internet Assigned Numbers Authority (IANA) is the central coordinator for the assignment of unique parameter values for Internet protocols, such as port numbers and URI schemes. For further information, see &lt;<a href="http://www.iana.org/">http://www.iana.org/</a>&gt;.</p><p><a name="nt-idm372" id="nt-idm372">23</a>. The XMPP Registrar maintains a list of reserved protocol namespaces as well as registries of parameters used in the context of XMPP extension protocols approved by the XMPP Standards Foundation. For further information, see &lt;<a href="https://xmpp.org/registrar/">https://xmpp.org/registrar/</a>&gt;.</p></div><hr /><a name="appendix-revs" id="appendix-revs"></a><h3>Appendix H: Revision History</h3><p>Note: Older versions of this specification might be available at <a href="http://xmpp.org/extensions/attic/">http://xmpp.org/extensions/attic/</a></p><div class="indent"><h4>Version 0.3.0 (2018-04-16)</h4><div class="indent">
      Split public keys into metadata and data nodes.
     (fs)
    </div><h4>Version 0.2.1 (2017-11-13)</h4><div class="indent">
      <ul class="" style="">
        <li class="" style="">Recommend setting the PubSub configuration field 'send_last_published_item' to 'on_sub'.</li>
        <li class="" style="">Only recommend persistent PubSub nodes.</li>
      </ul>
     (fs)
    </div><h4>Version 0.2 (2017-09-11)</h4><div class="indent">Defer due to lack of activity. (XEP Editor (jwi))
    </div><h4>Version 0.1.3 (2016-07-15)</h4><div class="indent"><p class="" style="">Update acknowledgements.</p> (fs (XEP Editor: ssw))
    </div><h4>Version 0.1.2 (2016-07-11)</h4><div class="indent"><p class="" style="">Minior editorial fixes.</p> (bjc (XEP Editor: ssw))
    </div><h4>Version 0.1.1 (2016-06-04)</h4><div class="indent"><p class="" style="">Minior editorial fixes.</p> (fs)
    </div><h4>Version 0.1 (2016-05-10)</h4><div class="indent"><p class="" style="">Initial published version approved by the XMPP Council.</p> (XEP Editor (ssw))
    </div><h4>Version 0.0.1 (2016-03-25)</h4><div class="indent"><p class="" style="">First draft.</p> (fs)
    </div></div><hr /><p>END</p></body></html>
